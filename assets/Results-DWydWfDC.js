const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/feature-path-coach-D61WCqvK.js","assets/vendor-react-Ah1pgjPn.js","assets/data-question-bank-F-s7nTqV.js","assets/vendor-supabase-BZ0N5lZN.js","assets/vendor-motion-DURBmaq0.js"])))=>i.map(i=>d[i]);
import{u as Qe,r as Ce,g as Xe,l as Ee,L as Te,a as Ze,i as ea,s as aa,b as sa,_ as ta}from"./index-B4nvK_id.js";import{r as u,j as e}from"./vendor-react-Ah1pgjPn.js";import{g as na,a as ia,r as O,b as ra,h as oa,u as ca,c as la}from"./feature-path-coach-D61WCqvK.js";import{v as da}from"./data-question-bank-F-s7nTqV.js";import{u as ma,m as p,A as H}from"./vendor-motion-DURBmaq0.js";import"./vendor-supabase-BZ0N5lZN.js";function L(a,t,n,c,o,f,l=""){return{title:a,description:t,potentialGain:n,difficulty:c,timeframe:o,icon:f,action:l}}function ua(a,t){const n=[],c=na(a),o=ia(a),f=a.firstOfficialLanguage==="french"?"french":"english",l=f==="french"||a.hasFrench==="yes";if(c<10){const r=Math.min(c+1,10),i=["listening","reading","writing","speaking"];let x="First official language";const b={};if(f==="french"){x="French (NCLC)",b.hasFrench="yes",b.frenchTestType="clb";for(const E of i){const k=`french_${E}`,$=parseInt(a[k],10)||0;b[k]=String(Math.max($,r))}}else{x=a.langTestType==="celpip"?"CELPIP":"IELTS";for(const E of i){const k=a.langTestType==="celpip"?`celpip_${E}`:`ielts_${E}`,$=a.langTestType==="celpip"?parseInt(a[k],10)||0:parseFloat(a[k])||0;a.langTestType==="celpip"?b[k]=Math.max($,r):b[k]=Math.max($,$+.5)}}const S=O(a,b).total-t.total;S>0&&n.push(L(`Improve ${x} Scores`,`Raising your weakest ${x} skill to CLB ${r} could add significant points. Focus on your lowest band.`,S,"Medium","3-5 months","language",`Current min CLB ${c} → target CLB ${r} = +${S} CRS`))}const d=["less_than_secondary","secondary","one_year_post","two_year_post","bachelors","two_or_more","masters","doctoral"],m=d.indexOf(a.education);if(m>=0&&m<d.length-1){const r=d[m+1],x=O(a,{education:r}).total-t.total;if(x>0){const b={secondary:"high school diploma",one_year_post:"1-year diploma",two_year_post:"2-year diploma",bachelors:"bachelor's degree",two_or_more:"two credentials",masters:"master's degree",doctoral:"doctoral degree"};n.push(L("Higher Education",`Completing a ${b[r]||"higher credential"} could boost your score.`,x,"Hard","1-4 years","education",`${a.education||"current level"} → ${r} = +${x} CRS`))}}const g=parseInt(a.canadianWorkExp)||0;if(g<5){const i=O(a,{canadianWorkExp:String(g+1)}).total-t.total;i>0&&n.push(L("Gain Canadian Work Experience","An additional year of Canadian work experience adds points across multiple categories including skill transferability.",i,"Hard","8-12 months","work",`${g} year(s) → ${g+1} year(s) = +${i} CRS`))}if(l)ra(a)>=7&&t.total<520&&t.total>=370&&n.push(L("Target French-Language Category Draw",`With your French NCLC 7+ scores, you qualify for French-language category draws where recent cutoffs are around 400 — your score of ${t.total} may already be competitive!`,0,"Easy","Immediate","french",`Current score ${t.total} already fits many French-category cutoffs`));else{const x=O(a,{hasFrench:"yes",french_listening:"7",french_reading:"7",french_writing:"7",french_speaking:"7"}).total-t.total;x>0&&n.push(L("Add French Test Results (TEF/TCF)",`Strong French skills (NCLC 7+) earn ${o>=5?"50":"25"} additional CRS points. Plus, French-language category draws have cutoffs around 400 — much lower than general draws (~520).`,x,"Hard","6-12 months","french",`Reach NCLC 7 in all 4 abilities = +${x} CRS`))}if(a.hasPNP!=="yes"&&n.push(L("Provincial Nominee Program","A PNP nomination adds 600 points, virtually guaranteeing an ITA. Explore programs in provinces like Ontario, BC, Alberta and Saskatchewan.",600,"Hard","2-8 months","province","PNP nomination = +600 CRS")),a.canadianEducation!=="yes"&&n.push(L("Study in Canada","A Canadian credential (1-2 year program) adds 15 points, or 30 points for a 3+ year program.",30,"Hard","12-36 months","study","Canadian credential can add +15 to +30 CRS")),a.hasSibling!=="yes"&&n.push(L("Sibling in Canada (If Applicable)","If you have a sibling who is a Canadian citizen or PR, this adds 15 points. Check if any siblings qualify.",15,"Easy","1-2 weeks","family","Eligible sibling relationship = +15 CRS")),oa(a)){const r=["listening","reading","writing","speaking"];let i=99;for(const x of r){const b=parseInt(a[`spouseLang_${x}`])||0;b<i&&(i=b)}if(i<9){const x=Math.min(i+1,9),b={};for(const E of r)b[`spouseLang_${E}`]=String(Math.max(parseInt(a[`spouseLang_${E}`])||0,x));const S=O(a,b).total-t.total;S>0&&n.push(L("Improve Spouse's Language Scores",`Your spouse's language improvement to CLB ${x} could add points.`,S,"Medium","3-5 months","language",`Spouse min CLB ${i} → ${x} = +${S} CRS`))}}return n.sort((r,i)=>i.potentialGain-r.potentialGain),n}function ha(a){const t=a.total;return t>=500?{label:"Very Strong",months:"1-3",description:"You are very likely to receive an ITA in the next few draws."}:t>=470?{label:"Strong",months:"3-6",description:"Your score is competitive. An ITA is likely within a few months."}:t>=440?{label:"Moderate",months:"6-12",description:"Your score is near recent cutoffs. Category-based draws may help."}:t>=400?{label:"Below Average",months:"12-18",description:"You may need to improve your profile or target a category-based draw."}:{label:"Needs Improvement",months:"18+",description:"Significant profile improvements are recommended before applying."}}const pa=[{id:"on",name:"Ontario",abbr:"ON",streams:["Human Capital Priorities","Skilled Trades","French-Speaking"],demandSectors:["stem","healthcare","trade"],minCLB:7,minEducation:"bachelors",minWorkYears:1,notes:"Largest province. Strong demand for tech, healthcare, and skilled trades. Ontario often sends NOIs to Express Entry candidates with CRS 400+."},{id:"bc",name:"British Columbia",abbr:"BC",streams:["Skills Immigration","Express Entry BC","Tech"],demandSectors:["stem","healthcare","trade"],minCLB:5,minEducation:"two_year_post",minWorkYears:1,notes:"Tech hub (Vancouver). BC PNP Tech targets 29 in-demand occupations including software, data, and engineering roles."},{id:"ab",name:"Alberta",abbr:"AB",streams:["Alberta Advantage Immigration","Express Entry Stream"],demandSectors:["trade","healthcare","stem","transport"],minCLB:5,minEducation:"secondary",minWorkYears:1,notes:"Strong energy/oil sector. Growing tech scene in Calgary and Edmonton. Lower cost of living than ON/BC."},{id:"sk",name:"Saskatchewan",abbr:"SK",streams:["International Skilled Worker","Express Entry"],demandSectors:["agriculture","healthcare","trade","transport"],minCLB:4,minEducation:"secondary",minWorkYears:1,notes:"In-Demand Occupations list is broad. One of the easiest PNPs to qualify for. Agriculture and mining are key industries."},{id:"mb",name:"Manitoba",abbr:"MB",streams:["Skilled Workers Overseas","Skilled Workers in Manitoba"],demandSectors:["healthcare","agriculture","trade","transport"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Welcoming to newcomers. Strong need for healthcare workers and tradespeople. Lower CRS requirements than federal draws."},{id:"ns",name:"Nova Scotia",abbr:"NS",streams:["Labour Market Priorities","Skilled Worker","Physician"],demandSectors:["healthcare","trade","stem"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Part of Atlantic Immigration Program. Growing tech sector in Halifax. Healthcare workers are highly sought after."},{id:"nb",name:"New Brunswick",abbr:"NB",streams:["Express Entry Labour Market","Skilled Workers with Employer Support"],demandSectors:["healthcare","trade","agriculture"],minCLB:5,minEducation:"secondary",minWorkYears:1,notes:"Bilingual province (English/French). Part of Atlantic Immigration Program. Francophone candidates get priority."},{id:"pe",name:"Prince Edward Island",abbr:"PE",streams:["Express Entry","Labour Impact"],demandSectors:["agriculture","healthcare","trade"],minCLB:5,minEducation:"two_year_post",minWorkYears:2,notes:"Small province with lower competition. Agriculture and tourism are key industries."},{id:"nl",name:"Newfoundland & Labrador",abbr:"NL",streams:["Express Entry","Skilled Worker","Priority Skills"],demandSectors:["healthcare","trade","stem"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Part of Atlantic Immigration Program. Growing need for healthcare and tech workers. Oil and gas sector."},{id:"yt",name:"Yukon",abbr:"YT",streams:["Yukon Express Entry","Skilled Worker"],demandSectors:["trade","healthcare","transport"],minCLB:4,minEducation:"secondary",minWorkYears:1,notes:"Territory with small population. Job offer typically required. Good for tradespeople and healthcare workers."}],me={less_than_secondary:0,secondary:1,one_year_post:2,two_year_post:3,bachelors:4,two_or_more:5,masters:6,doctoral:7};function fa(a,t){return(me[a]||0)>=(me[t]||0)}function ga(a){const t=xa(a),n=a.education||"secondary",c=Math.max(parseInt(a.canadianWorkExp)||0,parseInt(a.foreignWorkExp)||0),o=a.occupationCategory||"other",f=a.hasFrench==="yes";return pa.map(l=>{let d=0;const m=100;t>=l.minCLB&&(d+=20,t>=l.minCLB+2&&(d+=10)),fa(n,l.minEducation)&&(d+=15,(me[n]||0)>=4&&(d+=5)),c>=l.minWorkYears&&(d+=15,c>=3&&(d+=5)),l.demandSectors.includes(o)&&(d+=25),f&&(l.id==="nb"||l.id==="on")&&(d+=5);const g=Math.min(Math.round(d/m*100),100);return{...l,matchScore:g}}).sort((l,d)=>d.matchScore-l.matchScore)}function xa(a){if(a.langTestType==="celpip"){const n=["listening","reading","writing","speaking"].map(c=>parseInt(a[`celpip_${c}`])||0);return Math.min(...n)}if(a.langTestType==="ielts"){const n=["listening","reading","writing","speaking"].map(c=>{const o=parseFloat(a[`ielts_${c}`])||0;return o>=8?10:o>=7?9:o>=6.5?8:o>=6?7:o>=5.5?6:o>=5?5:o>=4?4:0});return Math.min(...n)}return 0}const Be="crs-saved-profiles-v1";function Ie(){try{const a=localStorage.getItem(Be);if(!a)return{};const t=JSON.parse(a);return t&&typeof t=="object"?t:{}}catch{return{}}}function va(a){try{localStorage.setItem(Be,JSON.stringify(a))}catch{}}function ba(){const a=Math.random().toString(36).slice(2,8);return`prf_${Date.now().toString(36)}_${a}`}function ya(){return`${Math.random().toString(36).slice(2,10)}${Math.random().toString(36).slice(2,10)}`}function V(){const a=Ie();return Object.values(a).sort((t,n)=>String(n.updatedAt).localeCompare(String(t.updatedAt)))}function ja({id:a,name:t="",answers:n={},score:c=0,email:o="",alertOptIn:f=!1,alertToken:l=null}){const d=Ie(),m=a||ba(),g=new Date().toISOString(),r=d[m],i={id:m,name:t||r?.name||`Profile ${m.slice(-4)}`,answers:n,score:c,email:o,alertOptIn:!!f,alertToken:f?l||r?.alertToken||ya():null,createdAt:r?.createdAt||g,updatedAt:g};return d[m]=i,va(d),i}const Na=u.lazy(()=>ta(()=>import("./feature-path-coach-D61WCqvK.js").then(a=>a.P),__vite__mapDeps([0,1,2,3,4]))),Pe={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.08}}},v={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{type:"spring",stiffness:100,damping:18}}};function _e(a){return a==="supabase"?"Live sync":"Local fallback"}function Le(a){return a==="supabase"?"draw-source-live":"draw-source-fallback"}function Fe(a){if(!a)return null;const t=new Date(a);return Number.isNaN(t.getTime())?null:t}function Ae(a){const t=Fe(a);if(!t)return{tier:"unknown",label:"Freshness unknown",dateLabel:a||"—"};const c=Math.max(new Date().getTime()-t.getTime(),0),o=Math.floor(c/(1e3*60*60*24)),f=o===0?"Updated today":o===1?"Updated 1 day ago":`Updated ${o} days ago`;return o<=2?{tier:"fresh",label:f,dateLabel:t.toLocaleDateString()}:o<=14?{tier:"recent",label:f,dateLabel:t.toLocaleDateString()}:{tier:"stale",label:f,dateLabel:t.toLocaleDateString()}}function $e(a={}){return[{label:"Age",value:a.age||"—"},{label:"Education",value:a.education||"—"},{label:"Language test",value:a.langTestType||"—"},{label:"Canadian work",value:a.canadianWorkExp||"0"},{label:"Program",value:a.pathway||"—"}]}function Sa({value:a,duration:t=1.2,reduceMotion:n=!1}){const[c,o]=u.useState(a);return u.useEffect(()=>{if(n)return;const f=a,l=performance.now(),d=m=>{const g=(m-l)/(t*1e3);if(g>=1){o(f);return}const r=1-Math.pow(1-g,3);o(Math.round(f*r)),requestAnimationFrame(d)};requestAnimationFrame(d)},[a,t,n]),n?e.jsx(e.Fragment,{children:a}):e.jsx(e.Fragment,{children:c})}function ka({score:a,statusColor:t,reduceMotion:n=!1}){const o=2*Math.PI*54,f=Math.min(a/1200,1);return e.jsxs("div",{className:"score-gauge","aria-label":`CRS Score: ${a} out of 1200`,children:[e.jsxs("svg",{viewBox:"0 0 120 120",width:"180",height:"180",children:[e.jsx("circle",{cx:"60",cy:"60",r:54,fill:"none",stroke:"var(--surface-2)",strokeWidth:"8"}),e.jsx(p.circle,{cx:"60",cy:"60",r:54,fill:"none",stroke:t,strokeWidth:"8",strokeLinecap:"round",transform:"rotate(-90 60 60)",strokeDasharray:o,initial:n?!1:{strokeDashoffset:o},animate:{strokeDashoffset:o-f*o},transition:n?{duration:0}:{duration:1.4,ease:[.22,1,.36,1]}})]}),e.jsxs("div",{className:"gauge-text",children:[e.jsx("div",{className:"gauge-number","aria-live":"polite",children:e.jsx(Sa,{value:a,reduceMotion:n})}),e.jsx("div",{className:"gauge-max",children:"/ 1,200"})]})]})}function z({id:a,label:t,open:n,onToggle:c}){return e.jsx("h3",{className:"section-toggle-heading",children:e.jsxs("button",{type:"button",className:"section-toggle",onClick:c,"aria-expanded":n,"aria-controls":a,children:[e.jsx("span",{children:t}),e.jsx("span",{className:"toggle-arrow","aria-hidden":"true",children:"▾"})]})})}function wa({icon:a,label:t,value:n,max:c,note:o}){const f=Math.round(n/c*100);return e.jsxs(p.div,{className:"bd-item",variants:v,children:[e.jsx("span",{className:"bd-icon",children:a}),e.jsxs("div",{className:"bd-info",children:[e.jsxs("div",{className:"bd-top",children:[e.jsxs("span",{className:"bd-label",children:[t,o&&e.jsxs("small",{className:"bd-note",children:[" (",o,")"]})]}),e.jsxs("span",{className:"bd-pts",children:[n," ",e.jsxs("small",{children:["/ ",c]})]})]}),e.jsx("div",{className:"bd-bar-bg",children:e.jsx(p.div,{className:"bd-bar-fill",initial:{width:0},animate:{width:`${f}%`},transition:{duration:.8,delay:.3,ease:"easeOut"}})})]})]})}function le({draw:a,userScore:t}){const n=t>=a.score;return e.jsxs("div",{className:`draw-row ${n?"draw-above":"draw-below"}`,children:[e.jsx("span",{className:"draw-date",children:a.date}),e.jsx("span",{className:"draw-program",children:a.program}),e.jsx("span",{className:"draw-score",children:a.score})]})}const Ca=[{value:"secondary",label:"High School"},{value:"one_year_post",label:"1-Year Diploma"},{value:"two_year_post",label:"2-Year Diploma"},{value:"bachelors",label:"Bachelor's"},{value:"two_or_more",label:"2+ Credentials"},{value:"masters",label:"Master's"},{value:"doctoral",label:"PhD"}];function de(a,t,n){return{id:a,label:t,age:n.age||"",education:n.education||"",canadianWorkExp:n.canadianWorkExp||"0",minClb:""}}function Ea(a){return{5:5,6:5.5,7:6,8:6.5,9:7,10:7.5}[a]||0}function Pa(a,t){const n={};if(t.age&&t.age!==a.age&&(n.age=t.age),t.education&&t.education!==a.education&&(n.education=t.education),t.canadianWorkExp&&t.canadianWorkExp!==a.canadianWorkExp&&(n.canadianWorkExp=t.canadianWorkExp),t.minClb){const c=parseInt(t.minClb,10),o=["listening","reading","writing","speaking"];if(a.langTestType==="celpip")for(const f of o){const l=`celpip_${f}`;n[l]=String(Math.max(parseInt(a[l],10)||0,c))}else{const f=Ea(c);for(const l of o){const d=`ielts_${l}`;n[d]=String(Math.max(parseFloat(a[d])||0,f))}}}return Object.keys(n).length===0?null:O(a,n)}function _a({answers:a,originalScore:t,t:n}){const[c,o]=u.useState(()=>[de("a","Scenario A",a),de("b","Scenario B",a)]),f=()=>{c.length>=3||o(m=>[...m,de("c","Scenario C",a)])},l=m=>{c.length<=2||o(g=>g.filter(r=>r.id!==m))},d=(m,g)=>{o(r=>r.map(i=>i.id===m?{...i,...g}:i))};return e.jsxs("div",{className:"scenario-panel",children:[e.jsx("div",{className:"scenario-grid",children:c.map(m=>{const g=Pa(a,m),r=g?g.total-t:0;return e.jsxs("div",{className:"scenario-card",children:[e.jsxs("div",{className:"scenario-head",children:[e.jsx("strong",{children:m.label}),m.id==="c"&&e.jsx("button",{type:"button",className:"scenario-remove",onClick:()=>l(m.id),children:"Remove"})]}),e.jsxs("div",{className:"wi-grid",children:[e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Age"}),e.jsxs("select",{value:m.age,onChange:i=>d(m.id,{age:i.target.value}),children:[e.jsx("option",{value:"",children:"Current"}),Array.from({length:30},(i,x)=>x+18).map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Education"}),e.jsxs("select",{value:m.education,onChange:i=>d(m.id,{education:i.target.value}),children:[e.jsx("option",{value:"",children:"Current"}),Ca.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))]})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Canadian Work (yrs)"}),e.jsx("select",{value:m.canadianWorkExp,onChange:i=>d(m.id,{canadianWorkExp:i.target.value}),children:[0,1,2,3,4,5].map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Min Language CLB"}),e.jsxs("select",{value:m.minClb,onChange:i=>d(m.id,{minClb:i.target.value}),children:[e.jsx("option",{value:"",children:"Current"}),[5,6,7,8,9,10].map(i=>e.jsxs("option",{value:i,children:["CLB ",i,"+"]},i))]})]})]}),g&&e.jsx(p.div,{className:"wi-result",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"wi-scores",children:[e.jsxs("div",{className:"wi-score-block",children:[e.jsx("small",{children:n("results.original")}),e.jsx("strong",{children:t})]}),e.jsx("span",{className:"wi-arrow",children:"→"}),e.jsxs("div",{className:"wi-score-block projected",children:[e.jsx("small",{children:n("results.projected")}),e.jsx("strong",{children:g.total})]}),e.jsxs("span",{className:`wi-delta ${r>0?"pos":r<0?"neg":""}`,children:[r>0?"+":"",r," pts"]})]})})]},m.id)})}),c.length<3&&e.jsx("button",{type:"button",className:"btn-toggle scenario-add-btn",onClick:f,children:"Add Scenario C ▼"})]})}function La(){return e.jsx(p.div,{className:"loading-screen",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,scale:.95,transition:{duration:.3}},children:e.jsx(Te,{})})}function Aa(a){const t=u.useRef(null);return u.useEffect(()=>{if(!a)return;const n=t.current;if(!n)return;const c=n.getContext("2d");n.width=window.innerWidth,n.height=window.innerHeight;const o=["#22c55e","#4CC9F0","#7C3AED","#f59e0b","#ec4899","#3A0CA3"],f=Array.from({length:120},()=>({x:Math.random()*n.width,y:Math.random()*n.height-n.height,w:Math.random()*8+4,h:Math.random()*6+2,color:o[Math.floor(Math.random()*o.length)],vx:(Math.random()-.5)*4,vy:Math.random()*3+2,rot:Math.random()*360,rv:(Math.random()-.5)*8}));let l;const d=()=>{c.clearRect(0,0,n.width,n.height);let g=!1;for(const r of f)r.x+=r.vx,r.y+=r.vy,r.rot+=r.rv,r.vy+=.05,r.y<n.height+20&&(g=!0),c.save(),c.translate(r.x,r.y),c.rotate(r.rot*Math.PI/180),c.fillStyle=r.color,c.fillRect(-r.w/2,-r.h/2,r.w,r.h),c.restore();g&&(l=requestAnimationFrame(d))};l=requestAnimationFrame(d);const m=setTimeout(()=>{cancelAnimationFrame(l),c.clearRect(0,0,n.width,n.height)},4e3);return()=>{cancelAnimationFrame(l),clearTimeout(m)}},[a]),t}function Ra({answers:a,onRestart:t,drawData:n,drawSource:c="local-fallback",categoryInfo:o,motionIntensity:f="full"}){const{t:l}=Qe(),d=ma()||f==="off",{user:m,isAuthenticated:g}=ca(),r=u.useMemo(()=>Ce(),[]),i=n||Ze(),x=u.useMemo(()=>Array.isArray(o)&&o.length>0?o:Xe(),[o]),[b,J]=u.useState(!0),[S,E]=u.useState(!1),[k,$]=u.useState(!1),[K,Re]=u.useState(!1),[Q,We]=u.useState(!1),[X,De]=u.useState(!1),[ue,he]=u.useState(()=>V()),[F,pe]=u.useState("__current__"),[Y,fe]=u.useState(()=>V()[0]?.id||"__current__"),[Z,Oe]=u.useState(()=>r.profileName||""),[ge,Ye]=u.useState(()=>r.contactEmail||""),[R,Ue]=u.useState(()=>!!r.defaultDrawAlerts),[xe,W]=u.useState(""),[ve,be]=u.useState(!1),[ee,U]=u.useState([]),[ae,D]=u.useState("idle"),ye=r.autoSyncProfiles!==!1;u.useEffect(()=>{const s=setTimeout(()=>J(!1),500);return()=>clearTimeout(s)},[]),u.useEffect(()=>{he(V())},[]);const M=u.useMemo(()=>{if(a.knowsScore==="yes"){const s=parseInt(a.scoreRange,10)||400;return{total:s,breakdown:{coreHumanCapital:s,spouseFactors:0,skillTransferability:0,additionalPoints:0},details:{age:0,education:0,firstLanguage:0,secondLanguage:0,canadianWork:0,foreignWork:0,spouseTotal:0,skillTotal:0,additionalTotal:0}}}return la(a)},[a]),w=a.knowsScore!=="yes",y=M.total,T=i.averageCutoff,B=y-T,se=ea(),je=u.useMemo(()=>Ae(i.lastUpdated),[i.lastUpdated]),te=u.useMemo(()=>{const s=x.map(h=>h?.updatedAt).filter(Boolean).map(h=>Fe(h)).filter(Boolean).sort((h,N)=>N.getTime()-h.getTime())[0];return Ae(s?s.toISOString():i.lastUpdated)},[x,i.lastUpdated]),Ne=u.useMemo(()=>x.some(s=>s?.source==="supabase")?"Live sync":"Local fallback",[x]),C=u.useMemo(()=>[{id:"__current__",name:"Current profile",score:y,answers:a},...ue.map(s=>({id:s.id,name:s.name||s.id,score:Number(s.score)||0,answers:s.answers||{}}))],[a,ue,y]),P=u.useMemo(()=>C.find(s=>s.id===F),[F,C]),_=u.useMemo(()=>C.find(s=>s.id===Y),[Y,C]),ne=!!P&&!!_&&P.id!==_.id,q=ne?_.score-P.score:0,qe=u.useMemo(()=>$e(P?.answers||a),[a,P?.answers]),Ge=u.useMemo(()=>$e(_?.answers||a),[a,_?.answers]);u.useEffect(()=>{const s=C.some(N=>N.id===F),h=C.some(N=>N.id===Y);if(s||pe("__current__"),!h){const N=C.find(G=>G.id!==F)?.id||"__current__";fe(N)}},[F,Y,C]),u.useEffect(()=>{if(!g||!se||!m?.id){U([]),D("idle");return}let s=!0;return D("loading"),Ee(m.id).then(h=>{s&&(h.status==="ok"?(U(h.data||[]),D("ready")):(U([]),D("empty")))}).catch(()=>{s&&D("error")}),()=>{s=!1}},[se,g,m?.id]);const I=B>=20?{cls:"above",marker:"+",title:"Great News!",desc:`Your score is ${B} points above the recent cut-off (${T}). You have a strong chance of receiving an Invitation to Apply.`,color:"#22c55e"}:B>=-10?{cls:"close",marker:"~",title:"Almost There!",desc:`You're just ${Math.abs(B)} points ${B>=0?"above":"below"} the recent cut-off (${T}). A few small improvements could make the difference.`,color:"#f59e0b"}:{cls:"below",marker:"—",title:"Room to Improve",desc:`You're ${Math.abs(B)} points below the recent cut-off (${T}). Don't worry — see the suggestions below to boost your score.`,color:"#ef4444"},ie=u.useMemo(()=>ua(a,M),[a,M]),re=u.useMemo(()=>ha(M),[M]),j=M.details,He=u.useMemo(()=>{const s=[{icon:"A",label:"Age",value:j.age,max:110},{icon:"E",label:"Education",value:j.education,max:150},{icon:"L",label:"English Language",value:j.firstLanguage,max:136},{icon:"W",label:"Canadian Work",value:j.canadianWork,max:80}];return j.secondLanguage>0&&s.splice(3,0,{icon:"F",label:"French",value:j.secondLanguage,max:24}),j.foreignWork>0?s.push({icon:"S",label:l("results.foreignWork"),value:j.skillTotal,max:100,note:"via skill transferability"}):s.push({icon:"S",label:"Skill Bonus",value:j.skillTotal,max:100}),j.spouseTotal>0&&s.push({icon:"P",label:"Spouse",value:j.spouseTotal,max:40}),j.additionalTotal>0&&s.push({icon:"+",label:"Bonus Points",value:j.additionalTotal,max:600}),s},[j,l]),Ve=ie.slice(0,3),oe=ie.slice(3),ce=da[a.pathway],Se=u.useMemo(()=>w?ga(a):[],[a,w]),ke=!d&&!b&&B>=20,ze=Aa(ke),Je=async()=>{const s=ge.trim()||m?.email||"";if(R&&!s){W("Add an email to enable draw alerts (or sign in).");return}if(s&&!/^\S+@\S+\.\S+$/.test(s)){W("Please enter a valid email address.");return}const h=ja({name:Z.trim(),answers:a,score:y,email:s,alertOptIn:!!R&&!!s});he(V());const N=Ce();aa({...N,profileName:Z.trim(),contactEmail:s,defaultDrawAlerts:!!R}),be(!0);try{if(ye&&(s||R))if((await sa(h,{userId:m?.id||null})).status==="ok"){if(g&&m?.id){const we=await Ee(m.id);we.status==="ok"&&(U(we.data||[]),D("ready"))}W(R?"Profile saved, synced, and draw alerts subscribed.":"Profile saved and synced with your account.")}else W("Profile saved locally. Configure Supabase env vars to enable cloud sync/alerts.");else W(ye?"Profile saved locally.":"Profile saved locally. Auto-sync is off in account settings.")}catch(G){W(`Profile saved locally, but cloud sync failed: ${G.message}`)}finally{be(!1)}},Ke=()=>window.print(),A=s=>{const h=document.getElementById(s);h&&h.scrollIntoView({behavior:"smooth",block:"start"})};return b?e.jsx(La,{}):e.jsxs(p.div,{className:"results",variants:Pe,initial:"hidden",animate:"show",exit:{opacity:0,transition:{duration:.2}},children:[ke&&e.jsx("canvas",{ref:ze,className:"confetti-canvas"}),e.jsx(p.div,{className:"score-hero",variants:v,children:e.jsx(ka,{score:y,statusColor:I.color,reduceMotion:d})}),e.jsx(p.div,{className:"result-actions",variants:v,children:e.jsx("button",{type:"button",className:"action-btn",onClick:Ke,"aria-label":"Download PDF",children:l("results.pdf")})}),e.jsxs(p.div,{className:"card quick-nav-card",variants:v,children:[e.jsx("h3",{children:"Quick navigation"}),e.jsxs("div",{className:"quick-nav-grid",children:[e.jsx("button",{type:"button",className:"action-btn",onClick:()=>A("section-save"),children:"Save profile"}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>A("section-profile-compare"),children:"Profile compare"}),w&&e.jsx("button",{type:"button",className:"action-btn",onClick:()=>A("section-breakdown"),children:"Score breakdown"}),w&&e.jsx("button",{type:"button",className:"action-btn",onClick:()=>A("section-improve"),children:"Improve score"}),w&&e.jsx("button",{type:"button",className:"action-btn",onClick:()=>A("section-coach"),children:"Expert strategy"}),w&&e.jsx("button",{type:"button",className:"action-btn",onClick:()=>A("section-category"),children:"Category draws"}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>A("section-timeline"),children:"Timeline"}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>A("section-draws"),children:"Recent draws"})]})]}),e.jsxs(p.div,{className:`card status-card ${I.cls}-card`,variants:v,children:[e.jsxs("div",{className:"status-header",children:[e.jsx("span",{className:`status-marker ${I.cls}`,children:I.marker})," ",e.jsx("strong",{children:I.title})]}),e.jsx("p",{className:"status-desc",children:I.desc}),e.jsxs("div",{className:`draw-source-pill ${Le(c)}`,children:["Draw data source: ",_e(c)," · Updated ",i.lastUpdated||"—",e.jsx("span",{className:`freshness-pill freshness-${je.tier}`,children:je.label})]}),e.jsxs("div",{className:"cutoff-compare",children:[e.jsx(Me,{label:"Your Score",value:y,max:Math.max(y,T,600),color:"var(--primary)"}),e.jsx(Me,{label:"Cut-off",value:T,max:Math.max(y,T,600),color:"var(--surface-3)"})]})]}),e.jsxs(p.div,{className:"card save-profile-card",variants:v,id:"section-save",children:[e.jsx("h3",{children:"Save your profile"}),e.jsx("p",{className:"cat-intro",children:"Save this result and optionally subscribe to draw alerts."}),g?e.jsxs("p",{className:"save-note",children:["Signed in as ",m.email,". Saves are synced across your devices."]}):e.jsx("p",{className:"save-note",children:"Tip: sign in to sync profiles and score tracking across devices."}),e.jsxs("div",{className:"save-grid",children:[e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Profile name (optional)"}),e.jsx("input",{type:"text",value:Z,onChange:s=>Oe(s.target.value),placeholder:"e.g., Feb 2026 Profile"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Email (optional)"}),e.jsx("input",{type:"email",value:ge,onChange:s=>Ye(s.target.value),placeholder:"you@example.com"})]})]}),e.jsxs("label",{className:"save-alert-row",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:s=>Ue(s.target.checked)}),e.jsx("span",{children:"Notify me by email when my score is at/above the latest cutoff"})]}),!se&&e.jsx("p",{className:"save-note",children:"Cloud alerts need Supabase env vars (`VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`)."}),e.jsx("div",{className:"save-actions",children:e.jsx("button",{type:"button",className:"action-btn",onClick:Je,disabled:ve,children:ve?"Saving…":"Save Profile"})}),xe&&e.jsx("p",{className:"save-status",children:xe}),g&&e.jsxs("div",{className:"save-synced-list",children:[e.jsx("h4",{children:"Synced profiles"}),ae==="loading"&&e.jsx("p",{className:"save-note",children:"Loading your synced profiles..."}),ae==="error"&&e.jsx("p",{className:"save-note",children:"Could not load synced profiles right now."}),ae!=="loading"&&ee.length===0&&e.jsx("p",{className:"save-note",children:"No synced profiles yet. Save your current result to start tracking."}),ee.length>0&&e.jsx("ul",{className:"save-synced-items",children:ee.slice(0,5).map(s=>e.jsxs("li",{children:[e.jsx("span",{children:s.name||s.id}),e.jsx("strong",{children:s.score})]},s.id))})]})]}),e.jsxs(p.div,{className:"card profile-compare-card",variants:v,id:"section-profile-compare",children:[e.jsx(z,{id:"profile-compare-panel",label:"Profile Compare Mode",open:X,onToggle:()=>De(!X)}),e.jsx(H,{initial:!1,children:X&&e.jsxs(p.div,{id:"profile-compare-panel",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:d?{duration:0}:{duration:.2},children:[e.jsx("p",{className:"cat-intro",children:"Compare your current answers with any locally saved profile to spot score gaps quickly."}),e.jsxs("div",{className:"profile-compare-controls wi-grid",children:[e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Profile A"}),e.jsx("select",{value:F,onChange:s=>pe(s.target.value),children:C.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.score,")"]},`a-${s.id}`))})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Profile B"}),e.jsx("select",{value:Y,onChange:s=>fe(s.target.value),children:C.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.score,")"]},`b-${s.id}`))})]})]}),!ne&&e.jsx("p",{className:"path-empty-text",children:"Choose two different profiles to compare."}),ne&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"profile-compare-delta",children:[e.jsx("strong",{children:_.name})," vs ",e.jsx("strong",{children:P.name}),":",e.jsxs("span",{className:q>0?"delta-up":q<0?"delta-down":"",children:[" ",q>0?"+":"",q," points"]})]}),e.jsxs("div",{className:"profile-compare-grid",children:[e.jsxs("div",{className:"profile-compare-column",children:[e.jsx("h4",{children:P.name}),e.jsx("strong",{className:"profile-compare-score",children:P.score}),e.jsx("ul",{children:qe.map(s=>e.jsxs("li",{children:[e.jsx("span",{children:s.label}),e.jsx("strong",{children:s.value})]},`${P.id}-${s.label}`))})]}),e.jsxs("div",{className:"profile-compare-column",children:[e.jsx("h4",{children:_.name}),e.jsx("strong",{className:"profile-compare-score",children:_.score}),e.jsx("ul",{children:Ge.map(s=>e.jsxs("li",{children:[e.jsx("span",{children:s.label}),e.jsx("strong",{children:s.value})]},`${_.id}-${s.label}`))})]})]})]})]})})]}),w&&e.jsxs(p.div,{className:"card",variants:v,id:"section-breakdown",children:[e.jsx("h3",{children:l("results.breakdown")}),e.jsx(p.div,{className:"breakdown-grid",variants:Pe,initial:"hidden",animate:"show",children:He.map(s=>e.jsx(wa,{...s},s.label))}),e.jsxs("div",{className:"bd-total",children:[e.jsx("span",{children:"Total CRS Score"}),e.jsx("span",{className:"bd-total-num",children:y})]})]}),w&&e.jsxs(p.div,{className:"card whatif-card",variants:v,children:[e.jsx(z,{id:"scenario-compare-panel",label:"Scenario Compare (A vs B)",open:K,onToggle:()=>Re(!K)}),e.jsx(H,{initial:!1,children:K&&e.jsxs(p.div,{id:"scenario-compare-panel",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:d?{duration:0}:{duration:.2},children:[e.jsx("p",{className:"cat-intro",children:l("results.whatifDesc")}),e.jsx(_a,{answers:a,originalScore:y,t:l})]})})]}),ie.length>0&&e.jsxs(p.div,{className:"card",variants:v,id:"section-improve",children:[e.jsx("h3",{children:l("results.improve")}),Ve.map((s,h)=>e.jsxs(p.div,{className:"action-card",variants:v,children:[e.jsx("div",{className:"action-rank",children:h+1}),e.jsxs("div",{className:"action-body",children:[e.jsxs("div",{className:"action-title",children:[s.title,s.potentialGain>0&&e.jsxs("span",{className:"action-badge",children:["+",s.potentialGain," pts"]})]}),e.jsx("div",{className:"action-desc",children:s.description}),s.action&&e.jsx("div",{className:"action-specific",children:s.action}),e.jsxs("div",{className:"action-meta",children:[e.jsx("span",{className:"action-time",children:s.timeframe}),e.jsx("span",{className:`action-diff diff-${s.difficulty.toLowerCase()}`,children:s.difficulty})]})]})]},h)),oe.length>0&&e.jsxs(e.Fragment,{children:[S&&oe.map((s,h)=>e.jsxs(p.div,{className:"action-card",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"action-rank",children:h+4}),e.jsxs("div",{className:"action-body",children:[e.jsxs("div",{className:"action-title",children:[s.title,s.potentialGain>0&&e.jsxs("span",{className:"action-badge",children:["+",s.potentialGain," pts"]})]}),e.jsx("div",{className:"action-desc",children:s.description}),s.action&&e.jsx("div",{className:"action-specific",children:s.action}),e.jsxs("div",{className:"action-meta",children:[e.jsx("span",{className:"action-time",children:s.timeframe}),e.jsx("span",{className:`action-diff diff-${s.difficulty.toLowerCase()}`,children:s.difficulty})]})]})]},h+3)),e.jsx("button",{type:"button",className:"btn-toggle",onClick:()=>E(!S),children:S?"Show fewer ▲":`Show ${oe.length} more suggestions ▼`})]})]}),w&&e.jsx("div",{id:"section-coach",children:e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(Te,{})}),children:e.jsx(Na,{answers:a,result:M,averageCutoff:i.averageCutoff,categoryInfo:x,motionIntensity:f})})}),w&&e.jsxs(p.div,{className:"card",variants:v,id:"section-category",children:[e.jsx("h3",{children:l("results.category")}),e.jsx("p",{className:"cat-intro",children:l("results.catIntro")}),e.jsxs("div",{className:"category-meta-row",children:[e.jsxs("span",{className:`draw-source-pill ${Ne==="Live sync"?"draw-source-live":"draw-source-fallback"}`,children:["Category config: ",Ne]}),e.jsxs("span",{className:`freshness-pill freshness-${te.tier}`,children:[te.label," · ",te.dateLabel]})]}),e.jsx("div",{className:"cat-grid",children:x.map(s=>{const h=s.check(a),N=h&&y>=s.recentCutoff;return e.jsxs(p.div,{className:`cat-card ${h?N?"cat-above":"cat-eligible":"cat-na"}`,variants:v,children:[e.jsxs("div",{className:"cat-header",children:[e.jsx("span",{className:"cat-icon",children:s.icon}),e.jsxs("div",{children:[e.jsx("strong",{className:"cat-name",children:s.name}),h&&e.jsx("span",{className:`cat-badge ${N?"badge-above":"badge-eligible"}`,children:N?"Above Cutoff":"Eligible"}),!h&&e.jsx("span",{className:"cat-badge badge-na",children:"Not Eligible"})]})]}),e.jsx("p",{className:"cat-desc",children:s.description}),e.jsxs("div",{className:"cat-cutoff",children:[e.jsxs("span",{children:["Recent cutoff: ",e.jsx("strong",{children:s.recentCutoff})]}),e.jsxs("span",{className:"cat-range",children:["Range: ",s.cutoffRange]})]}),!h&&e.jsx("p",{className:"cat-req",children:s.eligibility})]},s.id)})})]}),w&&Se.length>0&&e.jsxs(p.div,{className:"card",variants:v,children:[e.jsx(z,{id:"province-recommender-panel",label:"Province Recommender",open:Q,onToggle:()=>We(!Q)}),e.jsx(H,{initial:!1,children:Q&&e.jsxs(p.div,{id:"province-recommender-panel",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:d?{duration:0}:{duration:.2},children:[e.jsx("p",{className:"cat-intro",children:"Based on your profile, these provinces may be good matches for Provincial Nominee Programs."}),e.jsx("div",{className:"prov-grid",children:Se.slice(0,5).map(s=>e.jsxs("div",{className:"prov-card",children:[e.jsxs("div",{className:"prov-header",children:[e.jsx("span",{className:"prov-abbr",children:s.abbr}),e.jsxs("div",{children:[e.jsx("strong",{className:"prov-name",children:s.name}),e.jsxs("span",{className:`prov-match ${s.matchScore>=70?"match-high":s.matchScore>=40?"match-mid":"match-low"}`,children:[s.matchScore,"% match"]})]})]}),e.jsx("div",{className:"prov-bar-wrap",children:e.jsx(p.div,{className:"prov-bar",initial:{width:0},animate:{width:`${s.matchScore}%`},transition:d?{duration:0}:{duration:.8,ease:"easeOut"},style:{background:s.matchScore>=70?"#22c55e":s.matchScore>=40?"#f59e0b":"var(--surface-3)"}})}),e.jsx("p",{className:"prov-notes",children:s.notes})]},s.id))})]})})]}),e.jsxs(p.div,{className:"card",variants:v,id:"section-timeline",children:[e.jsx("h3",{children:l("results.timeline")}),e.jsxs("div",{className:`timeline-badge tl-${I.cls}`,children:[e.jsx("strong",{children:re.label})," — est. ",re.months," months"]}),e.jsx("p",{className:"timeline-desc",children:re.description})]}),e.jsxs(p.div,{className:"card",variants:v,id:"section-draws",children:[e.jsx(z,{id:"recent-draws-panel",label:l("results.draws"),open:k,onToggle:()=>$(!k)}),e.jsxs("div",{className:`draw-source-pill ${Le(c)}`,children:["Source: ",_e(c)," · Updated ",i.lastUpdated||"—"]}),e.jsx(H,{initial:!1,children:k&&e.jsxs(p.div,{id:"recent-draws-panel",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:d?{duration:0}:{duration:.22},className:"draws-content",children:[e.jsx("h4",{className:"draws-subhead",children:"General / CEC Draws"}),i.generalProgram.slice(0,4).map((s,h)=>e.jsx(le,{draw:s,userScore:y},`g${h}`)),e.jsx("h4",{className:"draws-subhead",children:"Category-Based Draws"}),i.categoryBased.slice(0,4).map((s,h)=>e.jsx(le,{draw:s,userScore:y},`c${h}`)),!!i.pnpDraws?.length&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"draws-subhead",children:"Provincial Nominee (PNP)"}),i.pnpDraws.slice(0,3).map((s,h)=>e.jsx(le,{draw:s,userScore:y},`p${h}`))]})]})})]}),ce&&e.jsxs(p.div,{className:"card",variants:v,children:[e.jsxs("h3",{children:[ce.name," Requirements"]}),e.jsx("ul",{className:"pathway-list",children:ce.requirements.map((s,h)=>e.jsx("li",{children:s},h))})]}),e.jsx(p.div,{className:"card disclaimer",variants:v,children:e.jsxs("p",{children:[e.jsx("strong",{children:"Disclaimer:"})," ",l("results.disclaimer")," ",e.jsx("a",{href:"https://www.canada.ca/en/immigration-refugees-citizenship.html",target:"_blank",rel:"noopener noreferrer",children:"canada.ca"})]})}),e.jsx(p.button,{type:"button",className:"btn-restart",onClick:t,whileHover:d?void 0:{scale:1.03},whileTap:d?void 0:{scale:.96},variants:v,children:l("results.restart")})]})}function Me({label:a,value:t,max:n,color:c}){const o=Math.round(t/n*100);return e.jsxs("div",{className:"cutoff-row",children:[e.jsx("span",{className:"cutoff-label",children:a}),e.jsx("div",{className:"cutoff-bar-wrap",children:e.jsx(p.div,{className:"cutoff-bar",style:{background:c},initial:{width:0},animate:{width:`${o}%`},transition:{duration:.8,ease:"easeOut"},children:t})})]})}export{Ra as default};
