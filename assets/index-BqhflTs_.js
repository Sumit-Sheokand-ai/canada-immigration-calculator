const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Wizard-BHzkKl0u.js","assets/vendor-react-Ah1pgjPn.js","assets/data-question-bank-BsLULj9F.js","assets/feature-strategy-hub-oR-PHGUa.js","assets/feature-path-coach-Beny58Sb.js","assets/vendor-motion-CtNR3TjB.js","assets/questionDataSource-DXK4mmFB.js","assets/Results-CGcXVPYL.js","assets/AuthModal-DPBNNMzb.js","assets/WelcomeScreen-Dyq52DRN.js","assets/motionFeatures-DFpXREjK.js"])))=>i.map(i=>d[i]);
import{_ as P,u as ut,i as we,g as M,r as dt,a as ft,A as pt}from"./feature-path-coach-Beny58Sb.js";import{r as o,j as r,c as ht}from"./vendor-react-Ah1pgjPn.js";import{u as Oe,I as mt,t as m,r as U,a as gt,b as yt,c as j,L as wt}from"./feature-strategy-hub-oR-PHGUa.js";import{u as vt,m as _t,A as bt,L as St}from"./vendor-motion-CtNR3TjB.js";import{r as D,t as B}from"./data-question-bank-BsLULj9F.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(i){if(i.ep)return;i.ep=!0;const c=n(i);fetch(i.href,c)}})();const ze=o.createContext();function Et({children:e}){const[t,n]=o.useState(()=>{try{return localStorage.getItem("crs-theme")==="dark"}catch{return!1}});o.useEffect(()=>{document.documentElement.setAttribute("data-theme",t?"dark":"light");try{localStorage.setItem("crs-theme",t?"dark":"light")}catch{}},[t]);const s=()=>n(i=>!i);return r.jsx(ze.Provider,{value:{dark:t,toggle:s},children:e})}function Ct(){return o.useContext(ze)}const ue=new Set;function At(e){if(typeof window>"u"){e();return}typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>e(),{timeout:1800}):window.setTimeout(e,220)}function kt(e,t){ue.has(e)||(ue.add(e),Promise.resolve().then(()=>t()).catch(()=>{ue.delete(e)}))}function te(e,t,{idle:n=!1}={}){const s=()=>kt(e,t);if(n){At(s);return}s()}function je(e){te("chunk:wizard",()=>P(()=>import("./Wizard-BHzkKl0u.js"),__vite__mapDeps([0,1,2,3,4,5,6])),e)}function xt(e){te("chunk:results",()=>P(()=>import("./Results-CGcXVPYL.js"),__vite__mapDeps([7,4,1,2,5,3])),e)}function jt(e){te("chunk:path-coach",()=>P(()=>import("./feature-path-coach-Beny58Sb.js").then(t=>t.P),__vite__mapDeps([4,1,2,5])),e)}function ee(e){te("chunk:auth-modal",()=>P(()=>import("./AuthModal-DPBNNMzb.js"),__vite__mapDeps([8,1,4,2,5,6,3])),e)}const Pt=o.lazy(()=>P(()=>import("./AuthModal-DPBNNMzb.js"),__vite__mapDeps([8,1,4,2,5,6,3]))),Nt={en:"EN",fr:"FR"};function It({canInstallApp:e=!1,onInstallApp:t=()=>{},motionIntensity:n="full"}){const s=vt()||n!=="full",{dark:i,toggle:c}=Ct(),{lang:l,setLang:N,t:y}=Oe(),{user:w,ensureAuthReady:v}=ut(),[I,R]=o.useState(!1);return o.useEffect(()=>{const A=()=>{R(!0),ee(),v().catch(()=>{})};return window.addEventListener("crs-open-account-modal",A),()=>{window.removeEventListener("crs-open-account-modal",A)}},[v]),r.jsxs(r.Fragment,{children:[r.jsx(_t.header,{className:"header",initial:s?!1:{y:-60,opacity:0},animate:{y:0,opacity:1},transition:s?{duration:0}:{type:"spring",stiffness:120,damping:20},children:r.jsxs("div",{className:"header-inner",children:[r.jsxs("div",{className:"logo",children:[r.jsx("span",{className:"logo-leaf","aria-hidden":"true",children:r.jsx(mt,{name:"diamond-sharp"})}),r.jsxs("div",{className:"logo-copy",children:[r.jsx("span",{children:y("header.title")}),r.jsx("small",{children:y("header.tagline","Clear score. Clear plan.")})]})]}),r.jsxs("div",{className:"header-actions",children:[e&&r.jsx("button",{type:"button",className:"install-btn",onClick:t,"aria-label":"Install app",title:"Add app shortcut",children:"Install app"}),r.jsx("button",{type:"button",className:"auth-toggle",onClick:()=>{ee(),R(!0),v().catch(()=>{}),m("account_modal_opened",{source:"header_button",is_authenticated:!!w})},onMouseEnter:()=>{ee(),v().catch(()=>{})},onFocus:()=>{ee(),v().catch(()=>{})},"aria-label":w?"Manage account":"Login or signup",title:w?w.email:"Login / Signup",children:w?"Account":"Sign in"}),r.jsx("select",{className:"lang-select",value:l,onChange:A=>N(A.target.value),"aria-label":"Select language",children:Object.entries(Nt).map(([A,p])=>r.jsx("option",{value:A,children:p},A))}),r.jsx("button",{type:"button",className:"theme-toggle",onClick:c,"aria-label":i?"Switch to light mode":"Switch to dark mode",title:i?"Light mode":"Dark mode",children:i?"Light":"Dark"})]})]})}),I&&r.jsx(o.Suspense,{fallback:r.jsx("div",{className:"auth-modal-backdrop",role:"presentation",children:r.jsx("div",{className:"auth-modal auth-modal-loading",role:"dialog","aria-modal":"true",children:r.jsxs("div",{className:"auth-modal-head",children:[r.jsx("h3",{children:"Loading account…"}),r.jsx("button",{type:"button",className:"auth-close",onClick:()=>R(!1),"aria-label":"Close dialog",children:"×"})]})})}),children:r.jsx(Pt,{open:I,onClose:()=>R(!1)})})]})}function de(){const e=Array.from({length:9});return r.jsxs("div",{className:"uv-loader",children:[e.map((t,n)=>r.jsx("div",{className:"uv-text",children:r.jsx("span",{children:"Loading"})},n)),r.jsx("div",{className:"uv-line"})]})}function Rt(e,t){const n=e.answers||{};return{id:e.id,user_id:t||null,name:e.name||null,score:Number(e.score)||0,email:e.email||null,alert_opt_in:!!e.alertOptIn,alert_token:e.alertToken||null,profile_json:{answers:n,tracking:{userId:t||null,savedAt:new Date().toISOString()}},updated_at:new Date().toISOString()}}function re(e){const t=String(e?.message||"");return/column\s+["']?user_id["']?\s+does not exist/i.test(t)}function Y(e,t){const n=t?.message||t?.hint||String(t);return`${e}: ${n}`}function J(){return we}async function mr(e,t={}){if(!J())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=await M();if(!n)return{status:"skipped",reason:"Supabase client is unavailable"};const s=t.userId||null,i=Rt(e,s);let c,l;if({data:c,error:l}=await n.from("saved_profiles").upsert(i,{onConflict:"id"}).select(),l&&s&&re(l)){const{user_id:N,...y}=i;({data:c,error:l}=await n.from("saved_profiles").upsert(y,{onConflict:"id"}).select())}if(l)throw new Error(Y("Supabase upsert failed",l));return{status:"ok",data:c||[]}}async function Lt(e){if(!e)return{status:"skipped",reason:"Missing token"};if(!J())return{status:"skipped",reason:"Supabase env vars are not configured"};const t=await M();if(!t)return{status:"skipped",reason:"Supabase client is unavailable"};const{data:n,error:s}=await t.from("saved_profiles").update({alert_opt_in:!1,updated_at:new Date().toISOString()}).eq("alert_token",e).select();if(s)throw new Error(Y("Supabase unsubscribe failed",s));return n?.length?{status:"ok",data:n[0]}:{status:"not-found"}}async function gr(e){if(!e)return{status:"skipped",reason:"Missing user id"};if(!J())return{status:"skipped",reason:"Supabase env vars are not configured"};const t=await M();if(!t)return{status:"skipped",reason:"Supabase client is unavailable"};const{data:n,error:s}=await t.from("saved_profiles").select("id,name,score,email,updated_at").eq("user_id",e).order("updated_at",{ascending:!1}).limit(12);if(s&&re(s))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(s)throw new Error(Y("Supabase profile list failed",s));return{status:"ok",data:n||[]}}async function yr(e,t){if(!e)return{status:"skipped",reason:"Missing user id"};if(!J())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=await M();if(!n)return{status:"skipped",reason:"Supabase client is unavailable"};const{error:s,data:i}=await n.from("saved_profiles").update({alert_opt_in:!!t,updated_at:new Date().toISOString()}).eq("user_id",e).select("id");if(s&&re(s))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(s)throw new Error(Y("Supabase alert preference update failed",s));return{status:"ok",updatedCount:i?.length||0}}async function wr(e,t){if(!e)return{status:"skipped",reason:"Missing user id"};if(!J())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=await M();if(!n)return{status:"skipped",reason:"Supabase client is unavailable"};const s=t?String(t).trim().toLowerCase():null,{error:i,data:c}=await n.from("saved_profiles").update({email:s||null,updated_at:new Date().toISOString()}).eq("user_id",e).select("id");if(i&&re(i))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(i)throw new Error(Y("Supabase profile email update failed",i));return{status:"ok",updatedCount:c?.length||0}}const Tt=300*1e3,Ue=!1,ve="crs-cache-latest-draws-v1",_e="crs-cache-category-config-v1";let E={data:null,source:"none",fetchedAt:0},C={data:null,source:"none",fetchedAt:0},pe=!1,he=!1,me=Ue;function Dt(e){return!!e&&typeof e=="object"&&Array.isArray(e.generalProgram)&&Array.isArray(e.categoryBased)&&Array.isArray(e.pnpDraws)&&Number.isFinite(Number(e.averageCutoff))}function Be(e){return Dt(e)?{...e,generalProgram:e.generalProgram||[],categoryBased:e.categoryBased||[],pnpDraws:e.pnpDraws||[],averageCutoff:Number(e.averageCutoff)||D.averageCutoff,lastUpdated:e.lastUpdated||D.lastUpdated,pnpRanges:e.pnpRanges||D.pnpRanges}:null}function Mt(e){if(!e||typeof e!="object")return null;const t=String(e.id||"").trim(),n=String(e.name||"").trim(),s=String(e.icon||"").trim(),i=String(e.description||"").trim(),c=String(e.eligibility||"").trim(),l=String(e.cutoff_range||e.cutoffRange||"").trim(),N=Number(e.recent_cutoff??e.recentCutoff);return!t||!n||!s||!i||!c||!Number.isFinite(N)?null:{id:t,name:n,icon:s,description:i,eligibility:c,recentCutoff:N,cutoffRange:l||"N/A",source:e.source||"supabase",updatedAt:e.updated_at||null}}function Ft(e){if(!e)return!1;const t=String(e.code||"").toUpperCase(),n=`${e.message||""} ${e.details||""} ${e.hint||""}`.toLowerCase();return!!(t==="PGRST205"||n.includes("could not find the table")||n.includes("category_draw_configs")&&n.includes("schema cache")||n.includes("relation")&&n.includes("does not exist"))}function Ve(e=[]){const t=new Map(B.map(c=>[c.id,c])),n=new Map;for(const c of e){const l=Mt(c);l&&(n.has(l.id)||n.set(l.id,l))}const s=B.map(c=>{const l=n.get(c.id);return l?{...c,name:l.name,icon:l.icon,description:l.description,eligibility:l.eligibility,recentCutoff:l.recentCutoff,cutoffRange:l.cutoffRange,source:l.source,updatedAt:l.updatedAt}:c}),i=[...n.values()].filter(c=>!t.has(c.id)).map(c=>({...c,check:()=>!1}));return[...s,...i]}function qe(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch{return null}}function Ge(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch{}}function We(e){try{localStorage.removeItem(e)}catch{}}function Ot(e){return Number.isFinite(e)&&e>0&&Date.now()-e<Tt}function zt(e){return Ot(e)?"fresh":"stale"}function S(e,{revalidating:t=!1}={}){return{status:"ok",source:e.source,data:e.data,fetchedAt:e.fetchedAt,freshness:zt(e.fetchedAt),revalidating:t}}function Ye(e=[]){return Array.isArray(e)?e.map(t=>({id:t?.id||"",source:t?.source||"supabase",name:t?.name||"",icon:t?.icon||"",description:t?.description||"",eligibility:t?.eligibility||"",recent_cutoff:Number(t?.recentCutoff??t?.recent_cutoff),cutoff_range:t?.cutoffRange??t?.cutoff_range??"N/A",updated_at:t?.updatedAt??t?.updated_at??null})):[]}function Je(){if(pe)return;pe=!0;const e=qe(ve),t=Be(e?.data),n=Number(e?.fetchedAt||0);!t||!Number.isFinite(n)||n<=0||(E={data:t,source:String(e?.source||"supabase-cache"),fetchedAt:n})}function Ke(){if(he)return;he=!0;const e=qe(_e),t=Ye(e?.data||[]);if(!t.length)return;const n=Ve(t);if(!n.length)return;const s=Number(e?.fetchedAt||0);!Number.isFinite(s)||s<=0||(C={data:n,source:String(e?.source||"supabase-cache"),fetchedAt:s})}function ge(e,t){E={data:e,source:t,fetchedAt:Date.now()},Ge(ve,{data:e,source:t,fetchedAt:E.fetchedAt})}function ye(e,t){C={data:e,source:t,fetchedAt:Date.now()},Ge(_e,{data:Ye(e),source:t,fetchedAt:C.fetchedAt})}function Pe(){return D}function fe(){return B}function Ut(){return Je(),E.data?S(E):S({data:D,source:"local-fallback",fetchedAt:0})}function Bt(){return Ke(),C.data?S(C):S({data:B,source:"local-fallback",fetchedAt:0})}function vr(){E={data:null,source:"none",fetchedAt:0},pe=!0,We(ve)}function _r(){C={data:null,source:"none",fetchedAt:0},he=!0,me=Ue,We(_e)}async function Ne(){if(we)try{const e=await M();if(!e)throw new Error("Supabase client unavailable");const{data:t,error:n}=await e.from("draw_snapshots").select("payload,last_updated").order("last_updated",{ascending:!1}).limit(1);if(!n){const s=t?.[0],i=Be(s?.payload);if(i)return ge(i,"supabase"),S(E)}}catch{}return E.data||ge(D,"local-fallback"),S(E)}async function Ie(){if(we&&me)try{const e=await M();if(!e)throw new Error("Supabase client unavailable");const{data:t,error:n}=await e.from("category_draw_configs").select("id,source,name,icon,description,eligibility,recent_cutoff,cutoff_range,is_active,updated_at").eq("is_active",!0).order("updated_at",{ascending:!1});if(Ft(n)&&(me=!1),!n&&Array.isArray(t)&&t.length>0){const s=Ve(t);return ye(s,"supabase"),S(C)}}catch{}return C.data||ye(B,"local-fallback"),S(C)}function He(e,t){typeof e=="function"&&e(t)}async function Vt({forceRefresh:e=!1,staleWhileRevalidate:t=!0,onRevalidated:n=null}={}){if(U().forceLocalData)return ge(D,"local-forced"),S(E);if(Je(),!e&&E.data){const c=S(E);return c.freshness==="fresh"||!t?c:(Ne().then(l=>He(n,l)).catch(()=>{}),{...c,revalidating:!0})}return await Ne()}async function qt({forceRefresh:e=!1,staleWhileRevalidate:t=!0,onRevalidated:n=null}={}){if(U().forceLocalData)return ye(B,"local-forced"),S(C);if(Ke(),!e&&C.data){const c=S(C);return c.freshness==="fresh"||!t?c:(Ie().then(l=>He(n,l)).catch(()=>{}),{...c,revalidating:!0})}return await Ie()}const $e="crs-account-settings-v1",z={profileName:"",contactEmail:"",defaultDrawAlerts:!1,autoSyncProfiles:!0,autoSaveProgress:!0,motionIntensity:"full"};function Re(){try{const e=localStorage.getItem($e);if(!e)return{...z};const t=JSON.parse(e);return!t||typeof t!="object"?{...z}:{...z,...t}}catch{return{...z}}}function br(e){const t={...z,...e||{}};["off","subtle","full"].includes(t.motionIntensity)||(t.motionIntensity=z.motionIntensity);try{localStorage.setItem($e,JSON.stringify(t))}catch{}try{window.dispatchEvent(new Event("crs-account-settings-updated"))}catch{}return t}const Qe="crs-policy-autopilot-state-v1";function Gt(e,t){if(typeof window>"u")return t;try{const n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch{return t}}function Wt(e,t){if(!(typeof window>"u"))try{window.localStorage.setItem(e,JSON.stringify(t))}catch{}}function Yt(){return Gt(Qe,{activePolicyId:"",policySource:"",registryVersion:"",lastRunAt:"",lastChangeAt:"",lastRecalculation:null})}function Jt(e){if(!(typeof window>"u"))try{window.dispatchEvent(new CustomEvent("crs-policy-autopilot-synced",{detail:e}))}catch{}}function Le({reason:e="app_startup",force:t=!1}={}){const n=dt(),s=ft(),i=Yt(),c=i.activePolicyId!==n.id||i.policySource!==n.source,l=i.registryVersion!==s.version;if(!(!!t||c||l))return{status:"noop",reason:e,activePolicyId:n.id,policySource:n.source,registryVersion:s.version,recalculation:null,changed:!1};const y=gt({reason:`policy_autopilot:${e}`,force:!!t||c||l}),w=new Date().toISOString(),v={activePolicyId:n.id,policySource:n.source,registryVersion:s.version,lastRunAt:w,lastChangeAt:c||l?w:i.lastChangeAt||w,lastRecalculation:y};Wt(Qe,v);const I={status:"updated",reason:e,activePolicyId:n.id,policySource:n.source,registryVersion:s.version,recalculation:y,changed:c||l};return Jt(I),I}const Kt=o.lazy(()=>P(()=>import("./WelcomeScreen-Dyq52DRN.js"),__vite__mapDeps([9,1,3,4,2,5]))),Ht=o.lazy(()=>P(()=>import("./Wizard-BHzkKl0u.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),$t=o.lazy(()=>P(()=>import("./Results-CGcXVPYL.js"),__vite__mapDeps([7,4,1,2,5,3]))),be="crs-progress",Qt={welcome:"/",wizard:"/wizard",results:"/results",unsubscribe:"/unsubscribe",handoff:"/handoff"},Xt={FCP:{good:1800,needsImprovement:3e3},LCP:{good:2500,needsImprovement:4e3},CLS:{good:.1,needsImprovement:.25},INP:{good:200,needsImprovement:500}};function Te(e){return Qt[e]||"/"}function Zt(){return typeof PerformanceObserver>"u"?[]:Array.isArray(PerformanceObserver.supportedEntryTypes)?PerformanceObserver.supportedEntryTypes:[]}function er(e){return Zt().includes(e)}function tr(e,t){const n=Xt[e];return!n||!Number.isFinite(t)?"unknown":t<=n.good?"good":t<=n.needsImprovement?"needs_improvement":"poor"}function De(){try{const e=localStorage.getItem(be);return e?JSON.parse(e):null}catch{return null}}function rr(e){try{localStorage.setItem(be,JSON.stringify(e))}catch{}}function Me(){try{localStorage.removeItem(be)}catch{}}function nr(){try{return new URLSearchParams(window.location.search).get("unsubscribe")}catch{return null}}function ar(){return{}}function sr(){const e=typeof navigator<"u"?navigator:null;if(!e)return!1;const n=!!(e.connection||e.mozConnection||e.webkitConnection)?.saveData,s=Number(e.deviceMemory||0),i=Number(e.hardwareConcurrency||0),c=Number.isFinite(s)&&s>0&&s<=4,l=Number.isFinite(i)&&i>0&&i<=4;return n||c||l}function or(e){return new Promise(t=>window.setTimeout(t,e))}async function Fe(e,{retries:t=2,baseDelayMs:n=250}={}){let s=null;for(let i=0;i<=t;i+=1)try{return await e()}catch(c){if(s=c,i===t)break;await or(n*2**i)}throw s||new Error("Retry attempts exhausted.")}function ir(){const{t:e}=Oe(),[t,n]=o.useState(()=>Re()),[s,i]=o.useState(()=>U()),c=t.autoSaveProgress!==!1,l=["off","subtle","full"].includes(t.motionIntensity)?t.motionIntensity:"full",N=o.useMemo(()=>sr(),[]),y=l==="off"?"off":N&&l==="full"?"subtle":l,w=nr(),v=o.useMemo(()=>yt(),[]),I=ar(),R=o.useMemo(()=>Ut(),[]),A=o.useMemo(()=>Bt(),[]),[p,V]=o.useState(()=>w?"unsubscribe":v?"handoff":Object.keys(I).length>0?"results":"welcome"),ne=o.useRef(p),ae=o.useRef(Te(p)),q=o.useRef(0),Xe=o.useRef(new Set),[Se,se]=o.useState(()=>I),[K,Ee]=o.useState(()=>w?"loading":"idle"),[Ce,oe]=o.useState(()=>R?.data||Pe()),[Ae,ie]=o.useState(()=>R?.source||"local-fallback"),[Ze,H]=o.useState(()=>Array.isArray(A?.data)&&A.data.length>0?A.data:fe()),[T,$]=o.useState(()=>({syncing:!1,lastError:"",lastSyncedAt:"",drawFreshness:R?.freshness||"stale",categoryFreshness:A?.freshness||"stale",drawRevalidating:!1,categoryRevalidating:!1}));o.useEffect(()=>{if(!w)return;let a=!0;return Lt(w).then(d=>{a&&Ee(d.status==="ok"?"success":"notfound")}).catch(d=>{a&&(Ee("error"),j("unsubscribe_request_failed",d,{source:"unsubscribe_flow",has_token:!!w}))}),()=>{a=!1}},[w]);const Q=o.useCallback(async({forceRefresh:a=!1,reason:d="initial"}={})=>{$(u=>({...u,syncing:!0,lastError:""}));let g=null,b=null,x={freshness:"fresh",revalidating:!1},L={freshness:"fresh",revalidating:!1};const X=u=>{u?.status==="ok"&&u.data&&(oe(u.data),ie(u.source||"local-fallback")),$(k=>({...k,drawFreshness:u?.freshness||k.drawFreshness,drawRevalidating:!1,lastSyncedAt:new Date().toISOString()})),m("draw_data_swr_revalidated",{resource:"latest_draws",source:u?.source||"unknown",freshness:u?.freshness||"unknown"})},F=u=>{u?.status==="ok"&&Array.isArray(u.data)&&u.data.length>0&&H(u.data),$(k=>({...k,categoryFreshness:u?.freshness||k.categoryFreshness,categoryRevalidating:!1,lastSyncedAt:new Date().toISOString()})),m("draw_data_swr_revalidated",{resource:"category_config",source:u?.source||"unknown",freshness:u?.freshness||"unknown"})};try{const u=await Fe(()=>Vt({forceRefresh:a,onRevalidated:X}),{retries:2,baseDelayMs:250});u?.status==="ok"&&u.data&&(oe(u.data),ie(u.source||"local-fallback")),x={freshness:u?.freshness||"fresh",revalidating:!!u?.revalidating}}catch(u){g=u,j("draw_data_sync_error",u,{reason:d,resource:"latest_draws",force_refresh:!!a}),oe(Pe()),ie("local-fallback"),x={freshness:"stale",revalidating:!1}}try{const u=await Fe(()=>qt({forceRefresh:a,onRevalidated:F}),{retries:2,baseDelayMs:250});u?.status==="ok"&&Array.isArray(u.data)&&u.data.length>0?H(u.data):H(fe()),L={freshness:u?.freshness||"fresh",revalidating:!!u?.revalidating}}catch(u){b=u,j("draw_data_sync_error",u,{reason:d,resource:"category_config",force_refresh:!!a}),H(fe()),L={freshness:"stale",revalidating:!1}}const O=!!g||!!b;$({syncing:!1,lastError:O?"Live sync is currently unavailable. Showing local data mode.":"",lastSyncedAt:new Date().toISOString(),drawFreshness:x.freshness,categoryFreshness:L.freshness,drawRevalidating:x.revalidating,categoryRevalidating:L.revalidating}),O?m("draw_data_sync_degraded",{reason:d,latest_error:String(g?.message||""),category_error:String(b?.message||"")}):m("draw_data_sync_ok",{reason:d,source:"live"})},[]),et=o.useCallback(()=>{Q({forceRefresh:!0,reason:"manual_retry"})},[Q]);o.useEffect(()=>{const a=window.setTimeout(()=>{Q()},0);return()=>window.clearTimeout(a)},[Q]),o.useEffect(()=>{try{const a=Le({reason:"app_boot"});m("policy_autopilot_sync",{reason:"app_boot",status:a.status,active_policy_id:a.activePolicyId||"",policy_source:a.policySource||"",changed:!!a.changed,recalculated_profiles:Number(a.recalculation?.updated||0)})}catch(a){j("policy_autopilot_sync_failed",a,{reason:"app_boot"})}},[]),o.useEffect(()=>{const a=()=>{try{const d=Le({reason:"policy_override_updated",force:!0});m("policy_autopilot_sync",{reason:"policy_override_updated",status:d.status,active_policy_id:d.activePolicyId||"",policy_source:d.policySource||"",changed:!!d.changed,recalculated_profiles:Number(d.recalculation?.updated||0)})}catch(d){j("policy_autopilot_sync_failed",d,{reason:"policy_override_updated"})}};return window.addEventListener("crs-policy-ruleset-updated",a),()=>{window.removeEventListener("crs-policy-ruleset-updated",a)}},[]),o.useEffect(()=>{if(p==="welcome"){je({idle:!0});return}if(p==="wizard"){xt({idle:!0});return}p==="results"&&jt({idle:!0})},[p]);const tt=o.useCallback(a=>{if(a&&c){const d=De();d&&se(d)}m("wizard_started",{resumed:!!a}),V("wizard")},[c]),rt=o.useCallback(a=>{se(a),Me(),m("wizard_completed",{answer_count:Object.keys(a||{}).length}),V("results"),window.scrollTo({top:0,behavior:"smooth"})},[]),nt=o.useCallback(()=>{se({}),Me(),m("calculator_restarted"),window.history.replaceState(null,"",window.location.pathname),V("welcome"),window.scrollTo({top:0,behavior:"smooth"})},[]),at=c&&!!De(),[st,ot]=o.useState(!1),[G,ce]=o.useState(null),[it,ct]=o.useState(()=>{const a=window.matchMedia?.("(display-mode: standalone)")?.matches,d=window.navigator?.standalone===!0;return!!(a||d)});o.useEffect(()=>{const a=()=>ot(window.scrollY>400);return window.addEventListener("scroll",a,{passive:!0}),()=>window.removeEventListener("scroll",a)},[]),o.useEffect(()=>{const a=g=>{typeof g?.prompt=="function"&&ce(g)},d=()=>{ce(null),ct(!0)};return window.addEventListener("beforeinstallprompt",a),window.addEventListener("appinstalled",d),()=>{window.removeEventListener("beforeinstallprompt",a),window.removeEventListener("appinstalled",d)}},[]);const lt=o.useCallback(async()=>{if(!G)return;m("install_prompt_triggered"),G.prompt(),(await G.userChoice)?.outcome==="accepted"?(ce(null),m("install_prompt_accepted")):m("install_prompt_dismissed")},[G]);return o.useEffect(()=>{const a=()=>{n(Re())};return window.addEventListener("storage",a),window.addEventListener("crs-account-settings-updated",a),()=>{window.removeEventListener("storage",a),window.removeEventListener("crs-account-settings-updated",a)}},[]),o.useEffect(()=>{const a=()=>{i(U())};return window.addEventListener("storage",a),window.addEventListener("crs-runtime-flags-updated",a),()=>{window.removeEventListener("storage",a),window.removeEventListener("crs-runtime-flags-updated",a)}},[]),o.useEffect(()=>{q.current===0&&(q.current=typeof performance<"u"?performance.now():Date.now())},[]),o.useEffect(()=>{if(!s.enablePerfTelemetry)return;const a=g=>{const b=g?.error instanceof Error?g.error:new Error(g?.message||"Window error");j("app_window_error",b,{source:"window_error",filename:g?.filename||"",line:Number(g?.lineno||0),column:Number(g?.colno||0)})},d=g=>{const b=g?.reason,x=b instanceof Error?b:new Error(typeof b=="string"?b:"Unhandled promise rejection");j("app_unhandled_rejection",x,{source:"unhandled_rejection",reason_type:typeof b})};return window.addEventListener("error",a),window.addEventListener("unhandledrejection",d),()=>{window.removeEventListener("error",a),window.removeEventListener("unhandledrejection",d)}},[s.enablePerfTelemetry]),o.useEffect(()=>{if(!s.enablePerfTelemetry)return;const a=Te(p);m("perf_route_view",{mode:p,route:a,previous_route:ae.current,transition_type:ae.current===a?"initial":"virtual_navigation"}),ae.current=a},[p,s.enablePerfTelemetry]),o.useEffect(()=>{if(s.enablePerfTelemetry)try{const a=window.performance?.getEntriesByType?.("navigation")?.[0];if(!a)return;m("perf_navigation_summary",{type:a.type||"navigate",dom_content_loaded_ms:Math.round(a.domContentLoadedEventEnd||0),load_event_ms:Math.round(a.loadEventEnd||0),transfer_kb:Number(((a.transferSize||0)/1024).toFixed(1))})}catch{}},[s.enablePerfTelemetry]),o.useEffect(()=>{if(!s.enablePerfTelemetry||typeof window>"u"||typeof PerformanceObserver>"u")return;const a=[],d=Xe.current;let g=0,b=0,x=0,L=0,X=0,F=0,O=0,u=0;const k=(f,h,_={})=>{if(!Number.isFinite(h)||h<=0||d.has(f))return;d.add(f);const le=f==="CLS"?Number(h.toFixed(3)):Math.round(h);m("perf_web_vital",{metric:f,value:le,rating:tr(f,h),..._})},W=(f,h)=>{if(er(f))try{const _=new PerformanceObserver(le=>{h(le.getEntries()||[])});_.observe(f==="event"?{type:f,buffered:!0,durationThreshold:16}:{type:f,buffered:!0}),a.push(_)}catch{}};W("paint",f=>{const h=f.find(_=>_.name==="first-contentful-paint");h&&k("FCP",Number(h.startTime||0))}),W("largest-contentful-paint",f=>{const h=f[f.length-1];h&&(g=Number(h.startTime||0),b=Number(h.size||0))}),W("layout-shift",f=>{for(const h of f)h.hadRecentInput||(x+=Number(h.value||0))}),W("event",f=>{for(const h of f){const _=Number(h.duration||0);!Number.isFinite(_)||_<=0||(L=Math.max(L,_),X+=1)}}),W("longtask",f=>{for(const h of f){const _=Number(h.duration||0);!Number.isFinite(_)||_<=0||(F+=1,O+=_,u=Math.max(u,_))}});let ke=!1;const Z=()=>{ke||(ke=!0,k("LCP",g,{element_size_px:Math.round(b)}),k("CLS",x),k("INP",L,{sample_count:X}),F>0&&!d.has("LONG_TASK_SUMMARY")&&(d.add("LONG_TASK_SUMMARY"),m("perf_long_task_summary",{task_count:F,max_duration_ms:Math.round(u),total_duration_ms:Math.round(O),average_duration_ms:Math.round(O/F)})))},xe=()=>{document.visibilityState==="hidden"&&Z()};return document.addEventListener("visibilitychange",xe,!0),window.addEventListener("pagehide",Z,!0),()=>{Z(),document.removeEventListener("visibilitychange",xe,!0),window.removeEventListener("pagehide",Z,!0),a.forEach(f=>f.disconnect())}},[s.enablePerfTelemetry]),o.useEffect(()=>{const a=typeof performance<"u"?performance.now():Date.now(),d=ne.current;if(!s.enablePerfTelemetry){ne.current=p,q.current=a;return}d!==p&&(m("perf_mode_transition",{from_mode:d,to_mode:p,duration_ms:Math.max(Math.round(a-q.current),0)}),ne.current=p,q.current=a)},[p,s.enablePerfTelemetry]),o.useEffect(()=>{document.documentElement.setAttribute("data-motion",y)},[y]),o.useEffect(()=>{const a=document.documentElement;a.style.setProperty("--pointer-x","50%"),a.style.setProperty("--pointer-y","40%"),a.style.setProperty("--pointer-glow",y==="off"?"0":"0.18")},[y]),r.jsxs("div",{className:"app",children:[r.jsxs("div",{className:"anime-bg","aria-hidden":"true",children:[r.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--one"}),r.jsx("span",{className:"anime-bg-vignette"})]}),r.jsx("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"}),r.jsx(It,{canInstallApp:!it&&!!G,onInstallApp:lt,motionIntensity:y}),r.jsx("main",{className:"main",role:"main",id:"main-content",children:r.jsxs(bt,{mode:"wait",children:[p==="welcome"&&r.jsx(o.Suspense,{fallback:r.jsx("div",{className:"loading-fallback",children:r.jsx(de,{})}),children:r.jsx(Kt,{onStart:tt,onPrepareStart:()=>je(),hasSaved:at,drawData:Ce,drawSource:Ae,motionIntensity:y},"welcome")}),p==="wizard"&&r.jsx(o.Suspense,{fallback:r.jsx("div",{className:"loading-fallback",children:r.jsx(de,{})}),children:r.jsx(Ht,{onFinish:rt,onProgress:c?rr:void 0,initialAnswers:Se,motionIntensity:y},"wizard")}),p==="unsubscribe"&&r.jsxs("div",{className:"card unsubscribe-card",children:[r.jsx("h3",{children:"Draw alert preferences"}),K==="loading"&&r.jsx("p",{children:"Processing your unsubscribe request…"}),K==="success"&&r.jsx("p",{children:"You’ve been unsubscribed from draw alerts successfully."}),K==="notfound"&&r.jsx("p",{children:"This unsubscribe link is invalid or already inactive."}),K==="error"&&r.jsx("p",{children:"We couldn’t process this request right now. Please try again later."}),r.jsx("button",{type:"button",className:"btn-restart",onClick:()=>V("welcome"),children:"Back to calculator"})]}),p==="handoff"&&r.jsxs("div",{className:"card unsubscribe-card",children:[r.jsx("h3",{children:"Consultant handoff summary"}),v?r.jsxs(r.Fragment,{children:[r.jsxs("p",{children:["Score: ",r.jsx("strong",{children:v?.summary?.score??"—"})," · ","Avg cutoff: ",r.jsx("strong",{children:v?.summary?.averageCutoff??"—"})," · ","Confidence: ",r.jsx("strong",{children:v?.summary?.confidenceBand||"Unknown"})]}),r.jsxs("p",{children:["Generated: ",v?.generatedAt?new Date(v.generatedAt).toLocaleString():"—"]})]}):r.jsx("p",{children:"This handoff link is invalid or expired."}),r.jsx("button",{type:"button",className:"btn-restart",onClick:()=>{window.history.replaceState(null,"",window.location.pathname),V("welcome")},children:"Open calculator"})]}),p==="results"&&r.jsx(o.Suspense,{fallback:r.jsx("div",{className:"loading-fallback",children:r.jsx(de,{})}),children:r.jsx($t,{answers:Se,onRestart:nt,drawData:Ce,drawSource:Ae,categoryInfo:Ze,motionIntensity:y,onRetryDataSync:et,isDataSyncing:T.syncing,dataSyncError:T.lastError,dataSyncFreshness:T.drawFreshness==="stale"||T.categoryFreshness==="stale"?"stale":"fresh",isDataRevalidating:T.drawRevalidating||T.categoryRevalidating,dataLastSyncedAt:T.lastSyncedAt},"results")})]})}),r.jsxs("footer",{className:"footer",children:[r.jsxs("p",{children:["© ",new Date().getFullYear()," ",e("footer.copy")]}),r.jsxs("p",{className:"footer-legal-links",children:[r.jsx("a",{href:"/guides.html",children:"Guides"}),r.jsx("span",{"aria-hidden":"true",children:" · "}),r.jsx("a",{href:"/terms.html",children:"Terms of Service"}),r.jsx("span",{"aria-hidden":"true",children:" · "}),r.jsx("a",{href:"/privacy.html",children:"Privacy Policy"}),r.jsx("span",{"aria-hidden":"true",children:" · "}),r.jsx("a",{href:"/trust.html",children:"Trust Center"})]})]}),st&&r.jsx("button",{type:"button",className:"btn-top",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),"aria-label":"Back to top",children:"↑"})]})}class cr extends o.Component{constructor(t){super(t),this.state={hasError:!1,errorMessage:""}}static getDerivedStateFromError(t){return{hasError:!0,errorMessage:t?.message||"Unexpected application error."}}componentDidCatch(t,n){j("app_error_boundary_triggered",t,{component_stack:String(n?.componentStack||"").slice(0,600),route:typeof window<"u"?window.location.pathname:"server"})}handleTryAgain=()=>{this.setState({hasError:!1,errorMessage:""})};render(){return this.state.hasError?r.jsx("main",{className:"error-boundary-screen",role:"alert","aria-live":"assertive",children:r.jsxs("section",{className:"error-boundary-card",children:[r.jsx("h1",{children:"Something went wrong"}),r.jsx("p",{children:"We hit an unexpected issue while rendering this page."}),r.jsx("p",{className:"error-boundary-message",children:this.state.errorMessage}),r.jsxs("div",{className:"error-boundary-actions",children:[r.jsx("button",{type:"button",className:"action-btn auth-btn-primary",onClick:this.handleTryAgain,children:"Try again"}),r.jsx("button",{type:"button",className:"action-btn",onClick:()=>window.location.reload(),children:"Reload app"})]})]})}):this.props.children}}const lr=()=>P(()=>import("./motionFeatures-DFpXREjK.js"),__vite__mapDeps([10,5,1])).then(e=>e.default);"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("[SW] Service Worker registered:",e),U().enablePerfTelemetry&&m("service_worker_registered",{scope:e?.scope||"/"})}).catch(e=>{console.error("[SW] Service Worker registration failed:",e),U().enablePerfTelemetry&&j("service_worker_registration_failed",e,{source:"main_bootstrap"})})});ht.createRoot(document.getElementById("root")).render(r.jsx(o.StrictMode,{children:r.jsx(cr,{children:r.jsx(pt,{children:r.jsx(Et,{children:r.jsx(wt,{children:r.jsx(St,{features:lr,children:r.jsx(ir,{})})})})})})}));export{de as L,jt as a,Pe as b,Yt as c,Vt as d,qt as e,yr as f,fe as g,wr as h,J as i,vr as j,_r as k,gr as l,Le as m,xt as p,Re as r,br as s,mr as u};
