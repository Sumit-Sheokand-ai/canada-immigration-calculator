import{r as l,j as r}from"./vendor-react-Ah1pgjPn.js";import{u as x}from"./data-question-bank-F-s7nTqV.js";import{u as $}from"./index-COdWnjdb.js";import{i as F,s as B,S as W}from"./feature-path-coach-CcxSME4q.js";import{u as G,m as v,A as U}from"./vendor-motion-DURBmaq0.js";import"./feature-strategy-hub-wr1XAEdI.js";import"./vendor-supabase-BZ0N5lZN.js";const X=[{noc:"00010",title:"Financial Manager",teer:"teer_0",keywords:"finance banking accounting"},{noc:"00012",title:"Human Resources Manager",teer:"teer_0",keywords:"hr personnel staffing"},{noc:"00013",title:"Purchasing Manager",teer:"teer_0",keywords:"procurement supply chain"},{noc:"00015",title:"Senior Government Manager",teer:"teer_0",keywords:"government public administration"},{noc:"10010",title:"Engineering Manager",teer:"teer_0",keywords:"engineering technical director"},{noc:"10019",title:"IT Manager",teer:"teer_0",keywords:"technology information systems director CTO"},{noc:"10020",title:"Construction Manager",teer:"teer_0",keywords:"building project site superintendent"},{noc:"10029",title:"Restaurant Manager",teer:"teer_0",keywords:"food service hospitality hotel"},{noc:"20010",title:"Sales Manager",teer:"teer_0",keywords:"marketing retail business development"},{noc:"21210",title:"Software Developer",teer:"teer_1",keywords:"programmer coder web app frontend backend fullstack"},{noc:"21211",title:"Data Scientist",teer:"teer_1",keywords:"machine learning AI analytics big data"},{noc:"21220",title:"Cybersecurity Analyst",teer:"teer_1",keywords:"security information network"},{noc:"21230",title:"Systems Analyst",teer:"teer_1",keywords:"IT consultant business analyst ERP"},{noc:"21310",title:"Civil Engineer",teer:"teer_1",keywords:"structural infrastructure roads bridges"},{noc:"21311",title:"Mechanical Engineer",teer:"teer_1",keywords:"machines HVAC automotive manufacturing"},{noc:"21320",title:"Electrical Engineer",teer:"teer_1",keywords:"electronics power systems circuits"},{noc:"21321",title:"Chemical Engineer",teer:"teer_1",keywords:"process plant petroleum refinery"},{noc:"31100",title:"Registered Nurse",teer:"teer_1",keywords:"RN nursing hospital patient care"},{noc:"31110",title:"Physician / Doctor",teer:"teer_1",keywords:"MD medical general practitioner specialist"},{noc:"31120",title:"Pharmacist",teer:"teer_1",keywords:"pharmacy medication dispensing"},{noc:"31121",title:"Dentist",teer:"teer_1",keywords:"dental oral surgeon teeth"},{noc:"31200",title:"Physiotherapist",teer:"teer_1",keywords:"physical therapy rehabilitation"},{noc:"41200",title:"Accountant",teer:"teer_1",keywords:"CPA auditor bookkeeper tax financial"},{noc:"41210",title:"Financial Analyst",teer:"teer_1",keywords:"investment banking equity research"},{noc:"41300",title:"Architect",teer:"teer_1",keywords:"building design urban planning"},{noc:"41400",title:"University Professor",teer:"teer_1",keywords:"teacher lecturer academic research"},{noc:"41401",title:"Secondary School Teacher",teer:"teer_1",keywords:"high school education teaching"},{noc:"41301",title:"Graphic Designer",teer:"teer_1",keywords:"visual UI UX creative design"},{noc:"21234",title:"Web Developer",teer:"teer_1",keywords:"website html css javascript react node"},{noc:"21223",title:"Database Analyst",teer:"teer_1",keywords:"SQL database administrator DBA"},{noc:"22100",title:"Electrician",teer:"teer_2",keywords:"electrical wiring power installation"},{noc:"22101",title:"Plumber",teer:"teer_2",keywords:"plumbing pipes water gas fitting"},{noc:"22110",title:"Welder",teer:"teer_2",keywords:"welding fabrication metal joining"},{noc:"22111",title:"Carpenter",teer:"teer_2",keywords:"woodwork framing construction cabinetry"},{noc:"22210",title:"Paralegal",teer:"teer_2",keywords:"legal assistant law clerk"},{noc:"22300",title:"Dental Hygienist",teer:"teer_2",keywords:"teeth cleaning oral health"},{noc:"22301",title:"Medical Lab Technician",teer:"teer_2",keywords:"laboratory blood test specimen"},{noc:"22220",title:"HVAC Technician",teer:"teer_2",keywords:"heating ventilation air conditioning refrigeration"},{noc:"22230",title:"Heavy Equipment Mechanic",teer:"teer_2",keywords:"machinery diesel repair maintenance"},{noc:"22310",title:"Automotive Mechanic",teer:"teer_2",keywords:"car vehicle repair service technician"},{noc:"33100",title:"Dental Assistant",teer:"teer_3",keywords:"dentistry chairside oral"},{noc:"33101",title:"Nurse Aide / Orderly",teer:"teer_3",keywords:"healthcare support patient nursing assistant"},{noc:"33102",title:"Pharmacy Technician",teer:"teer_3",keywords:"medication dispensing prescription"},{noc:"33110",title:"Baker",teer:"teer_3",keywords:"bakery pastry bread baking"},{noc:"33111",title:"Butcher / Meat Cutter",teer:"teer_3",keywords:"meat processing cutting food"},{noc:"33200",title:"Cook / Chef",teer:"teer_3",keywords:"cooking kitchen restaurant food preparation"},{noc:"73300",title:"Truck Driver",teer:"teer_3",keywords:"transport delivery long haul commercial driving"},{noc:"73301",title:"Bus Driver",teer:"teer_3",keywords:"transit public transport passenger"},{noc:"84100",title:"Farm Worker",teer:"teer_3",keywords:"agriculture livestock crop harvesting"},{noc:"84120",title:"Landscaping Worker",teer:"teer_3",keywords:"gardening grounds maintenance outdoor"}];function J(e){if(!e||e.trim().length<2)return[];const n=e.toLowerCase().split(/\s+/);return X.map(s=>{let a=0;for(const o of n)s.title.toLowerCase().includes(o)?a+=3:s.keywords.toLowerCase().includes(o)?a+=2:s.noc.includes(o)&&(a+=1);return{...s,score:a}}).filter(s=>s.score>0).sort((s,a)=>a.score-s.score).slice(0,8)}const Y=300*1e3;let k={data:null,source:"none",fetchedAt:0};function H(e){if(!e||typeof e!="object")return null;const n=String(e.value??"").trim(),t=String(e.label??"").trim();if(!n||!t)return null;const s=typeof e.example=="string"?e.example:"",a=Array.isArray(e.keywords)?e.keywords.map(o=>String(o)):[];return{value:n,label:t,example:s,keywords:a}}function Z(e){if(!e||typeof e!="object")return null;const n=String(e.answerKey??"").trim(),t=String(e.title??"").trim();if(!n||!t)return null;const s=String(e.type||"list"),a=Array.isArray(e.options)?e.options.map(H).filter(Boolean):[];return{title:t,answerKey:n,type:s,searchable:!!e.searchable,searchPlaceholder:typeof e.searchPlaceholder=="string"?e.searchPlaceholder:"",options:a}}function ee(e){if(!e||typeof e!="object")return;const n=o=>Array.isArray(o)?o.filter(h=>h&&typeof h=="object"&&h.key).map(h=>({key:String(h.key),op:String(h.op||"eq"),value:h.value})):[],t=n(e.all),s=n(e.any),a=n(e.none);if(!(!t.length&&!s.length&&!a.length))return{all:t,any:s,none:a}}function te(e){if(!e||typeof e!="object")return null;const n=String(e.id??"").trim(),t=String(e.type??"").trim();if(!n||!t)return null;const s={id:n,label:String(e.label??""),title:String(e.title??""),subtitle:String(e.subtitle??""),helpTip:String(e.helpTip??""),type:t,answerKey:String(e.answerKey??""),layout:String(e.layout??""),searchable:!!e.searchable,searchPlaceholder:String(e.searchPlaceholder??""),hasNOCSearch:!!e.hasNOCSearch,visibility:ee(e.visibility)};if(t==="grouped"){if(s.groups=Array.isArray(e.groups)?e.groups.map(Z).filter(Boolean):[],!s.groups.length)return null}else if(s.options=Array.isArray(e.options)?e.options.map(H).filter(Boolean):[],!s.answerKey||!s.options.length)return null;return s}function re(e){let n=[];Array.isArray(e)?n=e:e&&typeof e=="object"&&Array.isArray(e.steps)&&(n=e.steps);const t=n.map(te).filter(Boolean);return t.length>0?t:null}async function ne({forceRefresh:e=!1}={}){if(!e&&k.data&&Date.now()-k.fetchedAt<Y)return{status:"ok",source:k.source,data:k.data};if(F&&B)try{const{data:n,error:t}=await B.from("question_sets").select("id,source,version,payload,updated_at").eq("is_active",!0).order("updated_at",{ascending:!1}).limit(1);if(!t){const s=n?.[0],a=re(s?.payload);if(a)return k={data:a,source:"supabase",fetchedAt:Date.now()},{status:"ok",source:"supabase",data:a}}}catch{}return k={data:x,source:"local-fallback",fetchedAt:Date.now()},{status:"ok",source:"local-fallback",data:x}}function K(e,n=220){const[t,s]=l.useState(e);return l.useEffect(()=>{const a=window.setTimeout(()=>s(e),n);return()=>window.clearTimeout(a)},[n,e]),t}function M(e,n){if(!e||!e.key)return!0;const t=n?.[e.key],s=e.value;switch(e.op){case"eq":return t===s;case"neq":return t!==s;case"in":return Array.isArray(s)?s.includes(t):!1;case"not_in":return Array.isArray(s)?!s.includes(t):!0;case"exists":return t!=null&&t!=="";case"not_exists":return t==null||t==="";default:return t===s}}function j(e,n){const t=e?.visibility;if(!t)return!0;const s=Array.isArray(t.all)?t.all:[],a=Array.isArray(t.any)?t.any:[],o=Array.isArray(t.none)?t.none:[],h=s.every(d=>M(d,n)),u=a.length===0||a.some(d=>M(d,n)),g=o.every(d=>!M(d,n));return h&&u&&g}function E(e,n){return e?e.type==="grouped"?e.groups.every(t=>!!n[t.answerKey]):!!n[e.answerKey]:!1}function L(e,n){for(let t=0;t<e.length;t+=1)if(j(e[t],n))return t;return 0}function O(e,n="list"){return e==="grid"?"grid":e==="grid-wide"?"grid-wide":n}const se={enter:e=>({x:e>0?80:-80,opacity:0}),center:{x:0,opacity:1},exit:e=>({x:e>0?-80:80,opacity:0})};function ae({pct:e}){return r.jsxs("div",{className:"wiz-progress-container",children:[r.jsx("div",{className:"uv-progress-bar",style:{width:`${e}%`}}),r.jsxs("div",{className:"uv-progress-text",children:[e,"%"]}),r.jsxs("div",{className:"uv-particles",children:[r.jsx("div",{className:"uv-particle"}),r.jsx("div",{className:"uv-particle"}),r.jsx("div",{className:"uv-particle"}),r.jsx("div",{className:"uv-particle"}),r.jsx("div",{className:"uv-particle"})]})]})}function ie({opt:e,selected:n,layout:t,onSelect:s,reducedMotion:a=!1}){return r.jsxs(v.button,{type:"button",className:`opt-btn${n?" selected":""} ${t}`,onClick:s,"aria-pressed":n,whileHover:a?void 0:{scale:1.02},whileTap:a?void 0:{scale:.97},layout:!0,children:[t==="list"&&r.jsx("span",{className:"radio-dot"}),r.jsxs("span",{className:"opt-content",children:[r.jsx("span",{className:"opt-label",children:e.label}),e.example&&r.jsx("span",{className:"opt-example",children:e.example})]})]})}function oe({text:e}){const[n,t]=l.useState(!1),s=l.useId();return r.jsxs("span",{className:"help-tip-wrap",children:[r.jsx("button",{className:"help-tip-btn",onClick:()=>t(!n),"aria-label":"More info","aria-expanded":n,"aria-controls":s,type:"button",children:"?"}),n&&r.jsx("div",{id:s,className:"help-tip-bubble",onClick:()=>t(!1),children:e})]})}function ce({onSelect:e}){const[n,t]=l.useState(""),s=K(n,240),a=l.useMemo(()=>J(s),[s]);return r.jsxs("div",{className:"noc-search",children:[r.jsxs("div",{className:"option-search-wrap glass-search",children:[r.jsx("span",{className:"option-search-icon",children:"⌕"}),r.jsx("input",{className:"option-search-input",type:"text",placeholder:"Search your job title (e.g. Software Developer, Nurse)",value:n,onChange:o=>t(o.target.value),"aria-label":"Search NOC job titles"})]}),a.length>0&&r.jsx("div",{className:"noc-results",children:a.map(o=>r.jsxs("button",{className:"noc-result",onClick:()=>{e(o.teer),t("")},type:"button",children:[r.jsx("span",{className:"noc-code",children:o.noc}),r.jsx("span",{className:"noc-title",children:o.title}),r.jsx("span",{className:"noc-teer",children:o.teer.replace("teer_","TEER ")})]},o.noc))})]})}function R({options:e,answerKey:n,layout:t,answers:s,onAnswer:a,searchable:o=!1,searchPlaceholder:h="Search options...",reducedMotion:u=!1}){const[g,d]=l.useState(""),w=K(g,180),y=o||e.length>=12,b=l.useMemo(()=>{if(!y||!w.trim())return e;const p=w.trim().toLowerCase();return e.filter(f=>[f.label,f.example||"",...Array.isArray(f.keywords)?f.keywords:[]].join(" ").toLowerCase().includes(p))},[w,e,y]);return r.jsxs(r.Fragment,{children:[y&&r.jsxs("div",{className:"option-search-wrap glass-search",children:[r.jsx("span",{className:"option-search-icon",children:"⌕"}),r.jsx("input",{className:"option-search-input",type:"text",value:g,onChange:p=>d(p.target.value),placeholder:h,"aria-label":`Search options for ${n}`})]}),r.jsx("div",{className:`opt-${t}`,children:b.map(p=>r.jsx(ie,{opt:p,selected:s[n]===p.value,layout:t,onSelect:()=>a(n,p.value),reducedMotion:u},p.value))}),y&&b.length===0&&r.jsx("p",{className:"option-search-empty",children:"No options matched your search."})]})}function fe({onFinish:e,onProgress:n,initialAnswers:t,motionIntensity:s="full"}){const{t:a}=$(),o=G()||s==="off",h=l.useMemo(()=>t||{},[t]),[u,g]=l.useState(h),[d,w]=l.useState(()=>x),[y,b]=l.useState(()=>L(x,h)),[p,f]=l.useState([]),[N,P]=l.useState(1);l.useEffect(()=>{let i=!0;return ne().then(m=>{if(!i)return;const _=Array.isArray(m?.data)&&m.data.length>0?m.data:x;w(_),f([]),b(L(_,h))}).catch(()=>{i&&w(x)}),()=>{i=!1}},[h]);const c=d[y],A=l.useCallback((i,m)=>{g(_=>{const z={..._,[i]:m};return n&&n(z),z})},[n]),T=l.useMemo(()=>Math.max(1,d.filter(i=>j(i,u)).length),[u,d]),D=l.useMemo(()=>{let i=0;for(let m=0;m<=y;m+=1)j(d[m],u)&&(i+=1);return Math.max(1,i)},[u,y,d]),Q=Math.round(D/T*100),S=l.useMemo(()=>{if(!c)return!1;for(let i=y+1;i<d.length;i+=1)if(j(d[i],u))return!1;return!0},[u,y,c,d]),q=l.useCallback(()=>{if(!c||!E(c,u))return;P(1),f(m=>[...m,y]);let i=y+1;for(;i<d.length&&!j(d[i],u);)i+=1;i>=d.length?e(u):b(i)},[u,y,e,c,d]),I=l.useCallback(()=>{if(p.length===0)return;P(-1);const i=p[p.length-1];f(m=>m.slice(0,-1)),b(i)},[p]);if(!c)return r.jsxs("div",{className:"card",children:[r.jsx("h3",{children:"Question set unavailable"}),r.jsx("p",{children:"Please refresh and try again."})]});const C=E(c,u),V=O(c.type,c.layout||"list");return r.jsxs(v.div,{className:"wizard",initial:o?!1:{opacity:0,y:30},animate:{opacity:1,y:0},exit:o?{opacity:0}:{opacity:0,y:-30,transition:{duration:.25}},role:"form","aria-label":"CRS Calculator wizard",children:[r.jsxs("div",{className:"progress-bar-wrap",children:[r.jsx("div",{className:"progress-info",children:r.jsxs("span",{children:[a("wizard.step")," ",D," ",a("wizard.of")," ",T]})}),r.jsx(ae,{pct:Q})]}),r.jsx(U,{mode:"wait",custom:N,children:r.jsxs(v.div,{className:"step-wrap",custom:N,variants:se,initial:"enter",animate:"center",exit:"exit",transition:o?{duration:0}:{type:"spring",stiffness:200,damping:26},children:[r.jsx("span",{className:"step-label",children:c.label}),r.jsxs("h2",{className:"step-title",children:[c.title," ",c.helpTip&&r.jsx(oe,{text:c.helpTip})]}),c.subtitle&&r.jsx("p",{className:"step-subtitle",children:c.subtitle}),c.hasNOCSearch&&r.jsx(ce,{onSelect:i=>A(c.answerKey,i)}),(c.type==="single"||c.type==="grid"||c.type==="grid-wide")&&r.jsx(R,{options:c.options,answerKey:c.answerKey,layout:V,answers:u,onAnswer:A,searchable:c.searchable,searchPlaceholder:c.searchPlaceholder,reducedMotion:o}),c.type==="grouped"&&c.groups.map(i=>r.jsxs("div",{className:"question-group",children:[r.jsx("h3",{children:i.title}),r.jsx(R,{options:i.options,answerKey:i.answerKey,layout:O(i.type,"list"),answers:u,onAnswer:A,searchable:i.searchable,searchPlaceholder:i.searchPlaceholder,reducedMotion:o})]},i.answerKey))]},c.id)}),r.jsxs("div",{className:"wizard-nav",children:[p.length>0&&r.jsx(v.button,{type:"button",className:"btn-back",onClick:I,whileHover:o?void 0:{x:-3},whileTap:o?void 0:{scale:.95},"aria-label":"Go back",children:a("wizard.back")}),r.jsx(W,{color:"var(--primary)",speed:"5s",children:r.jsx(v.button,{type:"button",className:`btn-next${S?" finish":""}`,disabled:!C,onClick:q,whileHover:C&&!o?{scale:1.02}:void 0,whileTap:C&&!o?{scale:.97}:void 0,"aria-label":S?"Calculate score":"Next step",children:a(S?"wizard.calculate":"wizard.next")})})]})]})}export{fe as default};
