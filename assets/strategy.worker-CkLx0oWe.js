(function(){"use strict";const se={17:[0,0],18:[99,90],19:[105,95],20:[110,100],21:[110,100],22:[110,100],23:[110,100],24:[110,100],25:[110,100],26:[110,100],27:[110,100],28:[110,100],29:[110,100],30:[105,95],31:[99,90],32:[94,85],33:[88,80],34:[83,75],35:[77,70],36:[72,65],37:[66,60],38:[61,55],39:[55,50],40:[50,45],41:[39,35],42:[28,25],43:[17,15],44:[6,5],45:[0,0],46:[0,0],47:[0,0]},ce={less_than_secondary:[0,0],secondary:[30,28],one_year_post:[90,84],two_year_post:[98,91],bachelors:[120,112],two_or_more:[128,119],masters:[135,126],doctoral:[150,140]},le={0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[6,6],5:[6,6],6:[9,8],7:[17,16],8:[23,22],9:[31,29],10:[34,32],11:[34,32],12:[34,32]},de={0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[1,1],6:[1,1],7:[3,3],8:[3,3],9:[6,6],10:[6,6],11:[6,6],12:[6,6]},ue={0:[0,0],1:[40,35],2:[53,46],3:[64,56],4:[72,63],5:[80,70]},fe={less_than_secondary:0,secondary:2,one_year_post:6,two_year_post:7,bachelors:8,two_or_more:9,masters:10,doctoral:10},me={0:0,1:0,2:0,3:0,4:1,5:1,6:1,7:3,8:3,9:5,10:5,11:5,12:5},ge={0:0,1:5,2:7,3:8,4:9,5:10},pe={reading:[{min:8,clb:10},{min:7,clb:9},{min:6.5,clb:8},{min:6,clb:7},{min:5,clb:6},{min:4,clb:5},{min:3.5,clb:4}],writing:[{min:7.5,clb:10},{min:7,clb:9},{min:6.5,clb:8},{min:6,clb:7},{min:5.5,clb:6},{min:5,clb:5},{min:4,clb:4}],listening:[{min:8.5,clb:10},{min:8,clb:9},{min:7.5,clb:8},{min:6,clb:7},{min:5.5,clb:6},{min:5,clb:5},{min:4.5,clb:4}],speaking:[{min:7.5,clb:10},{min:7,clb:9},{min:6.5,clb:8},{min:6,clb:7},{min:5.5,clb:6},{min:5,clb:5},{min:4,clb:4}]};function he(e,t){const n=pe[e];if(!n)return 0;for(const i of n)if(t>=i.min)return i.clb;return 0}const ye={less_than_secondary:0,secondary:0,one_year_post:1,two_year_post:2,bachelors:3,two_or_more:3,masters:3,doctoral:3},ke=[[0,0,0],[0,13,25],[0,25,50],[0,25,50]],be=[[0,0,0],[0,13,25],[0,25,50],[0,25,50]],Ce=[[0,0,0],[0,13,25],[0,25,50]],we=[[0,0,0],[0,13,25],[0,25,50]],Se=[0,25,50],ve={pnp_nomination:600,job_offer_00:0,job_offer_other:0,canadian_edu_short:15,canadian_edu_long:30,sibling_in_canada:15,french_strong_weak_english:25,french_strong_strong_english:50},K={averageCutoff:520},_e={listening:[{min:360,nclc:10},{min:349,nclc:9},{min:334,nclc:8},{min:316,nclc:7},{min:298,nclc:6},{min:280,nclc:5},{min:249,nclc:4},{min:217,nclc:3},{min:181,nclc:2},{min:145,nclc:1}],reading:[{min:310,nclc:10},{min:294,nclc:9},{min:278,nclc:8},{min:263,nclc:7},{min:248,nclc:6},{min:233,nclc:5},{min:207,nclc:4},{min:181,nclc:3},{min:151,nclc:2},{min:121,nclc:1}],writing:[{min:450,nclc:10},{min:437,nclc:9},{min:415,nclc:8},{min:393,nclc:7},{min:371,nclc:6},{min:349,nclc:5},{min:310,nclc:4},{min:271,nclc:3},{min:226,nclc:2},{min:181,nclc:1}],speaking:[{min:450,nclc:10},{min:437,nclc:9},{min:415,nclc:8},{min:393,nclc:7},{min:371,nclc:6},{min:349,nclc:5},{min:310,nclc:4},{min:271,nclc:3},{min:226,nclc:2},{min:181,nclc:1}]};function Me(e,t){const n=_e[e];if(!n)return 0;for(const i of n)if(t>=i.min)return i.nclc;return 0}const Pe={listening:[{min:610,nclc:10},{min:590,nclc:9},{min:570,nclc:8},{min:549,nclc:7},{min:523,nclc:6},{min:503,nclc:5},{min:453,nclc:4},{min:398,nclc:3},{min:369,nclc:2},{min:331,nclc:1}],reading:[{min:625,nclc:10},{min:600,nclc:9},{min:575,nclc:8},{min:549,nclc:7},{min:524,nclc:6},{min:499,nclc:5},{min:453,nclc:4},{min:406,nclc:3},{min:375,nclc:2},{min:342,nclc:1}],writing:[{min:20,nclc:10},{min:19,nclc:9},{min:18,nclc:8},{min:16,nclc:7},{min:14,nclc:6},{min:12,nclc:5},{min:10,nclc:4},{min:7,nclc:3},{min:6,nclc:2},{min:4,nclc:1}],speaking:[{min:20,nclc:10},{min:19,nclc:9},{min:18,nclc:8},{min:16,nclc:7},{min:14,nclc:6},{min:12,nclc:5},{min:10,nclc:4},{min:7,nclc:3},{min:6,nclc:2},{min:4,nclc:1}]};function Te(e,t){const n=Pe[e];if(!n)return 0;for(const i of n)if(t>=i.min)return i.nclc;return 0}const Le="crs-policy-ruleset-override-v1";function D(e){const t=new Date(e);return Number.isNaN(t.getTime())?null:t}const L=[{id:"ircc-2024-01-01-v1",label:"Legacy arranged-employment points",effectiveDate:"2024-01-01",arrangedEmploymentPoints:!0,notes:["Legacy profile includes arranged-employment CRS additional points (NOC 00: +200, others: +50).","PNP nomination remains +600 additional points.","French additional points depend on both French and English thresholds."]},{id:"ircc-2025-03-25-v2",label:"Arranged-employment points removed",effectiveDate:"2025-03-25",arrangedEmploymentPoints:!1,notes:["Arranged-employment CRS additional points removed effective March 25, 2025.","PNP nomination remains +600 additional points.","French additional points depend on both French and English thresholds."]}].sort((e,t)=>{const n=D(e.effectiveDate)?.getTime()||0,i=D(t.effectiveDate)?.getTime()||0;return n-i});function V(){return L[L.length-1]}function J(e){return L.find(t=>t.id===e)||null}function Fe(){if(typeof window>"u")return null;try{const e=window.localStorage.getItem(Le);if(!e)return null;const t=String(e).trim();return J(t)?.id||null}catch{return null}}function xe(e=new Date){const t=D(e)||new Date;let n=L[0];for(const i of L){const a=D(i.effectiveDate);a&&a.getTime()<=t.getTime()&&(n=i)}return n||V()}function We({asOfDate:e=new Date,ignoreOverride:t=!1}={}){if(!t){const i=Fe();if(i){const a=J(i);if(a)return{...a,source:"override"}}}return{...xe(e),source:"effective_date"}}function Ee(e){const t={...ve};return e?.arrangedEmploymentPoints?(t.job_offer_00=200,t.job_offer_other=50):(t.job_offer_00=0,t.job_offer_other=0),t}function Q({asOfDate:e=new Date,ignoreOverride:t=!1}={}){const n=We({asOfDate:e,ignoreOverride:t});return{version:n.id,label:n.label,source:n.source,effectiveDate:n.effectiveDate,notes:n.notes,tables:{agePoints:se,educationPoints:ce,firstLangPoints:le,secondLangPoints:de,canadianWorkPoints:ue,spouseEducationPoints:fe,spouseLangPoints:me,spouseWorkPoints:ge,eduRank:ye,eduLangTransfer:ke,eduCWETransfer:be,fweLangTransfer:Ce,fweCWETransfer:we,certLangTransfer:Se,additionalPointsTable:Ee(n)},converters:{ieltsToCLB:he,tefToNCLC:Me,tcfToNCLC:Te},caps:{secondLanguageNoSpouse:24,secondLanguageWithSpouse:22,spouseTotal:40,skillTransferabilityTotal:100,additionalPointsTotal:600,crsTotal:1200}}}const X=V();X.id,X.effectiveDate,Q({ignoreOverride:!0});const Z=(e,t,n)=>Math.max(t,Math.min(n,e)),M=()=>Q();function Ie(e,t=M()){const n={...e},i=N(e)==="french"||e.hasFrench==="yes";if(i&&e.frenchTestType==="tef")for(const a of["listening","reading","writing","speaking"])n[`french_${a}`]=String(t.converters.tefToNCLC(a,parseInt(e[`tef_${a}`],10)||0));else if(i&&e.frenchTestType==="tcf")for(const a of["listening","reading","writing","speaking"])n[`french_${a}`]=String(t.converters.tcfToNCLC(a,parseInt(e[`tcf_${a}`],10)||0));return n}function N(e){return e.firstOfficialLanguage==="french"?"french":"english"}function $(e){return N(e)==="french"||e.hasFrench==="yes"}function G(e){return e.hasSpouse==="yes"&&e.spouseIsCanadian!=="yes"&&e.spouseAccompanying!=="no"}const F=e=>G(e)?1:0;function A(e,t,n=M()){if(e.langTestType==="celpip")return Z(parseInt(e[`celpip_${t}`],10)||0,0,12);const i=parseFloat(e[`ielts_${t}`])||0;return n.converters.ieltsToCLB(t,i)}function B(e,t){return Z(parseInt(e[`french_${t}`],10)||0,0,12)}function ee(e,t,n=M()){return N(e)==="french"?B(e,t):A(e,t,n)}function H(e,t=M()){const n=["listening","reading","writing","speaking"];let i=99;for(const a of n){const o=ee(e,a,t);o<i&&(i=o)}return i===99?0:i}function De(e,t=M()){const n=["listening","reading","writing","speaking"];let i=99;for(const a of n){const o=A(e,a,t);o<i&&(i=o)}return i===99?0:i}function Ne(e){if(!$(e))return 0;const t=["listening","reading","writing","speaking"];let n=99;for(const i of t){const a=B(e,i);a<n&&(n=a)}return n===99?0:n}function Oe(e,t){const n=H(e,t);return n>=9?2:n>=7?1:0}function Re(e){const t=parseInt(e.canadianWorkExp,10)||0;return t>=2?2:t>=1?1:0}function $e(e){const t=parseInt(e.foreignWorkExp,10)||0;return t>=3?2:t>=1?1:0}function Ge(e,t){let n=parseInt(e.age,10);return Number.isNaN(n)?0:(n<18&&(n=17),n>47&&(n=47),n>44&&(n=45),t.tables.agePoints[n]?.[F(e)]||0)}function Ae(e,t){return t.tables.educationPoints[e.education]?.[F(e)]||0}function Be(e,t){const n=["listening","reading","writing","speaking"],i=F(e);return n.reduce((a,o)=>{const r=ee(e,o,t);return a+(t.tables.firstLangPoints[r]?.[i]||0)},0)}function He(e,t){const n=N(e);if(!(n==="french"?e.langTestType==="ielts"||e.langTestType==="celpip":$(e)))return 0;const a=["listening","reading","writing","speaking"],o=F(e),r=a.reduce((s,c)=>{const l=n==="french"?A(e,c,t):B(e,c);return s+(t.tables.secondLangPoints[l]?.[o]||0)},0);return Math.min(r,o===0?t.caps.secondLanguageNoSpouse:t.caps.secondLanguageWithSpouse)}function je(e,t){let n=parseInt(e.canadianWorkExp,10)||0;return n>5&&(n=5),t.tables.canadianWorkPoints[n]?.[F(e)]||0}function ze(e,t){if(!G(e))return 0;let n=0;n+=t.tables.spouseEducationPoints[e.spouseEducation]||0;const i=["listening","reading","writing","speaking"];let a=0;for(const r of i){const s=parseInt(e[`spouseLang_${r}`],10)||0;a+=t.tables.spouseLangPoints[s]||0}n+=Math.min(a,20);let o=parseInt(e.spouseCanadianWork,10)||0;return o>5&&(o=5),n+=t.tables.spouseWorkPoints[o]||0,Math.min(n,t.caps.spouseTotal)}function Ye(e,t){const n=t.tables.eduRank[e.education]||0,i=Oe(e,t),a=Re(e),o=$e(e),r=t.tables.eduLangTransfer[n]?.[i]||0,s=t.tables.eduCWETransfer[n]?.[a]||0,c=Math.min(r+s,50),l=t.tables.fweLangTransfer[o]?.[i]||0,u=t.tables.fweCWETransfer[o]?.[a]||0,d=Math.min(l+u,50);let m=0;if(e.pathway==="fst"&&e.hasCertificate==="yes"){const f=H(e,t);m=t.tables.certLangTransfer[f>=7?2:f>=5?1:0]}return Math.min(c+d+m,t.caps.skillTransferabilityTotal)}function Ue(e,t){let n=0;const i=t.tables.additionalPointsTable;return e.hasPNP==="yes"&&(n+=i.pnp_nomination),e.hasJobOffer==="yes"&&(n+=e.jobOfferTeer==="teer_0"?i.job_offer_00:i.job_offer_other),e.canadianEducation==="yes"&&(n+=e.canadianEduType==="long"?i.canadian_edu_long:i.canadian_edu_short),e.hasSibling==="yes"&&(n+=i.sibling_in_canada),$(e)&&Ne(e)>=7&&(n+=De(e,t)>=5?i.french_strong_strong_english:i.french_strong_weak_english),Math.min(n,t.caps.additionalPointsTotal)}function qe(e){const t=M(),n=Ie(e,t),i=Ge(n,t),a=Ae(n,t),o=Be(n,t),r=He(n,t),s=je(n,t),c=parseInt(n.foreignWorkExp,10)||0,l=i+a+o+r+s,u=ze(n,t),d=Ye(n,t),m=Ue(n,t);return{total:Math.min(l+u+d+m,t.caps.crsTotal),breakdown:{coreHumanCapital:l,spouseFactors:u,skillTransferability:d,additionalPoints:m},details:{age:i,education:a,firstLanguage:o,secondLanguage:r,canadianWork:s,foreignWork:c,spouseTotal:u,skillTotal:d,additionalTotal:m},policy:{version:t.version,effectiveDate:t.effectiveDate,source:t.source}}}function Ke(e,t){return qe({...e,...t})}const j=["less_than_secondary","secondary","one_year_post","two_year_post","bachelors","two_or_more","masters","doctoral"],Ve={Easy:14,Medium:7,Hard:0},te={high:78,medium:58,low:35};function z(e,t,n){return Math.max(t,Math.min(n,e))}function Je(e,t=K.averageCutoff){return Math.max(t+10,e+25)}function Qe(e,t){return{listening:{7:6,8:7.5,9:8,10:8.5},reading:{7:6,8:6.5,9:7,10:8},writing:{7:6,8:6.5,9:7,10:7.5},speaking:{7:6,8:6.5,9:7,10:7.5}}[e]?.[t]||0}function Xe(e,t){if(e.firstOfficialLanguage==="french"){const i=["listening","reading","writing","speaking"],a={hasFrench:"yes",frenchTestType:"clb"};for(const o of i){const r=`french_${o}`;a[r]=String(Math.max(parseInt(e[r],10)||0,t))}return a}const n=["listening","reading","writing","speaking"];if(e.langTestType==="celpip"){const i={};for(const a of n){const o=`celpip_${a}`;i[o]=String(Math.max(parseInt(e[o],10)||0,t))}return i}if(e.langTestType==="ielts"){const i={};for(const a of n){const o=`ielts_${a}`,r=Qe(a,t);i[o]=String(Math.max(parseFloat(e[o])||0,r))}return i}return{langTestType:"celpip",celpip_listening:String(t),celpip_reading:String(t),celpip_writing:String(t),celpip_speaking:String(t)}}function Ze(e,t=7){const n={listening:parseInt(e.french_listening,10)||0,reading:parseInt(e.french_reading,10)||0,writing:parseInt(e.french_writing,10)||0,speaking:parseInt(e.french_speaking,10)||0};return{hasFrench:"yes",frenchTestType:"clb",french_listening:String(Math.max(n.listening,t)),french_reading:String(Math.max(n.reading,t)),french_writing:String(Math.max(n.writing,t)),french_speaking:String(Math.max(n.speaking,t))}}function et({pathId:e,gain:t,months:n,steps:i}){return i.map((a,o)=>({id:`${e}-m${o+1}`,title:a.title,details:a.details,etaWeeks:a.etaWeeks,expectedGain:o===i.length-1?Math.max(t-i.slice(0,-1).reduce((r,s)=>r+s.expectedGain,0),0):a.expectedGain,done:!1,monthHint:z(Math.ceil((a.etaWeeks||1)/4),1,n)}))}function ne({gain:e,months:t,difficulty:n,goalReached:i,likelihood:a}){const o=z(24-t*2,0,24),r=z(Math.round(e/4),0,80),s=i?32:0,c=Math.round((te[a]||0)/3);return r+o+s+c+(Ve[n]||0)}function P({id:e,title:t,summary:n,category:i,difficulty:a,months:o,estimatedCostCad:r,whyItFits:s,likelihood:c="medium",overrides:l,currentScore:u,targetScore:d,milestoneSteps:m}){const f=Ke(l.baseAnswers,l.patch),S=f.total-u;if(S<=0)return null;const v=f.total>=d,y=et({pathId:e,gain:S,months:o,steps:m});return{id:e,title:t,summary:n,category:i,difficulty:a,estimatedMonths:o,estimatedCostCad:r,projectedScore:f.total,potentialGain:S,goalReached:v,whyItFits:s,likelihood:c,likelihoodPercent:te[c]||50,fitScore:ne({gain:S,months:o,difficulty:a,goalReached:v,likelihood:c}),milestones:y,checks:{targetScore:d,currentScore:u,stillNeededAfterPath:Math.max(d-f.total,0)}}}function tt(e,t,n){const i=H(e);if(i>=10)return null;const a=i<7?8:9,o=e.firstOfficialLanguage==="french"?"french":"english",r=o==="french"?"French Accelerator Path":"English Accelerator Path",s=o==="french"?"Raise your weakest French ability first, then target NCLC 9+ for stronger transferability outcomes.":"Raise your weakest English ability first, then target CLB 9+ for transferability gains.";return P({id:`${o}-accelerator`,title:r,summary:s,category:"Language",difficulty:"Medium",months:4,estimatedCostCad:460,whyItFits:`Your current minimum first-official-language level is CLB/NCLC ${i}, so language gains are one of the fastest realistic boosters.`,likelihood:"high",overrides:{baseAnswers:e,patch:Xe(e,a)},currentScore:t,targetScore:n,milestoneSteps:[{title:"Baseline audit and weak-skill diagnosis",details:"Run a mock test and identify the lowest 2 abilities to prioritize.",etaWeeks:1,expectedGain:0},{title:"Targeted study sprint",details:"Follow a 5-day weekly schedule focused on weakest modules and timed drills.",etaWeeks:6,expectedGain:8},{title:"Exam booking + strategy correction",details:"Book IELTS/CELPIP and fine-tune pacing, vocabulary, and response format.",etaWeeks:4,expectedGain:8},{title:"Retake and profile refresh",details:"Update final language scores in your profile and reassess draw competitiveness.",etaWeeks:4,expectedGain:12}]})}function nt(e,t,n){return e.firstOfficialLanguage==="french"?null:P({id:"french-advantage",title:"French Advantage Path",summary:"Reach NCLC 7 in all French abilities to unlock additional points and French-category draw access.",category:"Language",difficulty:"Hard",months:8,estimatedCostCad:690,whyItFits:"French pathways remain one of the highest-yield options for many candidates below general cutoffs.",likelihood:e.hasFrench==="yes"?"high":"medium",overrides:{baseAnswers:e,patch:Ze(e,7)},currentScore:t,targetScore:n,milestoneSteps:[{title:"French baseline + study plan",details:"Assess current level and choose a structured curriculum for NCLC 7 goal.",etaWeeks:2,expectedGain:0},{title:"Core skill build phase",details:"Intensive reading/listening practice with weekly speaking/writing correction.",etaWeeks:12,expectedGain:8},{title:"TEF/TCF prep and mock cycles",details:"Complete timed mocks and focus weak modules before exam booking.",etaWeeks:8,expectedGain:8},{title:"Exam and score integration",details:"Enter verified NCLC scores and evaluate French-category competitiveness.",etaWeeks:6,expectedGain:12}]})}function it(e,t,n){const i=parseInt(e.canadianWorkExp,10)||0;return i>=5?null:P({id:"canadian-work-ladder",title:"Canadian Work Ladder Path",summary:"Add one more year of Canadian skilled work to increase core and transferability points.",category:"Work Experience",difficulty:"Hard",months:12,estimatedCostCad:0,whyItFits:`You currently report ${i} year(s) of Canadian work; the next year can materially lift your score.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{canadianWorkExp:String(i+1)}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Employer alignment",details:"Confirm TEER eligibility and maintain full-time skilled role continuity.",etaWeeks:2,expectedGain:0},{title:"Documentation discipline",details:"Collect monthly pay records and letters for future proof of experience.",etaWeeks:16,expectedGain:4},{title:"Mid-year score checkpoint",details:"Recalculate progress and combine with language upgrades if needed.",etaWeeks:24,expectedGain:6},{title:"Complete one full year increment",details:"Update profile immediately when additional year is met.",etaWeeks:52,expectedGain:12}]})}function at(e,t,n){const i=j.indexOf(e.education);if(i<0||i>=j.length-1)return null;const a=j[i+1];return P({id:"education-upgrade",title:"Education Upgrade Path",summary:"Move to the next recognized credential tier for predictable CRS uplift.",category:"Education",difficulty:"Hard",months:18,estimatedCostCad:12e3,whyItFits:`Your current education level can be improved to ${a.replace(/_/g," ")} for additional points.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{education:a}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Program selection",details:"Choose an accredited credential path aligned to CRS point tiers.",etaWeeks:4,expectedGain:0},{title:"Enrollment and milestone completion",details:"Track term-level progress to keep the plan on schedule.",etaWeeks:20,expectedGain:4},{title:"Credential completion prep",details:"Prepare final documents and ECA requirements where needed.",etaWeeks:20,expectedGain:4},{title:"Credential update in profile",details:"Add completed credential and recalculate total score immediately.",etaWeeks:28,expectedGain:10}]})}function ot(e,t,n){if(!G(e))return null;const i=["listening","reading","writing","speaking"],a={};for(const o of i){const r=`spouseLang_${o}`;a[r]=String(Math.max(parseInt(e[r],10)||0,9))}return P({id:"spouse-optimization",title:"Spouse Optimization Path",summary:"Use spouse language and experience factors for faster low-cost point improvements.",category:"Family Factors",difficulty:"Medium",months:5,estimatedCostCad:420,whyItFits:"You have an accompanying spouse, so spouse-factor optimization is available and often underused.",likelihood:"high",overrides:{baseAnswers:e,patch:a},currentScore:t,targetScore:n,milestoneSteps:[{title:"Spouse baseline review",details:"Identify spouse factors currently missing points.",etaWeeks:1,expectedGain:0},{title:"Spouse language prep",details:"Prepare specifically for CLB 9 in the weakest spouse abilities.",etaWeeks:8,expectedGain:4},{title:"Spouse profile integration",details:"Update spouse test scores and re-optimize joint profile configuration.",etaWeeks:6,expectedGain:8}]})}function rt(e,t,n){return e.hasPNP==="yes"?null:P({id:"pnp-fast-track",title:"PNP Fast-Track Path",summary:"Pursue provincial nomination for the largest single CRS jump (+600).",category:"Provincial",difficulty:"Hard",months:6,estimatedCostCad:2200,whyItFits:"If your baseline is below recent cutoffs, PNP remains the most direct guaranteed-lift route.",likelihood:"medium",overrides:{baseAnswers:e,patch:{hasPNP:"yes"}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Province shortlist",details:"Match your profile to provinces aligned with occupation/language strengths.",etaWeeks:2,expectedGain:0},{title:"Document stack preparation",details:"Prepare references, test proofs, ECA, and provincial forms early.",etaWeeks:6,expectedGain:0},{title:"Submit nomination stream",details:"Apply to selected stream and monitor NOI/application updates.",etaWeeks:8,expectedGain:0},{title:"Nomination linked to profile",details:"Accept nomination and refresh profile for major score jump.",etaWeeks:8,expectedGain:600}]})}function st(e,t){const n=[...e].sort((c,l)=>l.fitScore-c.fitScore);if(n.length<2)return null;const[i,a]=n,o=Math.min(i.projectedScore+a.potentialGain,1200),r=o-i.checks.currentScore;if(r<=0)return null;const s=o>=t;return{id:"combo-bridge-plan",title:"Bridge Combination Path",summary:`Combine “${i.title}” + “${a.title}” to maximize speed while limiting risk.`,category:"Combination",difficulty:i.difficulty==="Hard"||a.difficulty==="Hard"?"Hard":"Medium",estimatedMonths:Math.round((i.estimatedMonths+a.estimatedMonths)/2),estimatedCostCad:i.estimatedCostCad+a.estimatedCostCad,projectedScore:o,potentialGain:r,goalReached:s,whyItFits:"A blended route often reaches target faster than single-track attempts.",likelihood:"medium",likelihoodPercent:62,fitScore:ne({gain:r,months:Math.round((i.estimatedMonths+a.estimatedMonths)/2),difficulty:i.difficulty==="Hard"||a.difficulty==="Hard"?"Hard":"Medium",goalReached:s,likelihood:"medium"}),milestones:[...i.milestones.slice(0,2).map(c=>({...c,id:`combo-${c.id}`})),...a.milestones.slice(0,2).map(c=>({...c,id:`combo-${c.id}`})),{id:"combo-final-sync",title:"Final score synchronization",details:"Update all achieved improvements together and reassess draw strategy.",etaWeeks:4,expectedGain:Math.max(r-16,0),done:!1,monthHint:2}],checks:{targetScore:t,currentScore:i.checks.currentScore,stillNeededAfterPath:Math.max(t-o,0)}}}function ct(e,t,n={}){const i=t?.total||0,a=Number(n.averageCutoff)||K.averageCutoff,o=Number(n.targetScore)||Je(i,a),r=[tt(e,i,o),nt(e,i,o),it(e,i,o),at(e,i,o),ot(e,i,o),rt(e,i,o)].filter(Boolean),s=st(r,o);s&&r.push(s);const c=r.sort((l,u)=>u.fitScore-l.fitScore).slice(0,5);return{currentScore:i,targetScore:o,plans:c,generatedAt:new Date().toISOString()}}const ie=1440*60*1e3,ae={High:3,Medium:2,Low:1},C={impact:.34,speed:.18,confidence:.22,effort:.12,laneFit:.14};function p(e,t,n){return Math.max(t,Math.min(n,e))}function lt(e,t){return`Day ${e}-${t}`}function b(e,t=0){const n=Number(e);return Number.isFinite(n)?n:t}function x(e,t=0){const n=parseInt(e,10);return Number.isFinite(n)?n:t}function dt(e=new Date){const t=new Date(e);return t.setHours(0,0,0,0),t}function O(e,t){return new Date(e.getTime()+t*ie)}function Y(e){try{return e.toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return e.toISOString().slice(0,10)}}function R(e,t,n){const i=O(e,Math.max(t-1,0)),a=O(e,Math.max(n-1,0));return{startDateIso:i.toISOString(),endDateIso:a.toISOString(),weekWindow:`Week ${Math.ceil(t/7)}-${Math.ceil(n/7)}`,dateWindow:`${Y(i)} → ${Y(a)}`}}function ut(e,t){const n=b(t);return e==="listening"?n>=8.5?10:n>=8?9:n>=7.5?8:n>=6?7:n>=5.5?6:n>=5?5:0:e==="reading"?n>=8?10:n>=7?9:n>=6.5?8:n>=6?7:n>=5?6:n>=4?5:0:n>=7.5?10:n>=7?9:n>=6.5?8:n>=6?7:n>=5.5?6:n>=5?5:0}function ft(e={}){const t=["listening","reading","writing","speaking"],n=e.firstOfficialLanguage==="french",a=t.map(o=>n?x(e[`french_${o}`],0):e.langTestType==="celpip"?x(e[`celpip_${o}`],0):ut(o,e[`ielts_${o}`])).filter(o=>o>0);return a.length?Math.min(...a):0}function w(e,t,n,i="medium"){return{id:e,label:t,detail:n,severity:i}}function mt(e){return e==="high"?10:e==="medium"?5:2}function gt(e="Medium"){return e==="Easy"?100:e==="Medium"?68:38}function pt(e=0){return e>=76?"High":e>=56?"Medium":"Low"}function ht(e={},t,n){const i=b(t?.total),a=n-i,o=x(e.age,0),r=ft(e),s=e.hasFrench==="yes"||e.firstOfficialLanguage==="french",c=x(e.canadianWorkExp,0),l=x(e.foreignWorkExp,0),u=r>=9?18:r>=7?46:74,d=p((o>=33?28:14)+(r<7?26:r<9?16:6)+(c===0?12:4)+(l>=3?8:3),10,90),m=[{key:"answers_accuracy",label:"Profile values are accurate and complete",confidence:e.knowsScore==="yes"?"Medium":"High"},{key:"draw_trend_stability",label:"Recent draw patterns remain directionally similar",confidence:Math.abs(a)<=20?"Medium":"Low"},{key:"execution_discipline",label:"You can sustain weekly execution cadence for 90 days",confidence:d<=45?"High":d<=65?"Medium":"Low"}],f=[];return o>=33&&f.push(w("risk-age-decay","Age-point decay risk","Delays can reduce score as age thresholds change.",o>=38?"high":"medium")),r>0&&r<7&&f.push(w("risk-language-floor","Language floor below CLB 7","Several lanes become weaker or inaccessible below CLB 7.","high")),s||f.push(w("risk-no-french","No French upside yet","You may miss lower-cutoff category opportunities tied to French strength.","low")),a>40&&f.push(w("risk-large-gap","Large score gap","A single action may not close this gap; a combination strategy is likely required.","high")),{score:i,gap:a,age:o,minLanguageClb:r,hasFrench:s,canadianWorkExp:c,foreignWorkExp:l,languageHeadroom:u,profileComplexity:d,assumptions:m,globalRiskFlags:f}}function yt(e,t,n){const i=e.category==="Language"?50+t.languageHeadroom*.45:e.category==="Provincial"?72:e.category==="Combination"?76:60,a=p(i+(e.goalReached?8:0)+(e.likelihoodPercent-50)*.35,30,95),o=[];return e.estimatedMonths>=10&&o.push(w(`${e.id}-timeline`,"Long timeline","This lane can take substantial time before score impact materializes.","medium")),e.difficulty==="Hard"&&o.push(w(`${e.id}-effort`,"Execution intensity","Consistent weekly effort is required to avoid plan drift.","medium")),!e.goalReached&&n>0&&o.push(w(`${e.id}-bridge`,"May require a second lane","This lane may need a backup action to fully close your gap.","low")),{id:`path-${e.id}`,title:e.title,lane:e.category,reason:e.whyItFits,scoreGain:e.potentialGain,months:e.estimatedMonths,confidence:e.likelihoodPercent,effort:e.difficulty,laneFit:a,riskFlags:o}}function kt({score:e,cutoff:t,eligibleCount:n,signals:i}){const a=t-e,o=a<=0?82:a<=20?64:38,r=[];return n||r.push(w("category-not-eligible","Not category-eligible yet","A prerequisite profile change is required before this lane can be used.","high")),a>35&&r.push(w("category-gap","Gap still material","Category targeting helps, but the score gap remains significant.","medium")),{id:"lane-category-draws",title:"Category Draw Positioning",lane:"Category Draws",reason:n>0?`You match ${n} category stream(s). Improve targeted factors to close the category cutoff gap.`:"You are not currently category-eligible; targeted profile adjustments can unlock lower-cutoff streams.",scoreGain:p(Math.round(Math.max(a,0)*.5),0,80),months:a<=0?1:a<=20?4:8,confidence:o,effort:a<=0?"Easy":a<=20?"Medium":"Hard",laneFit:p((n>0?70:35)+(i.hasFrench?8:0),25,90),riskFlags:r}}function bt(e){if(!e)return null;const t=[];return e.matchScore<55&&t.push(w(`province-${e.id}-fit`,"Lower province fit","Province alignment is currently moderate; stream targeting needs tighter matching.","high")),e.matchScore>=55&&e.matchScore<70&&t.push(w(`province-${e.id}-variance`,"Selection variance","Provincial intake criteria can shift and may require profile tuning.","medium")),{id:`lane-province-${e.id}`,title:`${e.name} PNP Focus`,lane:"Provincial",reason:`${e.name} has the highest profile match in your province analysis.`,scoreGain:e.matchScore>=70?600:300,months:e.matchScore>=70?6:9,confidence:p(e.matchScore,35,88),effort:e.matchScore>=70?"Medium":"Hard",laneFit:p(e.matchScore+(e.matchScore>=70?6:-4),25,95),riskFlags:t}}function Ct(e={},t=0){return[{key:"coreHumanCapital",label:"Core profile factors",value:b(e.coreHumanCapital)},{key:"skillTransferability",label:"Transferability factors",value:b(e.skillTransferability)},{key:"additionalPoints",label:"Additional point factors",value:b(e.additionalPoints)},{key:"spouseFactors",label:"Spouse factors",value:b(e.spouseFactors)}].map(i=>({...i,headroom:p(100-Math.round(i.value/Math.max(t,1)*100),0,100)})).sort((i,a)=>a.headroom-i.headroom).slice(0,2)}function wt(e,t){const n=Math.max(Math.abs(t),35),i=p(Math.round(e.scoreGain/n*100),8,100),a=p(100-e.months*11,12,100),o=p(e.confidence,12,100),r=gt(e.effort),s=p(b(e.laneFit,60),10,100),c=i*C.impact+a*C.speed+o*C.confidence+r*C.effort+s*C.laneFit,l=Array.isArray(e.riskFlags)?e.riskFlags:[],u=p(l.reduce((m,f)=>m+mt(f.severity),0),0,24),d=p(Math.round(c-u),1,100);return{...e,score:d,riskPenalty:u,scoreBreakdown:[{key:"impact",label:"Impact potential",value:i,weight:C.impact},{key:"speed",label:"Speed to value",value:a,weight:C.speed},{key:"confidence",label:"Data confidence",value:o,weight:C.confidence},{key:"effort",label:"Execution ease",value:r,weight:C.effort},{key:"laneFit",label:"Profile-lane fit",value:s,weight:C.laneFit}]}}function St(e){const t=new Date(e?.date||"");return Number.isNaN(t.getTime())?null:t}function vt(e={},t=10){return[...e.generalProgram||[],...e.categoryBased||[],...e.pnpDraws||[]].map(i=>({score:b(i?.score),date:St(i),program:i?.program||"Unknown"})).filter(i=>i.score>0&&i.date).sort((i,a)=>a.date.getTime()-i.date.getTime()).slice(0,t)}function _t(e=[]){if(!e.length)return 0;const t=e.reduce((i,a)=>i+a,0)/e.length,n=e.reduce((i,a)=>i+(a-t)**2,0)/e.length;return Math.sqrt(n)}function Mt(e=0){return e>=75?"High":e>=55?"Medium":"Low"}function Pt({activeDraws:e,userScore:t,baseConfidence:n=60}){const i=vt(e,10);if(!i.length)return null;const a=i[0],o=[...i].reverse(),r=o[0],s=o[o.length-1],c=o.length,l=c>1?(s.score-r.score)/(c-1):0,u=a.score,d=Math.round(p(u+l,300,800)),m=Math.round(p(d+l,300,800)),f=Math.round(p(m+l,300,800)),S=Math.round((d+m+f)/3),v=_t(i.map(I=>I.score)),y=a.date,k=y?Math.floor((Date.now()-y.getTime())/ie):999;let h=b(n,60);h+=Math.min(c*3,18),h-=Math.min(v*1.2,24),k<=2?h+=5:k<=7?h+=1:k>14&&(h-=9),h=p(Math.round(h),20,92);const W=l>1.5?"rising":l<-1.5?"falling":"stable",U=W==="rising"?"Cutoff trend is rising":W==="falling"?"Cutoff trend is falling":"Cutoff trend is stable",E=b(t)-d,q=E>=20?"High":E>=0?"Medium":"Low";return{sampleSize:c,volatility:Number(v.toFixed(2)),slopePerDraw:Number(l.toFixed(2)),projectedNextCutoff:d,projectedThreeDrawAvg:S,projectedDraws:[d,m,f],trendDirection:W,trendLabel:U,confidenceScore:h,confidenceBand:Mt(h),invitationLikelihood:q,userGapToNext:E,latestObservedCutoff:u,latestObservedProgram:a.program,latestObservedDateIso:y?.toISOString()||""}}function Tt({answers:e,result:t,averageCutoff:n,categoryInfo:i=[],provinces:a=[],eligibleCategoryCount:o=Number.NaN}){const r=b(t?.total),s=b(n,520),c=s-r,l=ht(e,t,s),d=(ct(e,t,{averageCutoff:s}).plans||[]).slice(0,2).map(g=>yt(g,l,c)),m=b(o,Number.NaN),f=Number.isFinite(m)?Math.max(Math.round(m),0):i.filter(g=>typeof g?.check=="function"&&g.check(e)).length,S=kt({score:r,cutoff:s,eligibleCount:f,signals:l}),v=bt((a||[])[0]||null),k=[...d,S,v].filter(Boolean).map(g=>wt(g,c)).sort((g,_)=>_.score-g.score).slice(0,4),h=k[0]||null,W=k[1]||null,U=Ct(t?.breakdown,r),E=[...l.globalRiskFlags||[],...k.slice(0,2).flatMap(g=>g.riskFlags||[])],q=Object.values(E.reduce((g,_)=>(_?.id&&(g[_.id]||(g[_.id]=_)),g),{})).slice(0,5),I=k.slice(0,2).map(g=>p(g.confidence-g.riskPenalty,0,100)),oe=I.length?Math.round(I.reduce((g,_)=>g+_,0)/I.length):36,re=pt(oe),xt=h?`Primary lane: ${h.title}. Estimated gain ${h.scoreGain} points in ~${h.months} months (${re.toLowerCase()} confidence).`:"No strong lane detected yet. Start by improving language and category eligibility.";return{score:r,cutoff:s,gap:c,ranked:k,top:h,nextBest:W,bottlenecks:U,assumptions:l.assumptions,globalRiskFlags:q,overallConfidence:oe,confidenceBand:re,profileSignals:{minLanguageClb:l.minLanguageClb,profileComplexity:l.profileComplexity,languageHeadroom:l.languageHeadroom},scoreWeights:C,guidanceSummary:xt}}function Lt({answers:e,result:t,suggestions:n=[],averageCutoff:i,activeDraws:a,categoryInfo:o=[],provinces:r=[],progress:s={},enableAdvancedForecasting:c=!1,eligibleCategoryCount:l=Number.NaN}){const u=Tt({answers:e,result:t,averageCutoff:i,categoryInfo:o,provinces:r,eligibleCategoryCount:l}),d=Ft({suggestions:n,strategy:u,scoreGap:Math.max((i||0)-(t?.total||0),0),progress:s}),m=c?Pt({activeDraws:a,userScore:t?.total||0,baseConfidence:u.overallConfidence}):null;return{strategy:u,actionPlan:d,forecast:m}}function T(e,t,n,i,a,o,r,s="Medium",c,l={}){const{startDateIso:u,endDateIso:d,weekWindow:m,dateWindow:f}=R(c,i,a);return{id:e,title:t,rationale:n,window:lt(i,a),dayFrom:i,dayTo:a,impact:o,lane:r,priority:s,startDateIso:u,endDateIso:d,weekWindow:m,dateWindow:f,successMetric:l.successMetric||"Task completed with verified profile update.",checkpoint:l.checkpoint||"Run a score recalculation and note delta.",dependencies:l.dependencies||[],cadence:l.cadence||"3 focused sessions per week"}}function Ft({suggestions:e=[],strategy:t,scoreGap:n=0,progress:i={}}){const a=e[1],o=t?.top?.title||"Profile Optimization",r=Math.max(b(n),0),s=dt(new Date),c=[T("plan-baseline","Lock baseline and target score",`Set a concrete target and freeze your baseline profile to avoid random changes. Current gap: ${r} points.`,1,7,0,o,"High",s,{successMetric:"Target score and top lane documented; baseline snapshot saved.",checkpoint:"Save profile with date tag and score target.",cadence:"One 45-minute planning block + one review"}),T("plan-primary-lane",`Execute primary lane: ${o}`,t?.top?.reason||"Follow the highest-impact lane identified by optimizer.",8,30,t?.top?.scoreGain||10,o,"High",s,{successMetric:`Deliver at least 60% of ${o} milestones.`,checkpoint:"Verify measurable progress (test booking, docs, submissions, etc.)."}),T("plan-secondary-lane",a?`Secondary boost: ${a.title}`:"Secondary boost: language and profile precision",a?.description||"Add one additional improvement path to reduce draw uncertainty.",24,50,a?.potentialGain||8,a?.title||"Secondary path","Medium",s,{successMetric:"Secondary lane started with first concrete deliverable completed.",checkpoint:"Compare score delta before/after secondary-lane kickoff.",dependencies:["plan-primary-lane"]}),T("plan-document-pack","Prepare immigration document pack","Collect and verify key documents (identity, education, work proofs, test reports, proof-of-funds readiness).",35,68,0,"Readiness","High",s,{successMetric:"Core document checklist reaches 90% readiness.",checkpoint:"Review missing docs and issue dates.",cadence:"Two short admin sessions weekly"}),T("plan-risk-buffer","Activate fallback lane if progress stalls","If progress velocity is below target, start a backup action immediately (e.g., category-specific adjustment or province-first route).",55,80,6,"Fallback Control","Medium",s,{successMetric:"Fallback lane is selected and started within 7 days of stall signal.",checkpoint:"Mark stall trigger if expected gain is short by 20%+.",dependencies:["plan-primary-lane"]}),T("plan-profile-audit","Profile audit and draw readiness check","Re-evaluate score vs latest draws and category cutoffs. Trigger fallback lane if gap remains above 15 points.",75,90,0,"Risk Control","High",s,{successMetric:"Final 90-day readiness review completed with go/no-go decision.",checkpoint:"Capture current score, active cutoff delta, and next 30-day plan.",dependencies:["plan-document-pack"]})],l=[{label:"Days 1-30",objective:"Baseline lock + launch primary lane",expectedGain:c[1].impact,dateWindow:R(s,1,30).dateWindow},{label:"Days 31-60",objective:"Add secondary lane + document readiness",expectedGain:c[2].impact,dateWindow:R(s,31,60).dateWindow},{label:"Days 61-90",objective:"Fallback control + final draw readiness review",expectedGain:c[4].impact,dateWindow:R(s,61,90).dateWindow}],u=c.filter(y=>!!i[y.id]).length,d=c.length,m=d>0?Math.round(u/d*100):0,f=[...c].filter(y=>!i[y.id]).sort((y,k)=>{const h=ae[k.priority]-ae[y.priority];return h!==0?h:y.dayFrom-k.dayFrom})[0]||null,S=m>=100?"All action-plan tasks are complete. Keep a weekly score monitor to stay draw-ready.":f?`Next best task: ${f.title} (${f.dateWindow}).`:"Continue progressing through the plan in order of priority.",v=[14,30,60,90].map(y=>{const k=O(s,y-1);return{day:y,iso:k.toISOString(),label:Y(k)}});return{tasks:c,milestones:l,completedCount:u,totalCount:d,completionPct:m,nextBestTask:f,completionGuidance:S,calendar:{planStartIso:s.toISOString(),planEndIso:O(s,89).toISOString(),reviewDates:v}}}self.onmessage=e=>{const t=e?.data||{},n=t.id;try{const i=Lt(t.input||{});self.postMessage({id:n,status:"ok",data:i})}catch(i){self.postMessage({id:n,status:"error",error:String(i?.message||"Worker computation failed")})}}})();
