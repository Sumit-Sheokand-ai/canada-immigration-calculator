const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Wizard-BX6InIsd.js","assets/vendor-react-Ah1pgjPn.js","assets/data-question-bank-dwKgXfTg.js","assets/feature-strategy-hub-COzkZaoL.js","assets/feature-path-coach-DVgRK0e5.js","assets/vendor-motion-CtNR3TjB.js","assets/questionDataSource-CYn6-E29.js","assets/Results-Bc43U6Nw.js","assets/AuthModal-BnjqB9Yl.js","assets/WelcomeScreen-DxuwpYD_.js","assets/motionFeatures-DFpXREjK.js"])))=>i.map(i=>d[i]);
import{_ as I,u as ut,i as ve,g as B,r as dt,a as ft,A as pt}from"./feature-path-coach-DVgRK0e5.js";import{r as o,j as r,c as mt}from"./vendor-react-Ah1pgjPn.js";import{u as Oe,t as g,r as Y,a as ht,b as gt,c as R,L as yt}from"./feature-strategy-hub-COzkZaoL.js";import{u as wt,m as vt,A as bt,L as _t}from"./vendor-motion-CtNR3TjB.js";import{r as U,t as V}from"./data-question-bank-dwKgXfTg.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(i){if(i.ep)return;i.ep=!0;const c=n(i);fetch(i.href,c)}})();const ze=o.createContext();function St({children:e}){const[t,n]=o.useState(()=>{try{return localStorage.getItem("crs-theme")==="dark"}catch{return!1}});o.useEffect(()=>{document.documentElement.setAttribute("data-theme",t?"dark":"light");try{localStorage.setItem("crs-theme",t?"dark":"light")}catch{}},[t]);const s=()=>n(i=>!i);return r.jsx(ze.Provider,{value:{dark:t,toggle:s},children:e})}function Et(){return o.useContext(ze)}const de=new Set;function xt(e){if(typeof window>"u"){e();return}typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>e(),{timeout:1800}):window.setTimeout(e,220)}function Ct(e,t){de.has(e)||(de.add(e),Promise.resolve().then(()=>t()).catch(()=>{de.delete(e)}))}function re(e,t,{idle:n=!1}={}){const s=()=>Ct(e,t);if(n){xt(s);return}s()}function je(e){re("chunk:wizard",()=>I(()=>import("./Wizard-BX6InIsd.js"),__vite__mapDeps([0,1,2,3,4,5,6])),e)}function At(e){re("chunk:results",()=>I(()=>import("./Results-Bc43U6Nw.js"),__vite__mapDeps([7,4,1,2,5,3])),e)}function kt(e){re("chunk:path-coach",()=>I(()=>import("./feature-path-coach-DVgRK0e5.js").then(t=>t.P),__vite__mapDeps([4,1,2,5])),e)}function te(e){re("chunk:auth-modal",()=>I(()=>import("./AuthModal-BnjqB9Yl.js"),__vite__mapDeps([8,1,4,2,5,6,3])),e)}const jt=o.lazy(()=>I(()=>import("./AuthModal-BnjqB9Yl.js"),__vite__mapDeps([8,1,4,2,5,6,3]))),Pt={en:"EN",fr:"FR"};function Nt({canInstallApp:e=!1,onInstallApp:t=()=>{},motionIntensity:n="full"}){const s=wt()||n!=="full",{dark:i,toggle:c}=Et(),{lang:l,setLang:T,t:y}=Oe(),{user:w,ensureAuthReady:b}=ut(),[D,M]=o.useState(!1);return o.useEffect(()=>{const j=()=>{M(!0),te(),b().catch(()=>{})};return window.addEventListener("crs-open-account-modal",j),()=>{window.removeEventListener("crs-open-account-modal",j)}},[b]),r.jsxs(r.Fragment,{children:[r.jsx(vt.header,{className:"header",initial:s?!1:{y:-60,opacity:0},animate:{y:0,opacity:1},transition:s?{duration:0}:{type:"spring",stiffness:120,damping:20},children:r.jsxs("div",{className:"header-inner",children:[r.jsxs("div",{className:"logo",children:[r.jsx("span",{className:"logo-leaf",children:"ðŸ"}),r.jsx("span",{children:y("header.title")})]}),r.jsxs("div",{className:"header-actions",children:[e&&r.jsx("button",{type:"button",className:"install-btn",onClick:t,"aria-label":"Install app",title:"Add app shortcut",children:"Install app"}),r.jsx("button",{type:"button",className:"auth-toggle",onClick:()=>{te(),M(!0),b().catch(()=>{}),g("account_modal_opened",{source:"header_button",is_authenticated:!!w})},onMouseEnter:()=>{te(),b().catch(()=>{})},onFocus:()=>{te(),b().catch(()=>{})},"aria-label":w?"Manage account":"Login or signup",title:w?w.email:"Login / Signup",children:w?"Account":"Login"}),r.jsx("select",{className:"lang-select",value:l,onChange:j=>T(j.target.value),"aria-label":"Select language",children:Object.entries(Pt).map(([j,p])=>r.jsx("option",{value:j,children:p},j))}),r.jsx("button",{type:"button",className:"theme-toggle",onClick:c,"aria-label":i?"Switch to light mode":"Switch to dark mode",title:i?"Light mode":"Dark mode",children:i?"Light":"Dark"})]})]})}),D&&r.jsx(o.Suspense,{fallback:r.jsx("div",{className:"auth-modal-backdrop",role:"presentation",children:r.jsx("div",{className:"auth-modal auth-modal-loading",role:"dialog","aria-modal":"true",children:r.jsxs("div",{className:"auth-modal-head",children:[r.jsx("h3",{children:"Loading accountâ€¦"}),r.jsx("button",{type:"button",className:"auth-close",onClick:()=>M(!1),"aria-label":"Close dialog",children:"Ã—"})]})})}),children:r.jsx(jt,{open:D,onClose:()=>M(!1)})})]})}function fe(){const e=Array.from({length:9});return r.jsxs("div",{className:"uv-loader",children:[e.map((t,n)=>r.jsx("div",{className:"uv-text",children:r.jsx("span",{children:"Loading"})},n)),r.jsx("div",{className:"uv-line"})]})}function Lt(e,t){const n=e.answers||{};return{id:e.id,user_id:t||null,name:e.name||null,score:Number(e.score)||0,email:e.email||null,alert_opt_in:!!e.alertOptIn,alert_token:e.alertToken||null,profile_json:{answers:n,tracking:{userId:t||null,savedAt:new Date().toISOString()}},updated_at:new Date().toISOString()}}function ne(e){const t=String(e?.message||"");return/column\s+["']?user_id["']?\s+does not exist/i.test(t)}function K(e,t){const n=t?.message||t?.hint||String(t);return`${e}: ${n}`}function $(){return ve}async function mr(e,t={}){if(!$())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=await B();if(!n)return{status:"skipped",reason:"Supabase client is unavailable"};const s=t.userId||null,i=Lt(e,s);let c,l;if({data:c,error:l}=await n.from("saved_profiles").upsert(i,{onConflict:"id"}).select(),l&&s&&ne(l)){const{user_id:T,...y}=i;({data:c,error:l}=await n.from("saved_profiles").upsert(y,{onConflict:"id"}).select())}if(l)throw new Error(K("Supabase upsert failed",l));return{status:"ok",data:c||[]}}async function Rt(e){if(!e)return{status:"skipped",reason:"Missing token"};if(!$())return{status:"skipped",reason:"Supabase env vars are not configured"};const t=await B();if(!t)return{status:"skipped",reason:"Supabase client is unavailable"};const{data:n,error:s}=await t.from("saved_profiles").update({alert_opt_in:!1,updated_at:new Date().toISOString()}).eq("alert_token",e).select();if(s)throw new Error(K("Supabase unsubscribe failed",s));return n?.length?{status:"ok",data:n[0]}:{status:"not-found"}}async function hr(e){if(!e)return{status:"skipped",reason:"Missing user id"};if(!$())return{status:"skipped",reason:"Supabase env vars are not configured"};const t=await B();if(!t)return{status:"skipped",reason:"Supabase client is unavailable"};const{data:n,error:s}=await t.from("saved_profiles").select("id,name,score,email,updated_at").eq("user_id",e).order("updated_at",{ascending:!1}).limit(12);if(s&&ne(s))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(s)throw new Error(K("Supabase profile list failed",s));return{status:"ok",data:n||[]}}async function gr(e,t){if(!e)return{status:"skipped",reason:"Missing user id"};if(!$())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=await B();if(!n)return{status:"skipped",reason:"Supabase client is unavailable"};const{error:s,data:i}=await n.from("saved_profiles").update({alert_opt_in:!!t,updated_at:new Date().toISOString()}).eq("user_id",e).select("id");if(s&&ne(s))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(s)throw new Error(K("Supabase alert preference update failed",s));return{status:"ok",updatedCount:i?.length||0}}async function yr(e,t){if(!e)return{status:"skipped",reason:"Missing user id"};if(!$())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=await B();if(!n)return{status:"skipped",reason:"Supabase client is unavailable"};const s=t?String(t).trim().toLowerCase():null,{error:i,data:c}=await n.from("saved_profiles").update({email:s||null,updated_at:new Date().toISOString()}).eq("user_id",e).select("id");if(i&&ne(i))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(i)throw new Error(K("Supabase profile email update failed",i));return{status:"ok",updatedCount:c?.length||0}}const It=300*1e3,Ue=!1,be="crs-cache-latest-draws-v1",_e="crs-cache-category-config-v1";let A={data:null,source:"none",fetchedAt:0},k={data:null,source:"none",fetchedAt:0},me=!1,he=!1,ge=Ue;function Tt(e){return!!e&&typeof e=="object"&&Array.isArray(e.generalProgram)&&Array.isArray(e.categoryBased)&&Array.isArray(e.pnpDraws)&&Number.isFinite(Number(e.averageCutoff))}function Be(e){return Tt(e)?{...e,generalProgram:e.generalProgram||[],categoryBased:e.categoryBased||[],pnpDraws:e.pnpDraws||[],averageCutoff:Number(e.averageCutoff)||U.averageCutoff,lastUpdated:e.lastUpdated||U.lastUpdated,pnpRanges:e.pnpRanges||U.pnpRanges}:null}function Dt(e){if(!e||typeof e!="object")return null;const t=String(e.id||"").trim(),n=String(e.name||"").trim(),s=String(e.icon||"").trim(),i=String(e.description||"").trim(),c=String(e.eligibility||"").trim(),l=String(e.cutoff_range||e.cutoffRange||"").trim(),T=Number(e.recent_cutoff??e.recentCutoff);return!t||!n||!s||!i||!c||!Number.isFinite(T)?null:{id:t,name:n,icon:s,description:i,eligibility:c,recentCutoff:T,cutoffRange:l||"N/A",source:e.source||"supabase",updatedAt:e.updated_at||null}}function Mt(e){if(!e)return!1;const t=String(e.code||"").toUpperCase(),n=`${e.message||""} ${e.details||""} ${e.hint||""}`.toLowerCase();return!!(t==="PGRST205"||n.includes("could not find the table")||n.includes("category_draw_configs")&&n.includes("schema cache")||n.includes("relation")&&n.includes("does not exist"))}function qe(e=[]){const t=new Map(V.map(c=>[c.id,c])),n=new Map;for(const c of e){const l=Dt(c);l&&(n.has(l.id)||n.set(l.id,l))}const s=V.map(c=>{const l=n.get(c.id);return l?{...c,name:l.name,icon:l.icon,description:l.description,eligibility:l.eligibility,recentCutoff:l.recentCutoff,cutoffRange:l.cutoffRange,source:l.source,updatedAt:l.updatedAt}:c}),i=[...n.values()].filter(c=>!t.has(c.id)).map(c=>({...c,check:()=>!1}));return[...s,...i]}function Ye(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch{return null}}function Ve(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch{}}function We(e){try{localStorage.removeItem(e)}catch{}}function Ft(e){return Number.isFinite(e)&&e>0&&Date.now()-e<It}function Ot(e){return Ft(e)?"fresh":"stale"}function E(e,{revalidating:t=!1}={}){return{status:"ok",source:e.source,data:e.data,fetchedAt:e.fetchedAt,freshness:Ot(e.fetchedAt),revalidating:t}}function Ge(e=[]){return Array.isArray(e)?e.map(t=>({id:t?.id||"",source:t?.source||"supabase",name:t?.name||"",icon:t?.icon||"",description:t?.description||"",eligibility:t?.eligibility||"",recent_cutoff:Number(t?.recentCutoff??t?.recent_cutoff),cutoff_range:t?.cutoffRange??t?.cutoff_range??"N/A",updated_at:t?.updatedAt??t?.updated_at??null})):[]}function Je(){if(me)return;me=!0;const e=Ye(be),t=Be(e?.data),n=Number(e?.fetchedAt||0);!t||!Number.isFinite(n)||n<=0||(A={data:t,source:String(e?.source||"supabase-cache"),fetchedAt:n})}function He(){if(he)return;he=!0;const e=Ye(_e),t=Ge(e?.data||[]);if(!t.length)return;const n=qe(t);if(!n.length)return;const s=Number(e?.fetchedAt||0);!Number.isFinite(s)||s<=0||(k={data:n,source:String(e?.source||"supabase-cache"),fetchedAt:s})}function ye(e,t){A={data:e,source:t,fetchedAt:Date.now()},Ve(be,{data:e,source:t,fetchedAt:A.fetchedAt})}function we(e,t){k={data:e,source:t,fetchedAt:Date.now()},Ve(_e,{data:Ge(e),source:t,fetchedAt:k.fetchedAt})}function Pe(){return U}function pe(){return V}function zt(){return Je(),A.data?E(A):E({data:U,source:"local-fallback",fetchedAt:0})}function Ut(){return He(),k.data?E(k):E({data:V,source:"local-fallback",fetchedAt:0})}function wr(){A={data:null,source:"none",fetchedAt:0},me=!0,We(be)}function vr(){k={data:null,source:"none",fetchedAt:0},he=!0,ge=Ue,We(_e)}async function Ne(){if(ve)try{const e=await B();if(!e)throw new Error("Supabase client unavailable");const{data:t,error:n}=await e.from("draw_snapshots").select("payload,last_updated").order("last_updated",{ascending:!1}).limit(1);if(!n){const s=t?.[0],i=Be(s?.payload);if(i)return ye(i,"supabase"),E(A)}}catch{}return A.data||ye(U,"local-fallback"),E(A)}async function Le(){if(ve&&ge)try{const e=await B();if(!e)throw new Error("Supabase client unavailable");const{data:t,error:n}=await e.from("category_draw_configs").select("id,source,name,icon,description,eligibility,recent_cutoff,cutoff_range,is_active,updated_at").eq("is_active",!0).order("updated_at",{ascending:!1});if(Mt(n)&&(ge=!1),!n&&Array.isArray(t)&&t.length>0){const s=qe(t);return we(s,"supabase"),E(k)}}catch{}return k.data||we(V,"local-fallback"),E(k)}function Ke(e,t){typeof e=="function"&&e(t)}async function Bt({forceRefresh:e=!1,staleWhileRevalidate:t=!0,onRevalidated:n=null}={}){if(Y().forceLocalData)return ye(U,"local-forced"),E(A);if(Je(),!e&&A.data){const c=E(A);return c.freshness==="fresh"||!t?c:(Ne().then(l=>Ke(n,l)).catch(()=>{}),{...c,revalidating:!0})}return await Ne()}async function qt({forceRefresh:e=!1,staleWhileRevalidate:t=!0,onRevalidated:n=null}={}){if(Y().forceLocalData)return we(V,"local-forced"),E(k);if(He(),!e&&k.data){const c=E(k);return c.freshness==="fresh"||!t?c:(Le().then(l=>Ke(n,l)).catch(()=>{}),{...c,revalidating:!0})}return await Le()}const $e="crs-account-settings-v1",q={profileName:"",contactEmail:"",defaultDrawAlerts:!1,autoSyncProfiles:!0,autoSaveProgress:!0,motionIntensity:"full"};function Re(){try{const e=localStorage.getItem($e);if(!e)return{...q};const t=JSON.parse(e);return!t||typeof t!="object"?{...q}:{...q,...t}}catch{return{...q}}}function br(e){const t={...q,...e||{}};["off","subtle","full"].includes(t.motionIntensity)||(t.motionIntensity=q.motionIntensity);try{localStorage.setItem($e,JSON.stringify(t))}catch{}try{window.dispatchEvent(new Event("crs-account-settings-updated"))}catch{}return t}const Xe="crs-policy-autopilot-state-v1";function Yt(e,t){if(typeof window>"u")return t;try{const n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch{return t}}function Vt(e,t){if(!(typeof window>"u"))try{window.localStorage.setItem(e,JSON.stringify(t))}catch{}}function Wt(){return Yt(Xe,{activePolicyId:"",policySource:"",registryVersion:"",lastRunAt:"",lastChangeAt:"",lastRecalculation:null})}function Gt(e){if(!(typeof window>"u"))try{window.dispatchEvent(new CustomEvent("crs-policy-autopilot-synced",{detail:e}))}catch{}}function Ie({reason:e="app_startup",force:t=!1}={}){const n=dt(),s=ft(),i=Wt(),c=i.activePolicyId!==n.id||i.policySource!==n.source,l=i.registryVersion!==s.version;if(!(!!t||c||l))return{status:"noop",reason:e,activePolicyId:n.id,policySource:n.source,registryVersion:s.version,recalculation:null,changed:!1};const y=ht({reason:`policy_autopilot:${e}`,force:!!t||c||l}),w=new Date().toISOString(),b={activePolicyId:n.id,policySource:n.source,registryVersion:s.version,lastRunAt:w,lastChangeAt:c||l?w:i.lastChangeAt||w,lastRecalculation:y};Vt(Xe,b);const D={status:"updated",reason:e,activePolicyId:n.id,policySource:n.source,registryVersion:s.version,recalculation:y,changed:c||l};return Gt(D),D}const Jt=o.lazy(()=>I(()=>import("./WelcomeScreen-DxuwpYD_.js"),__vite__mapDeps([9,1,3,4,2,5]))),Ht=o.lazy(()=>I(()=>import("./Wizard-BX6InIsd.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Kt=o.lazy(()=>I(()=>import("./Results-Bc43U6Nw.js"),__vite__mapDeps([7,4,1,2,5,3]))),Se="crs-progress",$t={welcome:"/",wizard:"/wizard",results:"/results",unsubscribe:"/unsubscribe",handoff:"/handoff"},Xt={FCP:{good:1800,needsImprovement:3e3},LCP:{good:2500,needsImprovement:4e3},CLS:{good:.1,needsImprovement:.25},INP:{good:200,needsImprovement:500}};function Te(e){return $t[e]||"/"}function Qt(){return typeof PerformanceObserver>"u"?[]:Array.isArray(PerformanceObserver.supportedEntryTypes)?PerformanceObserver.supportedEntryTypes:[]}function Zt(e){return Qt().includes(e)}function er(e,t){const n=Xt[e];return!n||!Number.isFinite(t)?"unknown":t<=n.good?"good":t<=n.needsImprovement?"needs_improvement":"poor"}function De(){try{const e=localStorage.getItem(Se);return e?JSON.parse(e):null}catch{return null}}function tr(e){try{localStorage.setItem(Se,JSON.stringify(e))}catch{}}function Me(){try{localStorage.removeItem(Se)}catch{}}function rr(){try{return new URLSearchParams(window.location.search).get("unsubscribe")}catch{return null}}function nr(){return{}}function ar(){const e=typeof navigator<"u"?navigator:null;if(!e)return!1;const n=!!(e.connection||e.mozConnection||e.webkitConnection)?.saveData,s=Number(e.deviceMemory||0),i=Number(e.hardwareConcurrency||0),c=Number.isFinite(s)&&s>0&&s<=4,l=Number.isFinite(i)&&i>0&&i<=4;return n||c||l}function sr(e){return new Promise(t=>window.setTimeout(t,e))}async function Fe(e,{retries:t=2,baseDelayMs:n=250}={}){let s=null;for(let i=0;i<=t;i+=1)try{return await e()}catch(c){if(s=c,i===t)break;await sr(n*2**i)}throw s||new Error("Retry attempts exhausted.")}function or(){const{t:e}=Oe(),[t,n]=o.useState(()=>Re()),[s,i]=o.useState(()=>Y()),c=t.autoSaveProgress!==!1,l=["off","subtle","full"].includes(t.motionIntensity)?t.motionIntensity:"full",T=o.useMemo(()=>ar(),[]),y=l==="off"?"off":T&&l==="full"?"subtle":l,w=rr(),b=o.useMemo(()=>gt(),[]),D=nr(),M=o.useMemo(()=>zt(),[]),j=o.useMemo(()=>Ut(),[]),[p,W]=o.useState(()=>w?"unsubscribe":b?"handoff":Object.keys(D).length>0?"results":"welcome"),ae=o.useRef(p),se=o.useRef(Te(p)),G=o.useRef(0),Qe=o.useRef(new Set),[Ee,oe]=o.useState(()=>D),[X,xe]=o.useState(()=>w?"loading":"idle"),[Ce,ie]=o.useState(()=>M?.data||Pe()),[Ae,ce]=o.useState(()=>M?.source||"local-fallback"),[Ze,Q]=o.useState(()=>Array.isArray(j?.data)&&j.data.length>0?j.data:pe()),[O,Z]=o.useState(()=>({syncing:!1,lastError:"",lastSyncedAt:"",drawFreshness:M?.freshness||"stale",categoryFreshness:j?.freshness||"stale",drawRevalidating:!1,categoryRevalidating:!1}));o.useEffect(()=>{if(!w)return;let a=!0;return Rt(w).then(d=>{a&&xe(d.status==="ok"?"success":"notfound")}).catch(d=>{a&&(xe("error"),R("unsubscribe_request_failed",d,{source:"unsubscribe_flow",has_token:!!w}))}),()=>{a=!1}},[w]);const ee=o.useCallback(async({forceRefresh:a=!1,reason:d="initial"}={})=>{Z(u=>({...u,syncing:!0,lastError:""}));let h=null,_=null,v={freshness:"fresh",revalidating:!1},x={freshness:"fresh",revalidating:!1};const L=u=>{u?.status==="ok"&&u.data&&(ie(u.data),ce(u.source||"local-fallback")),Z(C=>({...C,drawFreshness:u?.freshness||C.drawFreshness,drawRevalidating:!1,lastSyncedAt:new Date().toISOString()})),g("draw_data_swr_revalidated",{resource:"latest_draws",source:u?.source||"unknown",freshness:u?.freshness||"unknown"})},P=u=>{u?.status==="ok"&&Array.isArray(u.data)&&u.data.length>0&&Q(u.data),Z(C=>({...C,categoryFreshness:u?.freshness||C.categoryFreshness,categoryRevalidating:!1,lastSyncedAt:new Date().toISOString()})),g("draw_data_swr_revalidated",{resource:"category_config",source:u?.source||"unknown",freshness:u?.freshness||"unknown"})};try{const u=await Fe(()=>Bt({forceRefresh:a,onRevalidated:L}),{retries:2,baseDelayMs:250});u?.status==="ok"&&u.data&&(ie(u.data),ce(u.source||"local-fallback")),v={freshness:u?.freshness||"fresh",revalidating:!!u?.revalidating}}catch(u){h=u,R("draw_data_sync_error",u,{reason:d,resource:"latest_draws",force_refresh:!!a}),ie(Pe()),ce("local-fallback"),v={freshness:"stale",revalidating:!1}}try{const u=await Fe(()=>qt({forceRefresh:a,onRevalidated:P}),{retries:2,baseDelayMs:250});u?.status==="ok"&&Array.isArray(u.data)&&u.data.length>0?Q(u.data):Q(pe()),x={freshness:u?.freshness||"fresh",revalidating:!!u?.revalidating}}catch(u){_=u,R("draw_data_sync_error",u,{reason:d,resource:"category_config",force_refresh:!!a}),Q(pe()),x={freshness:"stale",revalidating:!1}}const N=!!h||!!_;Z({syncing:!1,lastError:N?"Live sync is currently unavailable. Showing local data mode.":"",lastSyncedAt:new Date().toISOString(),drawFreshness:v.freshness,categoryFreshness:x.freshness,drawRevalidating:v.revalidating,categoryRevalidating:x.revalidating}),N?g("draw_data_sync_degraded",{reason:d,latest_error:String(h?.message||""),category_error:String(_?.message||"")}):g("draw_data_sync_ok",{reason:d,source:"live"})},[]),et=o.useCallback(()=>{ee({forceRefresh:!0,reason:"manual_retry"})},[ee]);o.useEffect(()=>{const a=window.setTimeout(()=>{ee()},0);return()=>window.clearTimeout(a)},[ee]),o.useEffect(()=>{try{const a=Ie({reason:"app_boot"});g("policy_autopilot_sync",{reason:"app_boot",status:a.status,active_policy_id:a.activePolicyId||"",policy_source:a.policySource||"",changed:!!a.changed,recalculated_profiles:Number(a.recalculation?.updated||0)})}catch(a){R("policy_autopilot_sync_failed",a,{reason:"app_boot"})}},[]),o.useEffect(()=>{const a=()=>{try{const d=Ie({reason:"policy_override_updated",force:!0});g("policy_autopilot_sync",{reason:"policy_override_updated",status:d.status,active_policy_id:d.activePolicyId||"",policy_source:d.policySource||"",changed:!!d.changed,recalculated_profiles:Number(d.recalculation?.updated||0)})}catch(d){R("policy_autopilot_sync_failed",d,{reason:"policy_override_updated"})}};return window.addEventListener("crs-policy-ruleset-updated",a),()=>{window.removeEventListener("crs-policy-ruleset-updated",a)}},[]),o.useEffect(()=>{if(p==="welcome"){je({idle:!0});return}if(p==="wizard"){At({idle:!0});return}p==="results"&&kt({idle:!0})},[p]);const tt=o.useCallback(a=>{if(a&&c){const d=De();d&&oe(d)}g("wizard_started",{resumed:!!a}),W("wizard")},[c]),rt=o.useCallback(a=>{oe(a),Me(),g("wizard_completed",{answer_count:Object.keys(a||{}).length}),W("results"),window.scrollTo({top:0,behavior:"smooth"})},[]),nt=o.useCallback(()=>{oe({}),Me(),g("calculator_restarted"),window.history.replaceState(null,"",window.location.pathname),W("welcome"),window.scrollTo({top:0,behavior:"smooth"})},[]),at=c&&!!De(),[st,ot]=o.useState(!1),[J,le]=o.useState(null),[it,ct]=o.useState(()=>{const a=window.matchMedia?.("(display-mode: standalone)")?.matches,d=window.navigator?.standalone===!0;return!!(a||d)});o.useEffect(()=>{const a=()=>ot(window.scrollY>400);return window.addEventListener("scroll",a,{passive:!0}),()=>window.removeEventListener("scroll",a)},[]),o.useEffect(()=>{const a=h=>{typeof h?.prompt=="function"&&le(h)},d=()=>{le(null),ct(!0)};return window.addEventListener("beforeinstallprompt",a),window.addEventListener("appinstalled",d),()=>{window.removeEventListener("beforeinstallprompt",a),window.removeEventListener("appinstalled",d)}},[]);const lt=o.useCallback(async()=>{if(!J)return;g("install_prompt_triggered"),J.prompt(),(await J.userChoice)?.outcome==="accepted"?(le(null),g("install_prompt_accepted")):g("install_prompt_dismissed")},[J]);return o.useEffect(()=>{const a=()=>{n(Re())};return window.addEventListener("storage",a),window.addEventListener("crs-account-settings-updated",a),()=>{window.removeEventListener("storage",a),window.removeEventListener("crs-account-settings-updated",a)}},[]),o.useEffect(()=>{const a=()=>{i(Y())};return window.addEventListener("storage",a),window.addEventListener("crs-runtime-flags-updated",a),()=>{window.removeEventListener("storage",a),window.removeEventListener("crs-runtime-flags-updated",a)}},[]),o.useEffect(()=>{G.current===0&&(G.current=typeof performance<"u"?performance.now():Date.now())},[]),o.useEffect(()=>{if(!s.enablePerfTelemetry)return;const a=h=>{const _=h?.error instanceof Error?h.error:new Error(h?.message||"Window error");R("app_window_error",_,{source:"window_error",filename:h?.filename||"",line:Number(h?.lineno||0),column:Number(h?.colno||0)})},d=h=>{const _=h?.reason,v=_ instanceof Error?_:new Error(typeof _=="string"?_:"Unhandled promise rejection");R("app_unhandled_rejection",v,{source:"unhandled_rejection",reason_type:typeof _})};return window.addEventListener("error",a),window.addEventListener("unhandledrejection",d),()=>{window.removeEventListener("error",a),window.removeEventListener("unhandledrejection",d)}},[s.enablePerfTelemetry]),o.useEffect(()=>{if(!s.enablePerfTelemetry)return;const a=Te(p);g("perf_route_view",{mode:p,route:a,previous_route:se.current,transition_type:se.current===a?"initial":"virtual_navigation"}),se.current=a},[p,s.enablePerfTelemetry]),o.useEffect(()=>{if(s.enablePerfTelemetry)try{const a=window.performance?.getEntriesByType?.("navigation")?.[0];if(!a)return;g("perf_navigation_summary",{type:a.type||"navigate",dom_content_loaded_ms:Math.round(a.domContentLoadedEventEnd||0),load_event_ms:Math.round(a.loadEventEnd||0),transfer_kb:Number(((a.transferSize||0)/1024).toFixed(1))})}catch{}},[s.enablePerfTelemetry]),o.useEffect(()=>{if(!s.enablePerfTelemetry||typeof window>"u"||typeof PerformanceObserver>"u")return;const a=[],d=Qe.current;let h=0,_=0,v=0,x=0,L=0,P=0,N=0,u=0;const C=(f,m,S={})=>{if(!Number.isFinite(m)||m<=0||d.has(f))return;d.add(f);const ue=f==="CLS"?Number(m.toFixed(3)):Math.round(m);g("perf_web_vital",{metric:f,value:ue,rating:er(f,m),...S})},F=(f,m)=>{if(Zt(f))try{const S=new PerformanceObserver(ue=>{m(ue.getEntries()||[])});S.observe(f==="event"?{type:f,buffered:!0,durationThreshold:16}:{type:f,buffered:!0}),a.push(S)}catch{}};F("paint",f=>{const m=f.find(S=>S.name==="first-contentful-paint");m&&C("FCP",Number(m.startTime||0))}),F("largest-contentful-paint",f=>{const m=f[f.length-1];m&&(h=Number(m.startTime||0),_=Number(m.size||0))}),F("layout-shift",f=>{for(const m of f)m.hadRecentInput||(v+=Number(m.value||0))}),F("event",f=>{for(const m of f){const S=Number(m.duration||0);!Number.isFinite(S)||S<=0||(x=Math.max(x,S),L+=1)}}),F("longtask",f=>{for(const m of f){const S=Number(m.duration||0);!Number.isFinite(S)||S<=0||(P+=1,N+=S,u=Math.max(u,S))}});let H=!1;const z=()=>{H||(H=!0,C("LCP",h,{element_size_px:Math.round(_)}),C("CLS",v),C("INP",x,{sample_count:L}),P>0&&!d.has("LONG_TASK_SUMMARY")&&(d.add("LONG_TASK_SUMMARY"),g("perf_long_task_summary",{task_count:P,max_duration_ms:Math.round(u),total_duration_ms:Math.round(N),average_duration_ms:Math.round(N/P)})))},ke=()=>{document.visibilityState==="hidden"&&z()};return document.addEventListener("visibilitychange",ke,!0),window.addEventListener("pagehide",z,!0),()=>{z(),document.removeEventListener("visibilitychange",ke,!0),window.removeEventListener("pagehide",z,!0),a.forEach(f=>f.disconnect())}},[s.enablePerfTelemetry]),o.useEffect(()=>{const a=typeof performance<"u"?performance.now():Date.now(),d=ae.current;if(!s.enablePerfTelemetry){ae.current=p,G.current=a;return}d!==p&&(g("perf_mode_transition",{from_mode:d,to_mode:p,duration_ms:Math.max(Math.round(a-G.current),0)}),ae.current=p,G.current=a)},[p,s.enablePerfTelemetry]),o.useEffect(()=>{document.documentElement.setAttribute("data-motion",y)},[y]),o.useEffect(()=>{const a=document.documentElement,d=window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,h=window.matchMedia?.("(pointer: fine)")?.matches;if(!(y!=="off"&&!d&&!!h)){a.style.setProperty("--pointer-x","50%"),a.style.setProperty("--pointer-y","40%"),a.style.setProperty("--pointer-glow","0");return}a.style.setProperty("--pointer-glow",y==="subtle"?"0.45":"1");let v=0,x=50,L=40,P=50,N=40;const u=()=>{x+=(P-x)*.12,L+=(N-L)*.12,a.style.setProperty("--pointer-x",`${x.toFixed(2)}%`),a.style.setProperty("--pointer-y",`${L.toFixed(2)}%`),Math.abs(P-x)>.05||Math.abs(N-L)>.05?v=window.requestAnimationFrame(u):v=0},C=()=>{v||(v=window.requestAnimationFrame(u))},F=z=>{P=z.clientX/window.innerWidth*100,N=z.clientY/window.innerHeight*100,C()},H=()=>{P=50,N=40,C()};return window.addEventListener("pointermove",F,{passive:!0}),window.addEventListener("pointerleave",H,{passive:!0}),()=>{window.removeEventListener("pointermove",F),window.removeEventListener("pointerleave",H),v&&window.cancelAnimationFrame(v)}},[y]),r.jsxs("div",{className:"app",children:[r.jsxs("div",{className:"anime-bg","aria-hidden":"true",children:[r.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--one"}),r.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--two"}),r.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--three"}),r.jsx("span",{className:"anime-bg-grid"}),r.jsx("span",{className:"anime-bg-noise"}),r.jsx("span",{className:"anime-bg-pointer-glow"}),r.jsx("span",{className:"anime-bg-flare"}),r.jsx("span",{className:"anime-bg-vignette"}),r.jsxs("div",{className:"anime-bg-sparks",children:[r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{})]})]}),r.jsx("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"}),r.jsx(Nt,{canInstallApp:!it&&!!J,onInstallApp:lt,motionIntensity:y}),r.jsx("main",{className:"main",role:"main",id:"main-content",children:r.jsxs(bt,{mode:"wait",children:[p==="welcome"&&r.jsx(o.Suspense,{fallback:r.jsx("div",{className:"loading-fallback",children:r.jsx(fe,{})}),children:r.jsx(Jt,{onStart:tt,onPrepareStart:()=>je(),hasSaved:at,drawData:Ce,drawSource:Ae,motionIntensity:y},"welcome")}),p==="wizard"&&r.jsx(o.Suspense,{fallback:r.jsx("div",{className:"loading-fallback",children:r.jsx(fe,{})}),children:r.jsx(Ht,{onFinish:rt,onProgress:c?tr:void 0,initialAnswers:Ee,motionIntensity:y},"wizard")}),p==="unsubscribe"&&r.jsxs("div",{className:"card unsubscribe-card",children:[r.jsx("h3",{children:"Draw alert preferences"}),X==="loading"&&r.jsx("p",{children:"Processing your unsubscribe requestâ€¦"}),X==="success"&&r.jsx("p",{children:"Youâ€™ve been unsubscribed from draw alerts successfully."}),X==="notfound"&&r.jsx("p",{children:"This unsubscribe link is invalid or already inactive."}),X==="error"&&r.jsx("p",{children:"We couldnâ€™t process this request right now. Please try again later."}),r.jsx("button",{type:"button",className:"btn-restart",onClick:()=>W("welcome"),children:"Back to calculator"})]}),p==="handoff"&&r.jsxs("div",{className:"card unsubscribe-card",children:[r.jsx("h3",{children:"Consultant handoff summary"}),b?r.jsxs(r.Fragment,{children:[r.jsxs("p",{children:["Score: ",r.jsx("strong",{children:b?.summary?.score??"â€”"})," Â· ","Avg cutoff: ",r.jsx("strong",{children:b?.summary?.averageCutoff??"â€”"})," Â· ","Confidence: ",r.jsx("strong",{children:b?.summary?.confidenceBand||"Unknown"})]}),r.jsxs("p",{children:["Generated: ",b?.generatedAt?new Date(b.generatedAt).toLocaleString():"â€”"]})]}):r.jsx("p",{children:"This handoff link is invalid or expired."}),r.jsx("button",{type:"button",className:"btn-restart",onClick:()=>{window.history.replaceState(null,"",window.location.pathname),W("welcome")},children:"Open calculator"})]}),p==="results"&&r.jsx(o.Suspense,{fallback:r.jsx("div",{className:"loading-fallback",children:r.jsx(fe,{})}),children:r.jsx(Kt,{answers:Ee,onRestart:nt,drawData:Ce,drawSource:Ae,categoryInfo:Ze,motionIntensity:y,onRetryDataSync:et,isDataSyncing:O.syncing,dataSyncError:O.lastError,dataSyncFreshness:O.drawFreshness==="stale"||O.categoryFreshness==="stale"?"stale":"fresh",isDataRevalidating:O.drawRevalidating||O.categoryRevalidating,dataLastSyncedAt:O.lastSyncedAt},"results")})]})}),r.jsxs("footer",{className:"footer",children:[r.jsxs("p",{children:["Â© ",new Date().getFullYear()," ",e("footer.copy")]}),r.jsxs("p",{className:"footer-legal-links",children:[r.jsx("a",{href:"/guides.html",children:"Guides"}),r.jsx("span",{"aria-hidden":"true",children:" Â· "}),r.jsx("a",{href:"/terms.html",children:"Terms of Service"}),r.jsx("span",{"aria-hidden":"true",children:" Â· "}),r.jsx("a",{href:"/privacy.html",children:"Privacy Policy"}),r.jsx("span",{"aria-hidden":"true",children:" Â· "}),r.jsx("a",{href:"/trust.html",children:"Trust Center"})]})]}),st&&r.jsx("button",{type:"button",className:"btn-top",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),"aria-label":"Back to top",children:"â†‘"})]})}class ir extends o.Component{constructor(t){super(t),this.state={hasError:!1,errorMessage:""}}static getDerivedStateFromError(t){return{hasError:!0,errorMessage:t?.message||"Unexpected application error."}}componentDidCatch(t,n){R("app_error_boundary_triggered",t,{component_stack:String(n?.componentStack||"").slice(0,600),route:typeof window<"u"?window.location.pathname:"server"})}handleTryAgain=()=>{this.setState({hasError:!1,errorMessage:""})};render(){return this.state.hasError?r.jsx("main",{className:"error-boundary-screen",role:"alert","aria-live":"assertive",children:r.jsxs("section",{className:"error-boundary-card",children:[r.jsx("h1",{children:"Something went wrong"}),r.jsx("p",{children:"We hit an unexpected issue while rendering this page."}),r.jsx("p",{className:"error-boundary-message",children:this.state.errorMessage}),r.jsxs("div",{className:"error-boundary-actions",children:[r.jsx("button",{type:"button",className:"action-btn auth-btn-primary",onClick:this.handleTryAgain,children:"Try again"}),r.jsx("button",{type:"button",className:"action-btn",onClick:()=>window.location.reload(),children:"Reload app"})]})]})}):this.props.children}}const cr=()=>I(()=>import("./motionFeatures-DFpXREjK.js"),__vite__mapDeps([10,5,1])).then(e=>e.default);"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("[SW] Service Worker registered:",e),Y().enablePerfTelemetry&&g("service_worker_registered",{scope:e?.scope||"/"})}).catch(e=>{console.error("[SW] Service Worker registration failed:",e),Y().enablePerfTelemetry&&R("service_worker_registration_failed",e,{source:"main_bootstrap"})})});mt.createRoot(document.getElementById("root")).render(r.jsx(o.StrictMode,{children:r.jsx(ir,{children:r.jsx(pt,{children:r.jsx(St,{children:r.jsx(yt,{children:r.jsx(_t,{features:cr,children:r.jsx(or,{})})})})})})}));export{fe as L,kt as a,Pe as b,Wt as c,Bt as d,qt as e,gr as f,pe as g,yr as h,$ as i,wr as j,vr as k,hr as l,Ie as m,At as p,Re as r,br as s,mr as u};
