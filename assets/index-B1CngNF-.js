const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WelcomeScreen-CIwq-3Kh.js","assets/vendor-react-Ah1pgjPn.js","assets/feature-path-coach-cfO7BAJT.js","assets/data-question-bank-F-s7nTqV.js","assets/vendor-supabase-BZ0N5lZN.js","assets/vendor-motion-DURBmaq0.js","assets/Wizard-BVA_CDLo.js","assets/Results-CGHMIwg5.js"])))=>i.map(i=>d[i]);
import{r,j as e,c as Pe}from"./vendor-react-Ah1pgjPn.js";import{s as j,i as oe,u as ge,A as Ie}from"./feature-path-coach-cfO7BAJT.js";import{u as _e,m as Re,A as Le}from"./vendor-motion-DURBmaq0.js";import{t as $,r as q}from"./data-question-bank-F-s7nTqV.js";import"./vendor-supabase-BZ0N5lZN.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function i(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(a){if(a.ep)return;a.ep=!0;const o=i(a);fetch(a.href,o)}})();const De="modulepreload",Te=function(t){return"/"+t},ue={},ce=function(s,i,l){let a=Promise.resolve();if(i&&i.length>0){let k=function(g){return Promise.all(g.map(S=>Promise.resolve(S).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),m=d?.nonce||d?.getAttribute("nonce");a=k(i.map(g=>{if(g=Te(g),g in ue)return;ue[g]=!0;const S=g.endsWith(".css"),y=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${y}`))return;const w=document.createElement("link");if(w.rel=S?"stylesheet":De,S||(w.as="script"),w.crossOrigin="",w.href=g,m&&w.setAttribute("nonce",m),document.head.appendChild(w),S)return new Promise((E,U)=>{w.addEventListener("load",E),w.addEventListener("error",()=>U(new Error(`Unable to preload CSS for ${g}`)))})}))}function o(d){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=d,window.dispatchEvent(m),!m.defaultPrevented)throw d}return a.then(d=>{for(const m of d||[])m.status==="rejected"&&o(m.reason);return s().catch(o)})},we=r.createContext();function Me({children:t}){const[s,i]=r.useState(()=>{try{return localStorage.getItem("crs-theme")==="dark"}catch{return!1}});r.useEffect(()=>{document.documentElement.setAttribute("data-theme",s?"dark":"light");try{localStorage.setItem("crs-theme",s?"dark":"light")}catch{}},[s]);const l=()=>i(a=>!a);return e.jsx(we.Provider,{value:{dark:s,toggle:l},children:t})}function Oe(){return r.useContext(we)}const ze={"header.title":"CRS Calculator 2026","welcome.heading":`Free CRS Calculator
for Express Entry 2026`,"welcome.sub":"Calculate your Comprehensive Ranking System (CRS) score for Canada Express Entry. Check FSW, CEC, PNP eligibility instantly. Updated with latest IRCC draw cutoffs.","welcome.btn":"Calculate My CRS Score Free","welcome.updated":"IRCC data updated:","welcome.trust":"Uses official IRCC draw data â€” last updated:","welcome.microcopy":"This will take 3 minutes â€” one question at a time.","welcome.resume":"You have an unfinished calculation.","welcome.resumeBtn":"Resume","welcome.startFresh":"Start Fresh","feature.accurate":"Official CRS Formula","feature.accurateDesc":"100% accurate IRCC scoring algorithm","feature.suggestions":"Boost Your Score","feature.suggestionsDesc":"Get personalized tips to gain +50 points","feature.draws":"2026 Draw Cutoffs","feature.drawsDesc":"Live IRCC Express Entry draw results","feature.instant":"Free & Instant","feature.instantDesc":"No signup required Â· Results in 2 minutes","wizard.step":"Step","wizard.of":"of","wizard.next":"Next â†’","wizard.back":"â† Back","wizard.calculate":"Calculate Score âœ“","results.breakdown":"Your CRS Score Breakdown","results.improve":"How to Increase Your CRS Score","results.category":"Category-Based Draw Eligibility","results.catIntro":"IRCC runs category-based draws with lower cutoffs for healthcare, STEM, trades, transport, and French speakers. Here's your eligibility:","results.timeline":"PR Timeline Estimate","results.draws":"Latest Express Entry Draws 2026","results.disclaimer":"This free CRS calculator provides an estimate based on IRCC's publicly available scoring criteria. Not affiliated with Immigration, Refugees and Citizenship Canada.","results.restart":"â†» Recalculate","results.share":"Share Results","results.pdf":"Download PDF","results.whatif":"What-If Score Simulator","results.whatifDesc":"See how improving IELTS, education, or work experience affects your CRS:","results.original":"Current","results.projected":"Projected","results.foreignWork":"Foreign Work (Skill Bonus)","footer.copy":"Free CRS Calculator 2026 Â· Not affiliated with IRCC"},Fe={"header.title":"Calculateur SRC","welcome.heading":`Immigration au Canada
Calculateur de Points`,"welcome.sub":"Calculez votre score du SystÃ¨me de classement global (SCG) et dÃ©couvrez votre meilleur chemin vers la rÃ©sidence permanente canadienne.","welcome.btn":"Calculer Mon Score","welcome.updated":"DerniÃ¨re mise Ã  jour :","welcome.trust":"DonnÃ©es officielles dâ€™IRCC â€” derniÃ¨re mise Ã  jour :","welcome.microcopy":"Cela prend 3 minutes â€” une question Ã  la fois.","welcome.resume":"Vous avez un calcul en cours.","welcome.resumeBtn":"Reprendre","welcome.startFresh":"Recommencer","feature.accurate":"Score SCG PrÃ©cis","feature.accurateDesc":"Calcul complet du SystÃ¨me de classement global","feature.suggestions":"Suggestions Intelligentes","feature.suggestionsDesc":"Conseils personnalisÃ©s pour augmenter vos points","feature.draws":"Derniers Tirages","feature.drawsDesc":"RÃ©sultats Ã  jour des tirages EntrÃ©e express d'IRCC","feature.instant":"RÃ©sultats InstantanÃ©s","feature.instantDesc":"Obtenez votre score en moins de 2 minutes","wizard.step":"Ã‰tape","wizard.of":"de","wizard.next":"Suivant â†’","wizard.back":"â† Retour","wizard.calculate":"Calculer le Score âœ“","results.breakdown":"DÃ©tail de Votre Score","results.improve":"Comment AmÃ©liorer Votre Score","results.category":"AdmissibilitÃ© aux Tirages par CatÃ©gorie","results.catIntro":"Le Canada organise des tirages spÃ©ciaux pour des groupes spÃ©cifiques avec des seuils plus bas. Voici ce Ã  quoi vous pourriez Ãªtre admissible :","results.timeline":"Calendrier EstimÃ©","results.draws":"Tirages RÃ©cents EntrÃ©e Express","results.disclaimer":"Ce calculateur fournit une estimation basÃ©e sur les critÃ¨res SCG publics. Il n'est pas affiliÃ© Ã  IRCC.","results.restart":"â†» Recommencer","results.share":"Partager les RÃ©sultats","results.pdf":"TÃ©lÃ©charger PDF","results.whatif":"Comparaison HypothÃ©tique","results.whatifDesc":"Ajustez les variables pour voir comment votre score change :","results.original":"Original","results.projected":"ProjetÃ©","results.foreignWork":"Exp. Ã‰trangÃ¨re (Bonus)","footer.copy":"Calculateur SRC Â· Non affiliÃ© Ã  IRCC"},de={en:ze,fr:Fe},be=r.createContext();function qe({children:t}){const[s,i]=r.useState(()=>{try{return localStorage.getItem("crs-lang")||"en"}catch{return"en"}}),l=r.useCallback(o=>{i(o);try{localStorage.setItem("crs-lang",o)}catch{}},[]),a=r.useCallback(o=>de[s]?.[o]||de.en[o]||o,[s]);return e.jsx(be.Provider,{value:{lang:s,setLang:l,t:a},children:t})}function ye(){return r.useContext(be)}function Be(t,s){const i=t.answers||{};return{id:t.id,user_id:s||null,name:t.name||null,score:Number(t.score)||0,email:t.email||null,alert_opt_in:!!t.alertOptIn,alert_token:t.alertToken||null,profile_json:{answers:i,tracking:{userId:s||null,savedAt:new Date().toISOString()}},updated_at:new Date().toISOString()}}function se(t){const s=String(t?.message||"");return/column\s+["']?user_id["']?\s+does not exist/i.test(s)}function H(t,s){const i=s?.message||s?.hint||String(s);return`${t}: ${i}`}function B(){return oe&&!!j}async function pt(t,s={}){if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const i=s.userId||null,l=Be(t,i);let a,o;if({data:a,error:o}=await j.from("saved_profiles").upsert(l,{onConflict:"id"}).select(),o&&i&&se(o)){const{user_id:d,...m}=l;({data:a,error:o}=await j.from("saved_profiles").upsert(m,{onConflict:"id"}).select())}if(o)throw new Error(H("Supabase upsert failed",o));return{status:"ok",data:a||[]}}async function Ue(t){if(!t)return{status:"skipped",reason:"Missing token"};if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const{data:s,error:i}=await j.from("saved_profiles").update({alert_opt_in:!1,updated_at:new Date().toISOString()}).eq("alert_token",t).select();if(i)throw new Error(H("Supabase unsubscribe failed",i));return s?.length?{status:"ok",data:s[0]}:{status:"not-found"}}async function gt(t){if(!t)return{status:"skipped",reason:"Missing user id"};if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const{data:s,error:i}=await j.from("saved_profiles").select("id,name,score,email,updated_at").eq("user_id",t).order("updated_at",{ascending:!1}).limit(12);if(i&&se(i))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(i)throw new Error(H("Supabase profile list failed",i));return{status:"ok",data:s||[]}}async function We(t,s){if(!t)return{status:"skipped",reason:"Missing user id"};if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const{error:i,data:l}=await j.from("saved_profiles").update({alert_opt_in:!!s,updated_at:new Date().toISOString()}).eq("user_id",t).select("id");if(i&&se(i))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(i)throw new Error(H("Supabase alert preference update failed",i));return{status:"ok",updatedCount:l?.length||0}}async function Ge(t,s){if(!t)return{status:"skipped",reason:"Missing user id"};if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const i=s?String(s).trim().toLowerCase():null,{error:l,data:a}=await j.from("saved_profiles").update({email:i||null,updated_at:new Date().toISOString()}).eq("user_id",t).select("id");if(l&&se(l))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(l)throw new Error(H("Supabase profile email update failed",l));return{status:"ok",updatedCount:a?.length||0}}const ve="crs-account-settings-v1",F={profileName:"",contactEmail:"",defaultDrawAlerts:!1,autoSyncProfiles:!0,autoSaveProgress:!0,motionIntensity:"full"};function ie(){try{const t=localStorage.getItem(ve);if(!t)return{...F};const s=JSON.parse(t);return!s||typeof s!="object"?{...F}:{...F,...s}}catch{return{...F}}}function Ve(t){const s={...F,...t||{}};["off","subtle","full"].includes(s.motionIntensity)||(s.motionIntensity=F.motionIntensity);try{localStorage.setItem(ve,JSON.stringify(s))}catch{}try{window.dispatchEvent(new Event("crs-account-settings-updated"))}catch{}return s}const me=/^\S+@\S+\.\S+$/,Y="DELETE",fe=8;function Ye({open:t,onClose:s}){const{isConfigured:i,loading:l,user:a,sendEmailMagicLink:o,verifyEmailOtp:d,refreshSession:m,signInWithGoogle:k,signOut:g,updateProfile:S,changePassword:y,deleteAccount:w}=ge(),[E,U]=r.useState(""),[T,L]=r.useState(""),[A,P]=r.useState("request"),[K,h]=r.useState(""),[J,c]=r.useState(""),[I,M]=r.useState(0),[v,C]=r.useState(()=>ie()),[X,W]=r.useState(""),[Q,u]=r.useState(""),[f,_]=r.useState(""),ae=r.useId(),R=r.useMemo(()=>a?"Account":"Login / Signup",[a]),D=B(),b=K!=="",x=n=>K===n;if(r.useEffect(()=>{if(!t||I<=0)return;const n=window.setInterval(()=>{M(p=>p<=1?0:p-1)},1e3);return()=>window.clearInterval(n)},[t,I]),r.useEffect(()=>{!t||!a||C(n=>({...n,profileName:a.user_metadata?.full_name||n.profileName||"",contactEmail:n.contactEmail||a.email||""}))},[t,a]),r.useEffect(()=>{if(!t||!a||!(A==="sent"||A==="verify"))return;c("Signed in successfully.");const n=window.setTimeout(()=>s(),500);return()=>window.clearTimeout(n)},[s,t,A,a]),r.useEffect(()=>{t||(P("request"),L(""),c(""),h(""),M(0),W(""),u(""),_(""))},[t]),r.useEffect(()=>{if(!t)return;const n=document.body.style.overflow,p=ne=>{ne.key==="Escape"&&s()};return document.body.style.overflow="hidden",window.addEventListener("keydown",p),()=>{window.removeEventListener("keydown",p),document.body.style.overflow=n}},[s,t]),!t)return null;const N=E.trim().toLowerCase(),G=f.trim().toUpperCase(),V=async()=>{if(!N||!me.test(N)){c("Please enter a valid email address.");return}h("sendMagicLink"),c("");try{await o(N),P("sent"),L(""),M(25),c("Magic link sent. Open your email and click the secure sign-in link.")}catch(n){c(n.message||"Could not send magic link.")}finally{h("")}},Z=async()=>{h("checkMagicLink"),c("");try{(await m())?.user?(c("Signed in successfully."),P("request"),window.setTimeout(()=>s(),500)):c("No active session found yet. Click the magic link from your email in this browser, then try again.")}catch(n){c(n.message||"Could not refresh session.")}finally{h("")}},ee=async()=>{I>0||await V()},te=async()=>{if(!N||!T.trim()){c("Enter your email and 6-digit code.");return}h("verifyCode"),c("");try{await d(N,T.trim()),await m(),c("Signed in successfully."),P("request"),L(""),window.setTimeout(()=>s(),500)}catch(n){c(n.message||"Verification failed.")}finally{h("")}},xe=async()=>{h("googleAuth"),c("");try{await k(),c("Redirecting to Google...")}catch(n){c(n.message||"Google login failed.")}finally{h("")}},Ce=async()=>{const n={...v,profileName:(v.profileName||"").trim(),contactEmail:(v.contactEmail||"").trim().toLowerCase()};if(n.contactEmail&&!me.test(n.contactEmail)){c("Please enter a valid contact email.");return}h("saveSettings"),c("");try{await S({fullName:n.profileName}),Ve(n),C(n),D&&a?.id&&await Promise.all([We(a.id,n.defaultDrawAlerts),Ge(a.id,n.contactEmail||a.email||"")]),c("Account settings saved.")}catch(p){c(p.message||"Could not save account settings.")}finally{h("")}},je=async()=>{const n=X.trim(),p=Q.trim();if(n.length<fe){c(`Password must be at least ${fe} characters.`);return}if(n!==p){c("New password and confirmation do not match.");return}h("changePassword"),c("");try{await y(n),W(""),u(""),c("Password updated successfully.")}catch(ne){c(ne.message||"Could not change password.")}finally{h("")}},ke=()=>{{c("Membership management is unavailable. Add VITE_STRIPE_BILLING_PORTAL_URL.");return}},Ne=async()=>{if(G!==Y){c(`Type ${Y} to confirm account deletion.`);return}h("deleteAccount"),c("");try{await w(),_(""),c("Account deleted."),window.setTimeout(()=>s(),350)}catch(n){c(n.message||"Could not delete account.")}finally{h("")}},Ee=async()=>{h("refreshSession"),c("");try{await m(),c("Session refreshed.")}catch(n){c(n.message||"Session refresh failed.")}finally{h("")}},Ae=async()=>{h("signOut"),c("");try{await g(),c("Signed out."),window.setTimeout(()=>s(),400)}catch(n){c(n.message||"Sign out failed.")}finally{h("")}};return e.jsx("div",{className:"auth-modal-backdrop",onClick:s,role:"presentation",children:e.jsxs("div",{className:"auth-modal",role:"dialog","aria-modal":"true","aria-labelledby":ae,onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"auth-modal-head",children:[e.jsx("h3",{id:ae,children:R}),e.jsx("button",{type:"button",className:"auth-close",onClick:s,"aria-label":"Close dialog",children:"Ã—"})]}),e.jsxs("div",{className:"auth-modal-scroll",children:[!i&&e.jsx("p",{className:"auth-note",children:"Auth is unavailable. Add `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`."}),i&&l&&e.jsx("p",{className:"auth-note",children:"Checking session..."}),i&&!l&&a&&e.jsxs("div",{className:"auth-body",children:[e.jsxs("p",{className:"auth-note",children:["Signed in as ",e.jsx("strong",{children:a.email})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section",children:[e.jsx("h4",{children:"Account settings"}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Display name"}),e.jsx("input",{type:"text",value:v.profileName,onChange:n=>C(p=>({...p,profileName:n.target.value})),placeholder:"Your name"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Contact email for draw alerts"}),e.jsx("input",{type:"email",value:v.contactEmail,onChange:n=>C(p=>({...p,contactEmail:n.target.value})),placeholder:"you@example.com"})]}),e.jsxs("label",{className:"auth-check-row",children:[e.jsx("input",{type:"checkbox",checked:v.defaultDrawAlerts,onChange:n=>C(p=>({...p,defaultDrawAlerts:n.target.checked}))}),e.jsx("span",{children:"Enable draw alerts by default"})]}),e.jsxs("label",{className:"auth-check-row",children:[e.jsx("input",{type:"checkbox",checked:v.autoSyncProfiles,onChange:n=>C(p=>({...p,autoSyncProfiles:n.target.checked}))}),e.jsx("span",{children:"Auto-sync saved profiles"})]}),e.jsxs("label",{className:"auth-check-row",children:[e.jsx("input",{type:"checkbox",checked:v.autoSaveProgress,onChange:n=>C(p=>({...p,autoSaveProgress:n.target.checked}))}),e.jsx("span",{children:"Auto-save wizard progress on this device"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Animation intensity"}),e.jsxs("select",{value:v.motionIntensity||"full",onChange:n=>C(p=>({...p,motionIntensity:n.target.value})),children:[e.jsx("option",{value:"full",children:"Full"}),e.jsx("option",{value:"subtle",children:"Subtle"}),e.jsx("option",{value:"off",children:"Off"})]})]}),!D&&e.jsx("p",{className:"auth-note",children:"Cloud account settings require Supabase env vars."})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section",children:[e.jsx("h4",{children:"Security"}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"New password"}),e.jsx("input",{type:"password",value:X,onChange:n=>W(n.target.value),placeholder:"At least 8 characters",autoComplete:"new-password"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Confirm new password"}),e.jsx("input",{type:"password",value:Q,onChange:n=>u(n.target.value),placeholder:"Re-enter new password",autoComplete:"new-password"})]}),e.jsx("div",{className:"auth-actions",children:e.jsx("button",{type:"button",className:"action-btn",disabled:b,onClick:je,children:x("changePassword")?"Updating...":"Change password"})})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section",children:[e.jsx("h4",{children:"Membership"}),e.jsx("p",{className:"auth-note",children:"Remove or manage your membership from the billing portal."}),e.jsx("div",{className:"auth-actions",children:e.jsx("button",{type:"button",className:"action-btn",disabled:b,onClick:ke,children:"Remove membership"})})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section auth-danger-zone",children:[e.jsx("h4",{children:"Danger zone"}),e.jsxs("p",{className:"auth-note",children:["This permanently deletes your account. Type ",e.jsx("strong",{children:Y})," to confirm."]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Confirmation"}),e.jsx("input",{type:"text",value:f,onChange:n=>_(n.target.value),placeholder:Y})]}),e.jsx("div",{className:"auth-actions",children:e.jsx("button",{type:"button",className:"action-btn auth-btn-danger",disabled:b||G!==Y,onClick:Ne,children:x("deleteAccount")?"Deleting...":"Delete account"})})]}),e.jsxs("div",{className:"auth-actions",children:[e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:b,onClick:Ce,children:x("saveSettings")?"Saving...":"Save settings"}),e.jsx("button",{type:"button",className:"action-btn",disabled:b,onClick:Ee,children:x("refreshSession")?"Refreshing...":"Refresh session"}),e.jsx("button",{type:"button",className:"action-btn",disabled:b,onClick:Ae,children:x("signOut")?"Signing out...":"Sign out"})]})]}),i&&!l&&!a&&e.jsxs("div",{className:"auth-body",children:[e.jsx("p",{className:"auth-note",children:"Sign in with a magic link (recommended) or verify manually with an email code."}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",placeholder:"you@example.com",value:E,onChange:n=>U(n.target.value),autoFocus:!0})]}),A==="verify"&&e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Email verification code"}),e.jsx("input",{type:"text",inputMode:"numeric",placeholder:"Enter code",value:T,onChange:n=>L(n.target.value)})]}),e.jsxs("div",{className:"auth-actions",children:[A==="request"?e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:b,onClick:V,children:x("sendMagicLink")?"Sending...":"Send magic link"}):A==="sent"?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:b,onClick:Z,children:x("checkMagicLink")?"Checking...":"I clicked the magic link"}),e.jsx("button",{type:"button",className:"action-btn",disabled:b||I>0,onClick:ee,children:I>0?`Resend in ${I}s`:"Resend magic link"}),e.jsx("button",{type:"button",className:"action-btn",disabled:b,onClick:()=>{P("verify"),c("If your email contains a code, enter it below.")},children:"Use email code instead"})]}):e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:b,onClick:te,children:x("verifyCode")?"Verifying...":"Verify and sign in"}),e.jsx("button",{type:"button",className:"action-btn",disabled:b,onClick:xe,children:x("googleAuth")?"Redirecting...":"Continue with Google"}),A!=="request"&&e.jsx("button",{type:"button",className:"action-btn",disabled:b,onClick:()=>{P("request"),L(""),c(""),M(0)},children:"Back"})]})]}),J&&e.jsx("p",{className:"auth-status",role:"status","aria-live":"polite",children:J})]})]})})}const $e={en:"EN",fr:"FR"};function He({canInstallApp:t=!1,onInstallApp:s=()=>{},motionIntensity:i="full"}){const l=_e()||i==="off",{dark:a,toggle:o}=Oe(),{lang:d,setLang:m,t:k}=ye(),{user:g}=ge(),[S,y]=r.useState(!1);return e.jsxs(Re.header,{className:"header",initial:l?!1:{y:-60,opacity:0},animate:{y:0,opacity:1},transition:l?{duration:0}:{type:"spring",stiffness:120,damping:20},children:[e.jsxs("div",{className:"header-inner",children:[e.jsxs("div",{className:"logo",children:[e.jsx("span",{className:"logo-leaf",children:"ðŸ"}),e.jsx("span",{children:k("header.title")})]}),e.jsxs("div",{className:"header-actions",children:[t&&e.jsx("button",{type:"button",className:"install-btn",onClick:s,"aria-label":"Install app",title:"Add app shortcut",children:"Install app"}),e.jsx("button",{type:"button",className:"auth-toggle",onClick:()=>y(!0),"aria-label":g?"Manage account":"Login or signup",title:g?g.email:"Login / Signup",children:g?"Account":"Login"}),e.jsx("select",{className:"lang-select",value:d,onChange:w=>m(w.target.value),"aria-label":"Select language",children:Object.entries($e).map(([w,E])=>e.jsx("option",{value:w,children:E},w))}),e.jsx("button",{type:"button",className:"theme-toggle",onClick:o,"aria-label":a?"Switch to light mode":"Switch to dark mode",title:a?"Light mode":"Dark mode",children:a?"Light":"Dark"})]})]}),e.jsx(Ye,{open:S,onClose:()=>y(!1)})]})}function re(){const t=Array.from({length:9});return e.jsxs("div",{className:"uv-loader",children:[t.map((s,i)=>e.jsx("div",{className:"uv-text",children:e.jsx("span",{children:"Loading"})},i)),e.jsx("div",{className:"uv-line"})]})}const Se=300*1e3;let O={data:null,source:"none",fetchedAt:0},z={data:null,source:"none",fetchedAt:0};function Ke(t){return!!t&&typeof t=="object"&&Array.isArray(t.generalProgram)&&Array.isArray(t.categoryBased)&&Array.isArray(t.pnpDraws)&&Number.isFinite(Number(t.averageCutoff))}function Je(t){return Ke(t)?{...t,generalProgram:t.generalProgram||[],categoryBased:t.categoryBased||[],pnpDraws:t.pnpDraws||[],averageCutoff:Number(t.averageCutoff)||q.averageCutoff,lastUpdated:t.lastUpdated||q.lastUpdated,pnpRanges:t.pnpRanges||q.pnpRanges}:null}function Xe(t){if(!t||typeof t!="object")return null;const s=String(t.id||"").trim(),i=String(t.name||"").trim(),l=String(t.icon||"").trim(),a=String(t.description||"").trim(),o=String(t.eligibility||"").trim(),d=String(t.cutoff_range||t.cutoffRange||"").trim(),m=Number(t.recent_cutoff??t.recentCutoff);return!s||!i||!l||!a||!o||!Number.isFinite(m)?null:{id:s,name:i,icon:l,description:a,eligibility:o,recentCutoff:m,cutoffRange:d||"N/A",source:t.source||"supabase",updatedAt:t.updated_at||null}}function Qe(t=[]){const s=new Map($.map(o=>[o.id,o])),i=new Map;for(const o of t){const d=Xe(o);d&&(i.has(d.id)||i.set(d.id,d))}const l=$.map(o=>{const d=i.get(o.id);return d?{...o,name:d.name,icon:d.icon,description:d.description,eligibility:d.eligibility,recentCutoff:d.recentCutoff,cutoffRange:d.cutoffRange,source:d.source,updatedAt:d.updatedAt}:o}),a=[...i.values()].filter(o=>!s.has(o.id)).map(o=>({...o,check:()=>!1}));return[...l,...a]}function Ze(){return q}function et(){return $}async function tt({forceRefresh:t=!1}={}){if(!t&&O.data&&Date.now()-O.fetchedAt<Se)return{status:"ok",source:O.source,data:O.data};if(oe&&j)try{const{data:s,error:i}=await j.from("draw_snapshots").select("payload,last_updated").order("last_updated",{ascending:!1}).limit(1);if(!i){const l=s?.[0],a=Je(l?.payload);if(a)return O={data:a,source:"supabase",fetchedAt:Date.now()},{status:"ok",source:"supabase",data:a}}}catch{}return O={data:q,source:"local-fallback",fetchedAt:Date.now()},{status:"ok",source:"local-fallback",data:q}}async function st({forceRefresh:t=!1}={}){if(!t&&z.data&&Date.now()-z.fetchedAt<Se)return{status:"ok",source:z.source,data:z.data};if(oe&&j)try{const{data:s,error:i}=await j.from("category_draw_configs").select("id,source,name,icon,description,eligibility,recent_cutoff,cutoff_range,is_active,updated_at").eq("is_active",!0).order("updated_at",{ascending:!1});if(!i&&Array.isArray(s)&&s.length>0){const l=Qe(s);return z={data:l,source:"supabase",fetchedAt:Date.now()},{status:"ok",source:"supabase",data:l}}}catch{}return z={data:$,source:"local-fallback",fetchedAt:Date.now()},{status:"ok",source:"local-fallback",data:$}}const at=r.lazy(()=>ce(()=>import("./WelcomeScreen-CIwq-3Kh.js"),__vite__mapDeps([0,1,2,3,4,5]))),nt=r.lazy(()=>ce(()=>import("./Wizard-BVA_CDLo.js"),__vite__mapDeps([6,1,3,2,4,5]))),rt=r.lazy(()=>ce(()=>import("./Results-CGHMIwg5.js"),__vite__mapDeps([7,1,2,3,4,5]))),le="crs-progress";function he(){try{const t=localStorage.getItem(le);return t?JSON.parse(t):null}catch{return null}}function it(t){try{localStorage.setItem(le,JSON.stringify(t))}catch{}}function pe(){try{localStorage.removeItem(le)}catch{}}function ot(){try{return new URLSearchParams(window.location.search).get("unsubscribe")}catch{return null}}function ct(){return{}}function lt(){const{t}=ye(),[s,i]=r.useState(()=>ie()),l=s.autoSaveProgress!==!1,a=["off","subtle","full"].includes(s.motionIntensity)?s.motionIntensity:"full",o=ot(),d=ct(),[m,k]=r.useState(()=>o?"unsubscribe":Object.keys(d).length>0?"results":"welcome"),[g,S]=r.useState(()=>d),[y,w]=r.useState(()=>o?"loading":"idle"),[E,U]=r.useState(()=>Ze()),[T,L]=r.useState("local-fallback"),[A,P]=r.useState(()=>et());r.useEffect(()=>{if(!o)return;let u=!0;return Ue(o).then(f=>{u&&w(f.status==="ok"?"success":"notfound")}).catch(()=>{u&&w("error")}),()=>{u=!1}},[o]),r.useEffect(()=>{let u=!0;return tt().then(f=>{u&&f?.status==="ok"&&f.data&&(U(f.data),L(f.source||"local-fallback"))}).catch(()=>{}),()=>{u=!1}},[]),r.useEffect(()=>{let u=!0;return st().then(f=>{u&&f?.status==="ok"&&Array.isArray(f.data)&&f.data.length>0&&P(f.data)}).catch(()=>{}),()=>{u=!1}},[]);const K=r.useCallback(u=>{if(u&&l){const f=he();f&&S(f)}k("wizard")},[l]),h=r.useCallback(u=>{S(u),pe(),k("results"),window.scrollTo({top:0,behavior:"smooth"})},[]),J=r.useCallback(()=>{S({}),pe(),window.history.replaceState(null,"",window.location.pathname),k("welcome"),window.scrollTo({top:0,behavior:"smooth"})},[]),c=l&&!!he(),[I,M]=r.useState(!1),[v,C]=r.useState(null),[X,W]=r.useState(()=>{const u=window.matchMedia?.("(display-mode: standalone)")?.matches,f=window.navigator?.standalone===!0;return!!(u||f)});r.useEffect(()=>{const u=()=>M(window.scrollY>400);return window.addEventListener("scroll",u,{passive:!0}),()=>window.removeEventListener("scroll",u)},[]),r.useEffect(()=>{const u=_=>{_.preventDefault(),C(_)},f=()=>{C(null),W(!0)};return window.addEventListener("beforeinstallprompt",u),window.addEventListener("appinstalled",f),()=>{window.removeEventListener("beforeinstallprompt",u),window.removeEventListener("appinstalled",f)}},[]);const Q=r.useCallback(async()=>{if(!v)return;v.prompt(),(await v.userChoice)?.outcome==="accepted"&&C(null)},[v]);return r.useEffect(()=>{const u=()=>{i(ie())};return window.addEventListener("storage",u),window.addEventListener("crs-account-settings-updated",u),()=>{window.removeEventListener("storage",u),window.removeEventListener("crs-account-settings-updated",u)}},[]),r.useEffect(()=>{document.documentElement.setAttribute("data-motion",a)},[a]),r.useEffect(()=>{const u=document.documentElement,f=window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,_=window.matchMedia?.("(pointer: fine)")?.matches;if(!(a!=="off"&&!f&&!!_)){u.style.setProperty("--pointer-x","50%"),u.style.setProperty("--pointer-y","40%"),u.style.setProperty("--pointer-glow","0");return}u.style.setProperty("--pointer-glow",a==="subtle"?"0.45":"1");let R=0,D=50,b=40,x=50,N=40;const G=()=>{D+=(x-D)*.12,b+=(N-b)*.12,u.style.setProperty("--pointer-x",`${D.toFixed(2)}%`),u.style.setProperty("--pointer-y",`${b.toFixed(2)}%`),Math.abs(x-D)>.05||Math.abs(N-b)>.05?R=window.requestAnimationFrame(G):R=0},V=()=>{R||(R=window.requestAnimationFrame(G))},Z=te=>{x=te.clientX/window.innerWidth*100,N=te.clientY/window.innerHeight*100,V()},ee=()=>{x=50,N=40,V()};return window.addEventListener("pointermove",Z,{passive:!0}),window.addEventListener("pointerleave",ee,{passive:!0}),()=>{window.removeEventListener("pointermove",Z),window.removeEventListener("pointerleave",ee),R&&window.cancelAnimationFrame(R)}},[a]),e.jsxs("div",{className:"app",children:[e.jsxs("div",{className:"anime-bg","aria-hidden":"true",children:[e.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--one"}),e.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--two"}),e.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--three"}),e.jsx("span",{className:"anime-bg-grid"}),e.jsx("span",{className:"anime-bg-noise"}),e.jsx("span",{className:"anime-bg-pointer-glow"}),e.jsx("span",{className:"anime-bg-flare"}),e.jsx("span",{className:"anime-bg-vignette"}),e.jsxs("div",{className:"anime-bg-sparks",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})]}),e.jsx("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"}),e.jsx(He,{canInstallApp:!X&&!!v,onInstallApp:Q,motionIntensity:a}),e.jsx("main",{className:"main",role:"main",id:"main-content",children:e.jsxs(Le,{mode:"wait",children:[m==="welcome"&&e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(re,{})}),children:e.jsx(at,{onStart:K,hasSaved:c,drawData:E,drawSource:T,motionIntensity:a},"welcome")}),m==="wizard"&&e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(re,{})}),children:e.jsx(nt,{onFinish:h,onProgress:l?it:void 0,initialAnswers:g,motionIntensity:a},"wizard")}),m==="unsubscribe"&&e.jsxs("div",{className:"card unsubscribe-card",children:[e.jsx("h3",{children:"Draw alert preferences"}),y==="loading"&&e.jsx("p",{children:"Processing your unsubscribe requestâ€¦"}),y==="success"&&e.jsx("p",{children:"Youâ€™ve been unsubscribed from draw alerts successfully."}),y==="notfound"&&e.jsx("p",{children:"This unsubscribe link is invalid or already inactive."}),y==="error"&&e.jsx("p",{children:"We couldnâ€™t process this request right now. Please try again later."}),e.jsx("button",{type:"button",className:"btn-restart",onClick:()=>k("welcome"),children:"Back to calculator"})]}),m==="results"&&e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(re,{})}),children:e.jsx(rt,{answers:g,onRestart:J,drawData:E,drawSource:T,categoryInfo:A,motionIntensity:a},"results")})]})}),e.jsxs("footer",{className:"footer",children:[e.jsxs("p",{children:["Â© ",new Date().getFullYear()," ",t("footer.copy")]}),e.jsxs("p",{className:"footer-legal-links",children:[e.jsx("a",{href:"/terms.html",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:" Â· "}),e.jsx("a",{href:"/privacy.html",children:"Privacy Policy"})]})]}),I&&e.jsx("button",{type:"button",className:"btn-top",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),"aria-label":"Back to top",children:"â†‘"})]})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("[SW] Service Worker registered:",t)}).catch(t=>{console.error("[SW] Service Worker registration failed:",t)})});Pe.createRoot(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(Ie,{children:e.jsx(Me,{children:e.jsx(qe,{children:e.jsx(lt,{})})})})}));export{re as L,ce as _,Ze as a,pt as b,et as g,B as i,gt as l,ie as r,Ve as s,ye as u};
