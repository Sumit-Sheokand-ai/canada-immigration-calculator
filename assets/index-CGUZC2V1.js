const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WelcomeScreen-kN_Bzg6u.js","assets/vendor-react-Ah1pgjPn.js","assets/feature-path-coach-CtSDU3nA.js","assets/data-question-bank-F-s7nTqV.js","assets/vendor-supabase-BZ0N5lZN.js","assets/vendor-motion-DURBmaq0.js","assets/Wizard-T0CAQzH6.js","assets/Results-DdO7xJR1.js"])))=>i.map(i=>d[i]);
import{r as o,j as e,c as Oe}from"./vendor-react-Ah1pgjPn.js";import{s as _,i as ye,u as be,A as Me}from"./feature-path-coach-CtSDU3nA.js";import{u as ze,m as Fe,A as qe}from"./vendor-motion-DURBmaq0.js";import{t as oe,r as U}from"./data-question-bank-F-s7nTqV.js";import"./vendor-supabase-BZ0N5lZN.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function r(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(n){if(n.ep)return;n.ep=!0;const c=r(n);fetch(n.href,c)}})();const Ue="modulepreload",Be=function(t){return"/"+t},ue={},ce=function(s,r,i){let n=Promise.resolve();if(r&&r.length>0){let j=function(p){return Promise.all(p.map(S=>Promise.resolve(S).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),d=h?.nonce||h?.getAttribute("nonce");n=j(r.map(p=>{if(p=Be(p),p in ue)return;ue[p]=!0;const S=p.endsWith(".css"),b=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const g=document.createElement("link");if(g.rel=S?"stylesheet":Ue,S||(g.as="script"),g.crossOrigin="",g.href=p,d&&g.setAttribute("nonce",d),document.head.appendChild(g),S)return new Promise((E,Y)=>{g.addEventListener("load",E),g.addEventListener("error",()=>Y(new Error(`Unable to preload CSS for ${p}`)))})}))}function c(h){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=h,window.dispatchEvent(d),!d.defaultPrevented)throw h}return n.then(h=>{for(const d of h||[])d.status==="rejected"&&c(d.reason);return s().catch(c)})},ve=o.createContext();function Ye({children:t}){const[s,r]=o.useState(()=>{try{return localStorage.getItem("crs-theme")==="dark"}catch{return!1}});o.useEffect(()=>{document.documentElement.setAttribute("data-theme",s?"dark":"light");try{localStorage.setItem("crs-theme",s?"dark":"light")}catch{}},[s]);const i=()=>r(n=>!n);return e.jsx(ve.Provider,{value:{dark:s,toggle:i},children:t})}function We(){return o.useContext(ve)}const Ve={"header.title":"CRS Calculator 2026","welcome.heading":`Free CRS Calculator
for Express Entry 2026`,"welcome.sub":"Calculate your Comprehensive Ranking System (CRS) score for Canada Express Entry. Check FSW, CEC, PNP eligibility instantly. Updated with latest IRCC draw cutoffs.","welcome.btn":"Calculate My CRS Score Free","welcome.updated":"IRCC data updated:","welcome.trust":"Uses official IRCC draw data â€” last updated:","welcome.microcopy":"This will take 3 minutes â€” one question at a time.","welcome.resume":"You have an unfinished calculation.","welcome.resumeBtn":"Resume","welcome.startFresh":"Start Fresh","feature.accurate":"Official CRS Formula","feature.accurateDesc":"100% accurate IRCC scoring algorithm","feature.suggestions":"Boost Your Score","feature.suggestionsDesc":"Get personalized tips to gain +50 points","feature.draws":"2026 Draw Cutoffs","feature.drawsDesc":"Live IRCC Express Entry draw results","feature.instant":"Free & Instant","feature.instantDesc":"No signup required Â· Results in 2 minutes","wizard.step":"Step","wizard.of":"of","wizard.next":"Next â†’","wizard.back":"â† Back","wizard.calculate":"Calculate Score âœ“","results.breakdown":"Your CRS Score Breakdown","results.improve":"How to Increase Your CRS Score","results.category":"Category-Based Draw Eligibility","results.catIntro":"IRCC runs category-based draws with lower cutoffs for healthcare, STEM, trades, transport, and French speakers. Here's your eligibility:","results.timeline":"PR Timeline Estimate","results.draws":"Latest Express Entry Draws 2026","results.disclaimer":"This free CRS calculator provides an estimate based on IRCC's publicly available scoring criteria. Not affiliated with Immigration, Refugees and Citizenship Canada.","results.restart":"â†» Recalculate","results.share":"Share Results","results.pdf":"Download PDF","results.whatif":"What-If Score Simulator","results.whatifDesc":"See how improving IELTS, education, or work experience affects your CRS:","results.original":"Current","results.projected":"Projected","results.foreignWork":"Foreign Work (Skill Bonus)","footer.copy":"Free CRS Calculator 2026 Â· Not affiliated with IRCC"},Ge={"header.title":"Calculateur SRC","welcome.heading":`Immigration au Canada
Calculateur de Points`,"welcome.sub":"Calculez votre score du SystÃ¨me de classement global (SCG) et dÃ©couvrez votre meilleur chemin vers la rÃ©sidence permanente canadienne.","welcome.btn":"Calculer Mon Score","welcome.updated":"DerniÃ¨re mise Ã  jour :","welcome.trust":"DonnÃ©es officielles dâ€™IRCC â€” derniÃ¨re mise Ã  jour :","welcome.microcopy":"Cela prend 3 minutes â€” une question Ã  la fois.","welcome.resume":"Vous avez un calcul en cours.","welcome.resumeBtn":"Reprendre","welcome.startFresh":"Recommencer","feature.accurate":"Score SCG PrÃ©cis","feature.accurateDesc":"Calcul complet du SystÃ¨me de classement global","feature.suggestions":"Suggestions Intelligentes","feature.suggestionsDesc":"Conseils personnalisÃ©s pour augmenter vos points","feature.draws":"Derniers Tirages","feature.drawsDesc":"RÃ©sultats Ã  jour des tirages EntrÃ©e express d'IRCC","feature.instant":"RÃ©sultats InstantanÃ©s","feature.instantDesc":"Obtenez votre score en moins de 2 minutes","wizard.step":"Ã‰tape","wizard.of":"de","wizard.next":"Suivant â†’","wizard.back":"â† Retour","wizard.calculate":"Calculer le Score âœ“","results.breakdown":"DÃ©tail de Votre Score","results.improve":"Comment AmÃ©liorer Votre Score","results.category":"AdmissibilitÃ© aux Tirages par CatÃ©gorie","results.catIntro":"Le Canada organise des tirages spÃ©ciaux pour des groupes spÃ©cifiques avec des seuils plus bas. Voici ce Ã  quoi vous pourriez Ãªtre admissible :","results.timeline":"Calendrier EstimÃ©","results.draws":"Tirages RÃ©cents EntrÃ©e Express","results.disclaimer":"Ce calculateur fournit une estimation basÃ©e sur les critÃ¨res SCG publics. Il n'est pas affiliÃ© Ã  IRCC.","results.restart":"â†» Recommencer","results.share":"Partager les RÃ©sultats","results.pdf":"TÃ©lÃ©charger PDF","results.whatif":"Comparaison HypothÃ©tique","results.whatifDesc":"Ajustez les variables pour voir comment votre score change :","results.original":"Original","results.projected":"ProjetÃ©","results.foreignWork":"Exp. Ã‰trangÃ¨re (Bonus)","footer.copy":"Calculateur SRC Â· Non affiliÃ© Ã  IRCC"},de={en:Ve,fr:Ge},Se=o.createContext();function $e({children:t}){const[s,r]=o.useState(()=>{try{return localStorage.getItem("crs-lang")||"en"}catch{return"en"}}),i=o.useCallback(c=>{r(c);try{localStorage.setItem("crs-lang",c)}catch{}},[]),n=o.useCallback(c=>de[s]?.[c]||de.en[c]||c,[s]);return e.jsx(Se.Provider,{value:{lang:s,setLang:i,t:n},children:t})}function xe(){return o.useContext(Se)}const Ce="crs-analytics-queue-v2",me="crs-analytics-session-v1",fe="2.0",He=1800*1e3,Je=2500;function je(t,s){try{return t?JSON.parse(t):s}catch{return s}}function Ke(t,s){return typeof window>"u"?s:je(window.localStorage.getItem(t),s)}function Qe(t,s){if(!(typeof window>"u"))try{window.localStorage.setItem(t,JSON.stringify(s))}catch{}}function ke(t="evt"){return`${t}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,9)}`}function Xe(t,s=0){const r=Number(t);return Number.isFinite(r)?r:s}function Ze(t){return t?String(t).trim().toLowerCase().replace(/[^a-z0-9:_-]+/g,"_").slice(0,80):""}function et(t={}){const s={};for(const[r,i]of Object.entries(t||{}))if(!(!r||i==null)){if(typeof i=="string"){s[r]=i.slice(0,280);continue}if(typeof i=="number"||typeof i=="boolean"){s[r]=i;continue}if(Array.isArray(i)){s[r]=i.slice(0,20).map(n=>String(n).slice(0,120));continue}s[r]=String(i).slice(0,280)}return s}function tt(){return Ke(Ce,[])}function st(t){const s=Array.isArray(t)?t.slice(-300):[];Qe(Ce,s)}function nt(){if(typeof window>"u")return{id:"server",seq:0,started_at:new Date().toISOString()};const t=Date.now(),s=je(window.sessionStorage.getItem(me),null),i=!s||!s.last_activity_ms||t-s.last_activity_ms>He?{id:ke("sess"),seq:1,started_at:new Date().toISOString(),last_activity_ms:t}:{...s,seq:Xe(s.seq,0)+1,last_activity_ms:t};try{window.sessionStorage.setItem(me,JSON.stringify(i))}catch{}return i}function at(){if(typeof window>"u")return{app_version:"dev"};let t="unknown";try{t=Intl.DateTimeFormat().resolvedOptions().timeZone||"unknown"}catch{}return{app_version:"dev",lang:window.navigator?.language||"unknown",timezone:t,path:window.location?.pathname||"/"}}function rt(t){return!1}async function ot(t){if(typeof window>"u")return!1;const s=void 0;if(!rt())return!1;const r=JSON.stringify(t);if(window.navigator?.sendBeacon&&document.visibilityState==="hidden")try{if(window.navigator.sendBeacon(s,new Blob([r],{type:"application/json"})))return!0}catch{}const i=typeof AbortController<"u"?new AbortController:null;let n=null;i&&(n=window.setTimeout(()=>i.abort(),Je));try{return(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:r,keepalive:!0,signal:i?.signal})).ok}catch{return!1}finally{n&&window.clearTimeout(n)}}function it(t,s){if(!(typeof window>"u")&&typeof window.plausible=="function")try{window.plausible(t,{props:s})}catch{}}function T(t,s={}){if(typeof window>"u")return;const r=Ze(t);if(!r)return;const i=nt(),n=et(s),c=at(),h={event_id:ke("evt"),schema_version:fe,name:r,ts:new Date().toISOString(),session_id:i.id,session_seq:i.seq,session_started_at:i.started_at,payload:n,meta:c},d=tt();d.push(h),st(d),it(r,{...n,schema_version:fe,session_seq:i.seq}),ot(h)}function ct(t,s){const r=t.answers||{};return{id:t.id,user_id:s||null,name:t.name||null,score:Number(t.score)||0,email:t.email||null,alert_opt_in:!!t.alertOptIn,alert_token:t.alertToken||null,profile_json:{answers:r,tracking:{userId:s||null,savedAt:new Date().toISOString()}},updated_at:new Date().toISOString()}}function se(t){const s=String(t?.message||"");return/column\s+["']?user_id["']?\s+does not exist/i.test(s)}function J(t,s){const r=s?.message||s?.hint||String(s);return`${t}: ${r}`}function B(){return ye&&!!_}async function Dt(t,s={}){if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const r=s.userId||null,i=ct(t,r);let n,c;if({data:n,error:c}=await _.from("saved_profiles").upsert(i,{onConflict:"id"}).select(),c&&r&&se(c)){const{user_id:h,...d}=i;({data:n,error:c}=await _.from("saved_profiles").upsert(d,{onConflict:"id"}).select())}if(c)throw new Error(J("Supabase upsert failed",c));return{status:"ok",data:n||[]}}async function lt(t){if(!t)return{status:"skipped",reason:"Missing token"};if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const{data:s,error:r}=await _.from("saved_profiles").update({alert_opt_in:!1,updated_at:new Date().toISOString()}).eq("alert_token",t).select();if(r)throw new Error(J("Supabase unsubscribe failed",r));return s?.length?{status:"ok",data:s[0]}:{status:"not-found"}}async function Tt(t){if(!t)return{status:"skipped",reason:"Missing user id"};if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const{data:s,error:r}=await _.from("saved_profiles").select("id,name,score,email,updated_at").eq("user_id",t).order("updated_at",{ascending:!1}).limit(12);if(r&&se(r))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(r)throw new Error(J("Supabase profile list failed",r));return{status:"ok",data:s||[]}}async function ut(t,s){if(!t)return{status:"skipped",reason:"Missing user id"};if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const{error:r,data:i}=await _.from("saved_profiles").update({alert_opt_in:!!s,updated_at:new Date().toISOString()}).eq("user_id",t).select("id");if(r&&se(r))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(r)throw new Error(J("Supabase alert preference update failed",r));return{status:"ok",updatedCount:i?.length||0}}async function dt(t,s){if(!t)return{status:"skipped",reason:"Missing user id"};if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const r=s?String(s).trim().toLowerCase():null,{error:i,data:n}=await _.from("saved_profiles").update({email:r||null,updated_at:new Date().toISOString()}).eq("user_id",t).select("id");if(i&&se(i))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(i)throw new Error(J("Supabase profile email update failed",i));return{status:"ok",updatedCount:n?.length||0}}const Ee="crs-account-settings-v1",q={profileName:"",contactEmail:"",defaultDrawAlerts:!1,autoSyncProfiles:!0,autoSaveProgress:!0,motionIntensity:"full"};function ie(){try{const t=localStorage.getItem(Ee);if(!t)return{...q};const s=JSON.parse(t);return!s||typeof s!="object"?{...q}:{...q,...s}}catch{return{...q}}}function mt(t){const s={...q,...t||{}};["off","subtle","full"].includes(s.motionIntensity)||(s.motionIntensity=q.motionIntensity);try{localStorage.setItem(Ee,JSON.stringify(s))}catch{}try{window.dispatchEvent(new Event("crs-account-settings-updated"))}catch{}return s}const he=/^\S+@\S+\.\S+$/,$="DELETE",pe=8;function ft({open:t,onClose:s}){const{isConfigured:r,loading:i,user:n,sendEmailMagicLink:c,verifyEmailOtp:h,refreshSession:d,signInWithGoogle:j,signOut:p,updateProfile:S,changePassword:b,deleteAccount:g}=be(),[E,Y]=o.useState(""),[O,R]=o.useState(""),[N,A]=o.useState("request"),[K,w]=o.useState(""),[Q,l]=o.useState(""),[I,M]=o.useState(0),[v,C]=o.useState(()=>ie()),[X,W]=o.useState(""),[Z,u]=o.useState(""),[m,P]=o.useState(""),ne=o.useId(),L=o.useMemo(()=>n?"Account":"Login / Signup",[n]),D=B(),y=K!=="",x=a=>K===a;if(o.useEffect(()=>{if(!t||I<=0)return;const a=window.setInterval(()=>{M(f=>f<=1?0:f-1)},1e3);return()=>window.clearInterval(a)},[t,I]),o.useEffect(()=>{!t||!n||C(a=>({...a,profileName:n.user_metadata?.full_name||a.profileName||"",contactEmail:a.contactEmail||n.email||""}))},[t,n]),o.useEffect(()=>{if(!t||!n||!(N==="sent"||N==="verify"))return;l("Signed in successfully.");const a=window.setTimeout(()=>s(),500);return()=>window.clearTimeout(a)},[s,t,N,n]),o.useEffect(()=>{t||(A("request"),R(""),l(""),w(""),M(0),W(""),u(""),P(""))},[t]),o.useEffect(()=>{if(!t)return;const a=document.body.style.overflow,f=ae=>{ae.key==="Escape"&&s()};return document.body.style.overflow="hidden",window.addEventListener("keydown",f),()=>{window.removeEventListener("keydown",f),document.body.style.overflow=a}},[s,t]),!t)return null;const k=E.trim().toLowerCase(),V=m.trim().toUpperCase(),z=a=>{const f=document.getElementById(a);f&&f.scrollIntoView({behavior:"smooth",block:"start"})},G=async()=>{if(!k||!he.test(k)){l("Please enter a valid email address.");return}w("sendMagicLink"),l("");try{await c(k),A("sent"),R(""),M(25),l("Magic link sent. Open your email and click the secure sign-in link.")}catch(a){l(a.message||"Could not send magic link.")}finally{w("")}},ee=async()=>{w("checkMagicLink"),l("");try{(await d())?.user?(l("Signed in successfully."),A("request"),window.setTimeout(()=>s(),500)):l("No active session found yet. Click the magic link from your email in this browser, then try again.")}catch(a){l(a.message||"Could not refresh session.")}finally{w("")}},te=async()=>{I>0||await G()},_e=async()=>{if(!k||!O.trim()){l("Enter your email and 6-digit code.");return}w("verifyCode"),l("");try{await h(k,O.trim()),await d(),l("Signed in successfully."),A("request"),R(""),window.setTimeout(()=>s(),500)}catch(a){l(a.message||"Verification failed.")}finally{w("")}},Ae=async()=>{w("googleAuth"),l("");try{await j(),l("Redirecting to Google...")}catch(a){l(a.message||"Google login failed.")}finally{w("")}},Ie=async()=>{const a={...v,profileName:(v.profileName||"").trim(),contactEmail:(v.contactEmail||"").trim().toLowerCase()};if(a.contactEmail&&!he.test(a.contactEmail)){l("Please enter a valid contact email.");return}w("saveSettings"),l("");try{await S({fullName:a.profileName}),mt(a),C(a),D&&n?.id&&await Promise.all([ut(n.id,a.defaultDrawAlerts),dt(n.id,a.contactEmail||n.email||"")]),l("Account settings saved.")}catch(f){l(f.message||"Could not save account settings.")}finally{w("")}},Pe=async()=>{const a=X.trim(),f=Z.trim();if(a.length<pe){l(`Password must be at least ${pe} characters.`);return}if(a!==f){l("New password and confirmation do not match.");return}w("changePassword"),l("");try{await b(a),W(""),u(""),l("Password updated successfully.")}catch(ae){l(ae.message||"Could not change password.")}finally{w("")}},Le=()=>{{l("Membership management is unavailable. Add VITE_STRIPE_BILLING_PORTAL_URL.");return}},Re=async()=>{if(V!==$){l(`Type ${$} to confirm account deletion.`);return}w("deleteAccount"),l("");try{await g(),P(""),l("Account deleted."),window.setTimeout(()=>s(),350)}catch(a){l(a.message||"Could not delete account.")}finally{w("")}},De=async()=>{w("refreshSession"),l("");try{await d(),l("Session refreshed.")}catch(a){l(a.message||"Session refresh failed.")}finally{w("")}},Te=async()=>{w("signOut"),l("");try{await p(),l("Signed out."),window.setTimeout(()=>s(),400)}catch(a){l(a.message||"Sign out failed.")}finally{w("")}};return e.jsx("div",{className:"auth-modal-backdrop",onClick:s,role:"presentation",children:e.jsxs("div",{className:"auth-modal",role:"dialog","aria-modal":"true","aria-labelledby":ne,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"auth-modal-head",children:[e.jsx("h3",{id:ne,children:L}),e.jsx("button",{type:"button",className:"auth-close",onClick:s,"aria-label":"Close dialog",children:"Ã—"})]}),e.jsxs("div",{className:"auth-modal-scroll",children:[!r&&e.jsx("p",{className:"auth-note",children:"Auth is unavailable. Add `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`."}),r&&i&&e.jsx("p",{className:"auth-note",children:"Checking session..."}),r&&!i&&n&&e.jsxs("div",{className:"auth-body",children:[e.jsxs("p",{className:"auth-note",children:["Signed in as ",e.jsx("strong",{children:n.email})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section",children:[e.jsx("h4",{children:"Account actions"}),e.jsxs("div",{className:"auth-action-shortcuts",children:[e.jsx("button",{type:"button",className:"action-btn",onClick:()=>z("auth-security"),children:"Change password"}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>z("auth-membership"),children:"Remove membership"}),e.jsx("button",{type:"button",className:"action-btn auth-btn-danger",onClick:()=>z("auth-danger-zone"),children:"Delete account"})]})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section",children:[e.jsx("h4",{children:"Account settings"}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Display name"}),e.jsx("input",{type:"text",value:v.profileName,onChange:a=>C(f=>({...f,profileName:a.target.value})),placeholder:"Your name"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Contact email for draw alerts"}),e.jsx("input",{type:"email",value:v.contactEmail,onChange:a=>C(f=>({...f,contactEmail:a.target.value})),placeholder:"you@example.com"})]}),e.jsxs("label",{className:"auth-check-row",children:[e.jsx("input",{type:"checkbox",checked:v.defaultDrawAlerts,onChange:a=>C(f=>({...f,defaultDrawAlerts:a.target.checked}))}),e.jsx("span",{children:"Enable draw alerts by default"})]}),e.jsxs("label",{className:"auth-check-row",children:[e.jsx("input",{type:"checkbox",checked:v.autoSyncProfiles,onChange:a=>C(f=>({...f,autoSyncProfiles:a.target.checked}))}),e.jsx("span",{children:"Auto-sync saved profiles"})]}),e.jsxs("label",{className:"auth-check-row",children:[e.jsx("input",{type:"checkbox",checked:v.autoSaveProgress,onChange:a=>C(f=>({...f,autoSaveProgress:a.target.checked}))}),e.jsx("span",{children:"Auto-save wizard progress on this device"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Animation intensity"}),e.jsxs("select",{value:v.motionIntensity||"full",onChange:a=>C(f=>({...f,motionIntensity:a.target.value})),children:[e.jsx("option",{value:"full",children:"Full"}),e.jsx("option",{value:"subtle",children:"Subtle"}),e.jsx("option",{value:"off",children:"Off"})]})]}),!D&&e.jsx("p",{className:"auth-note",children:"Cloud account settings require Supabase env vars."})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section",id:"auth-security",children:[e.jsx("h4",{children:"Security"}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"New password"}),e.jsx("input",{type:"password",value:X,onChange:a=>W(a.target.value),placeholder:"At least 8 characters",autoComplete:"new-password"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Confirm new password"}),e.jsx("input",{type:"password",value:Z,onChange:a=>u(a.target.value),placeholder:"Re-enter new password",autoComplete:"new-password"})]}),e.jsx("div",{className:"auth-actions",children:e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:Pe,children:x("changePassword")?"Updating...":"Change password"})})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section",id:"auth-membership",children:[e.jsx("h4",{children:"Membership"}),e.jsx("p",{className:"auth-note",children:"Remove or manage your membership from the billing portal."}),e.jsx("div",{className:"auth-actions",children:e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:Le,children:"Remove membership"})})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section auth-danger-zone",id:"auth-danger-zone",children:[e.jsx("h4",{children:"Danger zone"}),e.jsxs("p",{className:"auth-note",children:["This permanently deletes your account. Type ",e.jsx("strong",{children:$})," to confirm."]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Confirmation"}),e.jsx("input",{type:"text",value:m,onChange:a=>P(a.target.value),placeholder:$})]}),e.jsx("div",{className:"auth-actions",children:e.jsx("button",{type:"button",className:"action-btn auth-btn-danger",disabled:y||V!==$,onClick:Re,children:x("deleteAccount")?"Deleting...":"Delete account"})})]}),e.jsxs("div",{className:"auth-actions",children:[e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:y,onClick:Ie,children:x("saveSettings")?"Saving...":"Save settings"}),e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:De,children:x("refreshSession")?"Refreshing...":"Refresh session"}),e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:Te,children:x("signOut")?"Signing out...":"Sign out"})]})]}),r&&!i&&!n&&e.jsxs("div",{className:"auth-body",children:[e.jsx("p",{className:"auth-note",children:"Sign in with a magic link (recommended) or verify manually with an email code."}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",placeholder:"you@example.com",value:E,onChange:a=>Y(a.target.value),autoFocus:!0})]}),N==="verify"&&e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Email verification code"}),e.jsx("input",{type:"text",inputMode:"numeric",placeholder:"Enter code",value:O,onChange:a=>R(a.target.value)})]}),e.jsxs("div",{className:"auth-actions",children:[N==="request"?e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:y,onClick:G,children:x("sendMagicLink")?"Sending...":"Send magic link"}):N==="sent"?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:y,onClick:ee,children:x("checkMagicLink")?"Checking...":"I clicked the magic link"}),e.jsx("button",{type:"button",className:"action-btn",disabled:y||I>0,onClick:te,children:I>0?`Resend in ${I}s`:"Resend magic link"}),e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:()=>{A("verify"),l("If your email contains a code, enter it below.")},children:"Use email code instead"})]}):e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:y,onClick:_e,children:x("verifyCode")?"Verifying...":"Verify and sign in"}),e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:Ae,children:x("googleAuth")?"Redirecting...":"Continue with Google"}),N!=="request"&&e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:()=>{A("request"),R(""),l(""),M(0)},children:"Back"})]})]}),Q&&e.jsx("p",{className:"auth-status",role:"status","aria-live":"polite",children:Q})]})]})})}const ht={en:"EN",fr:"FR"};function pt({canInstallApp:t=!1,onInstallApp:s=()=>{},motionIntensity:r="full"}){const i=ze()||r==="off",{dark:n,toggle:c}=We(),{lang:h,setLang:d,t:j}=xe(),{user:p}=be(),[S,b]=o.useState(!1);return o.useEffect(()=>{const g=()=>b(!0);return window.addEventListener("crs-open-account-modal",g),()=>{window.removeEventListener("crs-open-account-modal",g)}},[]),e.jsxs(e.Fragment,{children:[e.jsx(Fe.header,{className:"header",initial:i?!1:{y:-60,opacity:0},animate:{y:0,opacity:1},transition:i?{duration:0}:{type:"spring",stiffness:120,damping:20},children:e.jsxs("div",{className:"header-inner",children:[e.jsxs("div",{className:"logo",children:[e.jsx("span",{className:"logo-leaf",children:"ðŸ"}),e.jsx("span",{children:j("header.title")})]}),e.jsxs("div",{className:"header-actions",children:[t&&e.jsx("button",{type:"button",className:"install-btn",onClick:s,"aria-label":"Install app",title:"Add app shortcut",children:"Install app"}),e.jsx("button",{type:"button",className:"auth-toggle",onClick:()=>{b(!0),T("account_modal_opened",{source:"header_button",is_authenticated:!!p})},"aria-label":p?"Manage account":"Login or signup",title:p?p.email:"Login / Signup",children:p?"Account":"Login"}),e.jsx("select",{className:"lang-select",value:h,onChange:g=>d(g.target.value),"aria-label":"Select language",children:Object.entries(ht).map(([g,E])=>e.jsx("option",{value:g,children:E},g))}),e.jsx("button",{type:"button",className:"theme-toggle",onClick:c,"aria-label":n?"Switch to light mode":"Switch to dark mode",title:n?"Light mode":"Dark mode",children:n?"Light":"Dark"})]})]})}),e.jsx(ft,{open:S,onClose:()=>b(!1)})]})}function re(){const t=Array.from({length:9});return e.jsxs("div",{className:"uv-loader",children:[t.map((s,r)=>e.jsx("div",{className:"uv-text",children:e.jsx("span",{children:"Loading"})},r)),e.jsx("div",{className:"uv-line"})]})}const Ne=300*1e3;let F={data:null,source:"none",fetchedAt:0},H={data:null,source:"none",fetchedAt:0};function gt(t){return!!t&&typeof t=="object"&&Array.isArray(t.generalProgram)&&Array.isArray(t.categoryBased)&&Array.isArray(t.pnpDraws)&&Number.isFinite(Number(t.averageCutoff))}function wt(t){return gt(t)?{...t,generalProgram:t.generalProgram||[],categoryBased:t.categoryBased||[],pnpDraws:t.pnpDraws||[],averageCutoff:Number(t.averageCutoff)||U.averageCutoff,lastUpdated:t.lastUpdated||U.lastUpdated,pnpRanges:t.pnpRanges||U.pnpRanges}:null}function yt(){return U}function bt(){return oe}async function vt({forceRefresh:t=!1}={}){if(!t&&F.data&&Date.now()-F.fetchedAt<Ne)return{status:"ok",source:F.source,data:F.data};if(ye&&_)try{const{data:s,error:r}=await _.from("draw_snapshots").select("payload,last_updated").order("last_updated",{ascending:!1}).limit(1);if(!r){const i=s?.[0],n=wt(i?.payload);if(n)return F={data:n,source:"supabase",fetchedAt:Date.now()},{status:"ok",source:"supabase",data:n}}}catch{}return F={data:U,source:"local-fallback",fetchedAt:Date.now()},{status:"ok",source:"local-fallback",data:U}}async function St({forceRefresh:t=!1}={}){return!t&&H.data&&Date.now()-H.fetchedAt<Ne?{status:"ok",source:H.source,data:H.data}:(H={data:oe,source:"local-fallback",fetchedAt:Date.now()},{status:"ok",source:"local-fallback",data:oe})}const xt=o.lazy(()=>ce(()=>import("./WelcomeScreen-kN_Bzg6u.js"),__vite__mapDeps([0,1,2,3,4,5]))),Ct=o.lazy(()=>ce(()=>import("./Wizard-T0CAQzH6.js"),__vite__mapDeps([6,1,3,2,4,5]))),jt=o.lazy(()=>ce(()=>import("./Results-DdO7xJR1.js"),__vite__mapDeps([7,1,2,3,4,5]))),le="crs-progress";function ge(){try{const t=localStorage.getItem(le);return t?JSON.parse(t):null}catch{return null}}function kt(t){try{localStorage.setItem(le,JSON.stringify(t))}catch{}}function we(){try{localStorage.removeItem(le)}catch{}}function Et(){try{return new URLSearchParams(window.location.search).get("unsubscribe")}catch{return null}}function Nt(){return{}}function _t(){const{t}=xe(),[s,r]=o.useState(()=>ie()),i=s.autoSaveProgress!==!1,n=["off","subtle","full"].includes(s.motionIntensity)?s.motionIntensity:"full",c=Et(),h=Nt(),[d,j]=o.useState(()=>c?"unsubscribe":Object.keys(h).length>0?"results":"welcome"),[p,S]=o.useState(()=>h),[b,g]=o.useState(()=>c?"loading":"idle"),[E,Y]=o.useState(()=>yt()),[O,R]=o.useState("local-fallback"),[N,A]=o.useState(()=>bt());o.useEffect(()=>{if(!c)return;let u=!0;return lt(c).then(m=>{u&&g(m.status==="ok"?"success":"notfound")}).catch(()=>{u&&g("error")}),()=>{u=!1}},[c]),o.useEffect(()=>{let u=!0;return vt().then(m=>{u&&m?.status==="ok"&&m.data&&(Y(m.data),R(m.source||"local-fallback"))}).catch(()=>{}),()=>{u=!1}},[]),o.useEffect(()=>{let u=!0;return St().then(m=>{u&&m?.status==="ok"&&Array.isArray(m.data)&&m.data.length>0&&A(m.data)}).catch(()=>{}),()=>{u=!1}},[]);const K=o.useCallback(u=>{if(u&&i){const m=ge();m&&S(m)}T("wizard_started",{resumed:!!u}),j("wizard")},[i]),w=o.useCallback(u=>{S(u),we(),T("wizard_completed",{answer_count:Object.keys(u||{}).length}),j("results"),window.scrollTo({top:0,behavior:"smooth"})},[]),Q=o.useCallback(()=>{S({}),we(),T("calculator_restarted"),window.history.replaceState(null,"",window.location.pathname),j("welcome"),window.scrollTo({top:0,behavior:"smooth"})},[]),l=i&&!!ge(),[I,M]=o.useState(!1),[v,C]=o.useState(null),[X,W]=o.useState(()=>{const u=window.matchMedia?.("(display-mode: standalone)")?.matches,m=window.navigator?.standalone===!0;return!!(u||m)});o.useEffect(()=>{const u=()=>M(window.scrollY>400);return window.addEventListener("scroll",u,{passive:!0}),()=>window.removeEventListener("scroll",u)},[]),o.useEffect(()=>{const u=P=>{typeof P?.prompt=="function"&&C(P)},m=()=>{C(null),W(!0)};return window.addEventListener("beforeinstallprompt",u),window.addEventListener("appinstalled",m),()=>{window.removeEventListener("beforeinstallprompt",u),window.removeEventListener("appinstalled",m)}},[]);const Z=o.useCallback(async()=>{if(!v)return;T("install_prompt_triggered"),v.prompt(),(await v.userChoice)?.outcome==="accepted"?(C(null),T("install_prompt_accepted")):T("install_prompt_dismissed")},[v]);return o.useEffect(()=>{const u=()=>{r(ie())};return window.addEventListener("storage",u),window.addEventListener("crs-account-settings-updated",u),()=>{window.removeEventListener("storage",u),window.removeEventListener("crs-account-settings-updated",u)}},[]),o.useEffect(()=>{document.documentElement.setAttribute("data-motion",n)},[n]),o.useEffect(()=>{const u=document.documentElement,m=window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,P=window.matchMedia?.("(pointer: fine)")?.matches;if(!(n!=="off"&&!m&&!!P)){u.style.setProperty("--pointer-x","50%"),u.style.setProperty("--pointer-y","40%"),u.style.setProperty("--pointer-glow","0");return}u.style.setProperty("--pointer-glow",n==="subtle"?"0.45":"1");let L=0,D=50,y=40,x=50,k=40;const V=()=>{D+=(x-D)*.12,y+=(k-y)*.12,u.style.setProperty("--pointer-x",`${D.toFixed(2)}%`),u.style.setProperty("--pointer-y",`${y.toFixed(2)}%`),Math.abs(x-D)>.05||Math.abs(k-y)>.05?L=window.requestAnimationFrame(V):L=0},z=()=>{L||(L=window.requestAnimationFrame(V))},G=te=>{x=te.clientX/window.innerWidth*100,k=te.clientY/window.innerHeight*100,z()},ee=()=>{x=50,k=40,z()};return window.addEventListener("pointermove",G,{passive:!0}),window.addEventListener("pointerleave",ee,{passive:!0}),()=>{window.removeEventListener("pointermove",G),window.removeEventListener("pointerleave",ee),L&&window.cancelAnimationFrame(L)}},[n]),e.jsxs("div",{className:"app",children:[e.jsxs("div",{className:"anime-bg","aria-hidden":"true",children:[e.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--one"}),e.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--two"}),e.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--three"}),e.jsx("span",{className:"anime-bg-grid"}),e.jsx("span",{className:"anime-bg-noise"}),e.jsx("span",{className:"anime-bg-pointer-glow"}),e.jsx("span",{className:"anime-bg-flare"}),e.jsx("span",{className:"anime-bg-vignette"}),e.jsxs("div",{className:"anime-bg-sparks",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})]}),e.jsx("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"}),e.jsx(pt,{canInstallApp:!X&&!!v,onInstallApp:Z,motionIntensity:n}),e.jsx("main",{className:"main",role:"main",id:"main-content",children:e.jsxs(qe,{mode:"wait",children:[d==="welcome"&&e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(re,{})}),children:e.jsx(xt,{onStart:K,hasSaved:l,drawData:E,drawSource:O,motionIntensity:n},"welcome")}),d==="wizard"&&e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(re,{})}),children:e.jsx(Ct,{onFinish:w,onProgress:i?kt:void 0,initialAnswers:p,motionIntensity:n},"wizard")}),d==="unsubscribe"&&e.jsxs("div",{className:"card unsubscribe-card",children:[e.jsx("h3",{children:"Draw alert preferences"}),b==="loading"&&e.jsx("p",{children:"Processing your unsubscribe requestâ€¦"}),b==="success"&&e.jsx("p",{children:"Youâ€™ve been unsubscribed from draw alerts successfully."}),b==="notfound"&&e.jsx("p",{children:"This unsubscribe link is invalid or already inactive."}),b==="error"&&e.jsx("p",{children:"We couldnâ€™t process this request right now. Please try again later."}),e.jsx("button",{type:"button",className:"btn-restart",onClick:()=>j("welcome"),children:"Back to calculator"})]}),d==="results"&&e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(re,{})}),children:e.jsx(jt,{answers:p,onRestart:Q,drawData:E,drawSource:O,categoryInfo:N,motionIntensity:n},"results")})]})}),e.jsxs("footer",{className:"footer",children:[e.jsxs("p",{children:["Â© ",new Date().getFullYear()," ",t("footer.copy")]}),e.jsxs("p",{className:"footer-legal-links",children:[e.jsx("a",{href:"/guides.html",children:"Guides"}),e.jsx("span",{"aria-hidden":"true",children:" Â· "}),e.jsx("a",{href:"/terms.html",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:" Â· "}),e.jsx("a",{href:"/privacy.html",children:"Privacy Policy"}),e.jsx("span",{"aria-hidden":"true",children:" Â· "}),e.jsx("a",{href:"/trust.html",children:"Trust Center"})]})]}),I&&e.jsx("button",{type:"button",className:"btn-top",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),"aria-label":"Back to top",children:"â†‘"})]})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("[SW] Service Worker registered:",t)}).catch(t=>{console.error("[SW] Service Worker registration failed:",t)})});Oe.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(Me,{children:e.jsx(Ye,{children:e.jsx($e,{children:e.jsx(_t,{})})})})}));export{re as L,ce as _,yt as a,Dt as b,bt as g,B as i,Tt as l,ie as r,mt as s,T as t,xe as u};
