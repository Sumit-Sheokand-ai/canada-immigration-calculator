const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/feature-path-coach-Beny58Sb.js","assets/vendor-react-Ah1pgjPn.js","assets/data-question-bank-BsLULj9F.js","assets/vendor-motion-CtNR3TjB.js","assets/feature-strategy-hub-CrbzrlAd.js"])))=>i.map(i=>d[i]);
import{d as ga,e as xa,f as H,h as va,j as ba,u as ya,c as ja,_ as Ge}from"./feature-path-coach-Beny58Sb.js";import{r as l,j as e}from"./vendor-react-Ah1pgjPn.js";import{v as Na}from"./data-question-bank-BsLULj9F.js";import{u as ka,l as ae,t as k,I as L,i as wa}from"./feature-strategy-hub-CrbzrlAd.js";import{r as Fe,g as Sa,l as Ie,a as Ca,b as _a,i as Ea,s as Pa,u as La,L as Ta}from"./index--z078Ve7.js";import{u as Aa,m,A as V}from"./vendor-motion-CtNR3TjB.js";function I(s,t,n,o,r,g,f=""){return{title:s,description:t,potentialGain:n,difficulty:o,timeframe:r,icon:g,action:f}}function Ma(s,t){const n=[],o=ga(s),r=xa(s),g=s.firstOfficialLanguage==="french"?"french":"english",f=g==="french"||s.hasFrench==="yes";if(o<10){const d=Math.min(o+1,10),c=["listening","reading","writing","speaking"];let u="First official language";const x={};if(g==="french"){u="French (NCLC)",x.hasFrench="yes",x.frenchTestType="clb";for(const _ of c){const v=`french_${_}`,w=parseInt(s[v],10)||0;x[v]=String(Math.max(w,d))}}else{u=s.langTestType==="celpip"?"CELPIP":"IELTS";for(const _ of c){const v=s.langTestType==="celpip"?`celpip_${_}`:`ielts_${_}`,w=s.langTestType==="celpip"?parseInt(s[v],10)||0:parseFloat(s[v])||0;s.langTestType==="celpip"?x[v]=Math.max(w,d):x[v]=Math.max(w,w+.5)}}const S=H(s,x).total-t.total;S>0&&n.push(I(`Improve ${u} Scores`,`Raising your weakest ${u} skill to CLB ${d} could add significant points. Focus on your lowest band.`,S,"Medium","3-5 months","language",`Current min CLB ${o} → target CLB ${d} = +${S} CRS`))}const p=["less_than_secondary","secondary","one_year_post","two_year_post","bachelors","two_or_more","masters","doctoral"],h=p.indexOf(s.education);if(h>=0&&h<p.length-1){const d=p[h+1],u=H(s,{education:d}).total-t.total;if(u>0){const x={secondary:"high school diploma",one_year_post:"1-year diploma",two_year_post:"2-year diploma",bachelors:"bachelor's degree",two_or_more:"two credentials",masters:"master's degree",doctoral:"doctoral degree"};n.push(I("Higher Education",`Completing a ${x[d]||"higher credential"} could boost your score.`,u,"Hard","1-4 years","education",`${s.education||"current level"} → ${d} = +${u} CRS`))}}const b=parseInt(s.canadianWorkExp)||0;if(b<5){const c=H(s,{canadianWorkExp:String(b+1)}).total-t.total;c>0&&n.push(I("Gain Canadian Work Experience","An additional year of Canadian work experience adds points across multiple categories including skill transferability.",c,"Hard","8-12 months","work",`${b} year(s) → ${b+1} year(s) = +${c} CRS`))}if(f)va(s)>=7&&t.total<520&&t.total>=370&&n.push(I("Target French-Language Category Draw",`With your French NCLC 7+ scores, you qualify for French-language category draws where recent cutoffs are around 400 — your score of ${t.total} may already be competitive!`,0,"Easy","Immediate","french",`Current score ${t.total} already fits many French-category cutoffs`));else{const u=H(s,{hasFrench:"yes",french_listening:"7",french_reading:"7",french_writing:"7",french_speaking:"7"}).total-t.total;u>0&&n.push(I("Add French Test Results (TEF/TCF)",`Strong French skills (NCLC 7+) earn ${r>=5?"50":"25"} additional CRS points. Plus, French-language category draws have cutoffs around 400 — much lower than general draws (~520).`,u,"Hard","6-12 months","french",`Reach NCLC 7 in all 4 abilities = +${u} CRS`))}if(s.hasPNP!=="yes"&&n.push(I("Provincial Nominee Program","A PNP nomination adds 600 points, virtually guaranteeing an ITA. Explore programs in provinces like Ontario, BC, Alberta and Saskatchewan.",600,"Hard","2-8 months","province","PNP nomination = +600 CRS")),s.canadianEducation!=="yes"&&n.push(I("Study in Canada","A Canadian credential (1-2 year program) adds 15 points, or 30 points for a 3+ year program.",30,"Hard","12-36 months","study","Canadian credential can add +15 to +30 CRS")),s.hasSibling!=="yes"&&n.push(I("Sibling in Canada (If Applicable)","If you have a sibling who is a Canadian citizen or PR, this adds 15 points. Check if any siblings qualify.",15,"Easy","1-2 weeks","family","Eligible sibling relationship = +15 CRS")),ba(s)){const d=["listening","reading","writing","speaking"];let c=99;for(const u of d){const x=parseInt(s[`spouseLang_${u}`])||0;x<c&&(c=x)}if(c<9){const u=Math.min(c+1,9),x={};for(const _ of d)x[`spouseLang_${_}`]=String(Math.max(parseInt(s[`spouseLang_${_}`])||0,u));const S=H(s,x).total-t.total;S>0&&n.push(I("Improve Spouse's Language Scores",`Your spouse's language improvement to CLB ${u} could add points.`,S,"Medium","3-5 months","language",`Spouse min CLB ${c} → ${u} = +${S} CRS`))}}return n.sort((d,c)=>c.potentialGain-d.potentialGain),n}function $a(s){const t=s.total;return t>=500?{label:"Very Strong",months:"1-3",description:"You are very likely to receive an ITA in the next few draws."}:t>=470?{label:"Strong",months:"3-6",description:"Your score is competitive. An ITA is likely within a few months."}:t>=440?{label:"Moderate",months:"6-12",description:"Your score is near recent cutoffs. Category-based draws may help."}:t>=400?{label:"Below Average",months:"12-18",description:"You may need to improve your profile or target a category-based draw."}:{label:"Needs Improvement",months:"18+",description:"Significant profile improvements are recommended before applying."}}const Ba=[{id:"on",name:"Ontario",abbr:"ON",streams:["Human Capital Priorities","Skilled Trades","French-Speaking"],demandSectors:["stem","healthcare","trade"],minCLB:7,minEducation:"bachelors",minWorkYears:1,notes:"Largest province. Strong demand for tech, healthcare, and skilled trades. Ontario often sends NOIs to Express Entry candidates with CRS 400+."},{id:"bc",name:"British Columbia",abbr:"BC",streams:["Skills Immigration","Express Entry BC","Tech"],demandSectors:["stem","healthcare","trade"],minCLB:5,minEducation:"two_year_post",minWorkYears:1,notes:"Tech hub (Vancouver). BC PNP Tech targets 29 in-demand occupations including software, data, and engineering roles."},{id:"ab",name:"Alberta",abbr:"AB",streams:["Alberta Advantage Immigration","Express Entry Stream"],demandSectors:["trade","healthcare","stem","transport"],minCLB:5,minEducation:"secondary",minWorkYears:1,notes:"Strong energy/oil sector. Growing tech scene in Calgary and Edmonton. Lower cost of living than ON/BC."},{id:"sk",name:"Saskatchewan",abbr:"SK",streams:["International Skilled Worker","Express Entry"],demandSectors:["agriculture","healthcare","trade","transport"],minCLB:4,minEducation:"secondary",minWorkYears:1,notes:"In-Demand Occupations list is broad. One of the easiest PNPs to qualify for. Agriculture and mining are key industries."},{id:"mb",name:"Manitoba",abbr:"MB",streams:["Skilled Workers Overseas","Skilled Workers in Manitoba"],demandSectors:["healthcare","agriculture","trade","transport"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Welcoming to newcomers. Strong need for healthcare workers and tradespeople. Lower CRS requirements than federal draws."},{id:"ns",name:"Nova Scotia",abbr:"NS",streams:["Labour Market Priorities","Skilled Worker","Physician"],demandSectors:["healthcare","trade","stem"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Part of Atlantic Immigration Program. Growing tech sector in Halifax. Healthcare workers are highly sought after."},{id:"nb",name:"New Brunswick",abbr:"NB",streams:["Express Entry Labour Market","Skilled Workers with Employer Support"],demandSectors:["healthcare","trade","agriculture"],minCLB:5,minEducation:"secondary",minWorkYears:1,notes:"Bilingual province (English/French). Part of Atlantic Immigration Program. Francophone candidates get priority."},{id:"pe",name:"Prince Edward Island",abbr:"PE",streams:["Express Entry","Labour Impact"],demandSectors:["agriculture","healthcare","trade"],minCLB:5,minEducation:"two_year_post",minWorkYears:2,notes:"Small province with lower competition. Agriculture and tourism are key industries."},{id:"nl",name:"Newfoundland & Labrador",abbr:"NL",streams:["Express Entry","Skilled Worker","Priority Skills"],demandSectors:["healthcare","trade","stem"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Part of Atlantic Immigration Program. Growing need for healthcare and tech workers. Oil and gas sector."},{id:"yt",name:"Yukon",abbr:"YT",streams:["Yukon Express Entry","Skilled Worker"],demandSectors:["trade","healthcare","transport"],minCLB:4,minEducation:"secondary",minWorkYears:1,notes:"Territory with small population. Job offer typically required. Good for tradespeople and healthcare workers."}],Se={less_than_secondary:0,secondary:1,one_year_post:2,two_year_post:3,bachelors:4,two_or_more:5,masters:6,doctoral:7};function Ra(s,t){return(Se[s]||0)>=(Se[t]||0)}function Fa(s){const t=Ia(s),n=s.education||"secondary",o=Math.max(parseInt(s.canadianWorkExp)||0,parseInt(s.foreignWorkExp)||0),r=s.occupationCategory||"other",g=s.hasFrench==="yes";return Ba.map(f=>{let p=0;const h=100;t>=f.minCLB&&(p+=20,t>=f.minCLB+2&&(p+=10)),Ra(n,f.minEducation)&&(p+=15,(Se[n]||0)>=4&&(p+=5)),o>=f.minWorkYears&&(p+=15,o>=3&&(p+=5)),f.demandSectors.includes(r)&&(p+=25),g&&(f.id==="nb"||f.id==="on")&&(p+=5);const b=Math.min(Math.round(p/h*100),100);return{...f,matchScore:b}}).sort((f,p)=>p.matchScore-f.matchScore)}function Ia(s){if(s.langTestType==="celpip"){const n=["listening","reading","writing","speaking"].map(o=>parseInt(s[`celpip_${o}`])||0);return Math.min(...n)}if(s.langTestType==="ielts"){const n=["listening","reading","writing","speaking"].map(o=>{const r=parseFloat(s[`ielts_${o}`])||0;return r>=8?10:r>=7?9:r>=6.5?8:r>=6?7:r>=5.5?6:r>=5?5:r>=4?4:0});return Math.min(...n)}return 0}const Wa=l.lazy(()=>Ge(()=>import("./feature-path-coach-Beny58Sb.js").then(s=>s.P),__vite__mapDeps([0,1,2,3]))),Oa=l.lazy(()=>Ge(()=>import("./feature-strategy-hub-CrbzrlAd.js").then(s=>s.R),__vite__mapDeps([4,1,0,2,3]))),We={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.08}}},j={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{type:"spring",stiffness:100,damping:18}}},Ne=[{key:"action",label:"Action hub",helper:"Prioritized next actions and execution workspace."},{key:"profile",label:"Profile plan",helper:"Your standing, profile setup, and score improvement tools."},{key:"market",label:"Draw insights",helper:"Recent draw trends, timelines, and program reference data."}],Da={"section-action-center":"action","section-action-queue":"action","section-opportunity-radar":"action","section-command-center":"action","section-copilot":"action","section-collaboration":"action","section-community-benchmarks":"action","section-digital-twin":"action","section-forecast":"action","section-optimizer":"action","section-90-day-plan":"action","section-pricing":"action","section-profile-trend":"action","section-explainability":"action","section-save":"profile","section-profile-compare":"profile","section-breakdown":"profile","section-improve":"profile","section-coach":"profile","section-category":"profile","section-timeline":"market","section-draws":"market"};function Oe(s){return s==="supabase"?"Live sync":"Local data mode"}function De(s){return s==="supabase"?"draw-source-live":"draw-source-fallback"}function Ve(s){if(!s)return null;const t=new Date(s);return Number.isNaN(t.getTime())?null:t}function qe(s){const t=Ve(s);if(!t)return{tier:"unknown",label:"Freshness unknown",dateLabel:s||"—"};const o=Math.max(new Date().getTime()-t.getTime(),0),r=Math.floor(o/(1e3*60*60*24)),g=r===0?"Updated today":r===1?"Updated 1 day ago":`Updated ${r} days ago`;return r<=2?{tier:"fresh",label:g,dateLabel:t.toLocaleDateString()}:r<=14?{tier:"recent",label:g,dateLabel:t.toLocaleDateString()}:{tier:"stale",label:g,dateLabel:t.toLocaleDateString()}}function Ye(s={}){return[{label:"Age",value:s.age||"—"},{label:"Education",value:s.education||"—"},{label:"Language test",value:s.langTestType||"—"},{label:"Canadian work",value:s.canadianWorkExp||"0"},{label:"Program",value:s.pathway||"—"}]}function qa({value:s,duration:t=1.2,reduceMotion:n=!1}){const[o,r]=l.useState(s);return l.useEffect(()=>{if(n)return;const g=s,f=performance.now(),p=h=>{const b=(h-f)/(t*1e3);if(b>=1){r(g);return}const d=1-Math.pow(1-b,3);r(Math.round(g*d)),requestAnimationFrame(p)};requestAnimationFrame(p)},[s,t,n]),n?e.jsx(e.Fragment,{children:s}):e.jsx(e.Fragment,{children:o})}function Ya({score:s,statusColor:t,reduceMotion:n=!1}){const r=2*Math.PI*54,g=Math.min(s/1200,1);return e.jsxs("div",{className:"score-gauge","aria-label":`CRS Score: ${s} out of 1200`,children:[e.jsxs("svg",{viewBox:"0 0 120 120",width:"180",height:"180",children:[e.jsx("circle",{cx:"60",cy:"60",r:54,fill:"none",stroke:"var(--surface-2)",strokeWidth:"8"}),e.jsx(m.circle,{cx:"60",cy:"60",r:54,fill:"none",stroke:t,strokeWidth:"8",strokeLinecap:"round",transform:"rotate(-90 60 60)",strokeDasharray:r,initial:n?!1:{strokeDashoffset:r},animate:{strokeDashoffset:r-g*r},transition:n?{duration:0}:{duration:1.4,ease:[.22,1,.36,1]}})]}),e.jsxs("div",{className:"gauge-text",children:[e.jsx("div",{className:"gauge-label",children:"Your CRS score"}),e.jsx("div",{className:"gauge-number","aria-live":"polite",children:e.jsx(qa,{value:s,reduceMotion:n})}),e.jsx("div",{className:"gauge-max",children:"/ 1,200"})]})]})}function z({id:s,label:t,open:n,onToggle:o,onIntent:r=null}){return e.jsx("h3",{className:"section-toggle-heading",children:e.jsxs("button",{type:"button",className:"section-toggle",onClick:o,onMouseEnter:()=>{typeof r=="function"&&r()},onFocus:()=>{typeof r=="function"&&r()},"aria-expanded":n,"aria-controls":s,children:[e.jsx("span",{children:t}),e.jsx("span",{className:"toggle-arrow","aria-hidden":"true",children:"▾"})]})})}function Ua({icon:s,label:t,value:n,max:o,note:r}){const g=Math.round(n/o*100);return e.jsxs(m.div,{className:"bd-item",variants:j,children:[e.jsx("span",{className:"bd-icon",children:s}),e.jsxs("div",{className:"bd-info",children:[e.jsxs("div",{className:"bd-top",children:[e.jsxs("span",{className:"bd-label",children:[t,r&&e.jsxs("small",{className:"bd-note",children:[" (",r,")"]})]}),e.jsxs("span",{className:"bd-pts",children:[n," ",e.jsxs("small",{children:["/ ",o]})]})]}),e.jsx("div",{className:"bd-bar-bg",children:e.jsx(m.div,{className:"bd-bar-fill",initial:{width:0},animate:{width:`${g}%`},transition:{duration:.8,delay:.3,ease:"easeOut"}})})]})]})}function ke({draw:s,userScore:t}){const n=t>=s.score;return e.jsxs("div",{className:`draw-row ${n?"draw-above":"draw-below"}`,children:[e.jsx("span",{className:"draw-date",children:s.date}),e.jsx("span",{className:"draw-program",children:s.program}),e.jsx("span",{className:"draw-score",children:s.score})]})}const Ha=[{value:"secondary",label:"High School"},{value:"one_year_post",label:"1-Year Diploma"},{value:"two_year_post",label:"2-Year Diploma"},{value:"bachelors",label:"Bachelor's"},{value:"two_or_more",label:"2+ Credentials"},{value:"masters",label:"Master's"},{value:"doctoral",label:"PhD"}];function we(s,t,n){return{id:s,label:t,age:n.age||"",education:n.education||"",canadianWorkExp:n.canadianWorkExp||"0",minClb:""}}function Ga(s){return{5:5,6:5.5,7:6,8:6.5,9:7,10:7.5}[s]||0}function Va(s,t){const n={};if(t.age&&t.age!==s.age&&(n.age=t.age),t.education&&t.education!==s.education&&(n.education=t.education),t.canadianWorkExp&&t.canadianWorkExp!==s.canadianWorkExp&&(n.canadianWorkExp=t.canadianWorkExp),t.minClb){const o=parseInt(t.minClb,10),r=["listening","reading","writing","speaking"];if(s.langTestType==="celpip")for(const g of r){const f=`celpip_${g}`;n[f]=String(Math.max(parseInt(s[f],10)||0,o))}else{const g=Ga(o);for(const f of r){const p=`ielts_${f}`;n[p]=String(Math.max(parseFloat(s[p])||0,g))}}}return Object.keys(n).length===0?null:H(s,n)}function za({answers:s,originalScore:t,t:n}){const[o,r]=l.useState(()=>[we("a","Scenario A",s),we("b","Scenario B",s)]),g=()=>{o.length>=3||r(h=>[...h,we("c","Scenario C",s)])},f=h=>{o.length<=2||r(b=>b.filter(d=>d.id!==h))},p=(h,b)=>{r(d=>d.map(c=>c.id===h?{...c,...b}:c))};return e.jsxs("div",{className:"scenario-panel",children:[e.jsx("div",{className:"scenario-grid",children:o.map(h=>{const b=Va(s,h),d=b?b.total-t:0;return e.jsxs("div",{className:"scenario-card",children:[e.jsxs("div",{className:"scenario-head",children:[e.jsx("strong",{children:h.label}),h.id==="c"&&e.jsx("button",{type:"button",className:"scenario-remove",onClick:()=>f(h.id),children:"Remove"})]}),e.jsxs("div",{className:"wi-grid",children:[e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Age"}),e.jsxs("select",{value:h.age,onChange:c=>p(h.id,{age:c.target.value}),children:[e.jsx("option",{value:"",children:"Current"}),Array.from({length:30},(c,u)=>u+18).map(c=>e.jsx("option",{value:c,children:c},c))]})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Education"}),e.jsxs("select",{value:h.education,onChange:c=>p(h.id,{education:c.target.value}),children:[e.jsx("option",{value:"",children:"Current"}),Ha.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))]})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Canadian Work (yrs)"}),e.jsx("select",{value:h.canadianWorkExp,onChange:c=>p(h.id,{canadianWorkExp:c.target.value}),children:[0,1,2,3,4,5].map(c=>e.jsx("option",{value:c,children:c},c))})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Min Language CLB"}),e.jsxs("select",{value:h.minClb,onChange:c=>p(h.id,{minClb:c.target.value}),children:[e.jsx("option",{value:"",children:"Current"}),[5,6,7,8,9,10].map(c=>e.jsxs("option",{value:c,children:["CLB ",c,"+"]},c))]})]})]}),b&&e.jsx(m.div,{className:"wi-result",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"wi-scores",children:[e.jsxs("div",{className:"wi-score-block",children:[e.jsx("small",{children:n("results.original")}),e.jsx("strong",{children:t})]}),e.jsx("span",{className:"wi-arrow",children:"→"}),e.jsxs("div",{className:"wi-score-block projected",children:[e.jsx("small",{children:n("results.projected")}),e.jsx("strong",{children:b.total})]}),e.jsxs("span",{className:`wi-delta ${d>0?"pos":d<0?"neg":""}`,children:[d>0?"+":"",d," pts"]})]})})]},h.id)})}),o.length<3&&e.jsx("button",{type:"button",className:"btn-toggle scenario-add-btn",onClick:g,children:"Add Scenario C ▼"})]})}function Ja(){return e.jsx(m.div,{className:"loading-screen",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,scale:.95,transition:{duration:.3}},children:e.jsx(Ta,{})})}function Ue({message:s="Loading section…",compact:t=!1}){return e.jsxs("div",{className:`section-load-shell ${t?"compact":""}`,children:[e.jsx("div",{className:"section-load-line"}),e.jsx("div",{className:"section-load-line short"}),e.jsx("p",{children:s})]})}function Ka(s){const t=l.useRef(null);return l.useEffect(()=>{if(!s)return;const n=t.current;if(!n)return;const o=n.getContext("2d");n.width=window.innerWidth,n.height=window.innerHeight;const r=["#22c55e","#4CC9F0","#7C3AED","#f59e0b","#ec4899","#3A0CA3"],g=Array.from({length:120},()=>({x:Math.random()*n.width,y:Math.random()*n.height-n.height,w:Math.random()*8+4,h:Math.random()*6+2,color:r[Math.floor(Math.random()*r.length)],vx:(Math.random()-.5)*4,vy:Math.random()*3+2,rot:Math.random()*360,rv:(Math.random()-.5)*8}));let f;const p=()=>{o.clearRect(0,0,n.width,n.height);let b=!1;for(const d of g)d.x+=d.vx,d.y+=d.vy,d.rot+=d.rv,d.vy+=.05,d.y<n.height+20&&(b=!0),o.save(),o.translate(d.x,d.y),o.rotate(d.rot*Math.PI/180),o.fillStyle=d.color,o.fillRect(-d.w/2,-d.h/2,d.w,d.h),o.restore();b&&(f=requestAnimationFrame(p))};f=requestAnimationFrame(p);const h=setTimeout(()=>{cancelAnimationFrame(f),o.clearRect(0,0,n.width,n.height)},4e3);return()=>{cancelAnimationFrame(f),clearTimeout(h)}},[s]),t}function ts({answers:s,onRestart:t,drawData:n,drawSource:o="local-fallback",categoryInfo:r,motionIntensity:g="full",onRetryDataSync:f=null,isDataSyncing:p=!1,dataSyncError:h="",dataSyncFreshness:b="fresh",isDataRevalidating:d=!1,dataLastSyncedAt:c=""}){const{t:u}=ka(),x=Aa()||g!=="full",{user:T,isAuthenticated:S}=ya(),_=l.useMemo(()=>Fe(),[]),v=n||_a(),w=l.useMemo(()=>Array.isArray(r)&&r.length>0?r:Sa(),[r]),[J,ze]=l.useState(!0),[$,Je]=l.useState("profile"),[se,Ke]=l.useState(!1),[te,Qe]=l.useState(!1),[ne,Xe]=l.useState(!1),[ie,Ze]=l.useState(!1),[re,ea]=l.useState(!1),[oe,aa]=l.useState(!1),[Ce,_e]=l.useState(()=>ae()),[Ee,sa]=l.useState(0),[q,Pe]=l.useState("__current__"),[G,Le]=l.useState(()=>ae()[0]?.id||"__current__"),[ce,ta]=l.useState(()=>_.profileName||""),[Te,na]=l.useState(()=>_.contactEmail||""),[P,ia]=l.useState(()=>!!_.defaultDrawAlerts),[le,Y]=l.useState(""),[Ae,Me]=l.useState(!1),[de,K]=l.useState([]),[me,U]=l.useState("idle"),ue=_.autoSyncProfiles!==!1;l.useEffect(()=>{const a=setTimeout(()=>ze(!1),160);return()=>clearTimeout(a)},[]),l.useEffect(()=>{const a=()=>{_e(ae())},i=()=>{a(),sa(N=>N+1)};if(a(),!(typeof window>"u"))return window.addEventListener("crs-policy-ruleset-updated",i),window.addEventListener("crs-policy-autopilot-synced",i),window.addEventListener("storage",i),()=>{window.removeEventListener("crs-policy-ruleset-updated",i),window.removeEventListener("crs-policy-autopilot-synced",i),window.removeEventListener("storage",i)}},[]);const W=l.useMemo(()=>{if(s.knowsScore==="yes"&&Ee>=0){const i=parseInt(s.scoreRange,10)||400;return{total:i,breakdown:{coreHumanCapital:i,spouseFactors:0,skillTransferability:0,additionalPoints:0},details:{age:0,education:0,firstLanguage:0,secondLanguage:0,canadianWork:0,foreignWork:0,spouseTotal:0,skillTotal:0,additionalTotal:0}}}return ja(s)},[s,Ee]),A=s.knowsScore!=="yes",y=W.total,O=v.averageCutoff,B=y-O,he=Ea(),pe=l.useMemo(()=>qe(v.lastUpdated),[v.lastUpdated]),Q=l.useMemo(()=>{const a=w.map(i=>i?.updatedAt).filter(Boolean).map(i=>Ve(i)).filter(Boolean).sort((i,N)=>N.getTime()-i.getTime())[0];return qe(a?a.toISOString():v.lastUpdated)},[w,v.lastUpdated]),fe=l.useMemo(()=>w.some(a=>a?.source==="supabase")?"Live sync":"Local data mode",[w]),ra=o!=="supabase"||fe!=="Live sync",M=l.useMemo(()=>[{id:"__current__",name:"Current profile",score:y,answers:s},...Ce.map(a=>({id:a.id,name:a.name||a.id,score:Number(a.score)||0,answers:a.answers||{}}))],[s,Ce,y]),R=l.useMemo(()=>M.find(a=>a.id===q),[q,M]),F=l.useMemo(()=>M.find(a=>a.id===G),[G,M]),ge=!!R&&!!F&&R.id!==F.id,X=ge?F.score-R.score:0,oa=l.useMemo(()=>Ye(R?.answers||s),[s,R?.answers]),ca=l.useMemo(()=>Ye(F?.answers||s),[s,F?.answers]);l.useEffect(()=>{const a=M.some(N=>N.id===q),i=M.some(N=>N.id===G);if(a||Pe("__current__"),!i){const N=M.find(ee=>ee.id!==q)?.id||"__current__";Le(N)}},[q,G,M]),l.useEffect(()=>{if(!S||!he||!T?.id){K([]),U("idle");return}let a=!0;return U("loading"),Ie(T.id).then(i=>{a&&(i.status==="ok"?(K(i.data||[]),U("ready")):(K([]),U("empty")))}).catch(()=>{a&&U("error")}),()=>{a=!1}},[he,S,T?.id]);const D=B>=20?{cls:"above",marker:"+",title:"Strong range",desc:`You are ${B} points above the recent reference cutoff (${O}). Keep your profile updated and stay draw-ready.`,color:"#22c55e"}:B>=-10?{cls:"close",marker:"~",title:"Close range",desc:`You are ${Math.abs(B)} points ${B>=0?"above":"below"} the recent reference cutoff (${O}). One or two focused upgrades can materially improve odds.`,color:"#f59e0b"}:{cls:"below",marker:"—",title:"Build-up range",desc:`You are ${Math.abs(B)} points below the recent reference cutoff (${O}). Follow the ranked actions below to close the gap step by step.`,color:"#ef4444"},Z=l.useMemo(()=>Ma(s,W),[s,W]),xe=l.useMemo(()=>$a(W),[W]),C=W.details,la=l.useMemo(()=>{const a=[{icon:"A",label:"Age",value:C.age,max:110},{icon:"E",label:"Education",value:C.education,max:150},{icon:"L",label:"English Language",value:C.firstLanguage,max:136},{icon:"W",label:"Canadian Work",value:C.canadianWork,max:80}];return C.secondLanguage>0&&a.splice(3,0,{icon:"F",label:"French",value:C.secondLanguage,max:24}),C.foreignWork>0?a.push({icon:"S",label:u("results.foreignWork"),value:C.skillTotal,max:100,note:"via skill transferability"}):a.push({icon:"S",label:"Skill Bonus",value:C.skillTotal,max:100}),C.spouseTotal>0&&a.push({icon:"P",label:"Spouse",value:C.spouseTotal,max:40}),C.additionalTotal>0&&a.push({icon:"+",label:"Bonus Points",value:C.additionalTotal,max:600}),a},[C,u]),da=Z.slice(0,3),ve=Z.slice(3),be=Na[s.pathway],ye=l.useMemo(()=>A?Fa(s):[],[s,A]),$e=!x&&!J&&B>=20,ma=Ka($e),ua=Ne.find(a=>a.key===$)||Ne[0],ha=async()=>{const a=Te.trim()||T?.email||"";if(P&&!a){Y("Add an email to enable draw alerts (or sign in).");return}if(a&&!/^\S+@\S+\.\S+$/.test(a)){Y("Please enter a valid email address.");return}const i=wa({name:ce.trim(),answers:s,score:y,email:a,alertOptIn:!!P&&!!a});_e(ae());const N=Fe();Pa({...N,profileName:ce.trim(),contactEmail:a,defaultDrawAlerts:!!P}),Me(!0),k("profile_save_started",{has_email:!!a,alerts_opt_in:!!P,is_authenticated:!!S,score:y});try{if(ue&&(a||P))if((await La(i,{userId:T?.id||null})).status==="ok"){if(S&&T?.id){const Re=await Ie(T.id);Re.status==="ok"&&(K(Re.data||[]),U("ready"))}Y(P?"Profile saved, synced, and draw alerts subscribed.":"Profile saved and synced with your account."),k("profile_save_completed",{status:"cloud_synced",alerts_opt_in:!!P,score:y})}else Y("Profile saved locally. Configure Supabase env vars to enable cloud sync/alerts."),k("profile_save_completed",{status:"local_only",alerts_opt_in:!!P,score:y});else Y(ue?"Profile saved locally.":"Profile saved locally. Auto-sync is off in account settings."),k("profile_save_completed",{status:ue?"local_only":"local_autosync_off",alerts_opt_in:!!P,score:y})}catch(ee){Y(`Profile saved locally, but cloud sync failed: ${ee.message}`),k("profile_save_completed",{status:"cloud_sync_failed",alerts_opt_in:!!P,score:y})}finally{Me(!1)}},pa=()=>{k("results_pdf_print_clicked",{score:y}),window.print()},Be=(a,i="manual")=>{!a||a===$||(Je(a),k("results_tab_changed",{tab:a,source:i}))},je=(a,i=0)=>{const N=document.getElementById(a);if(N){N.scrollIntoView({behavior:"smooth",block:"start"});return}i>=8||window.setTimeout(()=>je(a,i+1),80)},E=a=>{const i=Da[a];i&&Be(i,"section_jump"),i&&i!==$?window.setTimeout(()=>je(a),140):je(a),k("results_section_jump",{section_id:a,tab:i||$})},fa=()=>{window.dispatchEvent(new CustomEvent("crs-open-account-modal")),k("account_modal_open_requested",{source:"results_action_center"})};return l.useEffect(()=>{J||k("results_viewed",{score:y,diff_from_cutoff:B,draw_source:o,category_count:w.length})},[w.length,B,o,J,y]),J?e.jsx(Ja,{}):e.jsxs(m.div,{className:"results",variants:We,initial:"hidden",animate:"show",exit:{opacity:0,transition:{duration:.2}},children:[$e&&e.jsx("canvas",{ref:ma,className:"confetti-canvas"}),e.jsx(m.div,{className:"score-hero",variants:j,children:e.jsx(Ya,{score:y,statusColor:D.color,reduceMotion:x})}),e.jsx(m.div,{className:"result-actions",variants:j,children:e.jsx("button",{type:"button",className:"action-btn",onClick:pa,"aria-label":"Download PDF",children:u("results.pdf")})}),e.jsx(m.div,{className:"results-tab-strip",variants:j,role:"tablist","aria-label":"Results sections",children:Ne.map(a=>e.jsx("button",{type:"button",role:"tab",className:`results-tab-btn ${$===a.key?"active":""}`.trim(),"aria-selected":$===a.key,"aria-controls":`results-tab-panel-${a.key}`,onClick:()=>Be(a.key,"tab_click"),children:a.label},a.key))}),e.jsx(m.p,{className:"results-tab-helper",variants:j,children:ua.helper}),$==="action"&&e.jsxs("div",{role:"tabpanel",id:"results-tab-panel-action","aria-label":"Action hub",children:[e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"card",children:e.jsx(Ue,{message:"Loading action center and strategy insights…"})}),children:e.jsx(Oa,{answers:s,result:W,suggestions:Z,averageCutoff:v.averageCutoff,activeDraws:v,activeCategoryInfo:w,provinces:ye,drawFreshness:pe,categoryFreshness:Q,saveStatus:le,onJumpToSection:E,onOpenAccount:fa})}),e.jsxs(m.div,{className:"card quick-nav-card",variants:j,children:[e.jsx("h3",{children:"Quick navigator"}),e.jsx("p",{className:"quick-nav-help",children:"Jump directly to the section you want. Tabs auto-switch when needed."}),e.jsxs("div",{className:"quick-nav-grid",children:[e.jsx("button",{type:"button",className:"action-btn",onClick:()=>E("section-action-center"),children:e.jsxs("span",{className:"quick-nav-btn-content",children:[e.jsx(L,{name:"grid-sharp"})," Action center"]})}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>E("section-opportunity-radar"),children:e.jsxs("span",{className:"quick-nav-btn-content",children:[e.jsx(L,{name:"radar-sharp"})," Opportunity radar"]})}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>E("section-command-center"),children:e.jsxs("span",{className:"quick-nav-btn-content",children:[e.jsx(L,{name:"checkmark-done-circle-sharp"})," Command center"]})}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>E("section-90-day-plan"),children:e.jsxs("span",{className:"quick-nav-btn-content",children:[e.jsx(L,{name:"calendar-sharp"})," 90-day plan"]})}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>E("section-copilot"),children:e.jsxs("span",{className:"quick-nav-btn-content",children:[e.jsx(L,{name:"sparkles-sharp"})," Grounded copilot"]})}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>E("section-save"),children:e.jsxs("span",{className:"quick-nav-btn-content",children:[e.jsx(L,{name:"save-sharp"})," Save profile"]})}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>E("section-draws"),children:e.jsxs("span",{className:"quick-nav-btn-content",children:[e.jsx(L,{name:"trending-up-sharp"})," Recent draws"]})}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>E("section-timeline"),children:e.jsxs("span",{className:"quick-nav-btn-content",children:[e.jsx(L,{name:"time-sharp"})," Timeline"]})}),A&&e.jsx("button",{type:"button",className:"action-btn",onClick:()=>E("section-breakdown"),children:e.jsxs("span",{className:"quick-nav-btn-content",children:[e.jsx(L,{name:"pie-chart-sharp"})," Score breakdown"]})}),A&&e.jsx("button",{type:"button",className:"action-btn",onClick:()=>E("section-improve"),children:e.jsxs("span",{className:"quick-nav-btn-content",children:[e.jsx(L,{name:"flash-sharp"})," Improve score"]})}),A&&e.jsx("button",{type:"button",className:"action-btn",onClick:()=>E("section-category"),children:e.jsxs("span",{className:"quick-nav-btn-content",children:[e.jsx(L,{name:"layers-sharp"})," Category draws"]})})]})]})]}),$==="profile"&&e.jsxs("div",{role:"tabpanel",id:"results-tab-panel-profile","aria-label":"Profile plan",children:[e.jsxs(m.div,{className:`card status-card ${D.cls}-card`,variants:j,children:[e.jsx("p",{className:"status-kicker",children:"Current standing"}),e.jsxs("div",{className:"status-header",children:[e.jsx("span",{className:`status-marker ${D.cls}`,children:D.marker})," ",e.jsx("strong",{children:D.title})]}),e.jsx("p",{className:"status-desc",children:D.desc}),e.jsxs("div",{className:`draw-source-pill ${De(o)}`,children:["Draw data source: ",Oe(o)," · Updated ",v.lastUpdated||"—",e.jsx("span",{className:`freshness-pill freshness-${pe.tier}`,children:pe.label})]}),f&&(ra||h)&&e.jsxs("div",{className:"data-sync-row",children:[e.jsx("button",{type:"button",className:"action-btn",onClick:()=>{f(),k("draw_data_sync_retry_clicked",{source:"results_status_card"})},disabled:p,children:p?"Retrying live sync…":"Retry live sync"}),h&&e.jsx("small",{className:"data-sync-note",children:h})]}),d&&e.jsx("p",{className:"data-sync-note",children:"Using cached data while background refresh completes…"}),!d&&b==="stale"&&e.jsxs("p",{className:"data-sync-note",children:["Cached data is currently stale.",c?` Last sync: ${new Date(c).toLocaleString()}.`:""]}),e.jsxs("div",{className:"cutoff-compare",children:[e.jsx(He,{label:"Your Score",value:y,max:Math.max(y,O,600),color:"var(--primary)"}),e.jsx(He,{label:"Cut-off",value:O,max:Math.max(y,O,600),color:"var(--surface-3)"})]})]}),e.jsxs(m.div,{className:"card save-profile-card",variants:j,id:"section-save",children:[e.jsx("h3",{children:"Save your profile"}),e.jsx("p",{className:"cat-intro",children:"Save this result and optionally subscribe to draw alerts."}),S?e.jsxs("p",{className:"save-note",children:["Signed in as ",T.email,". Saves are synced across your devices."]}):e.jsx("p",{className:"save-note",children:"Tip: sign in to sync profiles and score tracking across devices."}),e.jsxs("div",{className:"save-grid",children:[e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Profile name (optional)"}),e.jsx("input",{type:"text",value:ce,onChange:a=>ta(a.target.value),placeholder:"e.g., Feb 2026 Profile"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Email (optional)"}),e.jsx("input",{type:"email",value:Te,onChange:a=>na(a.target.value),placeholder:"you@example.com"})]})]}),e.jsxs("label",{className:"save-alert-row",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:a=>ia(a.target.checked)}),e.jsx("span",{children:"Notify me by email when my score is at/above the latest cutoff"})]}),!he&&e.jsx("p",{className:"save-note",children:"Cloud alerts need Supabase env vars (`VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`)."}),e.jsx("div",{className:"save-actions",children:e.jsx("button",{type:"button",className:"action-btn",onClick:ha,disabled:Ae,children:Ae?"Saving…":"Save Profile"})}),le&&e.jsx("p",{className:"save-status",children:le}),S&&e.jsxs("div",{className:"save-synced-list",children:[e.jsx("h4",{children:"Synced profiles"}),me==="loading"&&e.jsx("p",{className:"save-note",children:"Loading your synced profiles..."}),me==="error"&&e.jsx("p",{className:"save-note",children:"Could not load synced profiles right now."}),me!=="loading"&&de.length===0&&e.jsx("p",{className:"save-note",children:"No synced profiles yet. Save your current result to start tracking."}),de.length>0&&e.jsx("ul",{className:"save-synced-items",children:de.slice(0,5).map(a=>e.jsxs("li",{children:[e.jsx("span",{children:a.name||a.id}),e.jsx("strong",{children:a.score})]},a.id))})]})]}),e.jsxs(m.div,{className:"card profile-compare-card",variants:j,id:"section-profile-compare",children:[e.jsx(z,{id:"profile-compare-panel",label:"Profile Compare Mode",open:oe,onToggle:()=>{const a=!oe;aa(a),k("profile_compare_toggled",{open:a})}}),e.jsx(V,{initial:!1,children:oe&&e.jsxs(m.div,{id:"profile-compare-panel",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:x?{duration:0}:{duration:.2},children:[e.jsx("p",{className:"cat-intro",children:"Compare your current answers with any locally saved profile to spot score gaps quickly."}),e.jsxs("div",{className:"profile-compare-controls wi-grid",children:[e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Profile A"}),e.jsx("select",{value:q,onChange:a=>Pe(a.target.value),children:M.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.score,")"]},`a-${a.id}`))})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Profile B"}),e.jsx("select",{value:G,onChange:a=>Le(a.target.value),children:M.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.score,")"]},`b-${a.id}`))})]})]}),!ge&&e.jsx("p",{className:"path-empty-text",children:"Choose two different profiles to compare."}),ge&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"profile-compare-delta",children:[e.jsx("strong",{children:F.name})," vs ",e.jsx("strong",{children:R.name}),":",e.jsxs("span",{className:X>0?"delta-up":X<0?"delta-down":"",children:[" ",X>0?"+":"",X," points"]})]}),e.jsxs("div",{className:"profile-compare-grid",children:[e.jsxs("div",{className:"profile-compare-column",children:[e.jsx("h4",{children:R.name}),e.jsx("strong",{className:"profile-compare-score",children:R.score}),e.jsx("ul",{children:oa.map(a=>e.jsxs("li",{children:[e.jsx("span",{children:a.label}),e.jsx("strong",{children:a.value})]},`${R.id}-${a.label}`))})]}),e.jsxs("div",{className:"profile-compare-column",children:[e.jsx("h4",{children:F.name}),e.jsx("strong",{className:"profile-compare-score",children:F.score}),e.jsx("ul",{children:ca.map(a=>e.jsxs("li",{children:[e.jsx("span",{children:a.label}),e.jsx("strong",{children:a.value})]},`${F.id}-${a.label}`))})]})]})]})]})})]}),A&&e.jsxs(m.div,{className:"card",variants:j,id:"section-breakdown",children:[e.jsx("h3",{children:u("results.breakdown")}),e.jsx(m.div,{className:"breakdown-grid",variants:We,initial:"hidden",animate:"show",children:la.map(a=>e.jsx(Ua,{...a},a.label))}),e.jsxs("div",{className:"bd-total",children:[e.jsx("span",{children:"Total CRS Score"}),e.jsx("span",{className:"bd-total-num",children:y})]})]}),A&&e.jsxs(m.div,{className:"card whatif-card",variants:j,children:[e.jsx(z,{id:"scenario-compare-panel",label:"Scenario Compare (A vs B)",open:ne,onToggle:()=>{const a=!ne;Xe(a),k("scenario_compare_toggled",{open:a})}}),e.jsx(V,{initial:!1,children:ne&&e.jsxs(m.div,{id:"scenario-compare-panel",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:x?{duration:0}:{duration:.2},children:[e.jsx("p",{className:"cat-intro",children:u("results.whatifDesc")}),e.jsx(za,{answers:s,originalScore:y,t:u})]})})]}),Z.length>0&&e.jsxs(m.div,{className:"card",variants:j,id:"section-improve",children:[e.jsx("h3",{children:u("results.improve")}),da.map((a,i)=>e.jsxs(m.div,{className:"action-card",variants:j,children:[e.jsx("div",{className:"action-rank",children:i+1}),e.jsxs("div",{className:"action-body",children:[e.jsxs("div",{className:"action-title",children:[a.title,a.potentialGain>0&&e.jsxs("span",{className:"action-badge",children:["+",a.potentialGain," pts"]})]}),e.jsx("div",{className:"action-desc",children:a.description}),a.action&&e.jsx("div",{className:"action-specific",children:a.action}),e.jsxs("div",{className:"action-meta",children:[e.jsx("span",{className:"action-time",children:a.timeframe}),e.jsx("span",{className:`action-diff diff-${a.difficulty.toLowerCase()}`,children:a.difficulty})]})]})]},i)),ve.length>0&&e.jsxs(e.Fragment,{children:[se&&ve.map((a,i)=>e.jsxs(m.div,{className:"action-card",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"action-rank",children:i+4}),e.jsxs("div",{className:"action-body",children:[e.jsxs("div",{className:"action-title",children:[a.title,a.potentialGain>0&&e.jsxs("span",{className:"action-badge",children:["+",a.potentialGain," pts"]})]}),e.jsx("div",{className:"action-desc",children:a.description}),a.action&&e.jsx("div",{className:"action-specific",children:a.action}),e.jsxs("div",{className:"action-meta",children:[e.jsx("span",{className:"action-time",children:a.timeframe}),e.jsx("span",{className:`action-diff diff-${a.difficulty.toLowerCase()}`,children:a.difficulty})]})]})]},i+3)),e.jsx("button",{type:"button",className:"btn-toggle",onClick:()=>Ke(!se),children:se?"Show fewer ▲":`Show ${ve.length} more suggestions ▼`})]})]}),A&&e.jsxs(m.div,{className:"card",variants:j,id:"section-coach",children:[e.jsx(z,{id:"expert-coach-panel",label:"Expert strategy coach",open:re,onIntent:()=>Ca(),onToggle:()=>{const a=!re;ea(a),k("path_coach_toggled",{open:a})}}),e.jsx(V,{initial:!1,children:re&&e.jsx(m.div,{id:"expert-coach-panel",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:x?{duration:0}:{duration:.2},children:e.jsx(l.Suspense,{fallback:e.jsx(Ue,{message:"Loading expert strategy coach…",compact:!0}),children:e.jsx(Wa,{answers:s,result:W,averageCutoff:v.averageCutoff,categoryInfo:w,motionIntensity:g})})})})]}),A&&e.jsxs(m.div,{className:"card",variants:j,id:"section-category",children:[e.jsx("h3",{children:u("results.category")}),e.jsx("p",{className:"cat-intro",children:u("results.catIntro")}),e.jsxs("div",{className:"category-meta-row",children:[e.jsxs("span",{className:`draw-source-pill ${fe==="Live sync"?"draw-source-live":"draw-source-fallback"}`,children:["Category config: ",fe]}),e.jsxs("span",{className:`freshness-pill freshness-${Q.tier}`,children:[Q.label," · ",Q.dateLabel]})]}),w.length===0?e.jsx("p",{className:"path-empty-text",children:"Category draw details are temporarily unavailable. The calculator is running in local data mode."}):e.jsx("div",{className:"cat-grid",children:w.map(a=>{const i=a.check(s),N=i&&y>=a.recentCutoff;return e.jsxs(m.div,{className:`cat-card ${i?N?"cat-above":"cat-eligible":"cat-na"}`,variants:j,children:[e.jsxs("div",{className:"cat-header",children:[e.jsx("span",{className:"cat-icon",children:a.icon}),e.jsxs("div",{children:[e.jsx("strong",{className:"cat-name",children:a.name}),i&&e.jsx("span",{className:`cat-badge ${N?"badge-above":"badge-eligible"}`,children:N?"Above Cutoff":"Eligible"}),!i&&e.jsx("span",{className:"cat-badge badge-na",children:"Not Eligible"})]})]}),e.jsx("p",{className:"cat-desc",children:a.description}),e.jsxs("div",{className:"cat-cutoff",children:[e.jsxs("span",{children:["Recent cutoff: ",e.jsx("strong",{children:a.recentCutoff})]}),e.jsxs("span",{className:"cat-range",children:["Range: ",a.cutoffRange]})]}),!i&&e.jsx("p",{className:"cat-req",children:a.eligibility})]},a.id)})})]}),A&&ye.length>0&&e.jsxs(m.div,{className:"card",variants:j,children:[e.jsx(z,{id:"province-recommender-panel",label:"Province Recommender",open:ie,onToggle:()=>{const a=!ie;Ze(a),k("province_recommender_toggled",{open:a})}}),e.jsx(V,{initial:!1,children:ie&&e.jsxs(m.div,{id:"province-recommender-panel",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:x?{duration:0}:{duration:.2},children:[e.jsx("p",{className:"cat-intro",children:"Based on your profile, these provinces may be good matches for Provincial Nominee Programs."}),e.jsx("div",{className:"prov-grid",children:ye.slice(0,5).map(a=>e.jsxs("div",{className:"prov-card",children:[e.jsxs("div",{className:"prov-header",children:[e.jsx("span",{className:"prov-abbr",children:a.abbr}),e.jsxs("div",{children:[e.jsx("strong",{className:"prov-name",children:a.name}),e.jsxs("span",{className:`prov-match ${a.matchScore>=70?"match-high":a.matchScore>=40?"match-mid":"match-low"}`,children:[a.matchScore,"% match"]})]})]}),e.jsx("div",{className:"prov-bar-wrap",children:e.jsx(m.div,{className:"prov-bar",initial:{width:0},animate:{width:`${a.matchScore}%`},transition:x?{duration:0}:{duration:.8,ease:"easeOut"},style:{background:a.matchScore>=70?"#22c55e":a.matchScore>=40?"#f59e0b":"var(--surface-3)"}})}),e.jsx("p",{className:"prov-notes",children:a.notes})]},a.id))})]})})]})]}),$==="market"&&e.jsxs("div",{role:"tabpanel",id:"results-tab-panel-market","aria-label":"Draw insights",children:[e.jsxs(m.div,{className:"card",variants:j,id:"section-timeline",children:[e.jsx("h3",{children:u("results.timeline")}),e.jsxs("div",{className:`timeline-badge tl-${D.cls}`,children:[e.jsx("strong",{children:xe.label})," — est. ",xe.months," months"]}),e.jsx("p",{className:"timeline-desc",children:xe.description})]}),e.jsxs(m.div,{className:"card",variants:j,id:"section-draws",children:[e.jsx(z,{id:"recent-draws-panel",label:u("results.draws"),open:te,onToggle:()=>{const a=!te;Qe(a),k("recent_draws_toggled",{open:a})}}),e.jsxs("div",{className:`draw-source-pill ${De(o)}`,children:["Source: ",Oe(o)," · Updated ",v.lastUpdated||"—"]}),e.jsx(V,{initial:!1,children:te&&e.jsx(m.div,{id:"recent-draws-panel",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:x?{duration:0}:{duration:.22},className:"draws-content",children:v.generalProgram?.length||v.categoryBased?.length||v.pnpDraws?.length?e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"draws-subhead",children:"General / CEC Draws"}),v.generalProgram.slice(0,4).map((a,i)=>e.jsx(ke,{draw:a,userScore:y},`g${i}`)),e.jsx("h4",{className:"draws-subhead",children:"Category-Based Draws"}),v.categoryBased.slice(0,4).map((a,i)=>e.jsx(ke,{draw:a,userScore:y},`c${i}`)),!!v.pnpDraws?.length&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"draws-subhead",children:"Provincial Nominee (PNP)"}),v.pnpDraws.slice(0,3).map((a,i)=>e.jsx(ke,{draw:a,userScore:y},`p${i}`))]})]}):e.jsx("p",{className:"path-empty-text",children:"Recent draw records are temporarily unavailable. Please check back shortly."})})})]}),be&&e.jsxs(m.div,{className:"card",variants:j,children:[e.jsxs("h3",{children:[be.name," Requirements"]}),e.jsx("ul",{className:"pathway-list",children:be.requirements.map((a,i)=>e.jsx("li",{children:a},i))})]})]}),e.jsx(m.div,{className:"card disclaimer",variants:j,children:e.jsxs("p",{children:[e.jsx("strong",{children:"Disclaimer:"})," ",u("results.disclaimer")," ",e.jsx("a",{href:"https://www.canada.ca/en/immigration-refugees-citizenship.html",target:"_blank",rel:"noopener noreferrer",children:"canada.ca"})]})}),e.jsx(m.button,{type:"button",className:"btn-restart",onClick:()=>{k("results_restart_clicked",{score:y}),t()},whileHover:x?void 0:{scale:1.03},whileTap:x?void 0:{scale:.96},variants:j,children:u("results.restart")})]})}function He({label:s,value:t,max:n,color:o}){const r=Math.round(t/n*100);return e.jsxs("div",{className:"cutoff-row",children:[e.jsx("span",{className:"cutoff-label",children:s}),e.jsx("div",{className:"cutoff-bar-wrap",children:e.jsx(m.div,{className:"cutoff-bar",style:{background:o},initial:{width:0},animate:{width:`${r}%`},transition:{duration:.8,ease:"easeOut"},children:t})})]})}export{ts as default};
