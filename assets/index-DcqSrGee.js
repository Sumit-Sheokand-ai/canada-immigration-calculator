const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Wizard-ByicJ3VV.js","assets/vendor-react-Ah1pgjPn.js","assets/data-question-bank-dwKgXfTg.js","assets/feature-strategy-hub-DXKTt56D.js","assets/feature-path-coach-CPwsuw6v.js","assets/vendor-motion-CtNR3TjB.js","assets/questionDataSource-ChPV6dLy.js","assets/Results-BtRQwGCf.js","assets/AuthModal-DQkNAhYi.js","assets/WelcomeScreen-BVCWSU7n.js","assets/motionFeatures-DFpXREjK.js"])))=>i.map(i=>d[i]);
import{_ as R,u as ct,i as be,g as U,A as lt}from"./feature-path-coach-CPwsuw6v.js";import{r as o,j as r,c as ut}from"./vendor-react-Ah1pgjPn.js";import{u as Fe,t as g,r as q,a as dt,b as O,L as ft}from"./feature-strategy-hub-DXKTt56D.js";import{u as mt,m as pt,A as ht,L as gt}from"./vendor-motion-CtNR3TjB.js";import{r as z,t as W}from"./data-question-bank-dwKgXfTg.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function n(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(i){if(i.ep)return;i.ep=!0;const c=n(i);fetch(i.href,c)}})();const Oe=o.createContext();function wt({children:e}){const[t,n]=o.useState(()=>{try{return localStorage.getItem("crs-theme")==="dark"}catch{return!1}});o.useEffect(()=>{document.documentElement.setAttribute("data-theme",t?"dark":"light");try{localStorage.setItem("crs-theme",t?"dark":"light")}catch{}},[t]);const s=()=>n(i=>!i);return r.jsx(Oe.Provider,{value:{dark:t,toggle:s},children:e})}function yt(){return o.useContext(Oe)}const de=new Set;function bt(e){if(typeof window>"u"){e();return}typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>e(),{timeout:1800}):window.setTimeout(e,220)}function vt(e,t){de.has(e)||(de.add(e),Promise.resolve().then(()=>t()).catch(()=>{de.delete(e)}))}function re(e,t,{idle:n=!1}={}){const s=()=>vt(e,t);if(n){bt(s);return}s()}function Ae(e){re("chunk:wizard",()=>R(()=>import("./Wizard-ByicJ3VV.js"),__vite__mapDeps([0,1,2,3,4,5,6])),e)}function _t(e){re("chunk:results",()=>R(()=>import("./Results-BtRQwGCf.js"),__vite__mapDeps([7,4,1,2,5,3])),e)}function St(e){re("chunk:path-coach",()=>R(()=>import("./feature-path-coach-CPwsuw6v.js").then(t=>t.P),__vite__mapDeps([4,1,2,5])),e)}function te(e){re("chunk:auth-modal",()=>R(()=>import("./AuthModal-DQkNAhYi.js"),__vite__mapDeps([8,1,4,2,5,6,3])),e)}const Et=o.lazy(()=>R(()=>import("./AuthModal-DQkNAhYi.js"),__vite__mapDeps([8,1,4,2,5,6,3]))),xt={en:"EN",fr:"FR"};function kt({canInstallApp:e=!1,onInstallApp:t=()=>{},motionIntensity:n="full"}){const s=mt()||n!=="full",{dark:i,toggle:c}=yt(),{lang:u,setLang:D,t:_}=Fe(),{user:j,ensureAuthReady:S}=ct(),[G,T]=o.useState(!1);return o.useEffect(()=>{const A=()=>{T(!0),te(),S().catch(()=>{})};return window.addEventListener("crs-open-account-modal",A),()=>{window.removeEventListener("crs-open-account-modal",A)}},[S]),r.jsxs(r.Fragment,{children:[r.jsx(pt.header,{className:"header",initial:s?!1:{y:-60,opacity:0},animate:{y:0,opacity:1},transition:s?{duration:0}:{type:"spring",stiffness:120,damping:20},children:r.jsxs("div",{className:"header-inner",children:[r.jsxs("div",{className:"logo",children:[r.jsx("span",{className:"logo-leaf",children:"ðŸ"}),r.jsx("span",{children:_("header.title")})]}),r.jsxs("div",{className:"header-actions",children:[e&&r.jsx("button",{type:"button",className:"install-btn",onClick:t,"aria-label":"Install app",title:"Add app shortcut",children:"Install app"}),r.jsx("button",{type:"button",className:"auth-toggle",onClick:()=>{te(),T(!0),S().catch(()=>{}),g("account_modal_opened",{source:"header_button",is_authenticated:!!j})},onMouseEnter:()=>{te(),S().catch(()=>{})},onFocus:()=>{te(),S().catch(()=>{})},"aria-label":j?"Manage account":"Login or signup",title:j?j.email:"Login / Signup",children:j?"Account":"Login"}),r.jsx("select",{className:"lang-select",value:u,onChange:A=>D(A.target.value),"aria-label":"Select language",children:Object.entries(xt).map(([A,m])=>r.jsx("option",{value:A,children:m},A))}),r.jsx("button",{type:"button",className:"theme-toggle",onClick:c,"aria-label":i?"Switch to light mode":"Switch to dark mode",title:i?"Light mode":"Dark mode",children:i?"Light":"Dark"})]})]})}),G&&r.jsx(o.Suspense,{fallback:r.jsx("div",{className:"auth-modal-backdrop",role:"presentation",children:r.jsx("div",{className:"auth-modal auth-modal-loading",role:"dialog","aria-modal":"true",children:r.jsxs("div",{className:"auth-modal-head",children:[r.jsx("h3",{children:"Loading accountâ€¦"}),r.jsx("button",{type:"button",className:"auth-close",onClick:()=>T(!1),"aria-label":"Close dialog",children:"Ã—"})]})})}),children:r.jsx(Et,{open:G,onClose:()=>T(!1)})})]})}function fe(){const e=Array.from({length:9});return r.jsxs("div",{className:"uv-loader",children:[e.map((t,n)=>r.jsx("div",{className:"uv-text",children:r.jsx("span",{children:"Loading"})},n)),r.jsx("div",{className:"uv-line"})]})}function Ct(e,t){const n=e.answers||{};return{id:e.id,user_id:t||null,name:e.name||null,score:Number(e.score)||0,email:e.email||null,alert_opt_in:!!e.alertOptIn,alert_token:e.alertToken||null,profile_json:{answers:n,tracking:{userId:t||null,savedAt:new Date().toISOString()}},updated_at:new Date().toISOString()}}function ne(e){const t=String(e?.message||"");return/column\s+["']?user_id["']?\s+does not exist/i.test(t)}function $(e,t){const n=t?.message||t?.hint||String(t);return`${e}: ${n}`}function J(){return be}async function sr(e,t={}){if(!J())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=await U();if(!n)return{status:"skipped",reason:"Supabase client is unavailable"};const s=t.userId||null,i=Ct(e,s);let c,u;if({data:c,error:u}=await n.from("saved_profiles").upsert(i,{onConflict:"id"}).select(),u&&s&&ne(u)){const{user_id:D,..._}=i;({data:c,error:u}=await n.from("saved_profiles").upsert(_,{onConflict:"id"}).select())}if(u)throw new Error($("Supabase upsert failed",u));return{status:"ok",data:c||[]}}async function jt(e){if(!e)return{status:"skipped",reason:"Missing token"};if(!J())return{status:"skipped",reason:"Supabase env vars are not configured"};const t=await U();if(!t)return{status:"skipped",reason:"Supabase client is unavailable"};const{data:n,error:s}=await t.from("saved_profiles").update({alert_opt_in:!1,updated_at:new Date().toISOString()}).eq("alert_token",e).select();if(s)throw new Error($("Supabase unsubscribe failed",s));return n?.length?{status:"ok",data:n[0]}:{status:"not-found"}}async function or(e){if(!e)return{status:"skipped",reason:"Missing user id"};if(!J())return{status:"skipped",reason:"Supabase env vars are not configured"};const t=await U();if(!t)return{status:"skipped",reason:"Supabase client is unavailable"};const{data:n,error:s}=await t.from("saved_profiles").select("id,name,score,email,updated_at").eq("user_id",e).order("updated_at",{ascending:!1}).limit(12);if(s&&ne(s))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(s)throw new Error($("Supabase profile list failed",s));return{status:"ok",data:n||[]}}async function ir(e,t){if(!e)return{status:"skipped",reason:"Missing user id"};if(!J())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=await U();if(!n)return{status:"skipped",reason:"Supabase client is unavailable"};const{error:s,data:i}=await n.from("saved_profiles").update({alert_opt_in:!!t,updated_at:new Date().toISOString()}).eq("user_id",e).select("id");if(s&&ne(s))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(s)throw new Error($("Supabase alert preference update failed",s));return{status:"ok",updatedCount:i?.length||0}}async function cr(e,t){if(!e)return{status:"skipped",reason:"Missing user id"};if(!J())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=await U();if(!n)return{status:"skipped",reason:"Supabase client is unavailable"};const s=t?String(t).trim().toLowerCase():null,{error:i,data:c}=await n.from("saved_profiles").update({email:s||null,updated_at:new Date().toISOString()}).eq("user_id",e).select("id");if(i&&ne(i))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(i)throw new Error($("Supabase profile email update failed",i));return{status:"ok",updatedCount:c?.length||0}}const At=300*1e3,ze=!1,ve="crs-cache-latest-draws-v1",_e="crs-cache-category-config-v1";let k={data:null,source:"none",fetchedAt:0},C={data:null,source:"none",fetchedAt:0},pe=!1,he=!1,ge=ze;function Nt(e){return!!e&&typeof e=="object"&&Array.isArray(e.generalProgram)&&Array.isArray(e.categoryBased)&&Array.isArray(e.pnpDraws)&&Number.isFinite(Number(e.averageCutoff))}function Ue(e){return Nt(e)?{...e,generalProgram:e.generalProgram||[],categoryBased:e.categoryBased||[],pnpDraws:e.pnpDraws||[],averageCutoff:Number(e.averageCutoff)||z.averageCutoff,lastUpdated:e.lastUpdated||z.lastUpdated,pnpRanges:e.pnpRanges||z.pnpRanges}:null}function Lt(e){if(!e||typeof e!="object")return null;const t=String(e.id||"").trim(),n=String(e.name||"").trim(),s=String(e.icon||"").trim(),i=String(e.description||"").trim(),c=String(e.eligibility||"").trim(),u=String(e.cutoff_range||e.cutoffRange||"").trim(),D=Number(e.recent_cutoff??e.recentCutoff);return!t||!n||!s||!i||!c||!Number.isFinite(D)?null:{id:t,name:n,icon:s,description:i,eligibility:c,recentCutoff:D,cutoffRange:u||"N/A",source:e.source||"supabase",updatedAt:e.updated_at||null}}function Pt(e){if(!e)return!1;const t=String(e.code||"").toUpperCase(),n=`${e.message||""} ${e.details||""} ${e.hint||""}`.toLowerCase();return!!(t==="PGRST205"||n.includes("could not find the table")||n.includes("category_draw_configs")&&n.includes("schema cache")||n.includes("relation")&&n.includes("does not exist"))}function Be(e=[]){const t=new Map(W.map(c=>[c.id,c])),n=new Map;for(const c of e){const u=Lt(c);u&&(n.has(u.id)||n.set(u.id,u))}const s=W.map(c=>{const u=n.get(c.id);return u?{...c,name:u.name,icon:u.icon,description:u.description,eligibility:u.eligibility,recentCutoff:u.recentCutoff,cutoffRange:u.cutoffRange,source:u.source,updatedAt:u.updatedAt}:c}),i=[...n.values()].filter(c=>!t.has(c.id)).map(c=>({...c,check:()=>!1}));return[...s,...i]}function qe(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch{return null}}function We(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch{}}function Ge(e){try{localStorage.removeItem(e)}catch{}}function Rt(e){return Number.isFinite(e)&&e>0&&Date.now()-e<At}function Tt(e){return Rt(e)?"fresh":"stale"}function v(e,{revalidating:t=!1}={}){return{status:"ok",source:e.source,data:e.data,fetchedAt:e.fetchedAt,freshness:Tt(e.fetchedAt),revalidating:t}}function Ye(e=[]){return Array.isArray(e)?e.map(t=>({id:t?.id||"",source:t?.source||"supabase",name:t?.name||"",icon:t?.icon||"",description:t?.description||"",eligibility:t?.eligibility||"",recent_cutoff:Number(t?.recentCutoff??t?.recent_cutoff),cutoff_range:t?.cutoffRange??t?.cutoff_range??"N/A",updated_at:t?.updatedAt??t?.updated_at??null})):[]}function Ve(){if(pe)return;pe=!0;const e=qe(ve),t=Ue(e?.data),n=Number(e?.fetchedAt||0);!t||!Number.isFinite(n)||n<=0||(k={data:t,source:String(e?.source||"supabase-cache"),fetchedAt:n})}function He(){if(he)return;he=!0;const e=qe(_e),t=Ye(e?.data||[]);if(!t.length)return;const n=Be(t);if(!n.length)return;const s=Number(e?.fetchedAt||0);!Number.isFinite(s)||s<=0||(C={data:n,source:String(e?.source||"supabase-cache"),fetchedAt:s})}function we(e,t){k={data:e,source:t,fetchedAt:Date.now()},We(ve,{data:e,source:t,fetchedAt:k.fetchedAt})}function ye(e,t){C={data:e,source:t,fetchedAt:Date.now()},We(_e,{data:Ye(e),source:t,fetchedAt:C.fetchedAt})}function Ne(){return z}function me(){return W}function It(){return Ve(),k.data?v(k):v({data:z,source:"local-fallback",fetchedAt:0})}function Dt(){return He(),C.data?v(C):v({data:W,source:"local-fallback",fetchedAt:0})}function lr(){k={data:null,source:"none",fetchedAt:0},pe=!0,Ge(ve)}function ur(){C={data:null,source:"none",fetchedAt:0},he=!0,ge=ze,Ge(_e)}async function Le(){if(be)try{const e=await U();if(!e)throw new Error("Supabase client unavailable");const{data:t,error:n}=await e.from("draw_snapshots").select("payload,last_updated").order("last_updated",{ascending:!1}).limit(1);if(!n){const s=t?.[0],i=Ue(s?.payload);if(i)return we(i,"supabase"),v(k)}}catch{}return k.data||we(z,"local-fallback"),v(k)}async function Pe(){if(be&&ge)try{const e=await U();if(!e)throw new Error("Supabase client unavailable");const{data:t,error:n}=await e.from("category_draw_configs").select("id,source,name,icon,description,eligibility,recent_cutoff,cutoff_range,is_active,updated_at").eq("is_active",!0).order("updated_at",{ascending:!1});if(Pt(n)&&(ge=!1),!n&&Array.isArray(t)&&t.length>0){const s=Be(t);return ye(s,"supabase"),v(C)}}catch{}return C.data||ye(W,"local-fallback"),v(C)}function Ke(e,t){typeof e=="function"&&e(t)}async function Mt({forceRefresh:e=!1,staleWhileRevalidate:t=!0,onRevalidated:n=null}={}){if(q().forceLocalData)return we(z,"local-forced"),v(k);if(Ve(),!e&&k.data){const c=v(k);return c.freshness==="fresh"||!t?c:(Le().then(u=>Ke(n,u)).catch(()=>{}),{...c,revalidating:!0})}return await Le()}async function Ft({forceRefresh:e=!1,staleWhileRevalidate:t=!0,onRevalidated:n=null}={}){if(q().forceLocalData)return ye(W,"local-forced"),v(C);if(He(),!e&&C.data){const c=v(C);return c.freshness==="fresh"||!t?c:(Pe().then(u=>Ke(n,u)).catch(()=>{}),{...c,revalidating:!0})}return await Pe()}const $e="crs-account-settings-v1",B={profileName:"",contactEmail:"",defaultDrawAlerts:!1,autoSyncProfiles:!0,autoSaveProgress:!0,motionIntensity:"full"};function Re(){try{const e=localStorage.getItem($e);if(!e)return{...B};const t=JSON.parse(e);return!t||typeof t!="object"?{...B}:{...B,...t}}catch{return{...B}}}function dr(e){const t={...B,...e||{}};["off","subtle","full"].includes(t.motionIntensity)||(t.motionIntensity=B.motionIntensity);try{localStorage.setItem($e,JSON.stringify(t))}catch{}try{window.dispatchEvent(new Event("crs-account-settings-updated"))}catch{}return t}const Ot=o.lazy(()=>R(()=>import("./WelcomeScreen-BVCWSU7n.js"),__vite__mapDeps([9,1,3,4,2,5]))),zt=o.lazy(()=>R(()=>import("./Wizard-ByicJ3VV.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Ut=o.lazy(()=>R(()=>import("./Results-BtRQwGCf.js"),__vite__mapDeps([7,4,1,2,5,3]))),Se="crs-progress",Bt={welcome:"/",wizard:"/wizard",results:"/results",unsubscribe:"/unsubscribe",handoff:"/handoff"},qt={FCP:{good:1800,needsImprovement:3e3},LCP:{good:2500,needsImprovement:4e3},CLS:{good:.1,needsImprovement:.25},INP:{good:200,needsImprovement:500}};function Te(e){return Bt[e]||"/"}function Wt(){return typeof PerformanceObserver>"u"?[]:Array.isArray(PerformanceObserver.supportedEntryTypes)?PerformanceObserver.supportedEntryTypes:[]}function Gt(e){return Wt().includes(e)}function Yt(e,t){const n=qt[e];return!n||!Number.isFinite(t)?"unknown":t<=n.good?"good":t<=n.needsImprovement?"needs_improvement":"poor"}function Ie(){try{const e=localStorage.getItem(Se);return e?JSON.parse(e):null}catch{return null}}function Vt(e){try{localStorage.setItem(Se,JSON.stringify(e))}catch{}}function De(){try{localStorage.removeItem(Se)}catch{}}function Ht(){try{return new URLSearchParams(window.location.search).get("unsubscribe")}catch{return null}}function Kt(){return{}}function $t(){const e=typeof navigator<"u"?navigator:null;if(!e)return!1;const n=!!(e.connection||e.mozConnection||e.webkitConnection)?.saveData,s=Number(e.deviceMemory||0),i=Number(e.hardwareConcurrency||0),c=Number.isFinite(s)&&s>0&&s<=4,u=Number.isFinite(i)&&i>0&&i<=4;return n||c||u}function Jt(e){return new Promise(t=>window.setTimeout(t,e))}async function Me(e,{retries:t=2,baseDelayMs:n=250}={}){let s=null;for(let i=0;i<=t;i+=1)try{return await e()}catch(c){if(s=c,i===t)break;await Jt(n*2**i)}throw s||new Error("Retry attempts exhausted.")}function Xt(){const{t:e}=Fe(),[t,n]=o.useState(()=>Re()),[s,i]=o.useState(()=>q()),c=t.autoSaveProgress!==!1,u=["off","subtle","full"].includes(t.motionIntensity)?t.motionIntensity:"full",D=o.useMemo(()=>$t(),[]),_=u==="off"?"off":D&&u==="full"?"subtle":u,j=Ht(),S=o.useMemo(()=>dt(),[]),G=Kt(),T=o.useMemo(()=>It(),[]),A=o.useMemo(()=>Dt(),[]),[m,Y]=o.useState(()=>j?"unsubscribe":S?"handoff":Object.keys(G).length>0?"results":"welcome"),ae=o.useRef(m),se=o.useRef(Te(m)),V=o.useRef(0),Je=o.useRef(new Set),[Ee,oe]=o.useState(()=>G),[X,xe]=o.useState(()=>j?"loading":"idle"),[ke,ie]=o.useState(()=>T?.data||Ne()),[Ce,ce]=o.useState(()=>T?.source||"local-fallback"),[Xe,Q]=o.useState(()=>Array.isArray(A?.data)&&A.data.length>0?A.data:me()),[M,Z]=o.useState(()=>({syncing:!1,lastError:"",lastSyncedAt:"",drawFreshness:T?.freshness||"stale",categoryFreshness:A?.freshness||"stale",drawRevalidating:!1,categoryRevalidating:!1}));o.useEffect(()=>{if(!j)return;let a=!0;return jt(j).then(d=>{a&&xe(d.status==="ok"?"success":"notfound")}).catch(d=>{a&&(xe("error"),O("unsubscribe_request_failed",d,{source:"unsubscribe_flow",has_token:!!j}))}),()=>{a=!1}},[j]);const ee=o.useCallback(async({forceRefresh:a=!1,reason:d="initial"}={})=>{Z(l=>({...l,syncing:!0,lastError:""}));let h=null,y=null,w={freshness:"fresh",revalidating:!1},E={freshness:"fresh",revalidating:!1};const P=l=>{l?.status==="ok"&&l.data&&(ie(l.data),ce(l.source||"local-fallback")),Z(x=>({...x,drawFreshness:l?.freshness||x.drawFreshness,drawRevalidating:!1,lastSyncedAt:new Date().toISOString()})),g("draw_data_swr_revalidated",{resource:"latest_draws",source:l?.source||"unknown",freshness:l?.freshness||"unknown"})},N=l=>{l?.status==="ok"&&Array.isArray(l.data)&&l.data.length>0&&Q(l.data),Z(x=>({...x,categoryFreshness:l?.freshness||x.categoryFreshness,categoryRevalidating:!1,lastSyncedAt:new Date().toISOString()})),g("draw_data_swr_revalidated",{resource:"category_config",source:l?.source||"unknown",freshness:l?.freshness||"unknown"})};try{const l=await Me(()=>Mt({forceRefresh:a,onRevalidated:P}),{retries:2,baseDelayMs:250});l?.status==="ok"&&l.data&&(ie(l.data),ce(l.source||"local-fallback")),w={freshness:l?.freshness||"fresh",revalidating:!!l?.revalidating}}catch(l){h=l,O("draw_data_sync_error",l,{reason:d,resource:"latest_draws",force_refresh:!!a}),ie(Ne()),ce("local-fallback"),w={freshness:"stale",revalidating:!1}}try{const l=await Me(()=>Ft({forceRefresh:a,onRevalidated:N}),{retries:2,baseDelayMs:250});l?.status==="ok"&&Array.isArray(l.data)&&l.data.length>0?Q(l.data):Q(me()),E={freshness:l?.freshness||"fresh",revalidating:!!l?.revalidating}}catch(l){y=l,O("draw_data_sync_error",l,{reason:d,resource:"category_config",force_refresh:!!a}),Q(me()),E={freshness:"stale",revalidating:!1}}const L=!!h||!!y;Z({syncing:!1,lastError:L?"Live sync is currently unavailable. Showing local data mode.":"",lastSyncedAt:new Date().toISOString(),drawFreshness:w.freshness,categoryFreshness:E.freshness,drawRevalidating:w.revalidating,categoryRevalidating:E.revalidating}),L?g("draw_data_sync_degraded",{reason:d,latest_error:String(h?.message||""),category_error:String(y?.message||"")}):g("draw_data_sync_ok",{reason:d,source:"live"})},[]),Qe=o.useCallback(()=>{ee({forceRefresh:!0,reason:"manual_retry"})},[ee]);o.useEffect(()=>{const a=window.setTimeout(()=>{ee()},0);return()=>window.clearTimeout(a)},[ee]),o.useEffect(()=>{if(m==="welcome"){Ae({idle:!0});return}if(m==="wizard"){_t({idle:!0});return}m==="results"&&St({idle:!0})},[m]);const Ze=o.useCallback(a=>{if(a&&c){const d=Ie();d&&oe(d)}g("wizard_started",{resumed:!!a}),Y("wizard")},[c]),et=o.useCallback(a=>{oe(a),De(),g("wizard_completed",{answer_count:Object.keys(a||{}).length}),Y("results"),window.scrollTo({top:0,behavior:"smooth"})},[]),tt=o.useCallback(()=>{oe({}),De(),g("calculator_restarted"),window.history.replaceState(null,"",window.location.pathname),Y("welcome"),window.scrollTo({top:0,behavior:"smooth"})},[]),rt=c&&!!Ie(),[nt,at]=o.useState(!1),[H,le]=o.useState(null),[st,ot]=o.useState(()=>{const a=window.matchMedia?.("(display-mode: standalone)")?.matches,d=window.navigator?.standalone===!0;return!!(a||d)});o.useEffect(()=>{const a=()=>at(window.scrollY>400);return window.addEventListener("scroll",a,{passive:!0}),()=>window.removeEventListener("scroll",a)},[]),o.useEffect(()=>{const a=h=>{typeof h?.prompt=="function"&&le(h)},d=()=>{le(null),ot(!0)};return window.addEventListener("beforeinstallprompt",a),window.addEventListener("appinstalled",d),()=>{window.removeEventListener("beforeinstallprompt",a),window.removeEventListener("appinstalled",d)}},[]);const it=o.useCallback(async()=>{if(!H)return;g("install_prompt_triggered"),H.prompt(),(await H.userChoice)?.outcome==="accepted"?(le(null),g("install_prompt_accepted")):g("install_prompt_dismissed")},[H]);return o.useEffect(()=>{const a=()=>{n(Re())};return window.addEventListener("storage",a),window.addEventListener("crs-account-settings-updated",a),()=>{window.removeEventListener("storage",a),window.removeEventListener("crs-account-settings-updated",a)}},[]),o.useEffect(()=>{const a=()=>{i(q())};return window.addEventListener("storage",a),window.addEventListener("crs-runtime-flags-updated",a),()=>{window.removeEventListener("storage",a),window.removeEventListener("crs-runtime-flags-updated",a)}},[]),o.useEffect(()=>{V.current===0&&(V.current=typeof performance<"u"?performance.now():Date.now())},[]),o.useEffect(()=>{if(!s.enablePerfTelemetry)return;const a=h=>{const y=h?.error instanceof Error?h.error:new Error(h?.message||"Window error");O("app_window_error",y,{source:"window_error",filename:h?.filename||"",line:Number(h?.lineno||0),column:Number(h?.colno||0)})},d=h=>{const y=h?.reason,w=y instanceof Error?y:new Error(typeof y=="string"?y:"Unhandled promise rejection");O("app_unhandled_rejection",w,{source:"unhandled_rejection",reason_type:typeof y})};return window.addEventListener("error",a),window.addEventListener("unhandledrejection",d),()=>{window.removeEventListener("error",a),window.removeEventListener("unhandledrejection",d)}},[s.enablePerfTelemetry]),o.useEffect(()=>{if(!s.enablePerfTelemetry)return;const a=Te(m);g("perf_route_view",{mode:m,route:a,previous_route:se.current,transition_type:se.current===a?"initial":"virtual_navigation"}),se.current=a},[m,s.enablePerfTelemetry]),o.useEffect(()=>{if(s.enablePerfTelemetry)try{const a=window.performance?.getEntriesByType?.("navigation")?.[0];if(!a)return;g("perf_navigation_summary",{type:a.type||"navigate",dom_content_loaded_ms:Math.round(a.domContentLoadedEventEnd||0),load_event_ms:Math.round(a.loadEventEnd||0),transfer_kb:Number(((a.transferSize||0)/1024).toFixed(1))})}catch{}},[s.enablePerfTelemetry]),o.useEffect(()=>{if(!s.enablePerfTelemetry||typeof window>"u"||typeof PerformanceObserver>"u")return;const a=[],d=Je.current;let h=0,y=0,w=0,E=0,P=0,N=0,L=0,l=0;const x=(f,p,b={})=>{if(!Number.isFinite(p)||p<=0||d.has(f))return;d.add(f);const ue=f==="CLS"?Number(p.toFixed(3)):Math.round(p);g("perf_web_vital",{metric:f,value:ue,rating:Yt(f,p),...b})},I=(f,p)=>{if(Gt(f))try{const b=new PerformanceObserver(ue=>{p(ue.getEntries()||[])});b.observe(f==="event"?{type:f,buffered:!0,durationThreshold:16}:{type:f,buffered:!0}),a.push(b)}catch{}};I("paint",f=>{const p=f.find(b=>b.name==="first-contentful-paint");p&&x("FCP",Number(p.startTime||0))}),I("largest-contentful-paint",f=>{const p=f[f.length-1];p&&(h=Number(p.startTime||0),y=Number(p.size||0))}),I("layout-shift",f=>{for(const p of f)p.hadRecentInput||(w+=Number(p.value||0))}),I("event",f=>{for(const p of f){const b=Number(p.duration||0);!Number.isFinite(b)||b<=0||(E=Math.max(E,b),P+=1)}}),I("longtask",f=>{for(const p of f){const b=Number(p.duration||0);!Number.isFinite(b)||b<=0||(N+=1,L+=b,l=Math.max(l,b))}});let K=!1;const F=()=>{K||(K=!0,x("LCP",h,{element_size_px:Math.round(y)}),x("CLS",w),x("INP",E,{sample_count:P}),N>0&&!d.has("LONG_TASK_SUMMARY")&&(d.add("LONG_TASK_SUMMARY"),g("perf_long_task_summary",{task_count:N,max_duration_ms:Math.round(l),total_duration_ms:Math.round(L),average_duration_ms:Math.round(L/N)})))},je=()=>{document.visibilityState==="hidden"&&F()};return document.addEventListener("visibilitychange",je,!0),window.addEventListener("pagehide",F,!0),()=>{F(),document.removeEventListener("visibilitychange",je,!0),window.removeEventListener("pagehide",F,!0),a.forEach(f=>f.disconnect())}},[s.enablePerfTelemetry]),o.useEffect(()=>{const a=typeof performance<"u"?performance.now():Date.now(),d=ae.current;if(!s.enablePerfTelemetry){ae.current=m,V.current=a;return}d!==m&&(g("perf_mode_transition",{from_mode:d,to_mode:m,duration_ms:Math.max(Math.round(a-V.current),0)}),ae.current=m,V.current=a)},[m,s.enablePerfTelemetry]),o.useEffect(()=>{document.documentElement.setAttribute("data-motion",_)},[_]),o.useEffect(()=>{const a=document.documentElement,d=window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,h=window.matchMedia?.("(pointer: fine)")?.matches;if(!(_!=="off"&&!d&&!!h)){a.style.setProperty("--pointer-x","50%"),a.style.setProperty("--pointer-y","40%"),a.style.setProperty("--pointer-glow","0");return}a.style.setProperty("--pointer-glow",_==="subtle"?"0.45":"1");let w=0,E=50,P=40,N=50,L=40;const l=()=>{E+=(N-E)*.12,P+=(L-P)*.12,a.style.setProperty("--pointer-x",`${E.toFixed(2)}%`),a.style.setProperty("--pointer-y",`${P.toFixed(2)}%`),Math.abs(N-E)>.05||Math.abs(L-P)>.05?w=window.requestAnimationFrame(l):w=0},x=()=>{w||(w=window.requestAnimationFrame(l))},I=F=>{N=F.clientX/window.innerWidth*100,L=F.clientY/window.innerHeight*100,x()},K=()=>{N=50,L=40,x()};return window.addEventListener("pointermove",I,{passive:!0}),window.addEventListener("pointerleave",K,{passive:!0}),()=>{window.removeEventListener("pointermove",I),window.removeEventListener("pointerleave",K),w&&window.cancelAnimationFrame(w)}},[_]),r.jsxs("div",{className:"app",children:[r.jsxs("div",{className:"anime-bg","aria-hidden":"true",children:[r.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--one"}),r.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--two"}),r.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--three"}),r.jsx("span",{className:"anime-bg-grid"}),r.jsx("span",{className:"anime-bg-noise"}),r.jsx("span",{className:"anime-bg-pointer-glow"}),r.jsx("span",{className:"anime-bg-flare"}),r.jsx("span",{className:"anime-bg-vignette"}),r.jsxs("div",{className:"anime-bg-sparks",children:[r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{})]})]}),r.jsx("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"}),r.jsx(kt,{canInstallApp:!st&&!!H,onInstallApp:it,motionIntensity:_}),r.jsx("main",{className:"main",role:"main",id:"main-content",children:r.jsxs(ht,{mode:"wait",children:[m==="welcome"&&r.jsx(o.Suspense,{fallback:r.jsx("div",{className:"loading-fallback",children:r.jsx(fe,{})}),children:r.jsx(Ot,{onStart:Ze,onPrepareStart:()=>Ae(),hasSaved:rt,drawData:ke,drawSource:Ce,motionIntensity:_},"welcome")}),m==="wizard"&&r.jsx(o.Suspense,{fallback:r.jsx("div",{className:"loading-fallback",children:r.jsx(fe,{})}),children:r.jsx(zt,{onFinish:et,onProgress:c?Vt:void 0,initialAnswers:Ee,motionIntensity:_},"wizard")}),m==="unsubscribe"&&r.jsxs("div",{className:"card unsubscribe-card",children:[r.jsx("h3",{children:"Draw alert preferences"}),X==="loading"&&r.jsx("p",{children:"Processing your unsubscribe requestâ€¦"}),X==="success"&&r.jsx("p",{children:"Youâ€™ve been unsubscribed from draw alerts successfully."}),X==="notfound"&&r.jsx("p",{children:"This unsubscribe link is invalid or already inactive."}),X==="error"&&r.jsx("p",{children:"We couldnâ€™t process this request right now. Please try again later."}),r.jsx("button",{type:"button",className:"btn-restart",onClick:()=>Y("welcome"),children:"Back to calculator"})]}),m==="handoff"&&r.jsxs("div",{className:"card unsubscribe-card",children:[r.jsx("h3",{children:"Consultant handoff summary"}),S?r.jsxs(r.Fragment,{children:[r.jsxs("p",{children:["Score: ",r.jsx("strong",{children:S?.summary?.score??"â€”"})," Â· ","Avg cutoff: ",r.jsx("strong",{children:S?.summary?.averageCutoff??"â€”"})," Â· ","Confidence: ",r.jsx("strong",{children:S?.summary?.confidenceBand||"Unknown"})]}),r.jsxs("p",{children:["Generated: ",S?.generatedAt?new Date(S.generatedAt).toLocaleString():"â€”"]})]}):r.jsx("p",{children:"This handoff link is invalid or expired."}),r.jsx("button",{type:"button",className:"btn-restart",onClick:()=>{window.history.replaceState(null,"",window.location.pathname),Y("welcome")},children:"Open calculator"})]}),m==="results"&&r.jsx(o.Suspense,{fallback:r.jsx("div",{className:"loading-fallback",children:r.jsx(fe,{})}),children:r.jsx(Ut,{answers:Ee,onRestart:tt,drawData:ke,drawSource:Ce,categoryInfo:Xe,motionIntensity:_,onRetryDataSync:Qe,isDataSyncing:M.syncing,dataSyncError:M.lastError,dataSyncFreshness:M.drawFreshness==="stale"||M.categoryFreshness==="stale"?"stale":"fresh",isDataRevalidating:M.drawRevalidating||M.categoryRevalidating,dataLastSyncedAt:M.lastSyncedAt},"results")})]})}),r.jsxs("footer",{className:"footer",children:[r.jsxs("p",{children:["Â© ",new Date().getFullYear()," ",e("footer.copy")]}),r.jsxs("p",{className:"footer-legal-links",children:[r.jsx("a",{href:"/guides.html",children:"Guides"}),r.jsx("span",{"aria-hidden":"true",children:" Â· "}),r.jsx("a",{href:"/terms.html",children:"Terms of Service"}),r.jsx("span",{"aria-hidden":"true",children:" Â· "}),r.jsx("a",{href:"/privacy.html",children:"Privacy Policy"}),r.jsx("span",{"aria-hidden":"true",children:" Â· "}),r.jsx("a",{href:"/trust.html",children:"Trust Center"})]})]}),nt&&r.jsx("button",{type:"button",className:"btn-top",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),"aria-label":"Back to top",children:"â†‘"})]})}class Qt extends o.Component{constructor(t){super(t),this.state={hasError:!1,errorMessage:""}}static getDerivedStateFromError(t){return{hasError:!0,errorMessage:t?.message||"Unexpected application error."}}componentDidCatch(t,n){O("app_error_boundary_triggered",t,{component_stack:String(n?.componentStack||"").slice(0,600),route:typeof window<"u"?window.location.pathname:"server"})}handleTryAgain=()=>{this.setState({hasError:!1,errorMessage:""})};render(){return this.state.hasError?r.jsx("main",{className:"error-boundary-screen",role:"alert","aria-live":"assertive",children:r.jsxs("section",{className:"error-boundary-card",children:[r.jsx("h1",{children:"Something went wrong"}),r.jsx("p",{children:"We hit an unexpected issue while rendering this page."}),r.jsx("p",{className:"error-boundary-message",children:this.state.errorMessage}),r.jsxs("div",{className:"error-boundary-actions",children:[r.jsx("button",{type:"button",className:"action-btn auth-btn-primary",onClick:this.handleTryAgain,children:"Try again"}),r.jsx("button",{type:"button",className:"action-btn",onClick:()=>window.location.reload(),children:"Reload app"})]})]})}):this.props.children}}const Zt=()=>R(()=>import("./motionFeatures-DFpXREjK.js"),__vite__mapDeps([10,5,1])).then(e=>e.default);"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("[SW] Service Worker registered:",e),q().enablePerfTelemetry&&g("service_worker_registered",{scope:e?.scope||"/"})}).catch(e=>{console.error("[SW] Service Worker registration failed:",e),q().enablePerfTelemetry&&O("service_worker_registration_failed",e,{source:"main_bootstrap"})})});ut.createRoot(document.getElementById("root")).render(r.jsx(o.StrictMode,{children:r.jsx(Qt,{children:r.jsx(lt,{children:r.jsx(wt,{children:r.jsx(ft,{children:r.jsx(gt,{features:Zt,children:r.jsx(Xt,{})})})})})})}));export{fe as L,St as a,Ne as b,Mt as c,Ft as d,ir as e,cr as f,me as g,lr as h,J as i,ur as j,or as l,_t as p,Re as r,dr as s,sr as u};
