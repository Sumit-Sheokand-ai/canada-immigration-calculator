const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WelcomeScreen-BqhHGZst.js","assets/vendor-react-Ah1pgjPn.js","assets/feature-path-coach-D61WCqvK.js","assets/data-question-bank-F-s7nTqV.js","assets/vendor-supabase-BZ0N5lZN.js","assets/vendor-motion-DURBmaq0.js","assets/Wizard-CqpwZVrf.js","assets/Results-DWydWfDC.js"])))=>i.map(i=>d[i]);
import{r as o,j as e,c as we}from"./vendor-react-Ah1pgjPn.js";import{s as x,i as Q,u as de,A as be}from"./feature-path-coach-D61WCqvK.js";import{u as ye,m as ve,A as Se}from"./vendor-motion-DURBmaq0.js";import{t as W,r as q}from"./data-question-bank-F-s7nTqV.js";import"./vendor-supabase-BZ0N5lZN.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const xe="modulepreload",Ce=function(t){return"/"+t},ie={},Z=function(s,n,l){let a=Promise.resolve();if(n&&n.length>0){let C=function(h){return Promise.all(h.map(v=>Promise.resolve(v).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),f=c?.nonce||c?.getAttribute("nonce");a=C(n.map(h=>{if(h=Ce(h),h in ie)return;ie[h]=!0;const v=h.endsWith(".css"),y=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${y}`))return;const g=document.createElement("link");if(g.rel=v?"stylesheet":xe,v||(g.as="script"),g.crossOrigin="",g.href=h,f&&g.setAttribute("nonce",f),document.head.appendChild(g),v)return new Promise((j,N)=>{g.addEventListener("load",j),g.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${h}`)))})}))}function r(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return a.then(c=>{for(const f of c||[])f.status==="rejected"&&r(f.reason);return s().catch(r)})},fe=o.createContext();function je({children:t}){const[s,n]=o.useState(()=>{try{return localStorage.getItem("crs-theme")==="dark"}catch{return!1}});o.useEffect(()=>{document.documentElement.setAttribute("data-theme",s?"dark":"light");try{localStorage.setItem("crs-theme",s?"dark":"light")}catch{}},[s]);const l=()=>n(a=>!a);return e.jsx(fe.Provider,{value:{dark:s,toggle:l},children:t})}function ke(){return o.useContext(fe)}const Ee={"header.title":"CRS Calculator 2026","welcome.heading":`Free CRS Calculator
for Express Entry 2026`,"welcome.sub":"Calculate your Comprehensive Ranking System (CRS) score for Canada Express Entry. Check FSW, CEC, PNP eligibility instantly. Updated with latest IRCC draw cutoffs.","welcome.btn":"Calculate My CRS Score Free","welcome.updated":"IRCC data updated:","welcome.trust":"Uses official IRCC draw data â€” last updated:","welcome.microcopy":"This will take 3 minutes â€” one question at a time.","welcome.resume":"You have an unfinished calculation.","welcome.resumeBtn":"Resume","welcome.startFresh":"Start Fresh","feature.accurate":"Official CRS Formula","feature.accurateDesc":"100% accurate IRCC scoring algorithm","feature.suggestions":"Boost Your Score","feature.suggestionsDesc":"Get personalized tips to gain +50 points","feature.draws":"2026 Draw Cutoffs","feature.drawsDesc":"Live IRCC Express Entry draw results","feature.instant":"Free & Instant","feature.instantDesc":"No signup required Â· Results in 2 minutes","wizard.step":"Step","wizard.of":"of","wizard.next":"Next â†’","wizard.back":"â† Back","wizard.calculate":"Calculate Score âœ“","results.breakdown":"Your CRS Score Breakdown","results.improve":"How to Increase Your CRS Score","results.category":"Category-Based Draw Eligibility","results.catIntro":"IRCC runs category-based draws with lower cutoffs for healthcare, STEM, trades, transport, and French speakers. Here's your eligibility:","results.timeline":"PR Timeline Estimate","results.draws":"Latest Express Entry Draws 2026","results.disclaimer":"This free CRS calculator provides an estimate based on IRCC's publicly available scoring criteria. Not affiliated with Immigration, Refugees and Citizenship Canada.","results.restart":"â†» Recalculate","results.share":"Share Results","results.pdf":"Download PDF","results.whatif":"What-If Score Simulator","results.whatifDesc":"See how improving IELTS, education, or work experience affects your CRS:","results.original":"Current","results.projected":"Projected","results.foreignWork":"Foreign Work (Skill Bonus)","footer.copy":"Free CRS Calculator 2026 Â· Not affiliated with IRCC"},Ne={"header.title":"Calculateur SRC","welcome.heading":`Immigration au Canada
Calculateur de Points`,"welcome.sub":"Calculez votre score du SystÃ¨me de classement global (SCG) et dÃ©couvrez votre meilleur chemin vers la rÃ©sidence permanente canadienne.","welcome.btn":"Calculer Mon Score","welcome.updated":"DerniÃ¨re mise Ã  jour :","welcome.trust":"DonnÃ©es officielles dâ€™IRCC â€” derniÃ¨re mise Ã  jour :","welcome.microcopy":"Cela prend 3 minutes â€” une question Ã  la fois.","welcome.resume":"Vous avez un calcul en cours.","welcome.resumeBtn":"Reprendre","welcome.startFresh":"Recommencer","feature.accurate":"Score SCG PrÃ©cis","feature.accurateDesc":"Calcul complet du SystÃ¨me de classement global","feature.suggestions":"Suggestions Intelligentes","feature.suggestionsDesc":"Conseils personnalisÃ©s pour augmenter vos points","feature.draws":"Derniers Tirages","feature.drawsDesc":"RÃ©sultats Ã  jour des tirages EntrÃ©e express d'IRCC","feature.instant":"RÃ©sultats InstantanÃ©s","feature.instantDesc":"Obtenez votre score en moins de 2 minutes","wizard.step":"Ã‰tape","wizard.of":"de","wizard.next":"Suivant â†’","wizard.back":"â† Retour","wizard.calculate":"Calculer le Score âœ“","results.breakdown":"DÃ©tail de Votre Score","results.improve":"Comment AmÃ©liorer Votre Score","results.category":"AdmissibilitÃ© aux Tirages par CatÃ©gorie","results.catIntro":"Le Canada organise des tirages spÃ©ciaux pour des groupes spÃ©cifiques avec des seuils plus bas. Voici ce Ã  quoi vous pourriez Ãªtre admissible :","results.timeline":"Calendrier EstimÃ©","results.draws":"Tirages RÃ©cents EntrÃ©e Express","results.disclaimer":"Ce calculateur fournit une estimation basÃ©e sur les critÃ¨res SCG publics. Il n'est pas affiliÃ© Ã  IRCC.","results.restart":"â†» Recommencer","results.share":"Partager les RÃ©sultats","results.pdf":"TÃ©lÃ©charger PDF","results.whatif":"Comparaison HypothÃ©tique","results.whatifDesc":"Ajustez les variables pour voir comment votre score change :","results.original":"Original","results.projected":"ProjetÃ©","results.foreignWork":"Exp. Ã‰trangÃ¨re (Bonus)","footer.copy":"Calculateur SRC Â· Non affiliÃ© Ã  IRCC"},oe={en:Ee,fr:Ne},me=o.createContext();function Ae({children:t}){const[s,n]=o.useState(()=>{try{return localStorage.getItem("crs-lang")||"en"}catch{return"en"}}),l=o.useCallback(r=>{n(r);try{localStorage.setItem("crs-lang",r)}catch{}},[]),a=o.useCallback(r=>oe[s]?.[r]||oe.en[r]||r,[s]);return e.jsx(me.Provider,{value:{lang:s,setLang:l,t:a},children:t})}function pe(){return o.useContext(me)}function Ie(t,s){const n=t.answers||{};return{id:t.id,user_id:s||null,name:t.name||null,score:Number(t.score)||0,email:t.email||null,alert_opt_in:!!t.alertOptIn,alert_token:t.alertToken||null,profile_json:{answers:n,tracking:{userId:s||null,savedAt:new Date().toISOString()}},updated_at:new Date().toISOString()}}function K(t){const s=String(t?.message||"");return/column\s+["']?user_id["']?\s+does not exist/i.test(s)}function Y(t,s){const n=s?.message||s?.hint||String(s);return`${t}: ${n}`}function B(){return Q&&!!x}async function at(t,s={}){if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=s.userId||null,l=Ie(t,n);let a,r;if({data:a,error:r}=await x.from("saved_profiles").upsert(l,{onConflict:"id"}).select(),r&&n&&K(r)){const{user_id:c,...f}=l;({data:a,error:r}=await x.from("saved_profiles").upsert(f,{onConflict:"id"}).select())}if(r)throw new Error(Y("Supabase upsert failed",r));return{status:"ok",data:a||[]}}async function _e(t){if(!t)return{status:"skipped",reason:"Missing token"};if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const{data:s,error:n}=await x.from("saved_profiles").update({alert_opt_in:!1,updated_at:new Date().toISOString()}).eq("alert_token",t).select();if(n)throw new Error(Y("Supabase unsubscribe failed",n));return s?.length?{status:"ok",data:s[0]}:{status:"not-found"}}async function nt(t){if(!t)return{status:"skipped",reason:"Missing user id"};if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const{data:s,error:n}=await x.from("saved_profiles").select("id,name,score,email,updated_at").eq("user_id",t).order("updated_at",{ascending:!1}).limit(12);if(n&&K(n))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(n)throw new Error(Y("Supabase profile list failed",n));return{status:"ok",data:s||[]}}async function Pe(t,s){if(!t)return{status:"skipped",reason:"Missing user id"};if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const{error:n,data:l}=await x.from("saved_profiles").update({alert_opt_in:!!s,updated_at:new Date().toISOString()}).eq("user_id",t).select("id");if(n&&K(n))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(n)throw new Error(Y("Supabase alert preference update failed",n));return{status:"ok",updatedCount:l?.length||0}}async function Re(t,s){if(!t)return{status:"skipped",reason:"Missing user id"};if(!B())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=s?String(s).trim().toLowerCase():null,{error:l,data:a}=await x.from("saved_profiles").update({email:n||null,updated_at:new Date().toISOString()}).eq("user_id",t).select("id");if(l&&K(l))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(l)throw new Error(Y("Supabase profile email update failed",l));return{status:"ok",updatedCount:a?.length||0}}const he="crs-account-settings-v1",z={profileName:"",contactEmail:"",defaultDrawAlerts:!1,autoSyncProfiles:!0,autoSaveProgress:!0,motionIntensity:"full"};function X(){try{const t=localStorage.getItem(he);if(!t)return{...z};const s=JSON.parse(t);return!s||typeof s!="object"?{...z}:{...z,...s}}catch{return{...z}}}function De(t){const s={...z,...t||{}};["off","subtle","full"].includes(s.motionIntensity)||(s.motionIntensity=z.motionIntensity);try{localStorage.setItem(he,JSON.stringify(s))}catch{}try{window.dispatchEvent(new Event("crs-account-settings-updated"))}catch{}return s}const le=/^\S+@\S+\.\S+$/;function Le({open:t,onClose:s}){const{isConfigured:n,loading:l,user:a,sendEmailMagicLink:r,verifyEmailOtp:c,refreshSession:f,signInWithGoogle:C,signOut:h,updateProfile:v}=de(),[y,g]=o.useState(""),[j,N]=o.useState(""),[k,A]=o.useState("request"),[w,b]=o.useState(!1),[V,d]=o.useState(""),[I,D]=o.useState(0),[S,E]=o.useState(()=>X()),_=o.useId(),U=o.useMemo(()=>a?"Account":"Login / Signup",[a]),G=B();if(o.useEffect(()=>{if(!t||I<=0)return;const i=window.setInterval(()=>{D(m=>m<=1?0:m-1)},1e3);return()=>window.clearInterval(i)},[t,I]),o.useEffect(()=>{!t||!a||E(i=>({...i,profileName:a.user_metadata?.full_name||i.profileName||"",contactEmail:i.contactEmail||a.email||""}))},[t,a]),o.useEffect(()=>{if(!t||!a||!(k==="sent"||k==="verify"))return;d("Signed in successfully.");const i=window.setTimeout(()=>s(),500);return()=>window.clearTimeout(i)},[s,t,k,a]),o.useEffect(()=>{t||(A("request"),N(""),d(""),b(!1),D(0))},[t]),o.useEffect(()=>{if(!t)return;const i=document.body.style.overflow,m=H=>{H.key==="Escape"&&s()};return document.body.style.overflow="hidden",window.addEventListener("keydown",m),()=>{window.removeEventListener("keydown",m),document.body.style.overflow=i}},[s,t]),!t)return null;const R=y.trim().toLowerCase(),$=async()=>{if(!R||!le.test(R)){d("Please enter a valid email address.");return}b(!0),d("");try{await r(R),A("sent"),N(""),D(25),d("Magic link sent. Open your email and click the secure sign-in link.")}catch(i){d(i.message||"Could not send magic link.")}finally{b(!1)}},u=async()=>{b(!0),d("");try{(await f())?.user?(d("Signed in successfully."),A("request"),setTimeout(()=>s(),500)):d("No active session found yet. Click the magic link from your email in this browser, then try again.")}catch(i){d(i.message||"Could not refresh session.")}finally{b(!1)}},p=async()=>{I>0||await $()},L=async()=>{if(!R||!j.trim()){d("Enter your email and 6-digit code.");return}b(!0),d("");try{await c(R,j.trim()),await f(),d("Signed in successfully."),A("request"),N(""),setTimeout(()=>s(),500)}catch(i){d(i.message||"Verification failed.")}finally{b(!1)}},te=async()=>{b(!0),d("");try{await C(),d("Redirecting to Google...")}catch(i){d(i.message||"Google login failed.")}finally{b(!1)}},P=async()=>{const i={...S,profileName:(S.profileName||"").trim(),contactEmail:(S.contactEmail||"").trim().toLowerCase()};if(i.contactEmail&&!le.test(i.contactEmail)){d("Please enter a valid contact email.");return}b(!0),d("");try{await v({fullName:i.profileName}),De(i),E(i),G&&a?.id&&await Promise.all([Pe(a.id,i.defaultDrawAlerts),Re(a.id,i.contactEmail||a.email||"")]),d("Account settings saved.")}catch(m){d(m.message||"Could not save account settings.")}finally{b(!1)}},T=async()=>{b(!0),d("");try{await f(),d("Session refreshed.")}catch(i){d(i.message||"Session refresh failed.")}finally{b(!1)}},M=async()=>{b(!0),d("");try{await h(),d("Signed out."),setTimeout(()=>s(),400)}catch(i){d(i.message||"Sign out failed.")}finally{b(!1)}};return e.jsx("div",{className:"auth-modal-backdrop",onClick:s,role:"presentation",children:e.jsxs("div",{className:"auth-modal",role:"dialog","aria-modal":"true","aria-labelledby":_,onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"auth-modal-head",children:[e.jsx("h3",{id:_,children:U}),e.jsx("button",{type:"button",className:"auth-close",onClick:s,"aria-label":"Close dialog",children:"âœ•"})]}),!n&&e.jsx("p",{className:"auth-note",children:"Auth is unavailable. Add `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`."}),n&&l&&e.jsx("p",{className:"auth-note",children:"Checking session..."}),n&&!l&&a&&e.jsxs("div",{className:"auth-body",children:[e.jsxs("p",{className:"auth-note",children:["Signed in as ",e.jsx("strong",{children:a.email})]}),e.jsxs("div",{className:"auth-settings-card",children:[e.jsx("h4",{children:"Account settings"}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Display name"}),e.jsx("input",{type:"text",value:S.profileName,onChange:i=>E(m=>({...m,profileName:i.target.value})),placeholder:"Your name"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Contact email for draw alerts"}),e.jsx("input",{type:"email",value:S.contactEmail,onChange:i=>E(m=>({...m,contactEmail:i.target.value})),placeholder:"you@example.com"})]}),e.jsxs("label",{className:"auth-check-row",children:[e.jsx("input",{type:"checkbox",checked:S.defaultDrawAlerts,onChange:i=>E(m=>({...m,defaultDrawAlerts:i.target.checked}))}),e.jsx("span",{children:"Enable draw alerts by default"})]}),e.jsxs("label",{className:"auth-check-row",children:[e.jsx("input",{type:"checkbox",checked:S.autoSyncProfiles,onChange:i=>E(m=>({...m,autoSyncProfiles:i.target.checked}))}),e.jsx("span",{children:"Auto-sync saved profiles"})]}),e.jsxs("label",{className:"auth-check-row",children:[e.jsx("input",{type:"checkbox",checked:S.autoSaveProgress,onChange:i=>E(m=>({...m,autoSaveProgress:i.target.checked}))}),e.jsx("span",{children:"Auto-save wizard progress on this device"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Animation intensity"}),e.jsxs("select",{value:S.motionIntensity||"full",onChange:i=>E(m=>({...m,motionIntensity:i.target.value})),children:[e.jsx("option",{value:"full",children:"Full"}),e.jsx("option",{value:"subtle",children:"Subtle"}),e.jsx("option",{value:"off",children:"Off"})]})]}),!G&&e.jsx("p",{className:"auth-note",children:"Cloud account settings require Supabase env vars."})]}),e.jsxs("div",{className:"auth-actions",children:[e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:w,onClick:P,children:w?"Saving...":"Save settings"}),e.jsx("button",{type:"button",className:"action-btn",disabled:w,onClick:T,children:"Refresh session"}),e.jsx("button",{type:"button",className:"action-btn",disabled:w,onClick:M,children:w?"Signing out...":"Sign out"})]})]}),n&&!l&&!a&&e.jsxs("div",{className:"auth-body",children:[e.jsx("p",{className:"auth-note",children:"Sign in with a magic link (recommended) or verify manually with an email code."}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",placeholder:"you@example.com",value:y,onChange:i=>g(i.target.value),autoFocus:!0})]}),k==="verify"&&e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Email verification code"}),e.jsx("input",{type:"text",inputMode:"numeric",placeholder:"Enter code",value:j,onChange:i=>N(i.target.value)})]}),e.jsxs("div",{className:"auth-actions",children:[k==="request"?e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:w,onClick:$,children:w?"Sending...":"Send magic link"}):k==="sent"?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:w,onClick:u,children:w?"Checking...":"I clicked the magic link"}),e.jsx("button",{type:"button",className:"action-btn",disabled:w||I>0,onClick:p,children:I>0?`Resend in ${I}s`:"Resend magic link"}),e.jsx("button",{type:"button",className:"action-btn",disabled:w,onClick:()=>{A("verify"),d("If your email contains a code, enter it below.")},children:"Use email code instead"})]}):e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:w,onClick:L,children:w?"Verifying...":"Verify and sign in"}),e.jsx("button",{type:"button",className:"action-btn",disabled:w,onClick:te,children:"Continue with Google"}),k!=="request"&&e.jsx("button",{type:"button",className:"action-btn",disabled:w,onClick:()=>{A("request"),N(""),d(""),D(0)},children:"Back"})]})]}),V&&e.jsx("p",{className:"auth-status",role:"status","aria-live":"polite",children:V})]})})}const Te={en:"EN",fr:"FR"};function Me({canInstallApp:t=!1,onInstallApp:s=()=>{},motionIntensity:n="full"}){const l=ye()||n==="off",{dark:a,toggle:r}=ke(),{lang:c,setLang:f,t:C}=pe(),{user:h}=de(),[v,y]=o.useState(!1);return e.jsxs(ve.header,{className:"header",initial:l?!1:{y:-60,opacity:0},animate:{y:0,opacity:1},transition:l?{duration:0}:{type:"spring",stiffness:120,damping:20},children:[e.jsxs("div",{className:"header-inner",children:[e.jsxs("div",{className:"logo",children:[e.jsx("span",{className:"logo-leaf",children:"ðŸ"}),e.jsx("span",{children:C("header.title")})]}),e.jsxs("div",{className:"header-actions",children:[t&&e.jsx("button",{type:"button",className:"install-btn",onClick:s,"aria-label":"Install app",title:"Add app shortcut",children:"Install app"}),e.jsx("button",{type:"button",className:"auth-toggle",onClick:()=>y(!0),"aria-label":h?"Manage account":"Login or signup",title:h?h.email:"Login / Signup",children:h?"Account":"Login"}),e.jsx("select",{className:"lang-select",value:c,onChange:g=>f(g.target.value),"aria-label":"Select language",children:Object.entries(Te).map(([g,j])=>e.jsx("option",{value:g,children:j},g))}),e.jsx("button",{type:"button",className:"theme-toggle",onClick:r,"aria-label":a?"Switch to light mode":"Switch to dark mode",title:a?"Light mode":"Dark mode",children:a?"Light":"Dark"})]})]}),e.jsx(Le,{open:v,onClose:()=>y(!1)})]})}function J(){const t=Array.from({length:9});return e.jsxs("div",{className:"uv-loader",children:[t.map((s,n)=>e.jsx("div",{className:"uv-text",children:e.jsx("span",{children:"Loading"})},n)),e.jsx("div",{className:"uv-line"})]})}const ge=300*1e3;let O={data:null,source:"none",fetchedAt:0},F={data:null,source:"none",fetchedAt:0};function Oe(t){return!!t&&typeof t=="object"&&Array.isArray(t.generalProgram)&&Array.isArray(t.categoryBased)&&Array.isArray(t.pnpDraws)&&Number.isFinite(Number(t.averageCutoff))}function Fe(t){return Oe(t)?{...t,generalProgram:t.generalProgram||[],categoryBased:t.categoryBased||[],pnpDraws:t.pnpDraws||[],averageCutoff:Number(t.averageCutoff)||q.averageCutoff,lastUpdated:t.lastUpdated||q.lastUpdated,pnpRanges:t.pnpRanges||q.pnpRanges}:null}function ze(t){if(!t||typeof t!="object")return null;const s=String(t.id||"").trim(),n=String(t.name||"").trim(),l=String(t.icon||"").trim(),a=String(t.description||"").trim(),r=String(t.eligibility||"").trim(),c=String(t.cutoff_range||t.cutoffRange||"").trim(),f=Number(t.recent_cutoff??t.recentCutoff);return!s||!n||!l||!a||!r||!Number.isFinite(f)?null:{id:s,name:n,icon:l,description:a,eligibility:r,recentCutoff:f,cutoffRange:c||"N/A",source:t.source||"supabase",updatedAt:t.updated_at||null}}function qe(t=[]){const s=new Map(W.map(r=>[r.id,r])),n=new Map;for(const r of t){const c=ze(r);c&&(n.has(c.id)||n.set(c.id,c))}const l=W.map(r=>{const c=n.get(r.id);return c?{...r,name:c.name,icon:c.icon,description:c.description,eligibility:c.eligibility,recentCutoff:c.recentCutoff,cutoffRange:c.cutoffRange,source:c.source,updatedAt:c.updatedAt}:r}),a=[...n.values()].filter(r=>!s.has(r.id)).map(r=>({...r,check:()=>!1}));return[...l,...a]}function Be(){return q}function Ue(){return W}async function We({forceRefresh:t=!1}={}){if(!t&&O.data&&Date.now()-O.fetchedAt<ge)return{status:"ok",source:O.source,data:O.data};if(Q&&x)try{const{data:s,error:n}=await x.from("draw_snapshots").select("payload,last_updated").order("last_updated",{ascending:!1}).limit(1);if(!n){const l=s?.[0],a=Fe(l?.payload);if(a)return O={data:a,source:"supabase",fetchedAt:Date.now()},{status:"ok",source:"supabase",data:a}}}catch{}return O={data:q,source:"local-fallback",fetchedAt:Date.now()},{status:"ok",source:"local-fallback",data:q}}async function Ye({forceRefresh:t=!1}={}){if(!t&&F.data&&Date.now()-F.fetchedAt<ge)return{status:"ok",source:F.source,data:F.data};if(Q&&x)try{const{data:s,error:n}=await x.from("category_draw_configs").select("id,source,name,icon,description,eligibility,recent_cutoff,cutoff_range,is_active,updated_at").eq("is_active",!0).order("updated_at",{ascending:!1});if(!n&&Array.isArray(s)&&s.length>0){const l=qe(s);return F={data:l,source:"supabase",fetchedAt:Date.now()},{status:"ok",source:"supabase",data:l}}}catch{}return F={data:W,source:"local-fallback",fetchedAt:Date.now()},{status:"ok",source:"local-fallback",data:W}}const Ve=o.lazy(()=>Z(()=>import("./WelcomeScreen-BqhHGZst.js"),__vite__mapDeps([0,1,2,3,4,5]))),Ge=o.lazy(()=>Z(()=>import("./Wizard-CqpwZVrf.js"),__vite__mapDeps([6,1,3,2,4,5]))),$e=o.lazy(()=>Z(()=>import("./Results-DWydWfDC.js"),__vite__mapDeps([7,1,2,3,4,5]))),ee="crs-progress";function ce(){try{const t=localStorage.getItem(ee);return t?JSON.parse(t):null}catch{return null}}function He(t){try{localStorage.setItem(ee,JSON.stringify(t))}catch{}}function ue(){try{localStorage.removeItem(ee)}catch{}}function Ke(){try{return new URLSearchParams(window.location.search).get("unsubscribe")}catch{return null}}function Je(){return{}}function Xe(){const{t}=pe(),[s,n]=o.useState(()=>X()),l=s.autoSaveProgress!==!1,a=["off","subtle","full"].includes(s.motionIntensity)?s.motionIntensity:"full",r=Ke(),c=Je(),[f,C]=o.useState(()=>r?"unsubscribe":Object.keys(c).length>0?"results":"welcome"),[h,v]=o.useState(()=>c),[y,g]=o.useState(()=>r?"loading":"idle"),[j,N]=o.useState(()=>Be()),[k,A]=o.useState("local-fallback"),[w,b]=o.useState(()=>Ue());o.useEffect(()=>{if(!r)return;let u=!0;return _e(r).then(p=>{u&&g(p.status==="ok"?"success":"notfound")}).catch(()=>{u&&g("error")}),()=>{u=!1}},[r]),o.useEffect(()=>{let u=!0;return We().then(p=>{u&&p?.status==="ok"&&p.data&&(N(p.data),A(p.source||"local-fallback"))}).catch(()=>{}),()=>{u=!1}},[]),o.useEffect(()=>{let u=!0;return Ye().then(p=>{u&&p?.status==="ok"&&Array.isArray(p.data)&&p.data.length>0&&b(p.data)}).catch(()=>{}),()=>{u=!1}},[]);const V=o.useCallback(u=>{if(u&&l){const p=ce();p&&v(p)}C("wizard")},[l]),d=o.useCallback(u=>{v(u),ue(),C("results"),window.scrollTo({top:0,behavior:"smooth"})},[]),I=o.useCallback(()=>{v({}),ue(),window.history.replaceState(null,"",window.location.pathname),C("welcome"),window.scrollTo({top:0,behavior:"smooth"})},[]),D=l&&!!ce(),[S,E]=o.useState(!1),[_,U]=o.useState(null),[G,R]=o.useState(()=>{const u=window.matchMedia?.("(display-mode: standalone)")?.matches,p=window.navigator?.standalone===!0;return!!(u||p)});o.useEffect(()=>{const u=()=>E(window.scrollY>400);return window.addEventListener("scroll",u,{passive:!0}),()=>window.removeEventListener("scroll",u)},[]),o.useEffect(()=>{const u=L=>{L.preventDefault(),U(L)},p=()=>{U(null),R(!0)};return window.addEventListener("beforeinstallprompt",u),window.addEventListener("appinstalled",p),()=>{window.removeEventListener("beforeinstallprompt",u),window.removeEventListener("appinstalled",p)}},[]);const $=o.useCallback(async()=>{if(!_)return;_.prompt(),(await _.userChoice)?.outcome==="accepted"&&U(null)},[_]);return o.useEffect(()=>{const u=()=>{n(X())};return window.addEventListener("storage",u),window.addEventListener("crs-account-settings-updated",u),()=>{window.removeEventListener("storage",u),window.removeEventListener("crs-account-settings-updated",u)}},[]),o.useEffect(()=>{document.documentElement.setAttribute("data-motion",a)},[a]),o.useEffect(()=>{const u=document.documentElement,p=window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,L=window.matchMedia?.("(pointer: fine)")?.matches;if(!(a!=="off"&&!p&&!!L)){u.style.setProperty("--pointer-x","50%"),u.style.setProperty("--pointer-y","40%"),u.style.setProperty("--pointer-glow","0");return}u.style.setProperty("--pointer-glow",a==="subtle"?"0.45":"1");let P=0,T=50,M=40,i=50,m=40;const H=()=>{T+=(i-T)*.12,M+=(m-M)*.12,u.style.setProperty("--pointer-x",`${T.toFixed(2)}%`),u.style.setProperty("--pointer-y",`${M.toFixed(2)}%`),Math.abs(i-T)>.05||Math.abs(m-M)>.05?P=window.requestAnimationFrame(H):P=0},se=()=>{P||(P=window.requestAnimationFrame(H))},ae=re=>{i=re.clientX/window.innerWidth*100,m=re.clientY/window.innerHeight*100,se()},ne=()=>{i=50,m=40,se()};return window.addEventListener("pointermove",ae,{passive:!0}),window.addEventListener("pointerleave",ne,{passive:!0}),()=>{window.removeEventListener("pointermove",ae),window.removeEventListener("pointerleave",ne),P&&window.cancelAnimationFrame(P)}},[a]),e.jsxs("div",{className:"app",children:[e.jsxs("div",{className:"anime-bg","aria-hidden":"true",children:[e.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--one"}),e.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--two"}),e.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--three"}),e.jsx("span",{className:"anime-bg-grid"}),e.jsx("span",{className:"anime-bg-noise"}),e.jsx("span",{className:"anime-bg-pointer-glow"}),e.jsx("span",{className:"anime-bg-flare"}),e.jsx("span",{className:"anime-bg-vignette"}),e.jsxs("div",{className:"anime-bg-sparks",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})]}),e.jsx("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"}),e.jsx(Me,{canInstallApp:!G&&!!_,onInstallApp:$,motionIntensity:a}),e.jsx("main",{className:"main",role:"main",id:"main-content",children:e.jsxs(Se,{mode:"wait",children:[f==="welcome"&&e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(J,{})}),children:e.jsx(Ve,{onStart:V,hasSaved:D,drawData:j,drawSource:k,motionIntensity:a},"welcome")}),f==="wizard"&&e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(J,{})}),children:e.jsx(Ge,{onFinish:d,onProgress:l?He:void 0,initialAnswers:h,motionIntensity:a},"wizard")}),f==="unsubscribe"&&e.jsxs("div",{className:"card unsubscribe-card",children:[e.jsx("h3",{children:"Draw alert preferences"}),y==="loading"&&e.jsx("p",{children:"Processing your unsubscribe requestâ€¦"}),y==="success"&&e.jsx("p",{children:"Youâ€™ve been unsubscribed from draw alerts successfully."}),y==="notfound"&&e.jsx("p",{children:"This unsubscribe link is invalid or already inactive."}),y==="error"&&e.jsx("p",{children:"We couldnâ€™t process this request right now. Please try again later."}),e.jsx("button",{type:"button",className:"btn-restart",onClick:()=>C("welcome"),children:"Back to calculator"})]}),f==="results"&&e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(J,{})}),children:e.jsx($e,{answers:h,onRestart:I,drawData:j,drawSource:k,categoryInfo:w,motionIntensity:a},"results")})]})}),e.jsxs("footer",{className:"footer",children:[e.jsxs("p",{children:["Â© ",new Date().getFullYear()," ",t("footer.copy")]}),e.jsxs("p",{className:"footer-legal-links",children:[e.jsx("a",{href:"/terms.html",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:" Â· "}),e.jsx("a",{href:"/privacy.html",children:"Privacy Policy"})]})]}),S&&e.jsx("button",{type:"button",className:"btn-top",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),"aria-label":"Back to top",children:"â†‘"})]})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("[SW] Service Worker registered:",t)}).catch(t=>{console.error("[SW] Service Worker registration failed:",t)})});we.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(be,{children:e.jsx(je,{children:e.jsx(Ae,{children:e.jsx(Xe,{})})})})}));export{J as L,Z as _,Be as a,at as b,Ue as g,B as i,nt as l,X as r,De as s,pe as u};
