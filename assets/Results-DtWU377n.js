import{c as et,a as tt,b as at,d as nt,e as st,f as it,s as rt,g as ot,h as ct,i as lt,j as dt,k as ut,l as ht,m as mt,n as pt,o as ft,p as gt,q as xt,r as Fe,t as q,u as yt,v as We,w as f,x as t,y as x,S as bt,z as kt,A as vt,B as Pe,C as St,D as jt,E as Ct,F as wt,G as Nt,H as Pt,I as Tt,L as _t}from"./index-Cz9R4ZsX.js";const S={tables:{agePoints:nt,educationPoints:st,firstLangPoints:it,secondLangPoints:rt,canadianWorkPoints:ot,spouseEducationPoints:ct,spouseLangPoints:gt,spouseWorkPoints:lt,eduRank:dt,eduLangTransfer:ut,eduCWETransfer:ht,fweLangTransfer:mt,fweCWETransfer:pt,certLangTransfer:xt,additionalPointsTable:ft},converters:{ieltsToCLB:at,tefToNCLC:et,tcfToNCLC:tt},caps:{secondLanguageNoSpouse:24,secondLanguageWithSpouse:22,spouseTotal:40,skillTransferabilityTotal:100,additionalPointsTotal:600,crsTotal:1200}},$e=(e,a,s)=>Math.max(a,Math.min(s,e));function Et(e){const a={...e},s=ee(e)==="french"||e.hasFrench==="yes";if(s&&e.frenchTestType==="tef")for(const n of["listening","reading","writing","speaking"])a[`french_${n}`]=String(S.converters.tefToNCLC(n,parseInt(e[`tef_${n}`],10)||0));else if(s&&e.frenchTestType==="tcf")for(const n of["listening","reading","writing","speaking"])a[`french_${n}`]=String(S.converters.tcfToNCLC(n,parseInt(e[`tcf_${n}`],10)||0));return a}function ee(e){return e.firstOfficialLanguage==="french"?"french":"english"}function ge(e){return ee(e)==="french"||e.hasFrench==="yes"}function te(e){return e.hasSpouse==="yes"&&e.spouseIsCanadian!=="yes"&&e.spouseAccompanying!=="no"}const V=e=>te(e)?1:0;function xe(e,a){if(e.langTestType==="celpip")return $e(parseInt(e[`celpip_${a}`],10)||0,0,12);const s=parseFloat(e[`ielts_${a}`])||0;return S.converters.ieltsToCLB(a,s)}function ye(e,a){return $e(parseInt(e[`french_${a}`],10)||0,0,12)}function Re(e,a){return ee(e)==="french"?ye(e,a):xe(e,a)}function ae(e){const a=["listening","reading","writing","speaking"];let s=99;for(const n of a){const i=Re(e,n);i<s&&(s=i)}return s===99?0:s}function Be(e){const a=["listening","reading","writing","speaking"];let s=99;for(const n of a){const i=xe(e,n);i<s&&(s=i)}return s===99?0:s}function De(e){if(!ge(e))return 0;const a=["listening","reading","writing","speaking"];let s=99;for(const n of a){const i=ye(e,n);i<s&&(s=i)}return s===99?0:s}function Lt(e){const a=ae(e);return a>=9?2:a>=7?1:0}function Mt(e){const a=parseInt(e.canadianWorkExp)||0;return a>=2?2:a>=1?1:0}function At(e){const a=parseInt(e.foreignWorkExp)||0;return a>=3?2:a>=1?1:0}function It(e){let a=parseInt(e.age);return isNaN(a)?0:(a<18&&(a=17),a>47&&(a=47),a>44&&(a=45),S.tables.agePoints[a]?.[V(e)]||0)}function Ft(e){return S.tables.educationPoints[e.education]?.[V(e)]||0}function Wt(e){const a=["listening","reading","writing","speaking"],s=V(e);return a.reduce((n,i)=>{const o=Re(e,i);return n+(S.tables.firstLangPoints[o]?.[s]||0)},0)}function $t(e){const a=ee(e);if(!(a==="french"?e.langTestType==="ielts"||e.langTestType==="celpip":ge(e)))return 0;const n=["listening","reading","writing","speaking"],i=V(e),o=n.reduce((c,m)=>{const h=a==="french"?xe(e,m):ye(e,m);return c+(S.tables.secondLangPoints[h]?.[i]||0)},0);return Math.min(o,i===0?S.caps.secondLanguageNoSpouse:S.caps.secondLanguageWithSpouse)}function Rt(e){let a=parseInt(e.canadianWorkExp)||0;return a>5&&(a=5),S.tables.canadianWorkPoints[a]?.[V(e)]||0}function Bt(e){if(!te(e))return 0;let a=0;a+=S.tables.spouseEducationPoints[e.spouseEducation]||0;const s=["listening","reading","writing","speaking"];let n=0;for(const o of s){const c=parseInt(e[`spouseLang_${o}`])||0;n+=S.tables.spouseLangPoints[c]||0}a+=Math.min(n,20);let i=parseInt(e.spouseCanadianWork)||0;return i>5&&(i=5),a+=S.tables.spouseWorkPoints[i]||0,Math.min(a,S.caps.spouseTotal)}function Dt(e){const a=S.tables.eduRank[e.education]||0,s=Lt(e),n=Mt(e),i=At(e),o=S.tables.eduLangTransfer[a]?.[s]||0,c=S.tables.eduCWETransfer[a]?.[n]||0,m=Math.min(o+c,50),h=S.tables.fweLangTransfer[i]?.[s]||0,p=S.tables.fweCWETransfer[i]?.[n]||0,l=Math.min(h+p,50);let u=0;if(e.pathway==="fst"&&e.hasCertificate==="yes"){const y=ae(e);u=S.tables.certLangTransfer[y>=7?2:y>=5?1:0]}return Math.min(m+l+u,S.caps.skillTransferabilityTotal)}function Ot(e){let a=0;const s=S.tables.additionalPointsTable;return e.hasPNP==="yes"&&(a+=s.pnp_nomination),e.canadianEducation==="yes"&&(a+=e.canadianEduType==="long"?s.canadian_edu_long:s.canadian_edu_short),e.hasSibling==="yes"&&(a+=s.sibling_in_canada),ge(e)&&De(e)>=7&&(a+=Be(e)>=5?s.french_strong_strong_english:s.french_strong_weak_english),Math.min(a,S.caps.additionalPointsTotal)}function Oe(e){const a=Et(e),s=It(a),n=Ft(a),i=Wt(a),o=$t(a),c=Rt(a),m=parseInt(a.foreignWorkExp)||0,h=s+n+i+o+c,p=Bt(a),l=Dt(a),u=Ot(a);return{total:Math.min(h+p+l+u,S.caps.crsTotal),breakdown:{coreHumanCapital:h,spouseFactors:p,skillTransferability:l,additionalPoints:u},details:{age:s,education:n,firstLanguage:i,secondLanguage:o,canadianWork:c,foreignWork:m,spouseTotal:p,skillTotal:l,additionalTotal:u}}}function H(e,a){return Oe({...e,...a})}function $(e,a,s,n,i,o,c=""){return{title:e,description:a,potentialGain:s,difficulty:n,timeframe:i,icon:o,action:c}}function Gt(e,a){const s=[],n=ae(e),i=Be(e),o=e.firstOfficialLanguage==="french"?"french":"english",c=o==="french"||e.hasFrench==="yes";if(n<10){const l=Math.min(n+1,10),u=["listening","reading","writing","speaking"];let y="First official language";const k={};if(o==="french"){y="French (NCLC)",k.hasFrench="yes",k.frenchTestType="clb";for(const N of u){const E=`french_${N}`,T=parseInt(e[E],10)||0;k[E]=String(Math.max(T,l))}}else{y=e.langTestType==="celpip"?"CELPIP":"IELTS";for(const N of u){const E=e.langTestType==="celpip"?`celpip_${N}`:`ielts_${N}`,T=e.langTestType==="celpip"?parseInt(e[E],10)||0:parseFloat(e[E])||0;e.langTestType==="celpip"?k[E]=Math.max(T,l):k[E]=Math.max(T,T+.5)}}const v=H(e,k).total-a.total;v>0&&s.push($(`Improve ${y} Scores`,`Raising your weakest ${y} skill to CLB ${l} could add significant points. Focus on your lowest band.`,v,"Medium","3-5 months","language",`Current min CLB ${n} → target CLB ${l} = +${v} CRS`))}const m=["less_than_secondary","secondary","one_year_post","two_year_post","bachelors","two_or_more","masters","doctoral"],h=m.indexOf(e.education);if(h>=0&&h<m.length-1){const l=m[h+1],y=H(e,{education:l}).total-a.total;if(y>0){const k={secondary:"high school diploma",one_year_post:"1-year diploma",two_year_post:"2-year diploma",bachelors:"bachelor's degree",two_or_more:"two credentials",masters:"master's degree",doctoral:"doctoral degree"};s.push($("Higher Education",`Completing a ${k[l]||"higher credential"} could boost your score.`,y,"Hard","1-4 years","education",`${e.education||"current level"} → ${l} = +${y} CRS`))}}const p=parseInt(e.canadianWorkExp)||0;if(p<5){const u=H(e,{canadianWorkExp:String(p+1)}).total-a.total;u>0&&s.push($("Gain Canadian Work Experience","An additional year of Canadian work experience adds points across multiple categories including skill transferability.",u,"Hard","8-12 months","work",`${p} year(s) → ${p+1} year(s) = +${u} CRS`))}if(c)De(e)>=7&&a.total<520&&a.total>=370&&s.push($("Target French-Language Category Draw",`With your French NCLC 7+ scores, you qualify for French-language category draws where recent cutoffs are around 400 — your score of ${a.total} may already be competitive!`,0,"Easy","Immediate","french",`Current score ${a.total} already fits many French-category cutoffs`));else{const y=H(e,{hasFrench:"yes",french_listening:"7",french_reading:"7",french_writing:"7",french_speaking:"7"}).total-a.total;y>0&&s.push($("Add French Test Results (TEF/TCF)",`Strong French skills (NCLC 7+) earn ${i>=5?"50":"25"} additional CRS points. Plus, French-language category draws have cutoffs around 400 — much lower than general draws (~520).`,y,"Hard","6-12 months","french",`Reach NCLC 7 in all 4 abilities = +${y} CRS`))}if(e.hasPNP!=="yes"&&s.push($("Provincial Nominee Program","A PNP nomination adds 600 points, virtually guaranteeing an ITA. Explore programs in provinces like Ontario, BC, Alberta and Saskatchewan.",600,"Hard","2-8 months","province","PNP nomination = +600 CRS")),e.canadianEducation!=="yes"&&s.push($("Study in Canada","A Canadian credential (1-2 year program) adds 15 points, or 30 points for a 3+ year program.",30,"Hard","12-36 months","study","Canadian credential can add +15 to +30 CRS")),e.hasSibling!=="yes"&&s.push($("Sibling in Canada (If Applicable)","If you have a sibling who is a Canadian citizen or PR, this adds 15 points. Check if any siblings qualify.",15,"Easy","1-2 weeks","family","Eligible sibling relationship = +15 CRS")),te(e)){const l=["listening","reading","writing","speaking"];let u=99;for(const y of l){const k=parseInt(e[`spouseLang_${y}`])||0;k<u&&(u=k)}if(u<9){const y=Math.min(u+1,9),k={};for(const N of l)k[`spouseLang_${N}`]=String(Math.max(parseInt(e[`spouseLang_${N}`])||0,y));const v=H(e,k).total-a.total;v>0&&s.push($("Improve Spouse's Language Scores",`Your spouse's language improvement to CLB ${y} could add points.`,v,"Medium","3-5 months","language",`Spouse min CLB ${u} → ${y} = +${v} CRS`))}}return s.sort((l,u)=>u.potentialGain-l.potentialGain),s}function Yt(e){const a=e.total;return a>=500?{label:"Very Strong",months:"1-3",description:"You are very likely to receive an ITA in the next few draws."}:a>=470?{label:"Strong",months:"3-6",description:"Your score is competitive. An ITA is likely within a few months."}:a>=440?{label:"Moderate",months:"6-12",description:"Your score is near recent cutoffs. Category-based draws may help."}:a>=400?{label:"Below Average",months:"12-18",description:"You may need to improve your profile or target a category-based draw."}:{label:"Needs Improvement",months:"18+",description:"Significant profile improvements are recommended before applying."}}const Ht=[{id:"on",name:"Ontario",abbr:"ON",streams:["Human Capital Priorities","Skilled Trades","French-Speaking"],demandSectors:["stem","healthcare","trade"],minCLB:7,minEducation:"bachelors",minWorkYears:1,notes:"Largest province. Strong demand for tech, healthcare, and skilled trades. Ontario often sends NOIs to Express Entry candidates with CRS 400+."},{id:"bc",name:"British Columbia",abbr:"BC",streams:["Skills Immigration","Express Entry BC","Tech"],demandSectors:["stem","healthcare","trade"],minCLB:5,minEducation:"two_year_post",minWorkYears:1,notes:"Tech hub (Vancouver). BC PNP Tech targets 29 in-demand occupations including software, data, and engineering roles."},{id:"ab",name:"Alberta",abbr:"AB",streams:["Alberta Advantage Immigration","Express Entry Stream"],demandSectors:["trade","healthcare","stem","transport"],minCLB:5,minEducation:"secondary",minWorkYears:1,notes:"Strong energy/oil sector. Growing tech scene in Calgary and Edmonton. Lower cost of living than ON/BC."},{id:"sk",name:"Saskatchewan",abbr:"SK",streams:["International Skilled Worker","Express Entry"],demandSectors:["agriculture","healthcare","trade","transport"],minCLB:4,minEducation:"secondary",minWorkYears:1,notes:"In-Demand Occupations list is broad. One of the easiest PNPs to qualify for. Agriculture and mining are key industries."},{id:"mb",name:"Manitoba",abbr:"MB",streams:["Skilled Workers Overseas","Skilled Workers in Manitoba"],demandSectors:["healthcare","agriculture","trade","transport"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Welcoming to newcomers. Strong need for healthcare workers and tradespeople. Lower CRS requirements than federal draws."},{id:"ns",name:"Nova Scotia",abbr:"NS",streams:["Labour Market Priorities","Skilled Worker","Physician"],demandSectors:["healthcare","trade","stem"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Part of Atlantic Immigration Program. Growing tech sector in Halifax. Healthcare workers are highly sought after."},{id:"nb",name:"New Brunswick",abbr:"NB",streams:["Express Entry Labour Market","Skilled Workers with Employer Support"],demandSectors:["healthcare","trade","agriculture"],minCLB:5,minEducation:"secondary",minWorkYears:1,notes:"Bilingual province (English/French). Part of Atlantic Immigration Program. Francophone candidates get priority."},{id:"pe",name:"Prince Edward Island",abbr:"PE",streams:["Express Entry","Labour Impact"],demandSectors:["agriculture","healthcare","trade"],minCLB:5,minEducation:"two_year_post",minWorkYears:2,notes:"Small province with lower competition. Agriculture and tourism are key industries."},{id:"nl",name:"Newfoundland & Labrador",abbr:"NL",streams:["Express Entry","Skilled Worker","Priority Skills"],demandSectors:["healthcare","trade","stem"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Part of Atlantic Immigration Program. Growing need for healthcare and tech workers. Oil and gas sector."},{id:"yt",name:"Yukon",abbr:"YT",streams:["Yukon Express Entry","Skilled Worker"],demandSectors:["trade","healthcare","transport"],minCLB:4,minEducation:"secondary",minWorkYears:1,notes:"Territory with small population. Job offer typically required. Good for tradespeople and healthcare workers."}],me={less_than_secondary:0,secondary:1,one_year_post:2,two_year_post:3,bachelors:4,two_or_more:5,masters:6,doctoral:7};function Ut(e,a){return(me[e]||0)>=(me[a]||0)}function qt(e){const a=zt(e),s=e.education||"secondary",n=Math.max(parseInt(e.canadianWorkExp)||0,parseInt(e.foreignWorkExp)||0),i=e.occupationCategory||"other",o=e.hasFrench==="yes";return Ht.map(c=>{let m=0;const h=100;a>=c.minCLB&&(m+=20,a>=c.minCLB+2&&(m+=10)),Ut(s,c.minEducation)&&(m+=15,(me[s]||0)>=4&&(m+=5)),n>=c.minWorkYears&&(m+=15,n>=3&&(m+=5)),c.demandSectors.includes(i)&&(m+=25),o&&(c.id==="nb"||c.id==="on")&&(m+=5);const p=Math.min(Math.round(m/h*100),100);return{...c,matchScore:p}}).sort((c,m)=>m.matchScore-c.matchScore)}function zt(e){if(e.langTestType==="celpip"){const s=["listening","reading","writing","speaking"].map(n=>parseInt(e[`celpip_${n}`])||0);return Math.min(...s)}if(e.langTestType==="ielts"){const s=["listening","reading","writing","speaking"].map(n=>{const i=parseFloat(e[`ielts_${n}`])||0;return i>=8?10:i>=7?9:i>=6.5?8:i>=6?7:i>=5.5?6:i>=5?5:i>=4?4:0});return Math.min(...s)}return 0}const le=["less_than_secondary","secondary","one_year_post","two_year_post","bachelors","two_or_more","masters","doctoral"],Kt={Easy:14,Medium:7,Hard:0},Ge={high:78,medium:58,low:35};function pe(e,a,s){return Math.max(a,Math.min(s,e))}function Vt(e,a=Fe.averageCutoff){return Math.max(a+10,e+25)}function Jt(e,a){return{listening:{7:6,8:7.5,9:8,10:8.5},reading:{7:6,8:6.5,9:7,10:8},writing:{7:6,8:6.5,9:7,10:7.5},speaking:{7:6,8:6.5,9:7,10:7.5}}[e]?.[a]||0}function Xt(e,a){if(e.firstOfficialLanguage==="french"){const n=["listening","reading","writing","speaking"],i={hasFrench:"yes",frenchTestType:"clb"};for(const o of n){const c=`french_${o}`;i[c]=String(Math.max(parseInt(e[c],10)||0,a))}return i}const s=["listening","reading","writing","speaking"];if(e.langTestType==="celpip"){const n={};for(const i of s){const o=`celpip_${i}`;n[o]=String(Math.max(parseInt(e[o],10)||0,a))}return n}if(e.langTestType==="ielts"){const n={};for(const i of s){const o=`ielts_${i}`,c=Jt(i,a);n[o]=String(Math.max(parseFloat(e[o])||0,c))}return n}return{langTestType:"celpip",celpip_listening:String(a),celpip_reading:String(a),celpip_writing:String(a),celpip_speaking:String(a)}}function Qt(e,a=7){const s={listening:parseInt(e.french_listening,10)||0,reading:parseInt(e.french_reading,10)||0,writing:parseInt(e.french_writing,10)||0,speaking:parseInt(e.french_speaking,10)||0};return{hasFrench:"yes",frenchTestType:"clb",french_listening:String(Math.max(s.listening,a)),french_reading:String(Math.max(s.reading,a)),french_writing:String(Math.max(s.writing,a)),french_speaking:String(Math.max(s.speaking,a))}}function Zt({pathId:e,gain:a,months:s,steps:n}){return n.map((i,o)=>({id:`${e}-m${o+1}`,title:i.title,details:i.details,etaWeeks:i.etaWeeks,expectedGain:o===n.length-1?Math.max(a-n.slice(0,-1).reduce((c,m)=>c+m.expectedGain,0),0):i.expectedGain,done:!1,monthHint:pe(Math.ceil((i.etaWeeks||1)/4),1,s)}))}function Ye({gain:e,months:a,difficulty:s,goalReached:n,likelihood:i}){const o=pe(24-a*2,0,24),c=pe(Math.round(e/4),0,80),m=n?32:0,h=Math.round((Ge[i]||0)/3);return c+o+m+h+(Kt[s]||0)}function z({id:e,title:a,summary:s,category:n,difficulty:i,months:o,estimatedCostCad:c,whyItFits:m,likelihood:h="medium",overrides:p,currentScore:l,targetScore:u,milestoneSteps:y}){const k=H(p.baseAnswers,p.patch),L=k.total-l;if(L<=0)return null;const v=k.total>=u,N=Zt({pathId:e,gain:L,months:o,steps:y});return{id:e,title:a,summary:s,category:n,difficulty:i,estimatedMonths:o,estimatedCostCad:c,projectedScore:k.total,potentialGain:L,goalReached:v,whyItFits:m,likelihood:h,likelihoodPercent:Ge[h]||50,fitScore:Ye({gain:L,months:o,difficulty:i,goalReached:v,likelihood:h}),milestones:N,checks:{targetScore:u,currentScore:l,stillNeededAfterPath:Math.max(u-k.total,0)}}}function ea(e,a,s){const n=ae(e);if(n>=10)return null;const i=n<7?8:9,o=e.firstOfficialLanguage==="french"?"french":"english",c=o==="french"?"French Accelerator Path":"English Accelerator Path",m=o==="french"?"Raise your weakest French ability first, then target NCLC 9+ for stronger transferability outcomes.":"Raise your weakest English ability first, then target CLB 9+ for transferability gains.";return z({id:`${o}-accelerator`,title:c,summary:m,category:"Language",difficulty:"Medium",months:4,estimatedCostCad:460,whyItFits:`Your current minimum first-official-language level is CLB/NCLC ${n}, so language gains are one of the fastest realistic boosters.`,likelihood:"high",overrides:{baseAnswers:e,patch:Xt(e,i)},currentScore:a,targetScore:s,milestoneSteps:[{title:"Baseline audit and weak-skill diagnosis",details:"Run a mock test and identify the lowest 2 abilities to prioritize.",etaWeeks:1,expectedGain:0},{title:"Targeted study sprint",details:"Follow a 5-day weekly schedule focused on weakest modules and timed drills.",etaWeeks:6,expectedGain:8},{title:"Exam booking + strategy correction",details:"Book IELTS/CELPIP and fine-tune pacing, vocabulary, and response format.",etaWeeks:4,expectedGain:8},{title:"Retake and profile refresh",details:"Update final language scores in your profile and reassess draw competitiveness.",etaWeeks:4,expectedGain:12}]})}function ta(e,a,s){return e.firstOfficialLanguage==="french"?null:z({id:"french-advantage",title:"French Advantage Path",summary:"Reach NCLC 7 in all French abilities to unlock additional points and French-category draw access.",category:"Language",difficulty:"Hard",months:8,estimatedCostCad:690,whyItFits:"French pathways remain one of the highest-yield options for many candidates below general cutoffs.",likelihood:e.hasFrench==="yes"?"high":"medium",overrides:{baseAnswers:e,patch:Qt(e,7)},currentScore:a,targetScore:s,milestoneSteps:[{title:"French baseline + study plan",details:"Assess current level and choose a structured curriculum for NCLC 7 goal.",etaWeeks:2,expectedGain:0},{title:"Core skill build phase",details:"Intensive reading/listening practice with weekly speaking/writing correction.",etaWeeks:12,expectedGain:8},{title:"TEF/TCF prep and mock cycles",details:"Complete timed mocks and focus weak modules before exam booking.",etaWeeks:8,expectedGain:8},{title:"Exam and score integration",details:"Enter verified NCLC scores and evaluate French-category competitiveness.",etaWeeks:6,expectedGain:12}]})}function aa(e,a,s){const n=parseInt(e.canadianWorkExp,10)||0;return n>=5?null:z({id:"canadian-work-ladder",title:"Canadian Work Ladder Path",summary:"Add one more year of Canadian skilled work to increase core and transferability points.",category:"Work Experience",difficulty:"Hard",months:12,estimatedCostCad:0,whyItFits:`You currently report ${n} year(s) of Canadian work; the next year can materially lift your score.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{canadianWorkExp:String(n+1)}},currentScore:a,targetScore:s,milestoneSteps:[{title:"Employer alignment",details:"Confirm TEER eligibility and maintain full-time skilled role continuity.",etaWeeks:2,expectedGain:0},{title:"Documentation discipline",details:"Collect monthly pay records and letters for future proof of experience.",etaWeeks:16,expectedGain:4},{title:"Mid-year score checkpoint",details:"Recalculate progress and combine with language upgrades if needed.",etaWeeks:24,expectedGain:6},{title:"Complete one full year increment",details:"Update profile immediately when additional year is met.",etaWeeks:52,expectedGain:12}]})}function na(e,a,s){const n=le.indexOf(e.education);if(n<0||n>=le.length-1)return null;const i=le[n+1];return z({id:"education-upgrade",title:"Education Upgrade Path",summary:"Move to the next recognized credential tier for predictable CRS uplift.",category:"Education",difficulty:"Hard",months:18,estimatedCostCad:12e3,whyItFits:`Your current education level can be improved to ${i.replace(/_/g," ")} for additional points.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{education:i}},currentScore:a,targetScore:s,milestoneSteps:[{title:"Program selection",details:"Choose an accredited credential path aligned to CRS point tiers.",etaWeeks:4,expectedGain:0},{title:"Enrollment and milestone completion",details:"Track term-level progress to keep the plan on schedule.",etaWeeks:20,expectedGain:4},{title:"Credential completion prep",details:"Prepare final documents and ECA requirements where needed.",etaWeeks:20,expectedGain:4},{title:"Credential update in profile",details:"Add completed credential and recalculate total score immediately.",etaWeeks:28,expectedGain:10}]})}function sa(e,a,s){if(!te(e))return null;const n=["listening","reading","writing","speaking"],i={};for(const o of n){const c=`spouseLang_${o}`;i[c]=String(Math.max(parseInt(e[c],10)||0,9))}return z({id:"spouse-optimization",title:"Spouse Optimization Path",summary:"Use spouse language and experience factors for faster low-cost point improvements.",category:"Family Factors",difficulty:"Medium",months:5,estimatedCostCad:420,whyItFits:"You have an accompanying spouse, so spouse-factor optimization is available and often underused.",likelihood:"high",overrides:{baseAnswers:e,patch:i},currentScore:a,targetScore:s,milestoneSteps:[{title:"Spouse baseline review",details:"Identify spouse factors currently missing points.",etaWeeks:1,expectedGain:0},{title:"Spouse language prep",details:"Prepare specifically for CLB 9 in the weakest spouse abilities.",etaWeeks:8,expectedGain:4},{title:"Spouse profile integration",details:"Update spouse test scores and re-optimize joint profile configuration.",etaWeeks:6,expectedGain:8}]})}function ia(e,a,s){return e.hasPNP==="yes"?null:z({id:"pnp-fast-track",title:"PNP Fast-Track Path",summary:"Pursue provincial nomination for the largest single CRS jump (+600).",category:"Provincial",difficulty:"Hard",months:6,estimatedCostCad:2200,whyItFits:"If your baseline is below recent cutoffs, PNP remains the most direct guaranteed-lift route.",likelihood:"medium",overrides:{baseAnswers:e,patch:{hasPNP:"yes"}},currentScore:a,targetScore:s,milestoneSteps:[{title:"Province shortlist",details:"Match your profile to provinces aligned with occupation/language strengths.",etaWeeks:2,expectedGain:0},{title:"Document stack preparation",details:"Prepare references, test proofs, ECA, and provincial forms early.",etaWeeks:6,expectedGain:0},{title:"Submit nomination stream",details:"Apply to selected stream and monitor NOI/application updates.",etaWeeks:8,expectedGain:0},{title:"Nomination linked to profile",details:"Accept nomination and refresh profile for major score jump.",etaWeeks:8,expectedGain:600}]})}function ra(e,a){const s=[...e].sort((h,p)=>p.fitScore-h.fitScore);if(s.length<2)return null;const[n,i]=s,o=Math.min(n.projectedScore+i.potentialGain,1200),c=o-n.checks.currentScore;if(c<=0)return null;const m=o>=a;return{id:"combo-bridge-plan",title:"Bridge Combination Path",summary:`Combine “${n.title}” + “${i.title}” to maximize speed while limiting risk.`,category:"Combination",difficulty:n.difficulty==="Hard"||i.difficulty==="Hard"?"Hard":"Medium",estimatedMonths:Math.round((n.estimatedMonths+i.estimatedMonths)/2),estimatedCostCad:n.estimatedCostCad+i.estimatedCostCad,projectedScore:o,potentialGain:c,goalReached:m,whyItFits:"A blended route often reaches target faster than single-track attempts.",likelihood:"medium",likelihoodPercent:62,fitScore:Ye({gain:c,months:Math.round((n.estimatedMonths+i.estimatedMonths)/2),difficulty:n.difficulty==="Hard"||i.difficulty==="Hard"?"Hard":"Medium",goalReached:m,likelihood:"medium"}),milestones:[...n.milestones.slice(0,2).map(h=>({...h,id:`combo-${h.id}`})),...i.milestones.slice(0,2).map(h=>({...h,id:`combo-${h.id}`})),{id:"combo-final-sync",title:"Final score synchronization",details:"Update all achieved improvements together and reassess draw strategy.",etaWeeks:4,expectedGain:Math.max(c-16,0),done:!1,monthHint:2}],checks:{targetScore:a,currentScore:n.checks.currentScore,stillNeededAfterPath:Math.max(a-o,0)}}}function oa(e,a,s={}){const n=a?.total||0,i=Number(s.averageCutoff)||Fe.averageCutoff,o=Number(s.targetScore)||Vt(n,i),c=[ea(e,n,o),ta(e,n,o),aa(e,n,o),na(e,n,o),sa(e,n,o),ia(e,n,o)].filter(Boolean),m=ra(c,o);m&&c.push(m);const h=c.sort((p,l)=>l.fitScore-p.fitScore).slice(0,5);return{currentScore:n,targetScore:o,plans:h,generatedAt:new Date().toISOString()}}const He="crs-path-tracking-v1";function be(){try{const e=localStorage.getItem(He);if(!e)return{};const a=JSON.parse(e);return a&&typeof a=="object"?a:{}}catch{return{}}}function Ue(e){try{localStorage.setItem(He,JSON.stringify(e))}catch{}}function qe(e,a){const s=new Date(e||Date.now());return s.setDate(s.getDate()+a),s.toISOString()}function ca(e=null,a=null){return e?`user:${e}`:a?`profile:${a}`:"guest:default"}function Te(e){return e&&be()[e]||null}function _e(e,a){if(!e||!a)return a;const s=be();return s[e]=a,Ue(s),a}function la(e){if(!e)return;const a=be();delete a[e],Ue(a)}function da(e,a,s){const n=new Date().toISOString(),i=(e?.milestones||[]).map(o=>({...o,done:!1,completedAt:null}));return{id:`track_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`,status:"active",startedAt:n,updatedAt:n,nextCheckInAt:qe(n,7),currentScore:Number(a)||0,targetScore:Number(s)||Number(e?.checks?.targetScore)||0,selectedPath:e,milestones:i,notes:[]}}function Ee(e){const a=e?.milestones||[];if(!a.length)return 0;const s=a.filter(n=>n.done).length;return Math.round(s/a.length*100)}function ua(e,a){if(!e)return e;const s=(e.milestones||[]).map(i=>{if(i.id!==a)return i;const o=!i.done;return{...i,done:o,completedAt:o?new Date().toISOString():null}}),n=s.length?s.filter(i=>i.done).length/s.length:0;return{...e,milestones:s,status:n>=1?"completed":"active",updatedAt:new Date().toISOString()}}function de(e,a){return e&&{...e,currentScore:a,updatedAt:new Date().toISOString()}}function ha(e,a=7){if(!e)return e;const s=e.nextCheckInAt||new Date().toISOString();return{...e,nextCheckInAt:qe(s,a),updatedAt:new Date().toISOString()}}function ma(e,a){if(!e||!a?.trim())return e;const s=[...e.notes||[],{id:`note_${Date.now().toString(36)}`,text:a.trim(),createdAt:new Date().toISOString()}];return{...e,notes:s,updatedAt:new Date().toISOString()}}function pa(e){if(!e)return"Choose a path to get a week-by-week action plan.";if(e.status==="completed")return"Great progress — this path is completed. Recalculate and pick your next upgrade path if needed.";const a=(e.milestones||[]).find(s=>!s.done);return a?`Next best action: ${a.title}. Focus on this before adding new goals.`:"Your milestone list is complete. Refresh your score and plan the next targeted move."}function ke(e,a){const s=String(e?.message||"");return new RegExp(`relation\\s+["']?public\\.${a}["']?\\s+does not exist`,"i").test(s)||new RegExp(`table\\s+["']?${a}["']?\\s+not found`,"i").test(s)}function ve(e,a){return new Error(`${e}: ${a?.message||a?.hint||String(a)}`)}function fe(){return new Date().toISOString()}function Se(){return yt&&!!q}function fa(e){if(!e)return!1;const a=new Set(["active","trialing","paid"]),s=String(e.status||"").toLowerCase();if(!a.has(s))return!1;if(!e.current_period_end)return!0;const n=new Date(e.current_period_end).getTime();return Number.isFinite(n)&&n>Date.now()}async function Le(e){if(!e)return{status:"skipped",reason:"Missing user id",active:!1};if(!Se())return{status:"skipped",reason:"Supabase env vars are not configured",active:!1};const{data:a,error:s}=await q.from("user_tracking_access").select("*").eq("user_id",e).limit(1);if(s&&ke(s,"user_tracking_access"))return{status:"skipped",reason:"Tracking access table missing. Run the latest supabase/schema.sql.",active:!1};if(s)throw ve("Failed to fetch tracking access",s);const n=a?.[0]||null;return{status:"ok",row:n,active:fa(n)}}async function ga(e,a){if(!e||!a)return{status:"skipped",reason:"Missing user id or tracking payload"};if(!Se())return{status:"skipped",reason:"Supabase env vars are not configured"};const s={id:a.id,user_id:e,path_id:a.selectedPath?.id||null,target_score:Number(a.targetScore)||0,start_score:Number(a.selectedPath?.checks?.currentScore)||0,current_score:Number(a.currentScore)||0,status:a.status||"active",progress_pct:Number.isFinite(a.progressPct)?a.progressPct:0,next_check_in_at:a.nextCheckInAt||null,milestones_json:a.milestones||[],plan_json:a.selectedPath||{},notes_json:a.notes||[],updated_at:fe()},{data:n,error:i}=await q.from("user_path_tracking").upsert(s,{onConflict:"id"}).select();if(i&&ke(i,"user_path_tracking"))return{status:"skipped",reason:"Path tracking table missing. Run the latest supabase/schema.sql."};if(i)throw ve("Failed to save path tracking",i);return{status:"ok",data:n?.[0]||null}}async function xa(e){if(!e)return{status:"skipped",reason:"Missing user id"};if(!Se())return{status:"skipped",reason:"Supabase env vars are not configured"};const{data:a,error:s}=await q.from("user_path_tracking").select("*").eq("user_id",e).order("updated_at",{ascending:!1}).limit(1);if(s&&ke(s,"user_path_tracking"))return{status:"skipped",reason:"Path tracking table missing. Run the latest supabase/schema.sql.",data:null};if(s)throw ve("Failed to load path tracking",s);const n=a?.[0]||null;return n?{status:"ok",data:{id:n.id,status:n.status||"active",startedAt:n.created_at||fe(),updatedAt:n.updated_at||fe(),nextCheckInAt:n.next_check_in_at||null,currentScore:n.current_score||0,targetScore:n.target_score||0,selectedPath:n.plan_json||null,milestones:Array.isArray(n.milestones_json)?n.milestones_json:[],notes:Array.isArray(n.notes_json)?n.notes_json:[]}}:{status:"ok",data:null}}function ya(e){if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?"—":a.toLocaleDateString()}function ba(e){const a=String(e||"").toLowerCase();return a==="easy"?"path-diff-easy":a==="hard"?"path-diff-hard":"path-diff-medium"}function ka({answers:e,result:a,averageCutoff:s}){const{user:n,isAuthenticated:i}=We(),o=void 0,[c,m]=f.useState(()=>Math.max((a?.total||0)+25,500)),[h,p]=f.useState(""),[l,u]=f.useState(null),[y,k]=f.useState(""),[L,v]=f.useState(""),[N,E]=f.useState(!1),[T,R]=f.useState({loading:!1,active:!1,reason:""}),F=f.useMemo(()=>ca(n?.id||null,null),[n?.id]),I=f.useMemo(()=>oa(e,a,{targetScore:c,averageCutoff:s}),[e,a,c,s]),M=f.useMemo(()=>I.plans.find(d=>d.id===h)||I.plans[0]||null,[I.plans,h]);f.useEffect(()=>{let d=!0;return queueMicrotask(()=>{if(!d)return;const g=Te(F);u(g?de(g,a.total):null)}),()=>{d=!1}},[a.total,F]),f.useEffect(()=>{if(!i||!n?.id)return;let d=!0;return Le(n.id).then(g=>{d&&R({loading:!1,active:!!g.active,reason:g.reason||""})}).catch(g=>{d&&R({loading:!1,active:!1,reason:g.message||"Could not verify tracking access."})}),()=>{d=!1}},[i,n?.id]),f.useEffect(()=>{if(!i||!n?.id)return;let d=!0;return xa(n.id).then(g=>{if(!d||g.status!=="ok"||!g.data)return;const _=Te(F),W=new Date(g.data.updatedAt||0).getTime(),C=new Date(_?.updatedAt||0).getTime();(!_||W>C)&&(_e(F,g.data),u(de(g.data,a.total)))}).catch(()=>{}),()=>{d=!1}},[i,a.total,F,n?.id]);const w=i&&T.active,J=Ee(l),X=pa(l),A=async d=>{const g=de(d,a.total);if(g.progressPct=Ee(g),_e(F,g),u(g),i&&w&&n?.id)try{await ga(n.id,g)}catch{}return g},Q=async()=>{if(!M)return;if(!w){v("Tracking is available on the 5 CAD/month plan.");return}const d=da(M,a.total,c);await A(d),v("Path tracking started. Follow the first milestone this week.")},Z=async d=>{if(!l||!w)return;const g=ua(l,d);await A(g),v("Milestone progress updated.")},D=async()=>{if(!l||!w)return;const d=ha(l,7);await A(d),v("Next check-in moved by 7 days.")},ne=async()=>{if(!l||!w)return;const d=y.trim();if(!d)return;const g=ma(l,d);await A(g),k(""),v("Coach note saved.")},K=()=>{la(F),u(null),v("Tracking reset. Choose a path to start again.")},U=async()=>{if(!i||!n?.id){v("Please log in before subscribing.");return}E(!0),v("");try{if(!q)throw new Error("Supabase client is not configured.");const{data:d,error:g}=await q.functions.invoke("create-tracking-checkout",{body:{source:"path-coach"}});if(g)throw g;const _=d?.url;if(!_)throw new Error("Checkout function returned no URL.");window.location.href=_,v("Opening secure checkout...")}catch(d){v(d.message||"Could not start subscription checkout.")}finally{E(!1)}};return t.jsxs(x.div,{className:"card path-coach-card",initial:{opacity:0,y:18},animate:{opacity:1,y:0},children:[t.jsxs("div",{className:"path-coach-head",children:[t.jsx("h3",{children:"Goal Path Coach (Most Important)"}),t.jsx("span",{className:"path-pill",children:"Detailed"})]}),t.jsx("p",{className:"cat-intro",children:"Pick the most suitable path for your situation, then track weekly milestones with guided assistance."}),t.jsxs("div",{className:"path-target-row",children:[t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Target score"}),t.jsx("input",{type:"number",min:"300",max:"1200",value:c,onChange:d=>m(Number(d.target.value)||I.targetScore)})]}),t.jsxs("div",{className:"path-target-meta",children:[t.jsxs("small",{children:["Current: ",I.currentScore]}),t.jsxs("small",{children:["Gap: ",Math.max(c-I.currentScore,0)]})]})]}),t.jsx("div",{className:"path-grid",children:I.plans.map(d=>t.jsxs(x.button,{className:`path-option ${M?.id===d.id?"selected":""}`,onClick:()=>p(d.id),whileHover:{y:-3},whileTap:{scale:.98},children:[t.jsxs("div",{className:"path-option-head",children:[t.jsx("strong",{children:d.title}),t.jsx("span",{className:`path-diff ${ba(d.difficulty)}`,children:d.difficulty})]}),t.jsx("p",{children:d.summary}),t.jsxs("div",{className:"path-stats",children:[t.jsxs("span",{children:["+",d.potentialGain," pts"]}),t.jsxs("span",{children:[d.estimatedMonths," months"]}),t.jsxs("span",{children:[d.likelihoodPercent,"% likely"]})]}),t.jsx("small",{children:d.goalReached?"Can hit target alone":`Still need ${d.checks.stillNeededAfterPath} pts after this path`})]},d.id))}),M&&t.jsxs("div",{className:"path-detail",children:[t.jsx("h4",{children:M.title}),t.jsx("p",{className:"path-why",children:M.whyItFits}),t.jsxs("div",{className:"path-meta-line",children:[t.jsxs("span",{children:["Projected score: ",t.jsx("strong",{children:M.projectedScore})]}),t.jsxs("span",{children:["Estimated cost: ",t.jsxs("strong",{children:[M.estimatedCostCad," CAD"]})]})]}),t.jsx("ul",{className:"path-milestones-preview",children:M.milestones.map(d=>t.jsxs("li",{children:[t.jsx("span",{children:d.title}),t.jsxs("small",{children:["~",d.etaWeeks," weeks"]})]},d.id))})]}),!i&&t.jsx("div",{className:"path-paywall",children:t.jsx("p",{children:"Login first, then activate paid tracking (5 CAD/month) to unlock weekly coaching and cloud sync."})}),i&&!w&&t.jsxs("div",{className:"path-paywall",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Tracking plan:"})," 5 CAD / month"]}),t.jsx("p",{children:"This includes guided path tracking, milestone reminders, and cross-device progress sync."}),t.jsxs("div",{className:"path-pay-actions",children:[t.jsx("button",{className:"action-btn auth-btn-primary",disabled:N,onClick:U,children:N?"Opening...":"Subscribe (5 CAD/month)"}),t.jsx("button",{className:"action-btn",onClick:async()=>{if(n?.id){R(d=>({...d,loading:!0}));try{const d=await Le(n.id);R({loading:!1,active:!!d.active,reason:d.reason||""}),v(d.active?"Subscription detected. Tracking unlocked.":"Subscription not active yet.")}catch(d){R({loading:!1,active:!1,reason:d.message||""})}}},children:T.loading?"Checking...":"Refresh payment status"}),o]}),T.reason&&t.jsx("small",{children:T.reason})]}),t.jsxs("div",{className:"path-actions",children:[t.jsx(bt,{color:"var(--primary)",speed:"5s",children:t.jsx("button",{className:"btn-next finish",type:"button",onClick:Q,children:l?"Switch to this path":"Start this path"})}),l&&t.jsx("button",{className:"btn-toggle",type:"button",onClick:K,children:"Reset tracking"})]}),l&&t.jsxs("div",{className:"path-tracker",children:[t.jsxs("div",{className:"path-progress-head",children:[t.jsxs("strong",{children:["Progress: ",J,"%"]}),t.jsxs("span",{children:["Next check-in: ",ya(l.nextCheckInAt)]})]}),t.jsx("div",{className:"path-progress-bar-wrap",children:t.jsx(x.div,{className:"path-progress-bar",initial:{width:0},animate:{width:`${J}%`},transition:{duration:.7}})}),t.jsxs("div",{className:"path-coach-note",children:[t.jsx("strong",{children:"Coach guidance:"})," ",X]}),t.jsx("ul",{className:"path-milestone-list",children:(l.milestones||[]).map(d=>t.jsxs("li",{className:d.done?"done":"",children:[t.jsx("button",{type:"button",onClick:()=>Z(d.id),disabled:!w,children:d.done?"✓":"○"}),t.jsxs("div",{children:[t.jsx("strong",{children:d.title}),t.jsx("p",{children:d.details}),t.jsxs("small",{children:["Expected impact: +",d.expectedGain," pts · ~",d.etaWeeks," weeks"]})]})]},d.id))}),t.jsx("div",{className:"path-checkin-row",children:t.jsx("button",{className:"action-btn",type:"button",onClick:D,disabled:!w,children:"Move next check-in by 7 days"})}),t.jsxs("div",{className:"path-note-input",children:[t.jsx("input",{type:"text",value:y,onChange:d=>k(d.target.value),placeholder:"Add blocker or update note for your next check-in..."}),t.jsx("button",{className:"action-btn",type:"button",onClick:ne,disabled:!w,children:"Save note"})]})]}),L&&t.jsx("p",{className:"save-status",children:L})]})}const Me={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.08}}},j={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{type:"spring",stiffness:100,damping:18}}};function va({value:e,duration:a=1.2}){const[s,n]=f.useState(0);return f.useEffect(()=>{const i=e,o=performance.now(),c=m=>{const h=(m-o)/(a*1e3);if(h>=1){n(i);return}const p=1-Math.pow(1-h,3);n(Math.round(i*p)),requestAnimationFrame(c)};requestAnimationFrame(c)},[e,a]),t.jsx(t.Fragment,{children:s})}function Sa({score:e,statusColor:a}){const n=2*Math.PI*54,i=Math.min(e/1200,1);return t.jsxs("div",{className:"score-gauge","aria-label":`CRS Score: ${e} out of 1200`,children:[t.jsxs("svg",{viewBox:"0 0 120 120",width:"180",height:"180",children:[t.jsx("circle",{cx:"60",cy:"60",r:54,fill:"none",stroke:"var(--surface-2)",strokeWidth:"8"}),t.jsx(x.circle,{cx:"60",cy:"60",r:54,fill:"none",stroke:a,strokeWidth:"8",strokeLinecap:"round",transform:"rotate(-90 60 60)",strokeDasharray:n,initial:{strokeDashoffset:n},animate:{strokeDashoffset:n-i*n},transition:{duration:1.4,ease:[.22,1,.36,1]}})]}),t.jsxs("div",{className:"gauge-text",children:[t.jsx("div",{className:"gauge-number","aria-live":"polite",children:t.jsx(va,{value:e})}),t.jsx("div",{className:"gauge-max",children:"/ 1,200"})]})]})}function ja({icon:e,label:a,value:s,max:n,note:i}){const o=Math.round(s/n*100);return t.jsxs(x.div,{className:"bd-item",variants:j,children:[t.jsx("span",{className:"bd-icon",children:e}),t.jsxs("div",{className:"bd-info",children:[t.jsxs("div",{className:"bd-top",children:[t.jsxs("span",{className:"bd-label",children:[a,i&&t.jsxs("small",{className:"bd-note",children:[" (",i,")"]})]}),t.jsxs("span",{className:"bd-pts",children:[s," ",t.jsxs("small",{children:["/ ",n]})]})]}),t.jsx("div",{className:"bd-bar-bg",children:t.jsx(x.div,{className:"bd-bar-fill",initial:{width:0},animate:{width:`${o}%`},transition:{duration:.8,delay:.3,ease:"easeOut"}})})]})]})}function ue({draw:e,userScore:a}){const s=a>=e.score;return t.jsxs("div",{className:`draw-row ${s?"draw-above":"draw-below"}`,children:[t.jsx("span",{className:"draw-date",children:e.date}),t.jsx("span",{className:"draw-program",children:e.program}),t.jsx("span",{className:"draw-score",children:e.score})]})}const Ca=[{value:"secondary",label:"High School"},{value:"one_year_post",label:"1-Year Diploma"},{value:"two_year_post",label:"2-Year Diploma"},{value:"bachelors",label:"Bachelor's"},{value:"two_or_more",label:"2+ Credentials"},{value:"masters",label:"Master's"},{value:"doctoral",label:"PhD"}];function he(e,a,s){return{id:e,label:a,age:s.age||"",education:s.education||"",canadianWorkExp:s.canadianWorkExp||"0",minClb:""}}function wa(e){return{5:5,6:5.5,7:6,8:6.5,9:7,10:7.5}[e]||0}function Na(e,a){const s={};if(a.age&&a.age!==e.age&&(s.age=a.age),a.education&&a.education!==e.education&&(s.education=a.education),a.canadianWorkExp&&a.canadianWorkExp!==e.canadianWorkExp&&(s.canadianWorkExp=a.canadianWorkExp),a.minClb){const n=parseInt(a.minClb,10),i=["listening","reading","writing","speaking"];if(e.langTestType==="celpip")for(const o of i){const c=`celpip_${o}`;s[c]=String(Math.max(parseInt(e[c],10)||0,n))}else{const o=wa(n);for(const c of i){const m=`ielts_${c}`;s[m]=String(Math.max(parseFloat(e[m])||0,o))}}}return Object.keys(s).length===0?null:H(e,s)}function Pa({answers:e,originalScore:a,t:s}){const[n,i]=f.useState(()=>[he("a","Scenario A",e),he("b","Scenario B",e)]),o=()=>{n.length>=3||i(h=>[...h,he("c","Scenario C",e)])},c=h=>{n.length<=2||i(p=>p.filter(l=>l.id!==h))},m=(h,p)=>{i(l=>l.map(u=>u.id===h?{...u,...p}:u))};return t.jsxs("div",{className:"scenario-panel",children:[t.jsx("div",{className:"scenario-grid",children:n.map(h=>{const p=Na(e,h),l=p?p.total-a:0;return t.jsxs("div",{className:"scenario-card",children:[t.jsxs("div",{className:"scenario-head",children:[t.jsx("strong",{children:h.label}),h.id==="c"&&t.jsx("button",{type:"button",className:"scenario-remove",onClick:()=>c(h.id),children:"Remove"})]}),t.jsxs("div",{className:"wi-grid",children:[t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Age"}),t.jsxs("select",{value:h.age,onChange:u=>m(h.id,{age:u.target.value}),children:[t.jsx("option",{value:"",children:"Current"}),Array.from({length:30},(u,y)=>y+18).map(u=>t.jsx("option",{value:u,children:u},u))]})]}),t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Education"}),t.jsxs("select",{value:h.education,onChange:u=>m(h.id,{education:u.target.value}),children:[t.jsx("option",{value:"",children:"Current"}),Ca.map(u=>t.jsx("option",{value:u.value,children:u.label},u.value))]})]}),t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Canadian Work (yrs)"}),t.jsx("select",{value:h.canadianWorkExp,onChange:u=>m(h.id,{canadianWorkExp:u.target.value}),children:[0,1,2,3,4,5].map(u=>t.jsx("option",{value:u,children:u},u))})]}),t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Min Language CLB"}),t.jsxs("select",{value:h.minClb,onChange:u=>m(h.id,{minClb:u.target.value}),children:[t.jsx("option",{value:"",children:"Current"}),[5,6,7,8,9,10].map(u=>t.jsxs("option",{value:u,children:["CLB ",u,"+"]},u))]})]})]}),p&&t.jsx(x.div,{className:"wi-result",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:t.jsxs("div",{className:"wi-scores",children:[t.jsxs("div",{className:"wi-score-block",children:[t.jsx("small",{children:s("results.original")}),t.jsx("strong",{children:a})]}),t.jsx("span",{className:"wi-arrow",children:"→"}),t.jsxs("div",{className:"wi-score-block projected",children:[t.jsx("small",{children:s("results.projected")}),t.jsx("strong",{children:p.total})]}),t.jsxs("span",{className:`wi-delta ${l>0?"pos":l<0?"neg":""}`,children:[l>0?"+":"",l," pts"]})]})})]},h.id)})}),n.length<3&&t.jsx("button",{type:"button",className:"btn-toggle scenario-add-btn",onClick:o,children:"Add Scenario C ▼"})]})}function Ta(){return t.jsx(x.div,{className:"loading-screen",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,scale:.95,transition:{duration:.3}},children:t.jsx(_t,{})})}function _a(e){const a=f.useRef(null);return f.useEffect(()=>{if(!e)return;const s=a.current;if(!s)return;const n=s.getContext("2d");s.width=window.innerWidth,s.height=window.innerHeight;const i=["#22c55e","#4CC9F0","#7C3AED","#f59e0b","#ec4899","#3A0CA3"],o=Array.from({length:120},()=>({x:Math.random()*s.width,y:Math.random()*s.height-s.height,w:Math.random()*8+4,h:Math.random()*6+2,color:i[Math.floor(Math.random()*i.length)],vx:(Math.random()-.5)*4,vy:Math.random()*3+2,rot:Math.random()*360,rv:(Math.random()-.5)*8}));let c;const m=()=>{n.clearRect(0,0,s.width,s.height);let p=!1;for(const l of o)l.x+=l.vx,l.y+=l.vy,l.rot+=l.rv,l.vy+=.05,l.y<s.height+20&&(p=!0),n.save(),n.translate(l.x,l.y),n.rotate(l.rot*Math.PI/180),n.fillStyle=l.color,n.fillRect(-l.w/2,-l.h/2,l.w,l.h),n.restore();p&&(c=requestAnimationFrame(m))};c=requestAnimationFrame(m);const h=setTimeout(()=>{cancelAnimationFrame(c),n.clearRect(0,0,s.width,s.height)},4e3);return()=>{cancelAnimationFrame(c),clearTimeout(h)}},[e]),a}async function Ae(e){try{return await navigator.clipboard.writeText(e),!0}catch{try{const a=document.createElement("textarea");return a.value=e,a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),!0}catch{return!1}}}function La({answers:e,onRestart:a,drawData:s}){const{t:n}=kt(),{user:i,isAuthenticated:o}=We(),c=s||Ct(),[m,h]=f.useState(!0),[p,l]=f.useState(!1),[u,y]=f.useState(!1),[k,L]=f.useState(!1),[v,N]=f.useState(!1),[E,T]=f.useState(!1),[R,F]=f.useState(""),[I,M]=f.useState(""),[w,J]=f.useState(!1),[X,A]=f.useState(""),[Q,Z]=f.useState(!1),[D,ne]=f.useState(()=>`${window.location.origin}${window.location.pathname}#${vt(e)}`),[K,U]=f.useState([]),[d,g]=f.useState("idle");f.useEffect(()=>{const r=setTimeout(()=>h(!1),2500);return()=>clearTimeout(r)},[]);const _=f.useMemo(()=>{if(e.knowsScore==="yes"){const r=parseInt(e.scoreRange,10)||400;return{total:r,breakdown:{coreHumanCapital:r,spouseFactors:0,skillTransferability:0,additionalPoints:0},details:{age:0,education:0,firstLanguage:0,secondLanguage:0,canadianWork:0,foreignWork:0,spouseTotal:0,skillTotal:0,additionalTotal:0}}}return Oe(e)},[e]),W=e.knowsScore!=="yes",C=_.total,B=c.averageCutoff,O=C-B,se=wt();f.useEffect(()=>{if(!o||!se||!i?.id){U([]),g("idle");return}let r=!0;return g("loading"),Pe(i.id).then(b=>{r&&(b.status==="ok"?(U(b.data||[]),g("ready")):(U([]),g("empty")))}).catch(()=>{r&&g("error")}),()=>{r=!1}},[se,o,i?.id]);const G=O>=20?{cls:"above",marker:"+",title:"Great News!",desc:`Your score is ${O} points above the recent cut-off (${B}). You have a strong chance of receiving an Invitation to Apply.`,color:"#22c55e"}:O>=-10?{cls:"close",marker:"~",title:"Almost There!",desc:`You're just ${Math.abs(O)} points ${O>=0?"above":"below"} the recent cut-off (${B}). A few small improvements could make the difference.`,color:"#f59e0b"}:{cls:"below",marker:"—",title:"Room to Improve",desc:`You're ${Math.abs(O)} points below the recent cut-off (${B}). Don't worry — see the suggestions below to boost your score.`,color:"#ef4444"},ie=f.useMemo(()=>Gt(e,_),[e,_]),re=f.useMemo(()=>Yt(_),[_]),P=_.details,ze=f.useMemo(()=>{const r=[{icon:"A",label:"Age",value:P.age,max:110},{icon:"E",label:"Education",value:P.education,max:150},{icon:"L",label:"English Language",value:P.firstLanguage,max:136},{icon:"W",label:"Canadian Work",value:P.canadianWork,max:80}];return P.secondLanguage>0&&r.splice(3,0,{icon:"F",label:"French",value:P.secondLanguage,max:24}),P.foreignWork>0?r.push({icon:"S",label:n("results.foreignWork"),value:P.skillTotal,max:100,note:"via skill transferability"}):r.push({icon:"S",label:"Skill Bonus",value:P.skillTotal,max:100}),P.spouseTotal>0&&r.push({icon:"P",label:"Spouse",value:P.spouseTotal,max:40}),P.additionalTotal>0&&r.push({icon:"+",label:"Bonus Points",value:P.additionalTotal,max:600}),r},[P,n]),Ke=ie.slice(0,3),oe=ie.slice(3),ce=St[e.pathway],je=f.useMemo(()=>W?qt(e):[],[e,W]),Ce=!m&&O>=20,Ve=_a(Ce),Je=async()=>{try{if(navigator.share){await navigator.share({title:"My CRS Score",text:`My CRS score is ${C}/1200!`,url:D});return}}catch{}await Ae(D)&&(T(!0),setTimeout(()=>T(!1),2e3))},Xe=()=>{const r=Math.max(470,B),b=`My CRS = ${C} — see how to reach ${r}+`,Y=`https://twitter.com/intent/tweet?text=${encodeURIComponent(b)}&url=${encodeURIComponent(D)}`;window.open(Y,"_blank","noopener,noreferrer")},Qe=async()=>{const r=I.trim()||i?.email||"";if(w&&!r){A("Add an email to enable draw alerts (or sign in).");return}if(r&&!/^\S+@\S+\.\S+$/.test(r)){A("Please enter a valid email address.");return}const b=Nt({name:R.trim(),answers:e,score:C,email:r,alertOptIn:!!w&&!!r}),Y=Pt(b.id,e);ne(Y),Z(!0);try{if(r||w)if((await Tt(b,{userId:i?.id||null})).status==="ok"){if(o&&i?.id){const Ne=await Pe(i.id);Ne.status==="ok"&&(U(Ne.data||[]),g("ready"))}A(w?"Profile saved, synced, and draw alerts subscribed.":"Profile saved and synced with your account.")}else A("Profile saved locally. Configure Supabase env vars to enable cloud sync/alerts.");else A("Profile saved locally with a unique shareable link.")}catch(we){A(`Profile saved locally, but cloud sync failed: ${we.message}`)}finally{Z(!1)}},Ze=()=>window.print();return m?t.jsx(Ta,{}):t.jsxs(x.div,{className:"results",variants:Me,initial:"hidden",animate:"show",exit:{opacity:0,transition:{duration:.2}},children:[Ce&&t.jsx("canvas",{ref:Ve,className:"confetti-canvas"}),t.jsx(x.div,{className:"score-hero",variants:j,children:t.jsx(Sa,{score:C,statusColor:G.color})}),t.jsxs(x.div,{className:"result-actions",variants:j,children:[t.jsx("button",{className:"action-btn",onClick:Je,"aria-label":"Share results",children:E?"✓ Copied!":n("results.share")}),t.jsx("button",{className:"action-btn",onClick:Xe,"aria-label":"Tweet score",children:"Share on X"}),t.jsx("button",{className:"action-btn",onClick:Ze,"aria-label":"Download PDF",children:n("results.pdf")})]}),t.jsxs(x.div,{className:`card status-card ${G.cls}-card`,variants:j,children:[t.jsxs("div",{className:"status-header",children:[t.jsx("span",{className:`status-marker ${G.cls}`,children:G.marker})," ",t.jsx("strong",{children:G.title})]}),t.jsx("p",{className:"status-desc",children:G.desc}),t.jsxs("div",{className:"cutoff-compare",children:[t.jsx(Ie,{label:"Your Score",value:C,max:Math.max(C,B,600),color:"var(--primary)"}),t.jsx(Ie,{label:"Cut-off",value:B,max:Math.max(C,B,600),color:"var(--surface-3)"})]})]}),t.jsxs(x.div,{className:"card save-profile-card",variants:j,children:[t.jsx("h3",{children:"Save & share your profile"}),t.jsx("p",{className:"cat-intro",children:"Save this result, generate a unique URL, and optionally subscribe to draw alerts."}),o?t.jsxs("p",{className:"save-note",children:["Signed in as ",i.email,". Saves are synced across your devices."]}):t.jsx("p",{className:"save-note",children:"Tip: sign in to sync profiles and score tracking across devices."}),t.jsxs("div",{className:"save-grid",children:[t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Profile name (optional)"}),t.jsx("input",{value:R,onChange:r=>F(r.target.value),placeholder:"e.g., Feb 2026 Profile"})]}),t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Email (optional)"}),t.jsx("input",{value:I,onChange:r=>M(r.target.value),placeholder:"you@example.com"})]})]}),t.jsxs("label",{className:"save-alert-row",children:[t.jsx("input",{type:"checkbox",checked:w,onChange:r=>J(r.target.checked)}),t.jsx("span",{children:"Notify me by email when my score is at/above the latest cutoff"})]}),!se&&t.jsx("p",{className:"save-note",children:"Cloud alerts need Supabase env vars (`VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`)."}),t.jsxs("div",{className:"save-actions",children:[t.jsx("button",{className:"action-btn",onClick:Qe,disabled:Q,children:Q?"Saving…":"Save Profile"}),t.jsx("button",{className:"action-btn",onClick:()=>Ae(D),children:"Copy Share URL"})]}),t.jsx("p",{className:"save-url",children:D}),X&&t.jsx("p",{className:"save-status",children:X}),o&&t.jsxs("div",{className:"save-synced-list",children:[t.jsx("h4",{children:"Synced profiles"}),d==="loading"&&t.jsx("p",{className:"save-note",children:"Loading your synced profiles..."}),d==="error"&&t.jsx("p",{className:"save-note",children:"Could not load synced profiles right now."}),d!=="loading"&&K.length===0&&t.jsx("p",{className:"save-note",children:"No synced profiles yet. Save your current result to start tracking."}),K.length>0&&t.jsx("ul",{className:"save-synced-items",children:K.slice(0,5).map(r=>t.jsxs("li",{children:[t.jsx("span",{children:r.name||r.id}),t.jsx("strong",{children:r.score})]},r.id))})]})]}),W&&t.jsxs(x.div,{className:"card",variants:j,children:[t.jsx("h3",{children:n("results.breakdown")}),t.jsx(x.div,{className:"breakdown-grid",variants:Me,initial:"hidden",animate:"show",children:ze.map(r=>t.jsx(ja,{...r},r.label))}),t.jsxs("div",{className:"bd-total",children:[t.jsx("span",{children:"Total CRS Score"}),t.jsx("span",{className:"bd-total-num",children:C})]})]}),W&&t.jsxs(x.div,{className:"card whatif-card",variants:j,children:[t.jsxs("h3",{className:"draws-toggle",onClick:()=>L(!k),children:["Scenario Compare (A vs B) ",t.jsx("span",{className:"toggle-arrow",children:k?"▲":"▼"})]}),k&&t.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},children:[t.jsx("p",{className:"cat-intro",children:n("results.whatifDesc")}),t.jsx(Pa,{answers:e,originalScore:C,t:n})]})]}),ie.length>0&&t.jsxs(x.div,{className:"card",variants:j,children:[t.jsx("h3",{children:n("results.improve")}),Ke.map((r,b)=>t.jsxs(x.div,{className:"action-card",variants:j,children:[t.jsx("div",{className:"action-rank",children:b+1}),t.jsxs("div",{className:"action-body",children:[t.jsxs("div",{className:"action-title",children:[r.title,r.potentialGain>0&&t.jsxs("span",{className:"action-badge",children:["+",r.potentialGain," pts"]})]}),t.jsx("div",{className:"action-desc",children:r.description}),r.action&&t.jsx("div",{className:"action-specific",children:r.action}),t.jsxs("div",{className:"action-meta",children:[t.jsx("span",{className:"action-time",children:r.timeframe}),t.jsx("span",{className:`action-diff diff-${r.difficulty.toLowerCase()}`,children:r.difficulty})]})]})]},b)),oe.length>0&&t.jsxs(t.Fragment,{children:[p&&oe.map((r,b)=>t.jsxs(x.div,{className:"action-card",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[t.jsx("div",{className:"action-rank",children:b+4}),t.jsxs("div",{className:"action-body",children:[t.jsxs("div",{className:"action-title",children:[r.title,r.potentialGain>0&&t.jsxs("span",{className:"action-badge",children:["+",r.potentialGain," pts"]})]}),t.jsx("div",{className:"action-desc",children:r.description}),r.action&&t.jsx("div",{className:"action-specific",children:r.action}),t.jsxs("div",{className:"action-meta",children:[t.jsx("span",{className:"action-time",children:r.timeframe}),t.jsx("span",{className:`action-diff diff-${r.difficulty.toLowerCase()}`,children:r.difficulty})]})]})]},b+3)),t.jsx("button",{className:"btn-toggle",onClick:()=>l(!p),children:p?"Show fewer ▲":`Show ${oe.length} more suggestions ▼`})]})]}),W&&t.jsx(ka,{answers:e,result:_,averageCutoff:c.averageCutoff}),W&&t.jsxs(x.div,{className:"card",variants:j,children:[t.jsx("h3",{children:n("results.category")}),t.jsx("p",{className:"cat-intro",children:n("results.catIntro")}),t.jsx("div",{className:"cat-grid",children:jt.map(r=>{const b=r.check(e),Y=b&&C>=r.recentCutoff;return t.jsxs(x.div,{className:`cat-card ${b?Y?"cat-above":"cat-eligible":"cat-na"}`,variants:j,children:[t.jsxs("div",{className:"cat-header",children:[t.jsx("span",{className:"cat-icon",children:r.icon}),t.jsxs("div",{children:[t.jsx("strong",{className:"cat-name",children:r.name}),b&&t.jsx("span",{className:`cat-badge ${Y?"badge-above":"badge-eligible"}`,children:Y?"Above Cutoff":"Eligible"}),!b&&t.jsx("span",{className:"cat-badge badge-na",children:"Not Eligible"})]})]}),t.jsx("p",{className:"cat-desc",children:r.description}),t.jsxs("div",{className:"cat-cutoff",children:[t.jsxs("span",{children:["Recent cutoff: ",t.jsx("strong",{children:r.recentCutoff})]}),t.jsxs("span",{className:"cat-range",children:["Range: ",r.cutoffRange]})]}),!b&&t.jsx("p",{className:"cat-req",children:r.eligibility})]},r.id)})})]}),W&&je.length>0&&t.jsxs(x.div,{className:"card",variants:j,children:[t.jsxs("h3",{className:"draws-toggle",onClick:()=>N(!v),children:["Province Recommender ",t.jsx("span",{className:"toggle-arrow",children:v?"▲":"▼"})]}),v&&t.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},children:[t.jsx("p",{className:"cat-intro",children:"Based on your profile, these provinces may be good matches for Provincial Nominee Programs."}),t.jsx("div",{className:"prov-grid",children:je.slice(0,5).map(r=>t.jsxs("div",{className:"prov-card",children:[t.jsxs("div",{className:"prov-header",children:[t.jsx("span",{className:"prov-abbr",children:r.abbr}),t.jsxs("div",{children:[t.jsx("strong",{className:"prov-name",children:r.name}),t.jsxs("span",{className:`prov-match ${r.matchScore>=70?"match-high":r.matchScore>=40?"match-mid":"match-low"}`,children:[r.matchScore,"% match"]})]})]}),t.jsx("div",{className:"prov-bar-wrap",children:t.jsx(x.div,{className:"prov-bar",initial:{width:0},animate:{width:`${r.matchScore}%`},transition:{duration:.8,ease:"easeOut"},style:{background:r.matchScore>=70?"#22c55e":r.matchScore>=40?"#f59e0b":"var(--surface-3)"}})}),t.jsx("p",{className:"prov-notes",children:r.notes})]},r.id))})]})]}),t.jsxs(x.div,{className:"card",variants:j,children:[t.jsx("h3",{children:n("results.timeline")}),t.jsxs("div",{className:`timeline-badge tl-${G.cls}`,children:[t.jsx("strong",{children:re.label})," — est. ",re.months," months"]}),t.jsx("p",{className:"timeline-desc",children:re.description})]}),t.jsxs(x.div,{className:"card",variants:j,children:[t.jsxs("h3",{className:"draws-toggle",onClick:()=>y(!u),children:[n("results.draws")," ",t.jsx("span",{className:"toggle-arrow",children:u?"▲":"▼"})]}),u&&t.jsxs(x.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"draws-content",children:[t.jsx("h4",{className:"draws-subhead",children:"General / CEC Draws"}),c.generalProgram.slice(0,4).map((r,b)=>t.jsx(ue,{draw:r,userScore:C},`g${b}`)),t.jsx("h4",{className:"draws-subhead",children:"Category-Based Draws"}),c.categoryBased.slice(0,4).map((r,b)=>t.jsx(ue,{draw:r,userScore:C},`c${b}`)),!!c.pnpDraws?.length&&t.jsxs(t.Fragment,{children:[t.jsx("h4",{className:"draws-subhead",children:"Provincial Nominee (PNP)"}),c.pnpDraws.slice(0,3).map((r,b)=>t.jsx(ue,{draw:r,userScore:C},`p${b}`))]})]})]}),ce&&t.jsxs(x.div,{className:"card",variants:j,children:[t.jsxs("h3",{children:[ce.name," Requirements"]}),t.jsx("ul",{className:"pathway-list",children:ce.requirements.map((r,b)=>t.jsx("li",{children:r},b))})]}),t.jsx(x.div,{className:"card disclaimer",variants:j,children:t.jsxs("p",{children:[t.jsx("strong",{children:"Disclaimer:"})," ",n("results.disclaimer")," ",t.jsx("a",{href:"https://www.canada.ca/en/immigration-refugees-citizenship.html",target:"_blank",rel:"noopener noreferrer",children:"canada.ca"})]})}),t.jsx(x.button,{className:"btn-restart",onClick:a,whileHover:{scale:1.03},whileTap:{scale:.96},variants:j,children:n("results.restart")})]})}function Ie({label:e,value:a,max:s,color:n}){const i=Math.round(a/s*100);return t.jsxs("div",{className:"cutoff-row",children:[t.jsx("span",{className:"cutoff-label",children:e}),t.jsx("div",{className:"cutoff-bar-wrap",children:t.jsx(x.div,{className:"cutoff-bar",style:{background:n},initial:{width:0},animate:{width:`${i}%`},transition:{duration:.8,ease:"easeOut"},children:a})})]})}export{La as default};
