(function(){"use strict";const ue={17:[0,0],18:[99,90],19:[105,95],20:[110,100],21:[110,100],22:[110,100],23:[110,100],24:[110,100],25:[110,100],26:[110,100],27:[110,100],28:[110,100],29:[110,100],30:[105,95],31:[99,90],32:[94,85],33:[88,80],34:[83,75],35:[77,70],36:[72,65],37:[66,60],38:[61,55],39:[55,50],40:[50,45],41:[39,35],42:[28,25],43:[17,15],44:[6,5],45:[0,0],46:[0,0],47:[0,0]},fe={less_than_secondary:[0,0],secondary:[30,28],one_year_post:[90,84],two_year_post:[98,91],bachelors:[120,112],two_or_more:[128,119],masters:[135,126],doctoral:[150,140]},me={0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[6,6],5:[6,6],6:[9,8],7:[17,16],8:[23,22],9:[31,29],10:[34,32],11:[34,32],12:[34,32]},ge={0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[1,1],6:[1,1],7:[3,3],8:[3,3],9:[6,6],10:[6,6],11:[6,6],12:[6,6]},pe={0:[0,0],1:[40,35],2:[53,46],3:[64,56],4:[72,63],5:[80,70]},he={less_than_secondary:0,secondary:2,one_year_post:6,two_year_post:7,bachelors:8,two_or_more:9,masters:10,doctoral:10},ye={0:0,1:0,2:0,3:0,4:1,5:1,6:1,7:3,8:3,9:5,10:5,11:5,12:5},be={0:0,1:5,2:7,3:8,4:9,5:10},ke={reading:[{min:8,clb:10},{min:7,clb:9},{min:6.5,clb:8},{min:6,clb:7},{min:5,clb:6},{min:4,clb:5},{min:3.5,clb:4}],writing:[{min:7.5,clb:10},{min:7,clb:9},{min:6.5,clb:8},{min:6,clb:7},{min:5.5,clb:6},{min:5,clb:5},{min:4,clb:4}],listening:[{min:8.5,clb:10},{min:8,clb:9},{min:7.5,clb:8},{min:6,clb:7},{min:5.5,clb:6},{min:5,clb:5},{min:4.5,clb:4}],speaking:[{min:7.5,clb:10},{min:7,clb:9},{min:6.5,clb:8},{min:6,clb:7},{min:5.5,clb:6},{min:5,clb:5},{min:4,clb:4}]};function we(e,t){const n=ke[e];if(!n)return 0;for(const i of n)if(t>=i.min)return i.clb;return 0}const Se={less_than_secondary:0,secondary:0,one_year_post:1,two_year_post:2,bachelors:3,two_or_more:3,masters:3,doctoral:3},Ce=[[0,0,0],[0,13,25],[0,25,50],[0,25,50]],ve=[[0,0,0],[0,13,25],[0,25,50],[0,25,50]],Pe=[[0,0,0],[0,13,25],[0,25,50]],Me=[[0,0,0],[0,13,25],[0,25,50]],_e=[0,25,50],Te={pnp_nomination:600,job_offer_00:0,job_offer_other:0,canadian_edu_short:15,canadian_edu_long:30,sibling_in_canada:15,french_strong_weak_english:25,french_strong_strong_english:50},X={averageCutoff:520},Le={listening:[{min:360,nclc:10},{min:349,nclc:9},{min:334,nclc:8},{min:316,nclc:7},{min:298,nclc:6},{min:280,nclc:5},{min:249,nclc:4},{min:217,nclc:3},{min:181,nclc:2},{min:145,nclc:1}],reading:[{min:310,nclc:10},{min:294,nclc:9},{min:278,nclc:8},{min:263,nclc:7},{min:248,nclc:6},{min:233,nclc:5},{min:207,nclc:4},{min:181,nclc:3},{min:151,nclc:2},{min:121,nclc:1}],writing:[{min:450,nclc:10},{min:437,nclc:9},{min:415,nclc:8},{min:393,nclc:7},{min:371,nclc:6},{min:349,nclc:5},{min:310,nclc:4},{min:271,nclc:3},{min:226,nclc:2},{min:181,nclc:1}],speaking:[{min:450,nclc:10},{min:437,nclc:9},{min:415,nclc:8},{min:393,nclc:7},{min:371,nclc:6},{min:349,nclc:5},{min:310,nclc:4},{min:271,nclc:3},{min:226,nclc:2},{min:181,nclc:1}]};function xe(e,t){const n=Le[e];if(!n)return 0;for(const i of n)if(t>=i.min)return i.nclc;return 0}const Fe={listening:[{min:610,nclc:10},{min:590,nclc:9},{min:570,nclc:8},{min:549,nclc:7},{min:523,nclc:6},{min:503,nclc:5},{min:453,nclc:4},{min:398,nclc:3},{min:369,nclc:2},{min:331,nclc:1}],reading:[{min:625,nclc:10},{min:600,nclc:9},{min:575,nclc:8},{min:549,nclc:7},{min:524,nclc:6},{min:499,nclc:5},{min:453,nclc:4},{min:406,nclc:3},{min:375,nclc:2},{min:342,nclc:1}],writing:[{min:20,nclc:10},{min:19,nclc:9},{min:18,nclc:8},{min:16,nclc:7},{min:14,nclc:6},{min:12,nclc:5},{min:10,nclc:4},{min:7,nclc:3},{min:6,nclc:2},{min:4,nclc:1}],speaking:[{min:20,nclc:10},{min:19,nclc:9},{min:18,nclc:8},{min:16,nclc:7},{min:14,nclc:6},{min:12,nclc:5},{min:10,nclc:4},{min:7,nclc:3},{min:6,nclc:2},{min:4,nclc:1}]};function Ie(e,t){const n=Fe[e];if(!n)return 0;for(const i of n)if(t>=i.min)return i.nclc;return 0}const We="crs-policy-ruleset-override-v1";function $(e){const t=new Date(e);return Number.isNaN(t.getTime())?null:t}const D=[{id:"ircc-2024-01-01-v1",label:"Legacy arranged-employment points",effectiveDate:"2024-01-01",arrangedEmploymentPoints:!0,notes:["Legacy profile includes arranged-employment CRS additional points (NOC 00: +200, others: +50).","PNP nomination remains +600 additional points.","French additional points depend on both French and English thresholds."]},{id:"ircc-2025-03-25-v2",label:"Arranged-employment points removed",effectiveDate:"2025-03-25",arrangedEmploymentPoints:!1,notes:["Arranged-employment CRS additional points removed effective March 25, 2025.","PNP nomination remains +600 additional points.","French additional points depend on both French and English thresholds."]}].sort((e,t)=>{const n=$(e.effectiveDate)?.getTime()||0,i=$(t.effectiveDate)?.getTime()||0;return n-i});function ee(){return D[D.length-1]}function te(e){return D.find(t=>t.id===e)||null}function Ee(){if(typeof window>"u")return null;try{const e=window.localStorage.getItem(We);if(!e)return null;const t=String(e).trim();return te(t)?.id||null}catch{return null}}function De(e=new Date){const t=$(e)||new Date;let n=D[0];for(const i of D){const o=$(i.effectiveDate);o&&o.getTime()<=t.getTime()&&(n=i)}return n||ee()}function Ne({asOfDate:e=new Date,ignoreOverride:t=!1}={}){if(!t){const i=Ee();if(i){const o=te(i);if(o)return{...o,source:"override"}}}return{...De(e),source:"effective_date"}}function Oe(e){const t={...Te};return e?.arrangedEmploymentPoints?(t.job_offer_00=200,t.job_offer_other=50):(t.job_offer_00=0,t.job_offer_other=0),t}function ne({asOfDate:e=new Date,ignoreOverride:t=!1}={}){const n=Ne({asOfDate:e,ignoreOverride:t});return{version:n.id,label:n.label,source:n.source,effectiveDate:n.effectiveDate,notes:n.notes,tables:{agePoints:ue,educationPoints:fe,firstLangPoints:me,secondLangPoints:ge,canadianWorkPoints:pe,spouseEducationPoints:he,spouseLangPoints:ye,spouseWorkPoints:be,eduRank:Se,eduLangTransfer:Ce,eduCWETransfer:ve,fweLangTransfer:Pe,fweCWETransfer:Me,certLangTransfer:_e,additionalPointsTable:Oe(n)},converters:{ieltsToCLB:we,tefToNCLC:xe,tcfToNCLC:Ie},caps:{secondLanguageNoSpouse:24,secondLanguageWithSpouse:22,spouseTotal:40,skillTransferabilityTotal:100,additionalPointsTotal:600,crsTotal:1200}}}const ie=ee();ie.id,ie.effectiveDate,ne({ignoreOverride:!0});const oe=(e,t,n)=>Math.max(t,Math.min(n,e)),x=()=>ne();function $e(e,t=x()){const n={...e},i=G(e)==="french"||e.hasFrench==="yes";if(i&&e.frenchTestType==="tef")for(const o of["listening","reading","writing","speaking"])n[`french_${o}`]=String(t.converters.tefToNCLC(o,parseInt(e[`tef_${o}`],10)||0));else if(i&&e.frenchTestType==="tcf")for(const o of["listening","reading","writing","speaking"])n[`french_${o}`]=String(t.converters.tcfToNCLC(o,parseInt(e[`tcf_${o}`],10)||0));return n}function G(e){return e.firstOfficialLanguage==="french"?"french":"english"}function j(e){return G(e)==="french"||e.hasFrench==="yes"}function z(e){return e.hasSpouse==="yes"&&e.spouseIsCanadian!=="yes"&&e.spouseAccompanying!=="no"}const N=e=>z(e)?1:0;function Y(e,t,n=x()){if(e.langTestType==="celpip")return oe(parseInt(e[`celpip_${t}`],10)||0,0,12);const i=parseFloat(e[`ielts_${t}`])||0;return n.converters.ieltsToCLB(t,i)}function U(e,t){return oe(parseInt(e[`french_${t}`],10)||0,0,12)}function ae(e,t,n=x()){return G(e)==="french"?U(e,t):Y(e,t,n)}function q(e,t=x()){const n=["listening","reading","writing","speaking"];let i=99;for(const o of n){const a=ae(e,o,t);a<i&&(i=a)}return i===99?0:i}function Ge(e,t=x()){const n=["listening","reading","writing","speaking"];let i=99;for(const o of n){const a=Y(e,o,t);a<i&&(i=a)}return i===99?0:i}function Re(e){if(!j(e))return 0;const t=["listening","reading","writing","speaking"];let n=99;for(const i of t){const o=U(e,i);o<n&&(n=o)}return n===99?0:n}function Be(e,t){const n=q(e,t);return n>=9?2:n>=7?1:0}function Ae(e){const t=parseInt(e.canadianWorkExp,10)||0;return t>=2?2:t>=1?1:0}function He(e){const t=parseInt(e.foreignWorkExp,10)||0;return t>=3?2:t>=1?1:0}function je(e,t){let n=parseInt(e.age,10);return Number.isNaN(n)?0:(n<18&&(n=17),n>47&&(n=47),n>44&&(n=45),t.tables.agePoints[n]?.[N(e)]||0)}function ze(e,t){return t.tables.educationPoints[e.education]?.[N(e)]||0}function Ye(e,t){const n=["listening","reading","writing","speaking"],i=N(e);return n.reduce((o,a)=>{const r=ae(e,a,t);return o+(t.tables.firstLangPoints[r]?.[i]||0)},0)}function Ue(e,t){const n=G(e);if(!(n==="french"?e.langTestType==="ielts"||e.langTestType==="celpip":j(e)))return 0;const o=["listening","reading","writing","speaking"],a=N(e),r=o.reduce((c,s)=>{const l=n==="french"?Y(e,s,t):U(e,s);return c+(t.tables.secondLangPoints[l]?.[a]||0)},0);return Math.min(r,a===0?t.caps.secondLanguageNoSpouse:t.caps.secondLanguageWithSpouse)}function qe(e,t){let n=parseInt(e.canadianWorkExp,10)||0;return n>5&&(n=5),t.tables.canadianWorkPoints[n]?.[N(e)]||0}function Ke(e,t){if(!z(e))return 0;let n=0;n+=t.tables.spouseEducationPoints[e.spouseEducation]||0;const i=["listening","reading","writing","speaking"];let o=0;for(const r of i){const c=parseInt(e[`spouseLang_${r}`],10)||0;o+=t.tables.spouseLangPoints[c]||0}n+=Math.min(o,20);let a=parseInt(e.spouseCanadianWork,10)||0;return a>5&&(a=5),n+=t.tables.spouseWorkPoints[a]||0,Math.min(n,t.caps.spouseTotal)}function Ve(e,t){const n=t.tables.eduRank[e.education]||0,i=Be(e,t),o=Ae(e),a=He(e),r=t.tables.eduLangTransfer[n]?.[i]||0,c=t.tables.eduCWETransfer[n]?.[o]||0,s=Math.min(r+c,50),l=t.tables.fweLangTransfer[a]?.[i]||0,d=t.tables.fweCWETransfer[a]?.[o]||0,u=Math.min(l+d,50);let f=0;if(e.pathway==="fst"&&e.hasCertificate==="yes"){const m=q(e,t);f=t.tables.certLangTransfer[m>=7?2:m>=5?1:0]}return Math.min(s+u+f,t.caps.skillTransferabilityTotal)}function Je(e,t){let n=0;const i=t.tables.additionalPointsTable;return e.hasPNP==="yes"&&(n+=i.pnp_nomination),e.hasJobOffer==="yes"&&(n+=e.jobOfferTeer==="teer_0"?i.job_offer_00:i.job_offer_other),e.canadianEducation==="yes"&&(n+=e.canadianEduType==="long"?i.canadian_edu_long:i.canadian_edu_short),e.hasSibling==="yes"&&(n+=i.sibling_in_canada),j(e)&&Re(e)>=7&&(n+=Ge(e,t)>=5?i.french_strong_strong_english:i.french_strong_weak_english),Math.min(n,t.caps.additionalPointsTotal)}function Ze(e){const t=x(),n=$e(e,t),i=je(n,t),o=ze(n,t),a=Ye(n,t),r=Ue(n,t),c=qe(n,t),s=parseInt(n.foreignWorkExp,10)||0,l=i+o+a+r+c,d=Ke(n,t),u=Ve(n,t),f=Je(n,t);return{total:Math.min(l+d+u+f,t.caps.crsTotal),breakdown:{coreHumanCapital:l,spouseFactors:d,skillTransferability:u,additionalPoints:f},details:{age:i,education:o,firstLanguage:a,secondLanguage:r,canadianWork:c,foreignWork:s,spouseTotal:d,skillTotal:u,additionalTotal:f},policy:{version:t.version,effectiveDate:t.effectiveDate,source:t.source}}}function Qe(e,t){return Ze({...e,...t})}const K=["less_than_secondary","secondary","one_year_post","two_year_post","bachelors","two_or_more","masters","doctoral"],Xe={Easy:14,Medium:7,Hard:0},re={high:78,medium:58,low:35};function V(e,t,n){return Math.max(t,Math.min(n,e))}function et(e,t=X.averageCutoff){return Math.max(t+10,e+25)}function tt(e,t){return{listening:{7:6,8:7.5,9:8,10:8.5},reading:{7:6,8:6.5,9:7,10:8},writing:{7:6,8:6.5,9:7,10:7.5},speaking:{7:6,8:6.5,9:7,10:7.5}}[e]?.[t]||0}function nt(e,t){if(e.firstOfficialLanguage==="french"){const i=["listening","reading","writing","speaking"],o={hasFrench:"yes",frenchTestType:"clb"};for(const a of i){const r=`french_${a}`;o[r]=String(Math.max(parseInt(e[r],10)||0,t))}return o}const n=["listening","reading","writing","speaking"];if(e.langTestType==="celpip"){const i={};for(const o of n){const a=`celpip_${o}`;i[a]=String(Math.max(parseInt(e[a],10)||0,t))}return i}if(e.langTestType==="ielts"){const i={};for(const o of n){const a=`ielts_${o}`,r=tt(o,t);i[a]=String(Math.max(parseFloat(e[a])||0,r))}return i}return{langTestType:"celpip",celpip_listening:String(t),celpip_reading:String(t),celpip_writing:String(t),celpip_speaking:String(t)}}function it(e,t=7){const n={listening:parseInt(e.french_listening,10)||0,reading:parseInt(e.french_reading,10)||0,writing:parseInt(e.french_writing,10)||0,speaking:parseInt(e.french_speaking,10)||0};return{hasFrench:"yes",frenchTestType:"clb",french_listening:String(Math.max(n.listening,t)),french_reading:String(Math.max(n.reading,t)),french_writing:String(Math.max(n.writing,t)),french_speaking:String(Math.max(n.speaking,t))}}function ot({pathId:e,gain:t,months:n,steps:i}){return i.map((o,a)=>({id:`${e}-m${a+1}`,title:o.title,details:o.details,etaWeeks:o.etaWeeks,expectedGain:a===i.length-1?Math.max(t-i.slice(0,-1).reduce((r,c)=>r+c.expectedGain,0),0):o.expectedGain,done:!1,monthHint:V(Math.ceil((o.etaWeeks||1)/4),1,n)}))}function ce({gain:e,months:t,difficulty:n,goalReached:i,likelihood:o}){const a=V(24-t*2,0,24),r=V(Math.round(e/4),0,80),c=i?32:0,s=Math.round((re[o]||0)/3);return r+a+c+s+(Xe[n]||0)}function F({id:e,title:t,summary:n,category:i,difficulty:o,months:a,estimatedCostCad:r,whyItFits:c,likelihood:s="medium",overrides:l,currentScore:d,targetScore:u,milestoneSteps:f}){const m=Qe(l.baseAnswers,l.patch),w=m.total-d;if(w<=0)return null;const P=m.total>=u,b=ot({pathId:e,gain:w,months:a,steps:f});return{id:e,title:t,summary:n,category:i,difficulty:o,estimatedMonths:a,estimatedCostCad:r,projectedScore:m.total,potentialGain:w,goalReached:P,whyItFits:c,likelihood:s,likelihoodPercent:re[s]||50,fitScore:ce({gain:w,months:a,difficulty:o,goalReached:P,likelihood:s}),milestones:b,checks:{targetScore:u,currentScore:d,stillNeededAfterPath:Math.max(u-m.total,0)}}}function at(e,t,n){const i=q(e);if(i>=10)return null;const o=i<7?8:9,a=e.firstOfficialLanguage==="french"?"french":"english",r=a==="french"?"French Accelerator Path":"English Accelerator Path",c=a==="french"?"Raise your weakest French ability first, then target NCLC 9+ for stronger transferability outcomes.":"Raise your weakest English ability first, then target CLB 9+ for transferability gains.";return F({id:`${a}-accelerator`,title:r,summary:c,category:"Language",difficulty:"Medium",months:4,estimatedCostCad:460,whyItFits:`Your current minimum first-official-language level is CLB/NCLC ${i}, so language gains are one of the fastest realistic boosters.`,likelihood:"high",overrides:{baseAnswers:e,patch:nt(e,o)},currentScore:t,targetScore:n,milestoneSteps:[{title:"Baseline audit and weak-skill diagnosis",details:"Run a mock test and identify the lowest 2 abilities to prioritize.",etaWeeks:1,expectedGain:0},{title:"Targeted study sprint",details:"Follow a 5-day weekly schedule focused on weakest modules and timed drills.",etaWeeks:6,expectedGain:8},{title:"Exam booking + strategy correction",details:"Book IELTS/CELPIP and fine-tune pacing, vocabulary, and response format.",etaWeeks:4,expectedGain:8},{title:"Retake and profile refresh",details:"Update final language scores in your profile and reassess draw competitiveness.",etaWeeks:4,expectedGain:12}]})}function rt(e,t,n){return e.firstOfficialLanguage==="french"?null:F({id:"french-advantage",title:"French Advantage Path",summary:"Reach NCLC 7 in all French abilities to unlock additional points and French-category draw access.",category:"Language",difficulty:"Hard",months:8,estimatedCostCad:690,whyItFits:"French pathways remain one of the highest-yield options for many candidates below general cutoffs.",likelihood:e.hasFrench==="yes"?"high":"medium",overrides:{baseAnswers:e,patch:it(e,7)},currentScore:t,targetScore:n,milestoneSteps:[{title:"French baseline + study plan",details:"Assess current level and choose a structured curriculum for NCLC 7 goal.",etaWeeks:2,expectedGain:0},{title:"Core skill build phase",details:"Intensive reading/listening practice with weekly speaking/writing correction.",etaWeeks:12,expectedGain:8},{title:"TEF/TCF prep and mock cycles",details:"Complete timed mocks and focus weak modules before exam booking.",etaWeeks:8,expectedGain:8},{title:"Exam and score integration",details:"Enter verified NCLC scores and evaluate French-category competitiveness.",etaWeeks:6,expectedGain:12}]})}function ct(e,t,n){const i=parseInt(e.canadianWorkExp,10)||0;return i>=5?null:F({id:"canadian-work-ladder",title:"Canadian Work Ladder Path",summary:"Add one more year of Canadian skilled work to increase core and transferability points.",category:"Work Experience",difficulty:"Hard",months:12,estimatedCostCad:0,whyItFits:`You currently report ${i} year(s) of Canadian work; the next year can materially lift your score.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{canadianWorkExp:String(i+1)}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Employer alignment",details:"Confirm TEER eligibility and maintain full-time skilled role continuity.",etaWeeks:2,expectedGain:0},{title:"Documentation discipline",details:"Collect monthly pay records and letters for future proof of experience.",etaWeeks:16,expectedGain:4},{title:"Mid-year score checkpoint",details:"Recalculate progress and combine with language upgrades if needed.",etaWeeks:24,expectedGain:6},{title:"Complete one full year increment",details:"Update profile immediately when additional year is met.",etaWeeks:52,expectedGain:12}]})}function st(e,t,n){const i=K.indexOf(e.education);if(i<0||i>=K.length-1)return null;const o=K[i+1];return F({id:"education-upgrade",title:"Education Upgrade Path",summary:"Move to the next recognized credential tier for predictable CRS uplift.",category:"Education",difficulty:"Hard",months:18,estimatedCostCad:12e3,whyItFits:`Your current education level can be improved to ${o.replace(/_/g," ")} for additional points.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{education:o}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Program selection",details:"Choose an accredited credential path aligned to CRS point tiers.",etaWeeks:4,expectedGain:0},{title:"Enrollment and milestone completion",details:"Track term-level progress to keep the plan on schedule.",etaWeeks:20,expectedGain:4},{title:"Credential completion prep",details:"Prepare final documents and ECA requirements where needed.",etaWeeks:20,expectedGain:4},{title:"Credential update in profile",details:"Add completed credential and recalculate total score immediately.",etaWeeks:28,expectedGain:10}]})}function lt(e,t,n){if(!z(e))return null;const i=["listening","reading","writing","speaking"],o={};for(const a of i){const r=`spouseLang_${a}`;o[r]=String(Math.max(parseInt(e[r],10)||0,9))}return F({id:"spouse-optimization",title:"Spouse Optimization Path",summary:"Use spouse language and experience factors for faster low-cost point improvements.",category:"Family Factors",difficulty:"Medium",months:5,estimatedCostCad:420,whyItFits:"You have an accompanying spouse, so spouse-factor optimization is available and often underused.",likelihood:"high",overrides:{baseAnswers:e,patch:o},currentScore:t,targetScore:n,milestoneSteps:[{title:"Spouse baseline review",details:"Identify spouse factors currently missing points.",etaWeeks:1,expectedGain:0},{title:"Spouse language prep",details:"Prepare specifically for CLB 9 in the weakest spouse abilities.",etaWeeks:8,expectedGain:4},{title:"Spouse profile integration",details:"Update spouse test scores and re-optimize joint profile configuration.",etaWeeks:6,expectedGain:8}]})}function dt(e,t,n){return e.hasPNP==="yes"?null:F({id:"pnp-fast-track",title:"PNP Fast-Track Path",summary:"Pursue provincial nomination for the largest single CRS jump (+600).",category:"Provincial",difficulty:"Hard",months:6,estimatedCostCad:2200,whyItFits:"If your baseline is below recent cutoffs, PNP remains the most direct guaranteed-lift route.",likelihood:"medium",overrides:{baseAnswers:e,patch:{hasPNP:"yes"}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Province shortlist",details:"Match your profile to provinces aligned with occupation/language strengths.",etaWeeks:2,expectedGain:0},{title:"Document stack preparation",details:"Prepare references, test proofs, ECA, and provincial forms early.",etaWeeks:6,expectedGain:0},{title:"Submit nomination stream",details:"Apply to selected stream and monitor NOI/application updates.",etaWeeks:8,expectedGain:0},{title:"Nomination linked to profile",details:"Accept nomination and refresh profile for major score jump.",etaWeeks:8,expectedGain:600}]})}function ut(e,t){const n=[...e].sort((s,l)=>l.fitScore-s.fitScore);if(n.length<2)return null;const[i,o]=n,a=Math.min(i.projectedScore+o.potentialGain,1200),r=a-i.checks.currentScore;if(r<=0)return null;const c=a>=t;return{id:"combo-bridge-plan",title:"Bridge Combination Path",summary:`Combine “${i.title}” + “${o.title}” to maximize speed while limiting risk.`,category:"Combination",difficulty:i.difficulty==="Hard"||o.difficulty==="Hard"?"Hard":"Medium",estimatedMonths:Math.round((i.estimatedMonths+o.estimatedMonths)/2),estimatedCostCad:i.estimatedCostCad+o.estimatedCostCad,projectedScore:a,potentialGain:r,goalReached:c,whyItFits:"A blended route often reaches target faster than single-track attempts.",likelihood:"medium",likelihoodPercent:62,fitScore:ce({gain:r,months:Math.round((i.estimatedMonths+o.estimatedMonths)/2),difficulty:i.difficulty==="Hard"||o.difficulty==="Hard"?"Hard":"Medium",goalReached:c,likelihood:"medium"}),milestones:[...i.milestones.slice(0,2).map(s=>({...s,id:`combo-${s.id}`})),...o.milestones.slice(0,2).map(s=>({...s,id:`combo-${s.id}`})),{id:"combo-final-sync",title:"Final score synchronization",details:"Update all achieved improvements together and reassess draw strategy.",etaWeeks:4,expectedGain:Math.max(r-16,0),done:!1,monthHint:2}],checks:{targetScore:t,currentScore:i.checks.currentScore,stillNeededAfterPath:Math.max(t-a,0)}}}function ft(e,t,n={}){const i=t?.total||0,o=Number(n.averageCutoff)||X.averageCutoff,a=Number(n.targetScore)||et(i,o),r=[at(e,i,a),rt(e,i,a),ct(e,i,a),st(e,i,a),lt(e,i,a),dt(e,i,a)].filter(Boolean),c=ut(r,a);c&&r.push(c);const s=r.sort((l,d)=>d.fitScore-l.fitScore).slice(0,5);return{currentScore:i,targetScore:a,plans:s,generatedAt:new Date().toISOString()}}const se=1440*60*1e3,le={High:3,Medium:2,Low:1},C={impact:.34,speed:.18,confidence:.22,effort:.12,laneFit:.14},mt=[{id:"3m",label:"3 months",months:3,gainFactor:.35},{id:"6m",label:"6 months",months:6,gainFactor:.62},{id:"12m",label:"12 months",months:12,gainFactor:.88}];function g(e,t,n){return Math.max(t,Math.min(n,e))}function gt(e,t){return`Day ${e}-${t}`}function h(e,t=0){const n=Number(e);return Number.isFinite(n)?n:t}function O(e,t=0){const n=parseInt(e,10);return Number.isFinite(n)?n:t}function pt(e=new Date){const t=new Date(e);return t.setHours(0,0,0,0),t}function R(e,t){return new Date(e.getTime()+t*se)}function J(e){try{return e.toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return e.toISOString().slice(0,10)}}function B(e,t,n){const i=R(e,Math.max(t-1,0)),o=R(e,Math.max(n-1,0));return{startDateIso:i.toISOString(),endDateIso:o.toISOString(),weekWindow:`Week ${Math.ceil(t/7)}-${Math.ceil(n/7)}`,dateWindow:`${J(i)} → ${J(o)}`}}function ht(e,t){const n=h(t);return e==="listening"?n>=8.5?10:n>=8?9:n>=7.5?8:n>=6?7:n>=5.5?6:n>=5?5:0:e==="reading"?n>=8?10:n>=7?9:n>=6.5?8:n>=6?7:n>=5?6:n>=4?5:0:n>=7.5?10:n>=7?9:n>=6.5?8:n>=6?7:n>=5.5?6:n>=5?5:0}function yt(e={}){const t=["listening","reading","writing","speaking"],n=e.firstOfficialLanguage==="french",o=t.map(a=>n?O(e[`french_${a}`],0):e.langTestType==="celpip"?O(e[`celpip_${a}`],0):ht(a,e[`ielts_${a}`])).filter(a=>a>0);return o.length?Math.min(...o):0}function v(e,t,n,i="medium"){return{id:e,label:t,detail:n,severity:i}}function bt(e){return e==="high"?10:e==="medium"?5:2}function kt(e="Medium"){return e==="Easy"?100:e==="Medium"?68:38}function wt(e=0){return e>=76?"High":e>=56?"Medium":"Low"}function St(e={},t,n){const i=h(t?.total),o=n-i,a=O(e.age,0),r=yt(e),c=e.hasFrench==="yes"||e.firstOfficialLanguage==="french",s=O(e.canadianWorkExp,0),l=O(e.foreignWorkExp,0),d=r>=9?18:r>=7?46:74,u=g((a>=33?28:14)+(r<7?26:r<9?16:6)+(s===0?12:4)+(l>=3?8:3),10,90),f=[{key:"answers_accuracy",label:"Profile values are accurate and complete",confidence:e.knowsScore==="yes"?"Medium":"High"},{key:"draw_trend_stability",label:"Recent draw patterns remain directionally similar",confidence:Math.abs(o)<=20?"Medium":"Low"},{key:"execution_discipline",label:"You can sustain weekly execution cadence for 90 days",confidence:u<=45?"High":u<=65?"Medium":"Low"}],m=[];return a>=33&&m.push(v("risk-age-decay","Age-point decay risk","Delays can reduce score as age thresholds change.",a>=38?"high":"medium")),r>0&&r<7&&m.push(v("risk-language-floor","Language floor below CLB 7","Several lanes become weaker or inaccessible below CLB 7.","high")),c||m.push(v("risk-no-french","No French upside yet","You may miss lower-cutoff category opportunities tied to French strength.","low")),o>40&&m.push(v("risk-large-gap","Large score gap","A single action may not close this gap; a combination strategy is likely required.","high")),{score:i,gap:o,age:a,minLanguageClb:r,hasFrench:c,canadianWorkExp:s,foreignWorkExp:l,languageHeadroom:d,profileComplexity:u,assumptions:f,globalRiskFlags:m}}function Ct(e,t,n){const i=e.category==="Language"?50+t.languageHeadroom*.45:e.category==="Provincial"?72:e.category==="Combination"?76:60,o=g(i+(e.goalReached?8:0)+(e.likelihoodPercent-50)*.35,30,95),a=[];return e.estimatedMonths>=10&&a.push(v(`${e.id}-timeline`,"Long timeline","This lane can take substantial time before score impact materializes.","medium")),e.difficulty==="Hard"&&a.push(v(`${e.id}-effort`,"Execution intensity","Consistent weekly effort is required to avoid plan drift.","medium")),!e.goalReached&&n>0&&a.push(v(`${e.id}-bridge`,"May require a second lane","This lane may need a backup action to fully close your gap.","low")),{id:`path-${e.id}`,title:e.title,lane:e.category,reason:e.whyItFits,scoreGain:e.potentialGain,months:e.estimatedMonths,confidence:e.likelihoodPercent,effort:e.difficulty,laneFit:o,riskFlags:a}}function vt({score:e,cutoff:t,eligibleCount:n,signals:i}){const o=t-e,a=o<=0?82:o<=20?64:38,r=[];return n||r.push(v("category-not-eligible","Not category-eligible yet","A prerequisite profile change is required before this lane can be used.","high")),o>35&&r.push(v("category-gap","Gap still material","Category targeting helps, but the score gap remains significant.","medium")),{id:"lane-category-draws",title:"Category Draw Positioning",lane:"Category Draws",reason:n>0?`You match ${n} category stream(s). Improve targeted factors to close the category cutoff gap.`:"You are not currently category-eligible; targeted profile adjustments can unlock lower-cutoff streams.",scoreGain:g(Math.round(Math.max(o,0)*.5),0,80),months:o<=0?1:o<=20?4:8,confidence:a,effort:o<=0?"Easy":o<=20?"Medium":"Hard",laneFit:g((n>0?70:35)+(i.hasFrench?8:0),25,90),riskFlags:r}}function Pt(e){if(!e)return null;const t=[];return e.matchScore<55&&t.push(v(`province-${e.id}-fit`,"Lower province fit","Province alignment is currently moderate; stream targeting needs tighter matching.","high")),e.matchScore>=55&&e.matchScore<70&&t.push(v(`province-${e.id}-variance`,"Selection variance","Provincial intake criteria can shift and may require profile tuning.","medium")),{id:`lane-province-${e.id}`,title:`${e.name} PNP Focus`,lane:"Provincial",reason:`${e.name} has the highest profile match in your province analysis.`,scoreGain:e.matchScore>=70?600:300,months:e.matchScore>=70?6:9,confidence:g(e.matchScore,35,88),effort:e.matchScore>=70?"Medium":"Hard",laneFit:g(e.matchScore+(e.matchScore>=70?6:-4),25,95),riskFlags:t}}function Mt(e={},t=0){return[{key:"coreHumanCapital",label:"Core profile factors",value:h(e.coreHumanCapital)},{key:"skillTransferability",label:"Transferability factors",value:h(e.skillTransferability)},{key:"additionalPoints",label:"Additional point factors",value:h(e.additionalPoints)},{key:"spouseFactors",label:"Spouse factors",value:h(e.spouseFactors)}].map(i=>({...i,headroom:g(100-Math.round(i.value/Math.max(t,1)*100),0,100)})).sort((i,o)=>o.headroom-i.headroom).slice(0,2)}function _t(e,t){const n=Math.max(Math.abs(t),35),i=g(Math.round(e.scoreGain/n*100),8,100),o=g(100-e.months*11,12,100),a=g(e.confidence,12,100),r=kt(e.effort),c=g(h(e.laneFit,60),10,100),s=i*C.impact+o*C.speed+a*C.confidence+r*C.effort+c*C.laneFit,l=Array.isArray(e.riskFlags)?e.riskFlags:[],d=g(l.reduce((f,m)=>f+bt(m.severity),0),0,24),u=g(Math.round(s-d),1,100);return{...e,score:u,riskPenalty:d,scoreBreakdown:[{key:"impact",label:"Impact potential",value:i,weight:C.impact},{key:"speed",label:"Speed to value",value:o,weight:C.speed},{key:"confidence",label:"Data confidence",value:a,weight:C.confidence},{key:"effort",label:"Execution ease",value:r,weight:C.effort},{key:"laneFit",label:"Profile-lane fit",value:c,weight:C.laneFit}]}}function Tt(e){const t=new Date(e?.date||"");return Number.isNaN(t.getTime())?null:t}function Lt(e={},t=10){return[...e.generalProgram||[],...e.categoryBased||[],...e.pnpDraws||[]].map(i=>({score:h(i?.score),date:Tt(i),program:i?.program||"Unknown"})).filter(i=>i.score>0&&i.date).sort((i,o)=>o.date.getTime()-i.date.getTime()).slice(0,t)}function xt(e=[]){if(!e.length)return 0;const t=e.reduce((i,o)=>i+o,0)/e.length,n=e.reduce((i,o)=>i+(o-t)**2,0)/e.length;return Math.sqrt(n)}function de(e=0){return e>=75?"High":e>=55?"Medium":"Low"}function Z({scoreGap:e=0,volatility:t=0,confidence:n=60}){const i=g((e+80)/160,0,1),o=g(h(t)/120,0,.26),a=g(h(n,60)/100,0,1)*.2,r=i*.72+a-o;return g(r,.02,.98)}function Ft({forecast:e,averageCutoff:t,horizonMonths:n}){if(!e)return Math.round(h(t,520));const i=h(e.projectedNextCutoff,h(t,520)),o=h(e.slopePerDraw,0),a=Math.max(Math.round(n/2),1);return Math.round(g(i+o*Math.max(a-1,0),300,800))}function It(e=0){return e>=70?"High":e>=45?"Medium":"Low"}function Wt({strategy:e,forecast:t,actionPlan:n,averageCutoff:i,userScore:o}){const a=h(o,h(e?.score,0)),r=Math.max(h(e?.top?.scoreGain,0),0),c=g(h(n?.completionPct,0),0,100),s=g(c/100*.55+.45,.4,1),l=h(t?.volatility,14),d=h(t?.confidenceScore,e?.overallConfidence||58),u=e?.top?.title||"Primary strategy lane",f=mt.map(p=>{const S=Ft({forecast:t,averageCutoff:i,horizonMonths:p.months}),W=Math.round(r*p.gainFactor*s),_=a+W,T=Math.round(_-S),L=Z({scoreGap:T,volatility:l,confidence:d}),A=Z({scoreGap:T+Math.max(Math.round(r*.35),8),volatility:l*.75,confidence:d+8}),H=Z({scoreGap:T-Math.max(Math.round(r*.45),10),volatility:l*1.25,confidence:d-10}),E=Math.round(L*100),y=Math.round(A*100),M=Math.round(H*100),Q=g(Math.round(26+l*.8-d*.18),8,34),$t=g(Math.round(E-Q/2),1,99),Gt=g(Math.round(E+Q/2),1,99);return{id:p.id,label:p.label,months:p.months,projectedCutoff:S,expectedScore:_,expectedGain:W,scoreGap:T,baseProbabilityPct:E,bestProbabilityPct:y,worstProbabilityPct:M,chanceBand:It(E),confidenceInterval:{lowPct:$t,highPct:Gt,uncertaintyPct:Q}}}),w=[...f].sort((p,S)=>S.baseProbabilityPct!==p.baseProbabilityPct?S.baseProbabilityPct-p.baseProbabilityPct:p.months-S.months)[0]||f[0]||null,P=w?.id||"6m",b=de(d),k=[{id:"top_lane_gain",label:`${u} expected gain`,value:`+${Math.round(r)} pts potential`,influence:r>=20?"positive":"neutral"},{id:"execution_cadence",label:"Execution cadence",value:`${c}% action-plan completion`,influence:c>=55?"positive":c>=25?"neutral":"negative"},{id:"draw_volatility",label:"Draw volatility pressure",value:`${Number(l).toFixed(2)} volatility`,influence:l<=12?"positive":l<=24?"neutral":"negative"}];return{generatedAt:new Date().toISOString(),confidenceBand:b,recommendedHorizonId:P,topLane:u,horizons:f,keyDrivers:k,summary:w?`Best current horizon: ${w.label} with ${w.baseProbabilityPct}% base invitation probability.`:"Digital twin is preparing probability projections."}}function Et({activeDraws:e,userScore:t,baseConfidence:n=60}){const i=Lt(e,10);if(!i.length)return null;const o=i[0],a=[...i].reverse(),r=a[0],c=a[a.length-1],s=a.length,l=s>1?(c.score-r.score)/(s-1):0,d=o.score,u=Math.round(g(d+l,300,800)),f=Math.round(g(u+l,300,800)),m=Math.round(g(f+l,300,800)),w=Math.round((u+f+m)/3),P=xt(i.map(L=>L.score)),b=o.date,k=b?Math.floor((Date.now()-b.getTime())/se):999;let p=h(n,60);p+=Math.min(s*3,18),p-=Math.min(P*1.2,24),k<=2?p+=5:k<=7?p+=1:k>14&&(p-=9),p=g(Math.round(p),20,92);const S=l>1.5?"rising":l<-1.5?"falling":"stable",W=S==="rising"?"Cutoff trend is rising":S==="falling"?"Cutoff trend is falling":"Cutoff trend is stable",_=h(t)-u,T=_>=20?"High":_>=0?"Medium":"Low";return{sampleSize:s,volatility:Number(P.toFixed(2)),slopePerDraw:Number(l.toFixed(2)),projectedNextCutoff:u,projectedThreeDrawAvg:w,projectedDraws:[u,f,m],trendDirection:S,trendLabel:W,confidenceScore:p,confidenceBand:de(p),invitationLikelihood:T,userGapToNext:_,latestObservedCutoff:d,latestObservedProgram:o.program,latestObservedDateIso:b?.toISOString()||""}}function Dt({answers:e,result:t,averageCutoff:n,categoryInfo:i=[],provinces:o=[],eligibleCategoryCount:a=Number.NaN}){const r=h(t?.total),c=h(n,520),s=c-r,l=St(e,t,c),u=(ft(e,t,{averageCutoff:c}).plans||[]).slice(0,2).map(y=>Ct(y,l,s)),f=h(a,Number.NaN),m=Number.isFinite(f)?Math.max(Math.round(f),0):i.filter(y=>typeof y?.check=="function"&&y.check(e)).length,w=vt({score:r,cutoff:c,eligibleCount:m,signals:l}),P=Pt((o||[])[0]||null),k=[...u,w,P].filter(Boolean).map(y=>_t(y,s)).sort((y,M)=>M.score-y.score).slice(0,4),p=k[0]||null,S=k[1]||null,W=Mt(t?.breakdown,r),_=[...l.globalRiskFlags||[],...k.slice(0,2).flatMap(y=>y.riskFlags||[])],T=Object.values(_.reduce((y,M)=>(M?.id&&(y[M.id]||(y[M.id]=M)),y),{})).slice(0,5),L=k.slice(0,2).map(y=>g(y.confidence-y.riskPenalty,0,100)),A=L.length?Math.round(L.reduce((y,M)=>y+M,0)/L.length):36,H=wt(A),E=p?`Primary lane: ${p.title}. Estimated gain ${p.scoreGain} points in ~${p.months} months (${H.toLowerCase()} confidence).`:"No strong lane detected yet. Start by improving language and category eligibility.";return{score:r,cutoff:c,gap:s,ranked:k,top:p,nextBest:S,bottlenecks:W,assumptions:l.assumptions,globalRiskFlags:T,overallConfidence:A,confidenceBand:H,profileSignals:{minLanguageClb:l.minLanguageClb,profileComplexity:l.profileComplexity,languageHeadroom:l.languageHeadroom},scoreWeights:C,guidanceSummary:E}}function Nt({answers:e,result:t,suggestions:n=[],averageCutoff:i,activeDraws:o,categoryInfo:a=[],provinces:r=[],progress:c={},enableAdvancedForecasting:s=!1,eligibleCategoryCount:l=Number.NaN}){const d=Dt({answers:e,result:t,averageCutoff:i,categoryInfo:a,provinces:r,eligibleCategoryCount:l}),u=Ot({suggestions:n,strategy:d,scoreGap:Math.max((i||0)-(t?.total||0),0),progress:c}),f=s?Et({activeDraws:o,userScore:t?.total||0,baseConfidence:d.overallConfidence}):null,m=Wt({strategy:d,forecast:f,actionPlan:u,averageCutoff:i,userScore:t?.total||0});return{strategy:d,actionPlan:u,forecast:f,digitalTwin:m}}function I(e,t,n,i,o,a,r,c="Medium",s,l={}){const{startDateIso:d,endDateIso:u,weekWindow:f,dateWindow:m}=B(s,i,o);return{id:e,title:t,rationale:n,window:gt(i,o),dayFrom:i,dayTo:o,impact:a,lane:r,priority:c,startDateIso:d,endDateIso:u,weekWindow:f,dateWindow:m,successMetric:l.successMetric||"Task completed with verified profile update.",checkpoint:l.checkpoint||"Run a score recalculation and note delta.",dependencies:l.dependencies||[],cadence:l.cadence||"3 focused sessions per week"}}function Ot({suggestions:e=[],strategy:t,scoreGap:n=0,progress:i={}}){const o=e[1],a=t?.top?.title||"Profile Optimization",r=Math.max(h(n),0),c=pt(new Date),s=[I("plan-baseline","Lock baseline and target score",`Set a concrete target and freeze your baseline profile to avoid random changes. Current gap: ${r} points.`,1,7,0,a,"High",c,{successMetric:"Target score and top lane documented; baseline snapshot saved.",checkpoint:"Save profile with date tag and score target.",cadence:"One 45-minute planning block + one review"}),I("plan-primary-lane",`Execute primary lane: ${a}`,t?.top?.reason||"Follow the highest-impact lane identified by optimizer.",8,30,t?.top?.scoreGain||10,a,"High",c,{successMetric:`Deliver at least 60% of ${a} milestones.`,checkpoint:"Verify measurable progress (test booking, docs, submissions, etc.)."}),I("plan-secondary-lane",o?`Secondary boost: ${o.title}`:"Secondary boost: language and profile precision",o?.description||"Add one additional improvement path to reduce draw uncertainty.",24,50,o?.potentialGain||8,o?.title||"Secondary path","Medium",c,{successMetric:"Secondary lane started with first concrete deliverable completed.",checkpoint:"Compare score delta before/after secondary-lane kickoff.",dependencies:["plan-primary-lane"]}),I("plan-document-pack","Prepare immigration document pack","Collect and verify key documents (identity, education, work proofs, test reports, proof-of-funds readiness).",35,68,0,"Readiness","High",c,{successMetric:"Core document checklist reaches 90% readiness.",checkpoint:"Review missing docs and issue dates.",cadence:"Two short admin sessions weekly"}),I("plan-risk-buffer","Activate fallback lane if progress stalls","If progress velocity is below target, start a backup action immediately (e.g., category-specific adjustment or province-first route).",55,80,6,"Fallback Control","Medium",c,{successMetric:"Fallback lane is selected and started within 7 days of stall signal.",checkpoint:"Mark stall trigger if expected gain is short by 20%+.",dependencies:["plan-primary-lane"]}),I("plan-profile-audit","Profile audit and draw readiness check","Re-evaluate score vs latest draws and category cutoffs. Trigger fallback lane if gap remains above 15 points.",75,90,0,"Risk Control","High",c,{successMetric:"Final 90-day readiness review completed with go/no-go decision.",checkpoint:"Capture current score, active cutoff delta, and next 30-day plan.",dependencies:["plan-document-pack"]})],l=[{label:"Days 1-30",objective:"Baseline lock + launch primary lane",expectedGain:s[1].impact,dateWindow:B(c,1,30).dateWindow},{label:"Days 31-60",objective:"Add secondary lane + document readiness",expectedGain:s[2].impact,dateWindow:B(c,31,60).dateWindow},{label:"Days 61-90",objective:"Fallback control + final draw readiness review",expectedGain:s[4].impact,dateWindow:B(c,61,90).dateWindow}],d=s.filter(b=>!!i[b.id]).length,u=s.length,f=u>0?Math.round(d/u*100):0,m=[...s].filter(b=>!i[b.id]).sort((b,k)=>{const p=le[k.priority]-le[b.priority];return p!==0?p:b.dayFrom-k.dayFrom})[0]||null,w=f>=100?"All action-plan tasks are complete. Keep a weekly score monitor to stay draw-ready.":m?`Next best task: ${m.title} (${m.dateWindow}).`:"Continue progressing through the plan in order of priority.",P=[14,30,60,90].map(b=>{const k=R(c,b-1);return{day:b,iso:k.toISOString(),label:J(k)}});return{tasks:s,milestones:l,completedCount:d,totalCount:u,completionPct:f,nextBestTask:m,completionGuidance:w,calendar:{planStartIso:c.toISOString(),planEndIso:R(c,89).toISOString(),reviewDates:P}}}self.onmessage=e=>{const t=e?.data||{},n=t.id;try{const i=Nt(t.input||{});self.postMessage({id:n,status:"ok",data:i})}catch(i){self.postMessage({id:n,status:"error",error:String(i?.message||"Worker computation failed")})}}})();
