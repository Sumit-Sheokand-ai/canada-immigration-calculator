(function(){"use strict";const he={17:[0,0],18:[99,90],19:[105,95],20:[110,100],21:[110,100],22:[110,100],23:[110,100],24:[110,100],25:[110,100],26:[110,100],27:[110,100],28:[110,100],29:[110,100],30:[105,95],31:[99,90],32:[94,85],33:[88,80],34:[83,75],35:[77,70],36:[72,65],37:[66,60],38:[61,55],39:[55,50],40:[50,45],41:[39,35],42:[28,25],43:[17,15],44:[6,5],45:[0,0],46:[0,0],47:[0,0]},ye={less_than_secondary:[0,0],secondary:[30,28],one_year_post:[90,84],two_year_post:[98,91],bachelors:[120,112],two_or_more:[128,119],masters:[135,126],doctoral:[150,140]},be={0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[6,6],5:[6,6],6:[9,8],7:[17,16],8:[23,22],9:[31,29],10:[34,32],11:[34,32],12:[34,32]},ke={0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[1,1],6:[1,1],7:[3,3],8:[3,3],9:[6,6],10:[6,6],11:[6,6],12:[6,6]},Ce={0:[0,0],1:[40,35],2:[53,46],3:[64,56],4:[72,63],5:[80,70]},we={less_than_secondary:0,secondary:2,one_year_post:6,two_year_post:7,bachelors:8,two_or_more:9,masters:10,doctoral:10},Se={0:0,1:0,2:0,3:0,4:1,5:1,6:1,7:3,8:3,9:5,10:5,11:5,12:5},ve={0:0,1:5,2:7,3:8,4:9,5:10},Pe={reading:[{min:8,clb:10},{min:7,clb:9},{min:6.5,clb:8},{min:6,clb:7},{min:5,clb:6},{min:4,clb:5},{min:3.5,clb:4}],writing:[{min:7.5,clb:10},{min:7,clb:9},{min:6.5,clb:8},{min:6,clb:7},{min:5.5,clb:6},{min:5,clb:5},{min:4,clb:4}],listening:[{min:8.5,clb:10},{min:8,clb:9},{min:7.5,clb:8},{min:6,clb:7},{min:5.5,clb:6},{min:5,clb:5},{min:4.5,clb:4}],speaking:[{min:7.5,clb:10},{min:7,clb:9},{min:6.5,clb:8},{min:6,clb:7},{min:5.5,clb:6},{min:5,clb:5},{min:4,clb:4}]};function Me(e,t){const n=Pe[e];if(!n)return 0;for(const i of n)if(t>=i.min)return i.clb;return 0}const _e={less_than_secondary:0,secondary:0,one_year_post:1,two_year_post:2,bachelors:3,two_or_more:3,masters:3,doctoral:3},xe=[[0,0,0],[0,13,25],[0,25,50],[0,25,50]],Te=[[0,0,0],[0,13,25],[0,25,50],[0,25,50]],Le=[[0,0,0],[0,13,25],[0,25,50]],Fe=[[0,0,0],[0,13,25],[0,25,50]],Ie=[0,25,50],Ee={pnp_nomination:600,job_offer_00:0,job_offer_other:0,canadian_edu_short:15,canadian_edu_long:30,sibling_in_canada:15,french_strong_weak_english:25,french_strong_strong_english:50},te={averageCutoff:520},We={listening:[{min:360,nclc:10},{min:349,nclc:9},{min:334,nclc:8},{min:316,nclc:7},{min:298,nclc:6},{min:280,nclc:5},{min:249,nclc:4},{min:217,nclc:3},{min:181,nclc:2},{min:145,nclc:1}],reading:[{min:310,nclc:10},{min:294,nclc:9},{min:278,nclc:8},{min:263,nclc:7},{min:248,nclc:6},{min:233,nclc:5},{min:207,nclc:4},{min:181,nclc:3},{min:151,nclc:2},{min:121,nclc:1}],writing:[{min:450,nclc:10},{min:437,nclc:9},{min:415,nclc:8},{min:393,nclc:7},{min:371,nclc:6},{min:349,nclc:5},{min:310,nclc:4},{min:271,nclc:3},{min:226,nclc:2},{min:181,nclc:1}],speaking:[{min:450,nclc:10},{min:437,nclc:9},{min:415,nclc:8},{min:393,nclc:7},{min:371,nclc:6},{min:349,nclc:5},{min:310,nclc:4},{min:271,nclc:3},{min:226,nclc:2},{min:181,nclc:1}]};function De(e,t){const n=We[e];if(!n)return 0;for(const i of n)if(t>=i.min)return i.nclc;return 0}const Oe={listening:[{min:610,nclc:10},{min:590,nclc:9},{min:570,nclc:8},{min:549,nclc:7},{min:523,nclc:6},{min:503,nclc:5},{min:453,nclc:4},{min:398,nclc:3},{min:369,nclc:2},{min:331,nclc:1}],reading:[{min:625,nclc:10},{min:600,nclc:9},{min:575,nclc:8},{min:549,nclc:7},{min:524,nclc:6},{min:499,nclc:5},{min:453,nclc:4},{min:406,nclc:3},{min:375,nclc:2},{min:342,nclc:1}],writing:[{min:20,nclc:10},{min:19,nclc:9},{min:18,nclc:8},{min:16,nclc:7},{min:14,nclc:6},{min:12,nclc:5},{min:10,nclc:4},{min:7,nclc:3},{min:6,nclc:2},{min:4,nclc:1}],speaking:[{min:20,nclc:10},{min:19,nclc:9},{min:18,nclc:8},{min:16,nclc:7},{min:14,nclc:6},{min:12,nclc:5},{min:10,nclc:4},{min:7,nclc:3},{min:6,nclc:2},{min:4,nclc:1}]};function Ne(e,t){const n=Oe[e];if(!n)return 0;for(const i of n)if(t>=i.min)return i.nclc;return 0}const ne="crs-policy-ruleset-override-v1",Re=Object.freeze({"ircc-2025-03-25-v1":"ircc-2025-03-25-v2"});function A(e){const t=new Date(e);return Number.isNaN(t.getTime())?null:t}const O=[{id:"ircc-2024-01-01-v1",label:"Legacy arranged-employment points",effectiveDate:"2024-01-01",arrangedEmploymentPoints:!0,notes:["Legacy profile includes arranged-employment CRS additional points (NOC 00: +200, others: +50).","PNP nomination remains +600 additional points.","French additional points depend on both French and English thresholds."]},{id:"ircc-2025-03-25-v2",label:"Arranged-employment points removed",effectiveDate:"2025-03-25",arrangedEmploymentPoints:!1,notes:["Arranged-employment CRS additional points removed effective March 25, 2025.","PNP nomination remains +600 additional points.","French additional points depend on both French and English thresholds."]}].sort((e,t)=>{const n=A(e.effectiveDate)?.getTime()||0,i=A(t.effectiveDate)?.getTime()||0;return n-i});function ie(){return O[O.length-1]}function ae(e){const t=oe(e);return O.find(n=>n.id===t)||null}function oe(e){const t=String(e||"").trim();return t?Re[t]||t:""}function $e(){if(typeof window>"u")return null;try{const e=window.localStorage.getItem(ne);if(!e)return null;const t=oe(e),n=ae(t)?.id||null;return n?(String(e).trim()!==n&&window.localStorage.setItem(ne,n),n):null}catch{return null}}function Ae(e=new Date){const t=A(e)||new Date;let n=O[0];for(const i of O){const a=A(i.effectiveDate);a&&a.getTime()<=t.getTime()&&(n=i)}return n||ie()}function Ge({asOfDate:e=new Date,ignoreOverride:t=!1}={}){if(!t){const i=$e();if(i){const a=ae(i);if(a)return{...a,source:"override"}}}return{...Ae(e),source:"effective_date"}}function He(e){const t={...Ee};return e?.arrangedEmploymentPoints?(t.job_offer_00=200,t.job_offer_other=50):(t.job_offer_00=0,t.job_offer_other=0),t}function re({asOfDate:e=new Date,ignoreOverride:t=!1}={}){const n=Ge({asOfDate:e,ignoreOverride:t});return{version:n.id,label:n.label,source:n.source,effectiveDate:n.effectiveDate,notes:n.notes,tables:{agePoints:he,educationPoints:ye,firstLangPoints:be,secondLangPoints:ke,canadianWorkPoints:Ce,spouseEducationPoints:we,spouseLangPoints:Se,spouseWorkPoints:ve,eduRank:_e,eduLangTransfer:xe,eduCWETransfer:Te,fweLangTransfer:Le,fweCWETransfer:Fe,certLangTransfer:Ie,additionalPointsTable:He(n)},converters:{ieltsToCLB:Me,tefToNCLC:De,tcfToNCLC:Ne},caps:{secondLanguageNoSpouse:24,secondLanguageWithSpouse:22,spouseTotal:40,skillTransferabilityTotal:100,additionalPointsTotal:600,crsTotal:1200}}}const ce=ie();ce.id,ce.effectiveDate,re({ignoreOverride:!0});const se=(e,t,n)=>Math.max(t,Math.min(n,e)),I=()=>re();function Be(e,t=I()){const n={...e},i=G(e)==="french"||e.hasFrench==="yes";if(i&&e.frenchTestType==="tef")for(const a of["listening","reading","writing","speaking"])n[`french_${a}`]=String(t.converters.tefToNCLC(a,parseInt(e[`tef_${a}`],10)||0));else if(i&&e.frenchTestType==="tcf")for(const a of["listening","reading","writing","speaking"])n[`french_${a}`]=String(t.converters.tcfToNCLC(a,parseInt(e[`tcf_${a}`],10)||0));return n}function G(e){return e.firstOfficialLanguage==="french"?"french":"english"}function z(e){return G(e)==="french"||e.hasFrench==="yes"}function Y(e){return e.hasSpouse==="yes"&&e.spouseIsCanadian!=="yes"&&e.spouseAccompanying!=="no"}const N=e=>Y(e)?1:0;function U(e,t,n=I()){if(e.langTestType==="celpip")return se(parseInt(e[`celpip_${t}`],10)||0,0,12);const i=parseFloat(e[`ielts_${t}`])||0;return n.converters.ieltsToCLB(t,i)}function q(e,t){return se(parseInt(e[`french_${t}`],10)||0,0,12)}function le(e,t,n=I()){return G(e)==="french"?q(e,t):U(e,t,n)}function K(e,t=I()){const n=["listening","reading","writing","speaking"];let i=99;for(const a of n){const o=le(e,a,t);o<i&&(i=o)}return i===99?0:i}function je(e,t=I()){const n=["listening","reading","writing","speaking"];let i=99;for(const a of n){const o=U(e,a,t);o<i&&(i=o)}return i===99?0:i}function ze(e){if(!z(e))return 0;const t=["listening","reading","writing","speaking"];let n=99;for(const i of t){const a=q(e,i);a<n&&(n=a)}return n===99?0:n}function Ye(e,t){const n=K(e,t);return n>=9?2:n>=7?1:0}function Ue(e){const t=parseInt(e.canadianWorkExp,10)||0;return t>=2?2:t>=1?1:0}function qe(e){const t=parseInt(e.foreignWorkExp,10)||0;return t>=3?2:t>=1?1:0}function Ke(e,t){let n=parseInt(e.age,10);return Number.isNaN(n)?0:(n<18&&(n=17),n>47&&(n=47),n>44&&(n=45),t.tables.agePoints[n]?.[N(e)]||0)}function Ve(e,t){return t.tables.educationPoints[e.education]?.[N(e)]||0}function Ze(e,t){const n=["listening","reading","writing","speaking"],i=N(e);return n.reduce((a,o)=>{const r=le(e,o,t);return a+(t.tables.firstLangPoints[r]?.[i]||0)},0)}function Je(e,t){const n=G(e);if(!(n==="french"?e.langTestType==="ielts"||e.langTestType==="celpip":z(e)))return 0;const a=["listening","reading","writing","speaking"],o=N(e),r=a.reduce((c,s)=>{const d=n==="french"?U(e,s,t):q(e,s);return c+(t.tables.secondLangPoints[d]?.[o]||0)},0);return Math.min(r,o===0?t.caps.secondLanguageNoSpouse:t.caps.secondLanguageWithSpouse)}function Qe(e,t){let n=parseInt(e.canadianWorkExp,10)||0;return n>5&&(n=5),t.tables.canadianWorkPoints[n]?.[N(e)]||0}function Xe(e,t){if(!Y(e))return 0;let n=0;n+=t.tables.spouseEducationPoints[e.spouseEducation]||0;const i=["listening","reading","writing","speaking"];let a=0;for(const r of i){const c=parseInt(e[`spouseLang_${r}`],10)||0;a+=t.tables.spouseLangPoints[c]||0}n+=Math.min(a,20);let o=parseInt(e.spouseCanadianWork,10)||0;return o>5&&(o=5),n+=t.tables.spouseWorkPoints[o]||0,Math.min(n,t.caps.spouseTotal)}function et(e,t){const n=t.tables.eduRank[e.education]||0,i=Ye(e,t),a=Ue(e),o=qe(e),r=t.tables.eduLangTransfer[n]?.[i]||0,c=t.tables.eduCWETransfer[n]?.[a]||0,s=Math.min(r+c,50),d=t.tables.fweLangTransfer[o]?.[i]||0,f=t.tables.fweCWETransfer[o]?.[a]||0,u=Math.min(d+f,50);let g=0;if(e.pathway==="fst"&&e.hasCertificate==="yes"){const l=K(e,t);g=t.tables.certLangTransfer[l>=7?2:l>=5?1:0]}return Math.min(s+u+g,t.caps.skillTransferabilityTotal)}function tt(e,t){let n=0;const i=t.tables.additionalPointsTable;return e.hasPNP==="yes"&&(n+=i.pnp_nomination),e.hasJobOffer==="yes"&&(n+=e.jobOfferTeer==="teer_0"?i.job_offer_00:i.job_offer_other),e.canadianEducation==="yes"&&(n+=e.canadianEduType==="long"?i.canadian_edu_long:i.canadian_edu_short),e.hasSibling==="yes"&&(n+=i.sibling_in_canada),z(e)&&ze(e)>=7&&(n+=je(e,t)>=5?i.french_strong_strong_english:i.french_strong_weak_english),Math.min(n,t.caps.additionalPointsTotal)}function nt(e){const t=I(),n=Be(e,t),i=Ke(n,t),a=Ve(n,t),o=Ze(n,t),r=Je(n,t),c=Qe(n,t),s=parseInt(n.foreignWorkExp,10)||0,d=i+a+o+r+c,f=Xe(n,t),u=et(n,t),g=tt(n,t);return{total:Math.min(d+f+u+g,t.caps.crsTotal),breakdown:{coreHumanCapital:d,spouseFactors:f,skillTransferability:u,additionalPoints:g},details:{age:i,education:a,firstLanguage:o,secondLanguage:r,canadianWork:c,foreignWork:s,spouseTotal:f,skillTotal:u,additionalTotal:g},policy:{version:t.version,effectiveDate:t.effectiveDate,source:t.source}}}function it(e,t){return nt({...e,...t})}const V=["less_than_secondary","secondary","one_year_post","two_year_post","bachelors","two_or_more","masters","doctoral"],at={Easy:14,Medium:7,Hard:0},de={high:78,medium:58,low:35};function Z(e,t,n){return Math.max(t,Math.min(n,e))}function ot(e,t=te.averageCutoff){return Math.max(t+10,e+25)}function rt(e,t){return{listening:{7:6,8:7.5,9:8,10:8.5},reading:{7:6,8:6.5,9:7,10:8},writing:{7:6,8:6.5,9:7,10:7.5},speaking:{7:6,8:6.5,9:7,10:7.5}}[e]?.[t]||0}function ct(e,t){if(e.firstOfficialLanguage==="french"){const i=["listening","reading","writing","speaking"],a={hasFrench:"yes",frenchTestType:"clb"};for(const o of i){const r=`french_${o}`;a[r]=String(Math.max(parseInt(e[r],10)||0,t))}return a}const n=["listening","reading","writing","speaking"];if(e.langTestType==="celpip"){const i={};for(const a of n){const o=`celpip_${a}`;i[o]=String(Math.max(parseInt(e[o],10)||0,t))}return i}if(e.langTestType==="ielts"){const i={};for(const a of n){const o=`ielts_${a}`,r=rt(a,t);i[o]=String(Math.max(parseFloat(e[o])||0,r))}return i}return{langTestType:"celpip",celpip_listening:String(t),celpip_reading:String(t),celpip_writing:String(t),celpip_speaking:String(t)}}function st(e,t=7){const n={listening:parseInt(e.french_listening,10)||0,reading:parseInt(e.french_reading,10)||0,writing:parseInt(e.french_writing,10)||0,speaking:parseInt(e.french_speaking,10)||0};return{hasFrench:"yes",frenchTestType:"clb",french_listening:String(Math.max(n.listening,t)),french_reading:String(Math.max(n.reading,t)),french_writing:String(Math.max(n.writing,t)),french_speaking:String(Math.max(n.speaking,t))}}function lt({pathId:e,gain:t,months:n,steps:i}){return i.map((a,o)=>({id:`${e}-m${o+1}`,title:a.title,details:a.details,etaWeeks:a.etaWeeks,expectedGain:o===i.length-1?Math.max(t-i.slice(0,-1).reduce((r,c)=>r+c.expectedGain,0),0):a.expectedGain,done:!1,monthHint:Z(Math.ceil((a.etaWeeks||1)/4),1,n)}))}function ue({gain:e,months:t,difficulty:n,goalReached:i,likelihood:a}){const o=Z(24-t*2,0,24),r=Z(Math.round(e/4),0,80),c=i?32:0,s=Math.round((de[a]||0)/3);return r+o+c+s+(at[n]||0)}function E({id:e,title:t,summary:n,category:i,difficulty:a,months:o,estimatedCostCad:r,whyItFits:c,likelihood:s="medium",overrides:d,currentScore:f,targetScore:u,milestoneSteps:g}){const l=it(d.baseAnswers,d.patch),k=l.total-f;if(k<=0)return null;const P=l.total>=u,b=lt({pathId:e,gain:k,months:o,steps:g});return{id:e,title:t,summary:n,category:i,difficulty:a,estimatedMonths:o,estimatedCostCad:r,projectedScore:l.total,potentialGain:k,goalReached:P,whyItFits:c,likelihood:s,likelihoodPercent:de[s]||50,fitScore:ue({gain:k,months:o,difficulty:a,goalReached:P,likelihood:s}),milestones:b,checks:{targetScore:u,currentScore:f,stillNeededAfterPath:Math.max(u-l.total,0)}}}function dt(e,t,n){const i=K(e);if(i>=10)return null;const a=i<7?8:9,o=e.firstOfficialLanguage==="french"?"french":"english",r=o==="french"?"French Accelerator Path":"English Accelerator Path",c=o==="french"?"Raise your weakest French ability first, then target NCLC 9+ for stronger transferability outcomes.":"Raise your weakest English ability first, then target CLB 9+ for transferability gains.";return E({id:`${o}-accelerator`,title:r,summary:c,category:"Language",difficulty:"Medium",months:4,estimatedCostCad:460,whyItFits:`Your current minimum first-official-language level is CLB/NCLC ${i}, so language gains are one of the fastest realistic boosters.`,likelihood:"high",overrides:{baseAnswers:e,patch:ct(e,a)},currentScore:t,targetScore:n,milestoneSteps:[{title:"Baseline audit and weak-skill diagnosis",details:"Run a mock test and identify the lowest 2 abilities to prioritize.",etaWeeks:1,expectedGain:0},{title:"Targeted study sprint",details:"Follow a 5-day weekly schedule focused on weakest modules and timed drills.",etaWeeks:6,expectedGain:8},{title:"Exam booking + strategy correction",details:"Book IELTS/CELPIP and fine-tune pacing, vocabulary, and response format.",etaWeeks:4,expectedGain:8},{title:"Retake and profile refresh",details:"Update final language scores in your profile and reassess draw competitiveness.",etaWeeks:4,expectedGain:12}]})}function ut(e,t,n){return e.firstOfficialLanguage==="french"?null:E({id:"french-advantage",title:"French Advantage Path",summary:"Reach NCLC 7 in all French abilities to unlock additional points and French-category draw access.",category:"Language",difficulty:"Hard",months:8,estimatedCostCad:690,whyItFits:"French pathways remain one of the highest-yield options for many candidates below general cutoffs.",likelihood:e.hasFrench==="yes"?"high":"medium",overrides:{baseAnswers:e,patch:st(e,7)},currentScore:t,targetScore:n,milestoneSteps:[{title:"French baseline + study plan",details:"Assess current level and choose a structured curriculum for NCLC 7 goal.",etaWeeks:2,expectedGain:0},{title:"Core skill build phase",details:"Intensive reading/listening practice with weekly speaking/writing correction.",etaWeeks:12,expectedGain:8},{title:"TEF/TCF prep and mock cycles",details:"Complete timed mocks and focus weak modules before exam booking.",etaWeeks:8,expectedGain:8},{title:"Exam and score integration",details:"Enter verified NCLC scores and evaluate French-category competitiveness.",etaWeeks:6,expectedGain:12}]})}function ft(e,t,n){const i=parseInt(e.canadianWorkExp,10)||0;return i>=5?null:E({id:"canadian-work-ladder",title:"Canadian Work Ladder Path",summary:"Add one more year of Canadian skilled work to increase core and transferability points.",category:"Work Experience",difficulty:"Hard",months:12,estimatedCostCad:0,whyItFits:`You currently report ${i} year(s) of Canadian work; the next year can materially lift your score.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{canadianWorkExp:String(i+1)}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Employer alignment",details:"Confirm TEER eligibility and maintain full-time skilled role continuity.",etaWeeks:2,expectedGain:0},{title:"Documentation discipline",details:"Collect monthly pay records and letters for future proof of experience.",etaWeeks:16,expectedGain:4},{title:"Mid-year score checkpoint",details:"Recalculate progress and combine with language upgrades if needed.",etaWeeks:24,expectedGain:6},{title:"Complete one full year increment",details:"Update profile immediately when additional year is met.",etaWeeks:52,expectedGain:12}]})}function mt(e,t,n){const i=V.indexOf(e.education);if(i<0||i>=V.length-1)return null;const a=V[i+1];return E({id:"education-upgrade",title:"Education Upgrade Path",summary:"Move to the next recognized credential tier for predictable CRS uplift.",category:"Education",difficulty:"Hard",months:18,estimatedCostCad:12e3,whyItFits:`Your current education level can be improved to ${a.replace(/_/g," ")} for additional points.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{education:a}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Program selection",details:"Choose an accredited credential path aligned to CRS point tiers.",etaWeeks:4,expectedGain:0},{title:"Enrollment and milestone completion",details:"Track term-level progress to keep the plan on schedule.",etaWeeks:20,expectedGain:4},{title:"Credential completion prep",details:"Prepare final documents and ECA requirements where needed.",etaWeeks:20,expectedGain:4},{title:"Credential update in profile",details:"Add completed credential and recalculate total score immediately.",etaWeeks:28,expectedGain:10}]})}function gt(e,t,n){if(!Y(e))return null;const i=["listening","reading","writing","speaking"],a={};for(const o of i){const r=`spouseLang_${o}`;a[r]=String(Math.max(parseInt(e[r],10)||0,9))}return E({id:"spouse-optimization",title:"Spouse Optimization Path",summary:"Use spouse language and experience factors for faster low-cost point improvements.",category:"Family Factors",difficulty:"Medium",months:5,estimatedCostCad:420,whyItFits:"You have an accompanying spouse, so spouse-factor optimization is available and often underused.",likelihood:"high",overrides:{baseAnswers:e,patch:a},currentScore:t,targetScore:n,milestoneSteps:[{title:"Spouse baseline review",details:"Identify spouse factors currently missing points.",etaWeeks:1,expectedGain:0},{title:"Spouse language prep",details:"Prepare specifically for CLB 9 in the weakest spouse abilities.",etaWeeks:8,expectedGain:4},{title:"Spouse profile integration",details:"Update spouse test scores and re-optimize joint profile configuration.",etaWeeks:6,expectedGain:8}]})}function pt(e,t,n){return e.hasPNP==="yes"?null:E({id:"pnp-fast-track",title:"PNP Fast-Track Path",summary:"Pursue provincial nomination for the largest single CRS jump (+600).",category:"Provincial",difficulty:"Hard",months:6,estimatedCostCad:2200,whyItFits:"If your baseline is below recent cutoffs, PNP remains the most direct guaranteed-lift route.",likelihood:"medium",overrides:{baseAnswers:e,patch:{hasPNP:"yes"}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Province shortlist",details:"Match your profile to provinces aligned with occupation/language strengths.",etaWeeks:2,expectedGain:0},{title:"Document stack preparation",details:"Prepare references, test proofs, ECA, and provincial forms early.",etaWeeks:6,expectedGain:0},{title:"Submit nomination stream",details:"Apply to selected stream and monitor NOI/application updates.",etaWeeks:8,expectedGain:0},{title:"Nomination linked to profile",details:"Accept nomination and refresh profile for major score jump.",etaWeeks:8,expectedGain:600}]})}function ht(e,t){const n=[...e].sort((s,d)=>d.fitScore-s.fitScore);if(n.length<2)return null;const[i,a]=n,o=Math.min(i.projectedScore+a.potentialGain,1200),r=o-i.checks.currentScore;if(r<=0)return null;const c=o>=t;return{id:"combo-bridge-plan",title:"Bridge Combination Path",summary:`Combine “${i.title}” + “${a.title}” to maximize speed while limiting risk.`,category:"Combination",difficulty:i.difficulty==="Hard"||a.difficulty==="Hard"?"Hard":"Medium",estimatedMonths:Math.round((i.estimatedMonths+a.estimatedMonths)/2),estimatedCostCad:i.estimatedCostCad+a.estimatedCostCad,projectedScore:o,potentialGain:r,goalReached:c,whyItFits:"A blended route often reaches target faster than single-track attempts.",likelihood:"medium",likelihoodPercent:62,fitScore:ue({gain:r,months:Math.round((i.estimatedMonths+a.estimatedMonths)/2),difficulty:i.difficulty==="Hard"||a.difficulty==="Hard"?"Hard":"Medium",goalReached:c,likelihood:"medium"}),milestones:[...i.milestones.slice(0,2).map(s=>({...s,id:`combo-${s.id}`})),...a.milestones.slice(0,2).map(s=>({...s,id:`combo-${s.id}`})),{id:"combo-final-sync",title:"Final score synchronization",details:"Update all achieved improvements together and reassess draw strategy.",etaWeeks:4,expectedGain:Math.max(r-16,0),done:!1,monthHint:2}],checks:{targetScore:t,currentScore:i.checks.currentScore,stillNeededAfterPath:Math.max(t-o,0)}}}function yt(e,t,n={}){const i=t?.total||0,a=Number(n.averageCutoff)||te.averageCutoff,o=Number(n.targetScore)||ot(i,a),r=[dt(e,i,o),ut(e,i,o),ft(e,i,o),mt(e,i,o),gt(e,i,o),pt(e,i,o)].filter(Boolean),c=ht(r,o);c&&r.push(c);const s=r.sort((d,f)=>f.fitScore-d.fitScore).slice(0,5);return{currentScore:i,targetScore:o,plans:s,generatedAt:new Date().toISOString()}}const fe=1440*60*1e3,me={High:3,Medium:2,Low:1},S={impact:.34,speed:.18,confidence:.22,effort:.12,laneFit:.14},W={budgetCad:3500,weeklyHours:6,examAttempts:2,relocationPreference:"balanced"},bt=[{id:"3m",label:"3 months",months:3,gainFactor:.35},{id:"6m",label:"6 months",months:6,gainFactor:.62},{id:"12m",label:"12 months",months:12,gainFactor:.88}];function m(e,t,n){return Math.max(t,Math.min(n,e))}function kt(e,t){return`Day ${e}-${t}`}function p(e,t=0){const n=Number(e);return Number.isFinite(n)?n:t}function x(e,t=0){const n=parseInt(e,10);return Number.isFinite(n)?n:t}function ge(e={}){const t=e&&typeof e=="object"?e:{},n=["balanced","province","federal"].includes(t.relocationPreference)?t.relocationPreference:W.relocationPreference;return{budgetCad:m(x(t.budgetCad,W.budgetCad),500,2e4),weeklyHours:m(x(t.weeklyHours,W.weeklyHours),2,30),examAttempts:m(x(t.examAttempts,W.examAttempts),1,8),relocationPreference:n}}function Ct(e=new Date){const t=new Date(e);return t.setHours(0,0,0,0),t}function H(e,t){return new Date(e.getTime()+t*fe)}function J(e){try{return e.toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return e.toISOString().slice(0,10)}}function B(e,t,n){const i=H(e,Math.max(t-1,0)),a=H(e,Math.max(n-1,0));return{startDateIso:i.toISOString(),endDateIso:a.toISOString(),weekWindow:`Week ${Math.ceil(t/7)}-${Math.ceil(n/7)}`,dateWindow:`${J(i)} → ${J(a)}`}}function wt(e,t){const n=p(t);return e==="listening"?n>=8.5?10:n>=8?9:n>=7.5?8:n>=6?7:n>=5.5?6:n>=5?5:0:e==="reading"?n>=8?10:n>=7?9:n>=6.5?8:n>=6?7:n>=5?6:n>=4?5:0:n>=7.5?10:n>=7?9:n>=6.5?8:n>=6?7:n>=5.5?6:n>=5?5:0}function St(e={}){const t=["listening","reading","writing","speaking"],n=e.firstOfficialLanguage==="french",a=t.map(o=>n?x(e[`french_${o}`],0):e.langTestType==="celpip"?x(e[`celpip_${o}`],0):wt(o,e[`ielts_${o}`])).filter(o=>o>0);return a.length?Math.min(...a):0}function v(e,t,n,i="medium"){return{id:e,label:t,detail:n,severity:i}}function vt(e){return e==="high"?10:e==="medium"?5:2}function Pt(e="Medium"){return e==="Easy"?100:e==="Medium"?68:38}function Mt(e=0){return e>=76?"High":e>=56?"Medium":"Low"}function _t(e={},t,n){const i=p(t?.total),a=n-i,o=x(e.age,0),r=St(e),c=e.hasFrench==="yes"||e.firstOfficialLanguage==="french",s=x(e.canadianWorkExp,0),d=x(e.foreignWorkExp,0),f=r>=9?18:r>=7?46:74,u=m((o>=33?28:14)+(r<7?26:r<9?16:6)+(s===0?12:4)+(d>=3?8:3),10,90),g=[{key:"answers_accuracy",label:"Profile values are accurate and complete",confidence:e.knowsScore==="yes"?"Medium":"High"},{key:"draw_trend_stability",label:"Recent draw patterns remain directionally similar",confidence:Math.abs(a)<=20?"Medium":"Low"},{key:"execution_discipline",label:"You can sustain weekly execution cadence for 90 days",confidence:u<=45?"High":u<=65?"Medium":"Low"}],l=[];return o>=33&&l.push(v("risk-age-decay","Age-point decay risk","Delays can reduce score as age thresholds change.",o>=38?"high":"medium")),r>0&&r<7&&l.push(v("risk-language-floor","Language floor below CLB 7","Several lanes become weaker or inaccessible below CLB 7.","high")),c||l.push(v("risk-no-french","No French upside yet","You may miss lower-cutoff category opportunities tied to French strength.","low")),a>40&&l.push(v("risk-large-gap","Large score gap","A single action may not close this gap; a combination strategy is likely required.","high")),{score:i,gap:a,age:o,minLanguageClb:r,hasFrench:c,canadianWorkExp:s,foreignWorkExp:d,languageHeadroom:f,profileComplexity:u,assumptions:g,globalRiskFlags:l}}function xt(e,t,n){const i=e.category==="Language"?50+t.languageHeadroom*.45:e.category==="Provincial"?72:e.category==="Combination"?76:60,a=m(i+(e.goalReached?8:0)+(e.likelihoodPercent-50)*.35,30,95),o=[];return e.estimatedMonths>=10&&o.push(v(`${e.id}-timeline`,"Long timeline","This lane can take substantial time before score impact materializes.","medium")),e.difficulty==="Hard"&&o.push(v(`${e.id}-effort`,"Execution intensity","Consistent weekly effort is required to avoid plan drift.","medium")),!e.goalReached&&n>0&&o.push(v(`${e.id}-bridge`,"May require a second lane","This lane may need a backup action to fully close your gap.","low")),{id:`path-${e.id}`,title:e.title,lane:e.category,reason:e.whyItFits,scoreGain:e.potentialGain,months:e.estimatedMonths,confidence:e.likelihoodPercent,effort:e.difficulty,estimatedCostCad:p(e.estimatedCostCad,0),examSensitive:e.category==="Language"||/language|ielts|celpip|tef|tcf|french/i.test(e.title||""),laneFit:a,riskFlags:o}}function Tt({score:e,cutoff:t,eligibleCount:n,signals:i}){const a=t-e,o=a<=0?82:a<=20?64:38,r=[];return n||r.push(v("category-not-eligible","Not category-eligible yet","A prerequisite profile change is required before this lane can be used.","high")),a>35&&r.push(v("category-gap","Gap still material","Category targeting helps, but the score gap remains significant.","medium")),{id:"lane-category-draws",title:"Category Draw Positioning",lane:"Category Draws",reason:n>0?`You match ${n} category stream(s). Improve targeted factors to close the category cutoff gap.`:"You are not currently category-eligible; targeted profile adjustments can unlock lower-cutoff streams.",scoreGain:m(Math.round(Math.max(a,0)*.5),0,80),months:a<=0?1:a<=20?4:8,confidence:o,effort:a<=0?"Easy":a<=20?"Medium":"Hard",estimatedCostCad:1200,examSensitive:!i.hasFrench,laneFit:m((n>0?70:35)+(i.hasFrench?8:0),25,90),riskFlags:r}}function Lt(e){if(!e)return null;const t=[];return e.matchScore<55&&t.push(v(`province-${e.id}-fit`,"Lower province fit","Province alignment is currently moderate; stream targeting needs tighter matching.","high")),e.matchScore>=55&&e.matchScore<70&&t.push(v(`province-${e.id}-variance`,"Selection variance","Provincial intake criteria can shift and may require profile tuning.","medium")),{id:`lane-province-${e.id}`,title:`${e.name} PNP Focus`,lane:"Provincial",reason:`${e.name} has the highest profile match in your province analysis.`,scoreGain:e.matchScore>=70?600:300,months:e.matchScore>=70?6:9,confidence:m(e.matchScore,35,88),effort:e.matchScore>=70?"Medium":"Hard",estimatedCostCad:e.matchScore>=70?3200:4200,examSensitive:!1,laneFit:m(e.matchScore+(e.matchScore>=70?6:-4),25,95),riskFlags:t}}function Ft(e={},t=0){return[{key:"coreHumanCapital",label:"Core profile factors",value:p(e.coreHumanCapital)},{key:"skillTransferability",label:"Transferability factors",value:p(e.skillTransferability)},{key:"additionalPoints",label:"Additional point factors",value:p(e.additionalPoints)},{key:"spouseFactors",label:"Spouse factors",value:p(e.spouseFactors)}].map(i=>({...i,headroom:m(100-Math.round(i.value/Math.max(t,1)*100),0,100)})).sort((i,a)=>a.headroom-i.headroom).slice(0,2)}function It(e,t){const n=Math.max(Math.abs(t),35),i=m(Math.round(e.scoreGain/n*100),8,100),a=m(100-e.months*11,12,100),o=m(e.confidence,12,100),r=Pt(e.effort),c=m(p(e.laneFit,60),10,100),s=i*S.impact+a*S.speed+o*S.confidence+r*S.effort+c*S.laneFit,d=Array.isArray(e.riskFlags)?e.riskFlags:[],f=m(d.reduce((g,l)=>g+vt(l.severity),0),0,24),u=m(Math.round(s-f),1,100);return{...e,score:u,riskPenalty:f,scoreBreakdown:[{key:"impact",label:"Impact potential",value:i,weight:S.impact},{key:"speed",label:"Speed to value",value:a,weight:S.speed},{key:"confidence",label:"Data confidence",value:o,weight:S.confidence},{key:"effort",label:"Execution ease",value:r,weight:S.effort},{key:"laneFit",label:"Profile-lane fit",value:c,weight:S.laneFit}]}}function Et(e={}){const t=e.effort==="Hard"?10:e.effort==="Medium"?6:3,n=p(e.months,6)<=3?2:p(e.months,6)<=6?1:0;return t+n}function Wt(e={}){const t=p(e.estimatedCostCad,0);return t>0?t:e.lane==="Provincial"?3600:e.lane==="Category Draws"?1200:e.lane==="Language"?1800:2200}function Dt(e={}){return/provincial/i.test(e.lane||"")}function Ot(e,t){const n=ge(t),i=[],a=Wt(e),o=Et(e);let r=0;const c=n.budgetCad/Math.max(a,1);if(c<.75){const l=Math.min(Math.round((.75-c)*20),12);r-=l,i.push({id:"budget",label:"Budget pressure",delta:-l})}else if(c>1.35){const l=Math.min(Math.round((c-1.35)*8),5);r+=l,i.push({id:"budget",label:"Budget headroom",delta:l})}const s=n.weeklyHours-o;if(s<0){const l=Math.min(Math.abs(s)*2,10);r-=l,i.push({id:"time",label:"Time constraint",delta:-l})}else if(s>0){const l=Math.min(s,4);r+=l,i.push({id:"time",label:"Time capacity",delta:l})}if(e.examSensitive){if(n.examAttempts<=1)r-=8,i.push({id:"exam",label:"Low exam retry budget",delta:-8});else if(n.examAttempts>=3){const l=Math.min((n.examAttempts-2)*2,4);r+=l,i.push({id:"exam",label:"Exam retry flexibility",delta:l})}}const d=Dt(e);if(n.relocationPreference==="province"){const l=d?8:-3;r+=l,i.push({id:"relocation",label:"Province-focused preference",delta:l})}else if(n.relocationPreference==="federal"){const l=d?-7:4;r+=l,i.push({id:"relocation",label:"Federal-focused preference",delta:l})}const f=m(Math.round(r),-24,18),u=m(e.score+f,1,100),g=m(Math.round(70+f*2),12,99);return{...e,baseScore:e.score,score:u,constraintAdjustment:f,constraintFitScore:g,constraintFactors:i,estimatedCostCad:a,requiredWeeklyHours:o}}function Nt(e){const t=new Date(e?.date||"");return Number.isNaN(t.getTime())?null:t}function Rt(e={},t=10){return[...e.generalProgram||[],...e.categoryBased||[],...e.pnpDraws||[]].map(i=>({score:p(i?.score),date:Nt(i),program:i?.program||"Unknown"})).filter(i=>i.score>0&&i.date).sort((i,a)=>a.date.getTime()-i.date.getTime()).slice(0,t)}function $t(e=[]){if(!e.length)return 0;const t=e.reduce((i,a)=>i+a,0)/e.length,n=e.reduce((i,a)=>i+(a-t)**2,0)/e.length;return Math.sqrt(n)}function pe(e=0){return e>=75?"High":e>=55?"Medium":"Low"}function Q({scoreGap:e=0,volatility:t=0,confidence:n=60}){const i=m((e+80)/160,0,1),a=m(p(t)/120,0,.26),o=m(p(n,60)/100,0,1)*.2,r=i*.72+o-a;return m(r,.02,.98)}function At({forecast:e,averageCutoff:t,horizonMonths:n}){if(!e)return Math.round(p(t,520));const i=p(e.projectedNextCutoff,p(t,520)),a=p(e.slopePerDraw,0),o=Math.max(Math.round(n/2),1);return Math.round(m(i+a*Math.max(o-1,0),300,800))}function Gt(e=0){return e>=70?"High":e>=45?"Medium":"Low"}function Ht({strategy:e,forecast:t,actionPlan:n,averageCutoff:i,userScore:a}){const o=p(a,p(e?.score,0)),r=Math.max(p(e?.top?.scoreGain,0),0),c=m(p(n?.completionPct,0),0,100),s=m(c/100*.55+.45,.4,1),d=p(t?.volatility,14),f=p(t?.confidenceScore,e?.overallConfidence||58),u=e?.top?.title||"Primary strategy lane",g=bt.map(y=>{const C=At({forecast:t,averageCutoff:i,horizonMonths:y.months}),M=Math.round(r*y.gainFactor*s),T=o+M,L=Math.round(T-C),R=Q({scoreGap:L,volatility:d,confidence:f}),X=Q({scoreGap:L+Math.max(Math.round(r*.35),8),volatility:d*.75,confidence:f+8}),$=Q({scoreGap:L-Math.max(Math.round(r*.45),10),volatility:d*1.25,confidence:f-10}),F=Math.round(R*100),j=Math.round(X*100),ee=Math.round($*100),h=m(Math.round(26+d*.8-f*.18),8,34),_=m(Math.round(F-h/2),1,99),Ut=m(Math.round(F+h/2),1,99);return{id:y.id,label:y.label,months:y.months,projectedCutoff:C,expectedScore:T,expectedGain:M,scoreGap:L,baseProbabilityPct:F,bestProbabilityPct:j,worstProbabilityPct:ee,chanceBand:Gt(F),confidenceInterval:{lowPct:_,highPct:Ut,uncertaintyPct:h}}}),k=[...g].sort((y,C)=>C.baseProbabilityPct!==y.baseProbabilityPct?C.baseProbabilityPct-y.baseProbabilityPct:y.months-C.months)[0]||g[0]||null,P=k?.id||"6m",b=pe(f),w=[{id:"top_lane_gain",label:`${u} expected gain`,value:`+${Math.round(r)} pts potential`,influence:r>=20?"positive":"neutral"},{id:"execution_cadence",label:"Execution cadence",value:`${c}% action-plan completion`,influence:c>=55?"positive":c>=25?"neutral":"negative"},{id:"draw_volatility",label:"Draw volatility pressure",value:`${Number(d).toFixed(2)} volatility`,influence:d<=12?"positive":d<=24?"neutral":"negative"}];return{generatedAt:new Date().toISOString(),confidenceBand:b,recommendedHorizonId:P,topLane:u,horizons:g,keyDrivers:w,summary:k?`Best current horizon: ${k.label} with ${k.baseProbabilityPct}% base invitation probability.`:"Digital twin is preparing probability projections."}}function Bt({activeDraws:e,userScore:t,baseConfidence:n=60}){const i=Rt(e,10);if(!i.length)return null;const a=i[0],o=[...i].reverse(),r=o[0],c=o[o.length-1],s=o.length,d=s>1?(c.score-r.score)/(s-1):0,f=a.score,u=Math.round(m(f+d,300,800)),g=Math.round(m(u+d,300,800)),l=Math.round(m(g+d,300,800)),k=Math.round((u+g+l)/3),P=$t(i.map(R=>R.score)),b=a.date,w=b?Math.floor((Date.now()-b.getTime())/fe):999;let y=p(n,60);y+=Math.min(s*3,18),y-=Math.min(P*1.2,24),w<=2?y+=5:w<=7?y+=1:w>14&&(y-=9),y=m(Math.round(y),20,92);const C=d>1.5?"rising":d<-1.5?"falling":"stable",M=C==="rising"?"Cutoff trend is rising":C==="falling"?"Cutoff trend is falling":"Cutoff trend is stable",T=p(t)-u,L=T>=20?"High":T>=0?"Medium":"Low";return{sampleSize:s,volatility:Number(P.toFixed(2)),slopePerDraw:Number(d.toFixed(2)),projectedNextCutoff:u,projectedThreeDrawAvg:k,projectedDraws:[u,g,l],trendDirection:C,trendLabel:M,confidenceScore:y,confidenceBand:pe(y),invitationLikelihood:L,userGapToNext:T,latestObservedCutoff:f,latestObservedProgram:a.program,latestObservedDateIso:b?.toISOString()||""}}function jt({answers:e,result:t,averageCutoff:n,categoryInfo:i=[],provinces:a=[],eligibleCategoryCount:o=Number.NaN,optimizerConstraints:r=W}){const c=ge(r),s=p(t?.total),d=p(n,520),f=d-s,u=_t(e,t,d),l=(yt(e,t,{averageCutoff:d}).plans||[]).slice(0,2).map(h=>xt(h,u,f)),k=p(o,Number.NaN),P=Number.isFinite(k)?Math.max(Math.round(k),0):i.filter(h=>typeof h?.check=="function"&&h.check(e)).length,b=Tt({score:s,cutoff:d,eligibleCount:P,signals:u}),w=Lt((a||[])[0]||null),C=[...l,b,w].filter(Boolean).map(h=>It(h,f)).map(h=>Ot(h,c)).sort((h,_)=>_.score-h.score).slice(0,4),M=C[0]||null,T=C[1]||null,L=Ft(t?.breakdown,s),R=[...u.globalRiskFlags||[],...C.slice(0,2).flatMap(h=>h.riskFlags||[])],X=Object.values(R.reduce((h,_)=>(_?.id&&(h[_.id]||(h[_.id]=_)),h),{})).slice(0,5),$=C.slice(0,2).map(h=>m(h.confidence-h.riskPenalty,0,100)),F=$.length?Math.round($.reduce((h,_)=>h+_,0)/$.length):36,j=Mt(F),ee=M?`Primary lane: ${M.title}. Estimated gain ${M.scoreGain} points in ~${M.months} months (${j.toLowerCase()} confidence).`:"No strong lane detected yet. Start by improving language and category eligibility.";return{score:s,cutoff:d,gap:f,ranked:C,top:M,nextBest:T,bottlenecks:L,assumptions:u.assumptions,globalRiskFlags:X,overallConfidence:F,confidenceBand:j,profileSignals:{minLanguageClb:u.minLanguageClb,profileComplexity:u.profileComplexity,languageHeadroom:u.languageHeadroom},optimizerConstraints:c,scoreWeights:S,guidanceSummary:ee}}function zt({answers:e,result:t,suggestions:n=[],averageCutoff:i,activeDraws:a,categoryInfo:o=[],provinces:r=[],progress:c={},enableAdvancedForecasting:s=!1,eligibleCategoryCount:d=Number.NaN,optimizerConstraints:f=W}){const u=jt({answers:e,result:t,averageCutoff:i,categoryInfo:o,provinces:r,eligibleCategoryCount:d,optimizerConstraints:f}),g=Yt({suggestions:n,strategy:u,scoreGap:Math.max((i||0)-(t?.total||0),0),progress:c}),l=s?Bt({activeDraws:a,userScore:t?.total||0,baseConfidence:u.overallConfidence}):null,k=Ht({strategy:u,forecast:l,actionPlan:g,averageCutoff:i,userScore:t?.total||0});return{strategy:u,actionPlan:g,forecast:l,digitalTwin:k}}function D(e,t,n,i,a,o,r,c="Medium",s,d={}){const{startDateIso:f,endDateIso:u,weekWindow:g,dateWindow:l}=B(s,i,a);return{id:e,title:t,rationale:n,window:kt(i,a),dayFrom:i,dayTo:a,impact:o,lane:r,priority:c,startDateIso:f,endDateIso:u,weekWindow:g,dateWindow:l,successMetric:d.successMetric||"Task completed with verified profile update.",checkpoint:d.checkpoint||"Run a score recalculation and note delta.",dependencies:d.dependencies||[],cadence:d.cadence||"3 focused sessions per week"}}function Yt({suggestions:e=[],strategy:t,scoreGap:n=0,progress:i={}}){const a=e[1],o=t?.top?.title||"Profile Optimization",r=Math.max(p(n),0),c=Ct(new Date),s=[D("plan-baseline","Lock baseline and target score",`Set a concrete target and freeze your baseline profile to avoid random changes. Current gap: ${r} points.`,1,7,0,o,"High",c,{successMetric:"Target score and top lane documented; baseline snapshot saved.",checkpoint:"Save profile with date tag and score target.",cadence:"One 45-minute planning block + one review"}),D("plan-primary-lane",`Execute primary lane: ${o}`,t?.top?.reason||"Follow the highest-impact lane identified by optimizer.",8,30,t?.top?.scoreGain||10,o,"High",c,{successMetric:`Deliver at least 60% of ${o} milestones.`,checkpoint:"Verify measurable progress (test booking, docs, submissions, etc.)."}),D("plan-secondary-lane",a?`Secondary boost: ${a.title}`:"Secondary boost: language and profile precision",a?.description||"Add one additional improvement path to reduce draw uncertainty.",24,50,a?.potentialGain||8,a?.title||"Secondary path","Medium",c,{successMetric:"Secondary lane started with first concrete deliverable completed.",checkpoint:"Compare score delta before/after secondary-lane kickoff.",dependencies:["plan-primary-lane"]}),D("plan-document-pack","Prepare immigration document pack","Collect and verify key documents (identity, education, work proofs, test reports, proof-of-funds readiness).",35,68,0,"Readiness","High",c,{successMetric:"Core document checklist reaches 90% readiness.",checkpoint:"Review missing docs and issue dates.",cadence:"Two short admin sessions weekly"}),D("plan-risk-buffer","Activate fallback lane if progress stalls","If progress velocity is below target, start a backup action immediately (e.g., category-specific adjustment or province-first route).",55,80,6,"Fallback Control","Medium",c,{successMetric:"Fallback lane is selected and started within 7 days of stall signal.",checkpoint:"Mark stall trigger if expected gain is short by 20%+.",dependencies:["plan-primary-lane"]}),D("plan-profile-audit","Profile audit and draw readiness check","Re-evaluate score vs latest draws and category cutoffs. Trigger fallback lane if gap remains above 15 points.",75,90,0,"Risk Control","High",c,{successMetric:"Final 90-day readiness review completed with go/no-go decision.",checkpoint:"Capture current score, active cutoff delta, and next 30-day plan.",dependencies:["plan-document-pack"]})],d=[{label:"Days 1-30",objective:"Baseline lock + launch primary lane",expectedGain:s[1].impact,dateWindow:B(c,1,30).dateWindow},{label:"Days 31-60",objective:"Add secondary lane + document readiness",expectedGain:s[2].impact,dateWindow:B(c,31,60).dateWindow},{label:"Days 61-90",objective:"Fallback control + final draw readiness review",expectedGain:s[4].impact,dateWindow:B(c,61,90).dateWindow}],f=s.filter(b=>!!i[b.id]).length,u=s.length,g=u>0?Math.round(f/u*100):0,l=[...s].filter(b=>!i[b.id]).sort((b,w)=>{const y=me[w.priority]-me[b.priority];return y!==0?y:b.dayFrom-w.dayFrom})[0]||null,k=g>=100?"All action-plan tasks are complete. Keep a weekly score monitor to stay draw-ready.":l?`Next best task: ${l.title} (${l.dateWindow}).`:"Continue progressing through the plan in order of priority.",P=[14,30,60,90].map(b=>{const w=H(c,b-1);return{day:b,iso:w.toISOString(),label:J(w)}});return{tasks:s,milestones:d,completedCount:f,totalCount:u,completionPct:g,nextBestTask:l,completionGuidance:k,calendar:{planStartIso:c.toISOString(),planEndIso:H(c,89).toISOString(),reviewDates:P}}}self.onmessage=e=>{const t=e?.data||{},n=t.id;try{const i=zt(t.input||{});self.postMessage({id:n,status:"ok",data:i})}catch(i){self.postMessage({id:n,status:"error",error:String(i?.message||"Worker computation failed")})}}})();
