import{r as h,j as t}from"./vendor-react-Ah1pgjPn.js";import{c as jt,b as vt}from"./feature-path-coach-DVgRK0e5.js";const Ct={"header.title":"CRS Calculator 2026","welcome.heading":`Free CRS Calculator
for Express Entry 2026`,"welcome.sub":"Calculate your Comprehensive Ranking System (CRS) score for Canada Express Entry. Check FSW, CEC, PNP eligibility instantly. Updated with latest IRCC draw cutoffs.","welcome.btn":"Calculate My CRS Score Free","welcome.updated":"IRCC data updated:","welcome.trust":"Uses official IRCC draw data — last updated:","welcome.microcopy":"This will take 3 minutes — one question at a time.","welcome.resume":"You have an unfinished calculation.","welcome.resumeBtn":"Resume","welcome.startFresh":"Start Fresh","feature.accurate":"Official CRS Formula","feature.accurateDesc":"100% accurate IRCC scoring algorithm","feature.suggestions":"Boost Your Score","feature.suggestionsDesc":"Get personalized tips to gain +50 points","feature.draws":"2026 Draw Cutoffs","feature.drawsDesc":"Live IRCC Express Entry draw results","feature.instant":"Free & Instant","feature.instantDesc":"No signup required · Results in 2 minutes","wizard.step":"Step","wizard.of":"of","wizard.next":"Next →","wizard.back":"← Back","wizard.calculate":"Calculate Score ✓","results.breakdown":"Your CRS Score Breakdown","results.improve":"How to Increase Your CRS Score","results.category":"Category-Based Draw Eligibility","results.catIntro":"IRCC runs category-based draws with lower cutoffs for healthcare, STEM, trades, transport, and French speakers. Here's your eligibility:","results.timeline":"PR Timeline Estimate","results.draws":"Latest Express Entry Draws 2026","results.disclaimer":"This free CRS calculator provides an estimate based on IRCC's publicly available scoring criteria. Not affiliated with Immigration, Refugees and Citizenship Canada.","results.restart":"↻ Recalculate","results.share":"Share Results","results.pdf":"Download PDF","results.whatif":"What-If Score Simulator","results.whatifDesc":"See how improving IELTS, education, or work experience affects your CRS:","results.original":"Current","results.projected":"Projected","results.foreignWork":"Foreign Work (Skill Bonus)","strategy.actionCenter.title":"Action Center","strategy.actionCenter.subtitle":"Use this control center to execute the highest-impact moves with clear priority and risk visibility.","strategy.actionCenter.saveProfile":"Save profile","strategy.actionCenter.openOptimizer":"Open strategy optimizer","strategy.actionCenter.openForecast":"Open forecast","strategy.actionCenter.openPlan":"Open 90-day plan","strategy.actionCenter.comparePlans":"Compare plans","strategy.actionCenter.expertCoach":"Expert strategy coach","strategy.actionCenter.manageAccount":"Manage account","strategy.actionCenter.exportHandoff":"Export consultant handoff","strategy.actionCenter.profileStatus":"Profile save status","strategy.actionCenter.notSavedYet":"Not saved yet","strategy.actionCenter.planCompletion":"90-day completion","strategy.actionCenter.confidence":"Confidence","strategy.actionCenter.riskLevel":"Risk level","strategy.actionCenter.nextTask":"Next best task","strategy.actionCenter.startTask":"Start task","strategy.optimizer.title":"Strategy Optimizer","strategy.forecast.title":"Forecast Outlook","strategy.forecast.subtitle":"Projection based on recent draw cutoffs, volatility, and freshness of available data.","strategy.forecast.trend":"Trend","strategy.forecast.confidence":"Forecast confidence","strategy.forecast.sampleSize":"Sample size","strategy.forecast.likelihood":"Invitation likelihood","strategy.forecast.nextCutoff":"Projected next cutoff","strategy.forecast.threeDrawAvg":"3-draw avg","strategy.forecast.latestObserved":"Latest observed cutoff","strategy.forecast.gapToProjection":"Gap to projection","strategy.forecast.projectedSequence":"Projected sequence","strategy.forecast.volatility":"Volatility","strategy.forecast.slope":"Slope/draw","strategy.plan.title":"90-Day Action Plan","strategy.pricing.title":"Plans & Upgrade Path","strategy.pricing.experimentLabel":"Active experiment variant","strategy.pricing.freeCta":"Continue with Free","strategy.pricing.proCtaDefault":"Go to Pro setup","strategy.pricing.proCtaExperiment":"Start Pro planning","strategy.explainability.title":"Explainability & Confidence","footer.copy":"Free CRS Calculator 2026 · Not affiliated with IRCC"},kt={"header.title":"Calculateur SRC","welcome.heading":`Immigration au Canada
Calculateur de Points`,"welcome.sub":"Calculez votre score du Système de classement global (SCG) et découvrez votre meilleur chemin vers la résidence permanente canadienne.","welcome.btn":"Calculer Mon Score","welcome.updated":"Dernière mise à jour :","welcome.trust":"Données officielles d’IRCC — dernière mise à jour :","welcome.microcopy":"Cela prend 3 minutes — une question à la fois.","welcome.resume":"Vous avez un calcul en cours.","welcome.resumeBtn":"Reprendre","welcome.startFresh":"Recommencer","feature.accurate":"Score SCG Précis","feature.accurateDesc":"Calcul complet du Système de classement global","feature.suggestions":"Suggestions Intelligentes","feature.suggestionsDesc":"Conseils personnalisés pour augmenter vos points","feature.draws":"Derniers Tirages","feature.drawsDesc":"Résultats à jour des tirages Entrée express d'IRCC","feature.instant":"Résultats Instantanés","feature.instantDesc":"Obtenez votre score en moins de 2 minutes","wizard.step":"Étape","wizard.of":"de","wizard.next":"Suivant →","wizard.back":"← Retour","wizard.calculate":"Calculer le Score ✓","results.breakdown":"Détail de Votre Score","results.improve":"Comment Améliorer Votre Score","results.category":"Admissibilité aux Tirages par Catégorie","results.catIntro":"Le Canada organise des tirages spéciaux pour des groupes spécifiques avec des seuils plus bas. Voici ce à quoi vous pourriez être admissible :","results.timeline":"Calendrier Estimé","results.draws":"Tirages Récents Entrée Express","results.disclaimer":"Ce calculateur fournit une estimation basée sur les critères SCG publics. Il n'est pas affilié à IRCC.","results.restart":"↻ Recommencer","results.share":"Partager les Résultats","results.pdf":"Télécharger PDF","results.whatif":"Comparaison Hypothétique","results.whatifDesc":"Ajustez les variables pour voir comment votre score change :","results.original":"Original","results.projected":"Projeté","results.foreignWork":"Exp. Étrangère (Bonus)","strategy.actionCenter.title":"Centre d’action","strategy.actionCenter.subtitle":"Utilisez ce centre de contrôle pour exécuter les actions à plus fort impact avec priorités et risques visibles.","strategy.actionCenter.saveProfile":"Enregistrer le profil","strategy.actionCenter.openOptimizer":"Ouvrir l’optimiseur","strategy.actionCenter.openForecast":"Ouvrir la prévision","strategy.actionCenter.openPlan":"Ouvrir le plan 90 jours","strategy.actionCenter.comparePlans":"Comparer les offres","strategy.actionCenter.expertCoach":"Coach stratégie expert","strategy.actionCenter.manageAccount":"Gérer le compte","strategy.actionCenter.exportHandoff":"Exporter le dossier consultant","strategy.actionCenter.profileStatus":"Statut d’enregistrement","strategy.actionCenter.notSavedYet":"Pas encore enregistré","strategy.actionCenter.planCompletion":"Progression 90 jours","strategy.actionCenter.confidence":"Confiance","strategy.actionCenter.riskLevel":"Niveau de risque","strategy.actionCenter.nextTask":"Prochaine tâche prioritaire","strategy.actionCenter.startTask":"Démarrer la tâche","strategy.optimizer.title":"Optimiseur de stratégie","strategy.forecast.title":"Perspective de prévision","strategy.forecast.subtitle":"Projection basée sur les seuils récents, la volatilité et la fraîcheur des données.","strategy.forecast.trend":"Tendance","strategy.forecast.confidence":"Confiance de la prévision","strategy.forecast.sampleSize":"Taille d’échantillon","strategy.forecast.likelihood":"Probabilité d’invitation","strategy.forecast.nextCutoff":"Seuil projeté suivant","strategy.forecast.threeDrawAvg":"Moy. 3 tirages","strategy.forecast.latestObserved":"Dernier seuil observé","strategy.forecast.gapToProjection":"Écart à la projection","strategy.forecast.projectedSequence":"Séquence projetée","strategy.forecast.volatility":"Volatilité","strategy.forecast.slope":"Pente/tirage","strategy.plan.title":"Plan d’action 90 jours","strategy.pricing.title":"Offres et montée en gamme","strategy.pricing.experimentLabel":"Variante d’expérience active","strategy.pricing.freeCta":"Continuer en gratuit","strategy.pricing.proCtaDefault":"Accéder à la configuration Pro","strategy.pricing.proCtaExperiment":"Démarrer la planification Pro","strategy.explainability.title":"Explicabilité et confiance","footer.copy":"Calculateur SRC · Non affilié à IRCC"},ze={en:Ct,fr:kt},Je=h.createContext();function qn({children:e}){const[n,i]=h.useState(()=>{try{return localStorage.getItem("crs-lang")||"en"}catch{return"en"}}),a=h.useCallback(o=>{i(o);try{localStorage.setItem("crs-lang",o)}catch{}},[]),s=h.useCallback((o,l="")=>ze[n]?.[o]||ze.en[o]||l||o,[n]);return t.jsx(Je.Provider,{value:{lang:n,setLang:a,t:s},children:e})}function St(){return h.useContext(Je)}const Ke="crs-analytics-queue-v2",Le="crs-analytics-session-v1",$e="2.0",Nt=1800*1e3,_t=2500;function Qe(e,n){try{return e?JSON.parse(e):n}catch{return n}}function Pt(e,n){return typeof window>"u"?n:Qe(window.localStorage.getItem(e),n)}function Mt(e,n){if(!(typeof window>"u"))try{window.localStorage.setItem(e,JSON.stringify(n))}catch{}}function Xe(e="evt"){return`${e}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,9)}`}function Et(e,n=0){const i=Number(e);return Number.isFinite(i)?i:n}function At(e){return e?String(e).trim().toLowerCase().replace(/[^a-z0-9:_-]+/g,"_").slice(0,80):""}function Ze(e={}){const n={};for(const[i,a]of Object.entries(e||{}))if(!(!i||a==null)){if(typeof a=="string"){n[i]=a.slice(0,280);continue}if(typeof a=="number"||typeof a=="boolean"){n[i]=a;continue}if(Array.isArray(a)){n[i]=a.slice(0,20).map(s=>String(s).slice(0,120));continue}n[i]=String(a).slice(0,280)}return n}function Dt(){return Pt(Ke,[])}function Tt(e){const n=Array.isArray(e)?e.slice(-300):[];Mt(Ke,n)}function Rt(){if(typeof window>"u")return{id:"server",seq:0,started_at:new Date().toISOString()};const e=Date.now(),n=Qe(window.sessionStorage.getItem(Le),null),a=!n||!n.last_activity_ms||e-n.last_activity_ms>Nt?{id:Xe("sess"),seq:1,started_at:new Date().toISOString(),last_activity_ms:e}:{...n,seq:Et(n.seq,0)+1,last_activity_ms:e};try{window.sessionStorage.setItem(Le,JSON.stringify(a))}catch{}return a}function Ft(){if(typeof window>"u")return{app_version:"dev"};let e="unknown";try{e=Intl.DateTimeFormat().resolvedOptions().timeZone||"unknown"}catch{}return{app_version:"dev",lang:window.navigator?.language||"unknown",timezone:e,path:window.location?.pathname||"/"}}function It(e){return!1}async function Ot(e){if(typeof window>"u")return!1;const n=void 0;if(!It())return!1;const i=JSON.stringify(e);if(window.navigator?.sendBeacon&&document.visibilityState==="hidden")try{if(window.navigator.sendBeacon(n,new Blob([i],{type:"application/json"})))return!0}catch{}const a=typeof AbortController<"u"?new AbortController:null;let s=null;a&&(s=window.setTimeout(()=>a.abort(),_t));try{return(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:i,keepalive:!0,signal:a?.signal})).ok}catch{return!1}finally{s&&window.clearTimeout(s)}}function zt(e,n){if(!(typeof window>"u")&&typeof window.plausible=="function")try{window.plausible(e,{props:n})}catch{}}function Lt(e){if(e instanceof Error){const n=String(e.stack||"").split(`
`)[0]||"",i=e?.cause instanceof Error?e.cause.message:typeof e?.cause=="string"?e.cause:"";return{error_name:String(e.name||"Error").slice(0,120),error_message:String(e.message||"Unknown error").slice(0,280),error_stack_head:String(n||"").slice(0,280),error_cause:String(i||"").slice(0,200)}}return typeof e=="string"?{error_name:"Error",error_message:e.slice(0,280),error_stack_head:"",error_cause:""}:e&&typeof e=="object"?{error_name:String(e.name||"Error").slice(0,120),error_message:String(e.message||JSON.stringify(e)).slice(0,280),error_stack_head:String(e.stack||"").split(`
`)[0]?.slice(0,280)||"",error_cause:""}:{error_name:"Error",error_message:"Unknown error",error_stack_head:"",error_cause:""}}function T(e,n={}){if(typeof window>"u")return;const i=At(e);if(!i)return;const a=Rt(),s=Ze(n),o=Ft(),l={event_id:Xe("evt"),schema_version:$e,name:i,ts:new Date().toISOString(),session_id:a.id,session_seq:a.seq,session_started_at:a.started_at,payload:s,meta:o},d=Dt();d.push(l),Tt(d),zt(i,{...s,schema_version:$e,session_seq:a.seq}),Ot(l)}function Vn(e,n,i={}){if(typeof window>"u")return;const a=Ze(i),s=Lt(n),o=typeof navigator<"u"?navigator.onLine:void 0,l={...a,...s,online:typeof o=="boolean"?o:void 0,visibility:typeof document<"u"?document.visibilityState:void 0};T(e||"app_error",l)}const Ne="crs-runtime-flags-v1",ee={forceLocalData:!1,allowRemoteQuestionBank:!0,enableAdvancedForecasting:!0,enablePerfTelemetry:!0};function et(e){const n=e&&typeof e=="object"?e:{};return{forceLocalData:!!n.forceLocalData,allowRemoteQuestionBank:n.allowRemoteQuestionBank!==!1,enableAdvancedForecasting:n.enableAdvancedForecasting!==!1,enablePerfTelemetry:n.enablePerfTelemetry!==!1}}function Be(){if(typeof window>"u")return{...ee};try{const e=window.localStorage.getItem(Ne);if(!e)return{...ee};const n=JSON.parse(e);return{...ee,...et(n)}}catch{return{...ee}}}function Yn(e){const n={...ee,...et(e)};if(typeof window>"u")return n;try{window.localStorage.setItem(Ne,JSON.stringify(n))}catch{}try{window.dispatchEvent(new Event("crs-runtime-flags-updated"))}catch{}return n}function Jn(){if(typeof window>"u")return{...ee};try{window.localStorage.removeItem(Ne)}catch{}try{window.dispatchEvent(new Event("crs-runtime-flags-updated"))}catch{}return{...ee}}const ke="crs-exp-assignments-v1",$t="crs-exp-overrides-v1",He="crs-exp-visitor-id-v1",Ge="crs-exp-exposures-v1",_e={pricing_layout_v1:{variants:[{id:"control",weight:50},{id:"pro_first",weight:50}],goals:["pricing_cta_click","handoff_export"]}};function tt(e,n){try{return e?JSON.parse(e):n}catch{return n}}function Pe(e){return typeof window>"u"?{}:tt(window.localStorage.getItem(e),{})}function Bt(e,n){if(!(typeof window>"u"))try{window.localStorage.setItem(e,JSON.stringify(n||{}))}catch{}}function Ht(e){return typeof window>"u"?{}:tt(window.sessionStorage.getItem(e),{})}function Gt(e,n){if(!(typeof window>"u"))try{window.sessionStorage.setItem(e,JSON.stringify(n||{}))}catch{}}function Ut(e=""){let n=0;for(let i=0;i<e.length;i+=1)n=(n<<5)-n+e.charCodeAt(i),n|=0;return Math.abs(n)}function Wt(e,n,i=_e){const a=i?.[e];if(!a||!Array.isArray(a.variants)||a.variants.length===0)return"control";const s=a.variants.map(u=>({id:String(u.id||""),weight:Number(u.weight)>0?Number(u.weight):0})).filter(u=>u.id&&u.weight>0);if(!s.length)return"control";const o=s.reduce((u,y)=>u+y.weight,0),d=Ut(`${e}:${n||"default"}`)%o;let f=0;for(const u of s)if(f+=u.weight,d<f)return u.id;return s[s.length-1].id}function qt(){if(typeof window>"u")return"server";const e=String(window.localStorage.getItem(He)||"").trim();if(e)return e;const n=`visitor_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,9)}`;try{window.localStorage.setItem(He,n)}catch{}return n}function Vt(e){const n=Pe($t),i=String(n?.[e]||"").trim();return i&&_e[e]?.variants?.some(o=>o.id===i)?i:null}function Yt(e){if(typeof window>"u")return;const n=Ht(Ge),i=`${e.experimentKey}:${e.variant}`;n?.[e.experimentKey]!==i&&(Gt(Ge,{...n,[e.experimentKey]:i}),T("experiment_exposure",{experiment_key:e.experimentKey,experiment_variant:e.variant,experiment_source:e.source}))}function nt(e,{autoTrack:n=!1}={}){if(!_e[e])return{experimentKey:e,variant:"control",source:"unknown_experiment"};const a=Vt(e),s=qt(),o=a||Wt(e,s),l=a?"override":"hash",d=Pe(ke);d?.[e]!==o&&Bt(ke,{...d,[e]:o});const f={experimentKey:e,variant:o,source:l,visitorId:s};return n&&Yt(f),f}function ve(e,n,i={}){const a=nt(e,{autoTrack:!0});return T("experiment_goal",{experiment_key:a.experimentKey,experiment_variant:a.variant,experiment_source:a.source,goal:n,...i}),a}function Jt(){return Pe(ke)}function Kt(e={}){const n={};for(const[i,a]of Object.entries(e||{}))a!=null&&(typeof a=="string"||typeof a=="number"||typeof a=="boolean")&&(n[i]=a);return n}function Qt(e=[],n={}){return(Array.isArray(e)?e:[]).map(i=>{let a=!1;try{a=typeof i?.check=="function"?!!i.check(n):!1}catch{a=!1}return{id:i?.id||"",name:i?.name||"",recentCutoff:Number(i?.recentCutoff)||0,cutoffRange:i?.cutoffRange||"",source:i?.source||"unknown",updatedAt:i?.updatedAt||null,eligible:a}})}function Xt(e={}){return{confidenceBand:e?.confidenceBand||"Unknown",overallConfidence:Number(e?.overallConfidence)||0,score:Number(e?.score)||0,cutoff:Number(e?.cutoff)||0,gap:Number(e?.gap)||0,top:e?.top?{title:e.top.title,lane:e.top.lane,score:Number(e.top.score)||0,scoreGain:Number(e.top.scoreGain)||0,months:Number(e.top.months)||0,confidence:Number(e.top.confidence)||0,effort:e.top.effort||"Unknown"}:null,ranked:(e?.ranked||[]).slice(0,4).map(n=>({id:n.id,title:n.title,lane:n.lane,score:Number(n.score)||0,scoreGain:Number(n.scoreGain)||0,months:Number(n.months)||0,confidence:Number(n.confidence)||0,effort:n.effort||"Unknown"})),riskFlags:(e?.globalRiskFlags||[]).map(n=>({id:n.id,label:n.label,severity:n.severity}))}}function Zt(e={}){return{completionPct:Number(e?.completionPct)||0,completedCount:Number(e?.completedCount)||0,totalCount:Number(e?.totalCount)||0,nextBestTask:e?.nextBestTask?{id:e.nextBestTask.id,title:e.nextBestTask.title,dateWindow:e.nextBestTask.dateWindow,successMetric:e.nextBestTask.successMetric}:null,tasks:(e?.tasks||[]).map(n=>({id:n.id,title:n.title,lane:n.lane,priority:n.priority,impact:Number(n.impact)||0,dateWindow:n.dateWindow,weekWindow:n.weekWindow}))}}function en({answers:e={},result:n={},strategy:i={},forecast:a=null,actionPlan:s={},drawData:o={},categoryInfo:l=[]}={}){const d=Number(n?.total)||0,f=Number(o?.averageCutoff)||Number(i?.cutoff)||0;return{schema:"crs_consultant_handoff_v1",generatedAt:new Date().toISOString(),appVersion:"dev",summary:{score:d,averageCutoff:f,gapToAverageCutoff:d-f,confidenceBand:i?.confidenceBand||"Unknown"},policy:n?.policy||null,profileAnswers:Kt(e),scoreBreakdown:n?.breakdown||{},scoreDetails:n?.details||{},strategy:Xt(i),forecast:a?{trendLabel:a.trendLabel,confidenceBand:a.confidenceBand,confidenceScore:Number(a.confidenceScore)||0,projectedNextCutoff:Number(a.projectedNextCutoff)||0,projectedThreeDrawAvg:Number(a.projectedThreeDrawAvg)||0,projectedDraws:Array.isArray(a.projectedDraws)?a.projectedDraws:[],invitationLikelihood:a.invitationLikelihood||"Unknown"}:null,actionPlan:Zt(s),dataSnapshot:{drawLastUpdated:o?.lastUpdated||null,drawSource:o?.source||null,categoryCount:Array.isArray(l)?l.length:0,categoryEligibility:Qt(l,e)},experimentAssignments:Jt()}}function tn(e){return String(e||"").replace(/[:]/g,"-").replace(/\..+$/,"").replace("T","_").replace("Z","")}function nn(e,{filePrefix:n="consultant-handoff"}={}){if(typeof window>"u")return!1;try{const i=JSON.stringify(e,null,2),a=new Blob([i],{type:"application/json"}),s=window.URL.createObjectURL(a),o=document.createElement("a"),l=tn(e?.generatedAt||new Date().toISOString());return o.href=s,o.download=`${n}-${l}.json`,document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(s),!0}catch{return!1}}function rn(e){try{return btoa(encodeURIComponent(JSON.stringify(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}catch{return""}}function an(e){try{if(!e)return null;const n=String(e).replace(/-/g,"+").replace(/_/g,"/"),i=n.length%4===0?"":"=".repeat(4-n.length%4);return JSON.parse(decodeURIComponent(atob(n+i)))}catch{return null}}function sn(e){if(typeof window>"u")return"";const n=rn(e);if(!n)return"";const i=new URL(`${window.location.origin}${window.location.pathname}`);return i.searchParams.set("handoff",n),i.toString()}function Kn(e=window.location.search){try{const i=new URLSearchParams(e||"").get("handoff");return an(i)}catch{return null}}const rt="crs-saved-profiles-v1";function Me(){try{const e=localStorage.getItem(rt);if(!e)return{};const n=JSON.parse(e);return n&&typeof n=="object"?n:{}}catch{return{}}}function it(e){try{localStorage.setItem(rt,JSON.stringify(e))}catch{}}function on(){const e=Math.random().toString(36).slice(2,8);return`prf_${Date.now().toString(36)}_${e}`}function cn(){return`${Math.random().toString(36).slice(2,10)}${Math.random().toString(36).slice(2,10)}`}function ln(){const e=Me();return Object.values(e).sort((n,i)=>String(i.updatedAt).localeCompare(String(n.updatedAt)))}function Qn({id:e,name:n="",answers:i={},score:a=0,email:s="",alertOptIn:o=!1,alertToken:l=null}){const d=Me(),f=e||on(),u=new Date().toISOString(),y=d[f],g={id:f,name:n||y?.name||`Profile ${f.slice(-4)}`,answers:i,score:a,email:s,alertOptIn:!!o,alertToken:o?l||y?.alertToken||cn():null,createdAt:y?.createdAt||u,updatedAt:u};return d[f]=g,it(d),g}function Xn({reason:e="autopilot",force:n=!1}={}){const i=Me(),a=Object.entries(i||{});if(!a.length)return{status:"noop",reason:e,scanned:0,updated:0,skipped:0,policyVersion:""};let s=0,o=0,l="";const d=new Date().toISOString();for(const[f,u]of a){const y=u?.answers;if(!y||typeof y!="object"){o+=1;continue}const g=jt(y),c=Number(g?.total||0),m=String(g?.policy?.version||"");l=m||l;const E=Number(u?.score||0),k=String(u?.policyVersion||"");(n||E!==c||k!==m)&&(i[f]={...u,score:c,policyVersion:m,policyEffectiveDate:g?.policy?.effectiveDate||"",policySource:g?.policy?.source||"",policyRecalculatedAt:d},s+=1)}return s>0&&it(i),{status:s>0?"updated":"noop",reason:e,scanned:a.length,updated:s,skipped:o,policyVersion:l,recalculatedAt:d}}const at="crs-90-day-action-plan-v1",st=1440*60*1e3,Ue={High:3,Medium:2,Low:1},G={impact:.34,speed:.18,confidence:.22,effort:.12,laneFit:.14},J={budgetCad:3500,weeklyHours:6,examAttempts:2,relocationPreference:"balanced"},dn=[{id:"3m",label:"3 months",months:3,gainFactor:.35},{id:"6m",label:"6 months",months:6,gainFactor:.62},{id:"12m",label:"12 months",months:12,gainFactor:.88}];function b(e,n,i){return Math.max(n,Math.min(i,e))}function un(e,n){return`Day ${e}-${n}`}function j(e,n=0){const i=Number(e);return Number.isFinite(i)?i:n}function Q(e,n=0){const i=parseInt(e,10);return Number.isFinite(i)?i:n}function ne(e={}){const n=e&&typeof e=="object"?e:{},i=["balanced","province","federal"].includes(n.relocationPreference)?n.relocationPreference:J.relocationPreference;return{budgetCad:b(Q(n.budgetCad,J.budgetCad),500,2e4),weeklyHours:b(Q(n.weeklyHours,J.weeklyHours),2,30),examAttempts:b(Q(n.examAttempts,J.examAttempts),1,8),relocationPreference:i}}function pn(e=new Date){const n=new Date(e);return n.setHours(0,0,0,0),n}function ge(e,n){return new Date(e.getTime()+n*st)}function Se(e){try{return e.toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return e.toISOString().slice(0,10)}}function me(e,n,i){const a=ge(e,Math.max(n-1,0)),s=ge(e,Math.max(i-1,0));return{startDateIso:a.toISOString(),endDateIso:s.toISOString(),weekWindow:`Week ${Math.ceil(n/7)}-${Math.ceil(i/7)}`,dateWindow:`${Se(a)} → ${Se(s)}`}}function fn(e,n){const i=j(n);return e==="listening"?i>=8.5?10:i>=8?9:i>=7.5?8:i>=6?7:i>=5.5?6:i>=5?5:0:e==="reading"?i>=8?10:i>=7?9:i>=6.5?8:i>=6?7:i>=5?6:i>=4?5:0:i>=7.5?10:i>=7?9:i>=6.5?8:i>=6?7:i>=5.5?6:i>=5?5:0}function mn(e={}){const n=["listening","reading","writing","speaking"],i=e.firstOfficialLanguage==="french",s=n.map(o=>i?Q(e[`french_${o}`],0):e.langTestType==="celpip"?Q(e[`celpip_${o}`],0):fn(o,e[`ielts_${o}`])).filter(o=>o>0);return s.length?Math.min(...s):0}function U(e,n,i,a="medium"){return{id:e,label:n,detail:i,severity:a}}function gn(e){return e==="high"?10:e==="medium"?5:2}function hn(e="Medium"){return e==="Easy"?100:e==="Medium"?68:38}function yn(e=0){return e>=76?"High":e>=56?"Medium":"Low"}function xn(e={},n,i){const a=j(n?.total),s=i-a,o=Q(e.age,0),l=mn(e),d=e.hasFrench==="yes"||e.firstOfficialLanguage==="french",f=Q(e.canadianWorkExp,0),u=Q(e.foreignWorkExp,0),y=l>=9?18:l>=7?46:74,g=b((o>=33?28:14)+(l<7?26:l<9?16:6)+(f===0?12:4)+(u>=3?8:3),10,90),c=[{key:"answers_accuracy",label:"Profile values are accurate and complete",confidence:e.knowsScore==="yes"?"Medium":"High"},{key:"draw_trend_stability",label:"Recent draw patterns remain directionally similar",confidence:Math.abs(s)<=20?"Medium":"Low"},{key:"execution_discipline",label:"You can sustain weekly execution cadence for 90 days",confidence:g<=45?"High":g<=65?"Medium":"Low"}],m=[];return o>=33&&m.push(U("risk-age-decay","Age-point decay risk","Delays can reduce score as age thresholds change.",o>=38?"high":"medium")),l>0&&l<7&&m.push(U("risk-language-floor","Language floor below CLB 7","Several lanes become weaker or inaccessible below CLB 7.","high")),d||m.push(U("risk-no-french","No French upside yet","You may miss lower-cutoff category opportunities tied to French strength.","low")),s>40&&m.push(U("risk-large-gap","Large score gap","A single action may not close this gap; a combination strategy is likely required.","high")),{score:a,gap:s,age:o,minLanguageClb:l,hasFrench:d,canadianWorkExp:f,foreignWorkExp:u,languageHeadroom:y,profileComplexity:g,assumptions:c,globalRiskFlags:m}}function ot(e={}){const n=[e.age,e.education,e.pathway,e.canadianWorkExp,e.foreignWorkExp,e.hasFrench,e.hasPNP].join("|");let i=0;for(let a=0;a<n.length;a+=1)i=(i<<5)-i+n.charCodeAt(a),i|=0;return Math.abs(i).toString(16)}function bn(e,n,i){const a=e.category==="Language"?50+n.languageHeadroom*.45:e.category==="Provincial"?72:e.category==="Combination"?76:60,s=b(a+(e.goalReached?8:0)+(e.likelihoodPercent-50)*.35,30,95),o=[];return e.estimatedMonths>=10&&o.push(U(`${e.id}-timeline`,"Long timeline","This lane can take substantial time before score impact materializes.","medium")),e.difficulty==="Hard"&&o.push(U(`${e.id}-effort`,"Execution intensity","Consistent weekly effort is required to avoid plan drift.","medium")),!e.goalReached&&i>0&&o.push(U(`${e.id}-bridge`,"May require a second lane","This lane may need a backup action to fully close your gap.","low")),{id:`path-${e.id}`,title:e.title,lane:e.category,reason:e.whyItFits,scoreGain:e.potentialGain,months:e.estimatedMonths,confidence:e.likelihoodPercent,effort:e.difficulty,estimatedCostCad:j(e.estimatedCostCad,0),examSensitive:e.category==="Language"||/language|ielts|celpip|tef|tcf|french/i.test(e.title||""),laneFit:s,riskFlags:o}}function wn({score:e,cutoff:n,eligibleCount:i,signals:a}){const s=n-e,o=s<=0?82:s<=20?64:38,l=[];return i||l.push(U("category-not-eligible","Not category-eligible yet","A prerequisite profile change is required before this lane can be used.","high")),s>35&&l.push(U("category-gap","Gap still material","Category targeting helps, but the score gap remains significant.","medium")),{id:"lane-category-draws",title:"Category Draw Positioning",lane:"Category Draws",reason:i>0?`You match ${i} category stream(s). Improve targeted factors to close the category cutoff gap.`:"You are not currently category-eligible; targeted profile adjustments can unlock lower-cutoff streams.",scoreGain:b(Math.round(Math.max(s,0)*.5),0,80),months:s<=0?1:s<=20?4:8,confidence:o,effort:s<=0?"Easy":s<=20?"Medium":"Hard",estimatedCostCad:1200,examSensitive:!a.hasFrench,laneFit:b((i>0?70:35)+(a.hasFrench?8:0),25,90),riskFlags:l}}function jn(e){if(!e)return null;const n=[];return e.matchScore<55&&n.push(U(`province-${e.id}-fit`,"Lower province fit","Province alignment is currently moderate; stream targeting needs tighter matching.","high")),e.matchScore>=55&&e.matchScore<70&&n.push(U(`province-${e.id}-variance`,"Selection variance","Provincial intake criteria can shift and may require profile tuning.","medium")),{id:`lane-province-${e.id}`,title:`${e.name} PNP Focus`,lane:"Provincial",reason:`${e.name} has the highest profile match in your province analysis.`,scoreGain:e.matchScore>=70?600:300,months:e.matchScore>=70?6:9,confidence:b(e.matchScore,35,88),effort:e.matchScore>=70?"Medium":"Hard",estimatedCostCad:e.matchScore>=70?3200:4200,examSensitive:!1,laneFit:b(e.matchScore+(e.matchScore>=70?6:-4),25,95),riskFlags:n}}function vn(e={},n=0){return[{key:"coreHumanCapital",label:"Core profile factors",value:j(e.coreHumanCapital)},{key:"skillTransferability",label:"Transferability factors",value:j(e.skillTransferability)},{key:"additionalPoints",label:"Additional point factors",value:j(e.additionalPoints)},{key:"spouseFactors",label:"Spouse factors",value:j(e.spouseFactors)}].map(a=>({...a,headroom:b(100-Math.round(a.value/Math.max(n,1)*100),0,100)})).sort((a,s)=>s.headroom-a.headroom).slice(0,2)}function Cn(e,n){const i=Math.max(Math.abs(n),35),a=b(Math.round(e.scoreGain/i*100),8,100),s=b(100-e.months*11,12,100),o=b(e.confidence,12,100),l=hn(e.effort),d=b(j(e.laneFit,60),10,100),f=a*G.impact+s*G.speed+o*G.confidence+l*G.effort+d*G.laneFit,u=Array.isArray(e.riskFlags)?e.riskFlags:[],y=b(u.reduce((c,m)=>c+gn(m.severity),0),0,24),g=b(Math.round(f-y),1,100);return{...e,score:g,riskPenalty:y,scoreBreakdown:[{key:"impact",label:"Impact potential",value:a,weight:G.impact},{key:"speed",label:"Speed to value",value:s,weight:G.speed},{key:"confidence",label:"Data confidence",value:o,weight:G.confidence},{key:"effort",label:"Execution ease",value:l,weight:G.effort},{key:"laneFit",label:"Profile-lane fit",value:d,weight:G.laneFit}]}}function kn(e={}){const n=e.effort==="Hard"?10:e.effort==="Medium"?6:3,i=j(e.months,6)<=3?2:j(e.months,6)<=6?1:0;return n+i}function Sn(e={}){const n=j(e.estimatedCostCad,0);return n>0?n:e.lane==="Provincial"?3600:e.lane==="Category Draws"?1200:e.lane==="Language"?1800:2200}function Nn(e={}){return/provincial/i.test(e.lane||"")}function _n(e,n){const i=ne(n),a=[],s=Sn(e),o=kn(e);let l=0;const d=i.budgetCad/Math.max(s,1);if(d<.75){const m=Math.min(Math.round((.75-d)*20),12);l-=m,a.push({id:"budget",label:"Budget pressure",delta:-m})}else if(d>1.35){const m=Math.min(Math.round((d-1.35)*8),5);l+=m,a.push({id:"budget",label:"Budget headroom",delta:m})}const f=i.weeklyHours-o;if(f<0){const m=Math.min(Math.abs(f)*2,10);l-=m,a.push({id:"time",label:"Time constraint",delta:-m})}else if(f>0){const m=Math.min(f,4);l+=m,a.push({id:"time",label:"Time capacity",delta:m})}if(e.examSensitive){if(i.examAttempts<=1)l-=8,a.push({id:"exam",label:"Low exam retry budget",delta:-8});else if(i.examAttempts>=3){const m=Math.min((i.examAttempts-2)*2,4);l+=m,a.push({id:"exam",label:"Exam retry flexibility",delta:m})}}const u=Nn(e);if(i.relocationPreference==="province"){const m=u?8:-3;l+=m,a.push({id:"relocation",label:"Province-focused preference",delta:m})}else if(i.relocationPreference==="federal"){const m=u?-7:4;l+=m,a.push({id:"relocation",label:"Federal-focused preference",delta:m})}const y=b(Math.round(l),-24,18),g=b(e.score+y,1,100),c=b(Math.round(70+y*2),12,99);return{...e,baseScore:e.score,score:g,constraintAdjustment:y,constraintFitScore:c,constraintFactors:a,estimatedCostCad:s,requiredWeeklyHours:o}}function Pn(e){const n=new Date(e?.date||"");return Number.isNaN(n.getTime())?null:n}function Mn(e={},n=10){return[...e.generalProgram||[],...e.categoryBased||[],...e.pnpDraws||[]].map(a=>({score:j(a?.score),date:Pn(a),program:a?.program||"Unknown"})).filter(a=>a.score>0&&a.date).sort((a,s)=>s.date.getTime()-a.date.getTime()).slice(0,n)}function En(e=[]){if(!e.length)return 0;const n=e.reduce((a,s)=>a+s,0)/e.length,i=e.reduce((a,s)=>a+(s-n)**2,0)/e.length;return Math.sqrt(i)}function ct(e=0){return e>=75?"High":e>=55?"Medium":"Low"}function Ce({scoreGap:e=0,volatility:n=0,confidence:i=60}){const a=b((e+80)/160,0,1),s=b(j(n)/120,0,.26),o=b(j(i,60)/100,0,1)*.2,l=a*.72+o-s;return b(l,.02,.98)}function An({forecast:e,averageCutoff:n,horizonMonths:i}){if(!e)return Math.round(j(n,520));const a=j(e.projectedNextCutoff,j(n,520)),s=j(e.slopePerDraw,0),o=Math.max(Math.round(i/2),1);return Math.round(b(a+s*Math.max(o-1,0),300,800))}function Dn(e=0){return e>=70?"High":e>=45?"Medium":"Low"}function Tn({strategy:e,forecast:n,actionPlan:i,averageCutoff:a,userScore:s}){const o=j(s,j(e?.score,0)),l=Math.max(j(e?.top?.scoreGain,0),0),d=b(j(i?.completionPct,0),0,100),f=b(d/100*.55+.45,.4,1),u=j(n?.volatility,14),y=j(n?.confidenceScore,e?.overallConfidence||58),g=e?.top?.title||"Primary strategy lane",c=dn.map(C=>{const N=An({forecast:n,averageCutoff:a,horizonMonths:C.months}),O=Math.round(l*C.gainFactor*f),A=o+O,B=Math.round(A-N),K=Ce({scoreGap:B,volatility:u,confidence:y}),W=Ce({scoreGap:B+Math.max(Math.round(l*.35),8),volatility:u*.75,confidence:y+8}),q=Ce({scoreGap:B-Math.max(Math.round(l*.45),10),volatility:u*1.25,confidence:y-10}),z=Math.round(K*100),V=Math.round(W*100),F=Math.round(q*100),v=b(Math.round(26+u*.8-y*.18),8,34),I=b(Math.round(z-v/2),1,99),ie=b(Math.round(z+v/2),1,99);return{id:C.id,label:C.label,months:C.months,projectedCutoff:N,expectedScore:A,expectedGain:O,scoreGap:B,baseProbabilityPct:z,bestProbabilityPct:V,worstProbabilityPct:F,chanceBand:Dn(z),confidenceInterval:{lowPct:I,highPct:ie,uncertaintyPct:v}}}),E=[...c].sort((C,N)=>N.baseProbabilityPct!==C.baseProbabilityPct?N.baseProbabilityPct-C.baseProbabilityPct:C.months-N.months)[0]||c[0]||null,k=E?.id||"6m",P=ct(y),_=[{id:"top_lane_gain",label:`${g} expected gain`,value:`+${Math.round(l)} pts potential`,influence:l>=20?"positive":"neutral"},{id:"execution_cadence",label:"Execution cadence",value:`${d}% action-plan completion`,influence:d>=55?"positive":d>=25?"neutral":"negative"},{id:"draw_volatility",label:"Draw volatility pressure",value:`${Number(u).toFixed(2)} volatility`,influence:u<=12?"positive":u<=24?"neutral":"negative"}];return{generatedAt:new Date().toISOString(),confidenceBand:P,recommendedHorizonId:k,topLane:g,horizons:c,keyDrivers:_,summary:E?`Best current horizon: ${E.label} with ${E.baseProbabilityPct}% base invitation probability.`:"Digital twin is preparing probability projections."}}function Rn({activeDraws:e,userScore:n,baseConfidence:i=60}){const a=Mn(e,10);if(!a.length)return null;const s=a[0],o=[...a].reverse(),l=o[0],d=o[o.length-1],f=o.length,u=f>1?(d.score-l.score)/(f-1):0,y=s.score,g=Math.round(b(y+u,300,800)),c=Math.round(b(g+u,300,800)),m=Math.round(b(c+u,300,800)),E=Math.round((g+c+m)/3),k=En(a.map(K=>K.score)),P=s.date,_=P?Math.floor((Date.now()-P.getTime())/st):999;let C=j(i,60);C+=Math.min(f*3,18),C-=Math.min(k*1.2,24),_<=2?C+=5:_<=7?C+=1:_>14&&(C-=9),C=b(Math.round(C),20,92);const N=u>1.5?"rising":u<-1.5?"falling":"stable",O=N==="rising"?"Cutoff trend is rising":N==="falling"?"Cutoff trend is falling":"Cutoff trend is stable",A=j(n)-g,B=A>=20?"High":A>=0?"Medium":"Low";return{sampleSize:f,volatility:Number(k.toFixed(2)),slopePerDraw:Number(u.toFixed(2)),projectedNextCutoff:g,projectedThreeDrawAvg:E,projectedDraws:[g,c,m],trendDirection:N,trendLabel:O,confidenceScore:C,confidenceBand:ct(C),invitationLikelihood:B,userGapToNext:A,latestObservedCutoff:y,latestObservedProgram:s.program,latestObservedDateIso:P?.toISOString()||""}}function Fn({answers:e,result:n,averageCutoff:i,categoryInfo:a=[],provinces:s=[],eligibleCategoryCount:o=Number.NaN,optimizerConstraints:l=J}){const d=ne(l),f=j(n?.total),u=j(i,520),y=u-f,g=xn(e,n,u),m=(vt(e,n,{averageCutoff:u}).plans||[]).slice(0,2).map(v=>bn(v,g,y)),E=j(o,Number.NaN),k=Number.isFinite(E)?Math.max(Math.round(E),0):a.filter(v=>typeof v?.check=="function"&&v.check(e)).length,P=wn({score:f,cutoff:u,eligibleCount:k,signals:g}),_=jn((s||[])[0]||null),N=[...m,P,_].filter(Boolean).map(v=>Cn(v,y)).map(v=>_n(v,d)).sort((v,I)=>I.score-v.score).slice(0,4),O=N[0]||null,A=N[1]||null,B=vn(n?.breakdown,f),K=[...g.globalRiskFlags||[],...N.slice(0,2).flatMap(v=>v.riskFlags||[])],W=Object.values(K.reduce((v,I)=>(I?.id&&(v[I.id]||(v[I.id]=I)),v),{})).slice(0,5),q=N.slice(0,2).map(v=>b(v.confidence-v.riskPenalty,0,100)),z=q.length?Math.round(q.reduce((v,I)=>v+I,0)/q.length):36,V=yn(z),F=O?`Primary lane: ${O.title}. Estimated gain ${O.scoreGain} points in ~${O.months} months (${V.toLowerCase()} confidence).`:"No strong lane detected yet. Start by improving language and category eligibility.";return{score:f,cutoff:u,gap:y,ranked:N,top:O,nextBest:A,bottlenecks:B,assumptions:g.assumptions,globalRiskFlags:W,overallConfidence:z,confidenceBand:V,profileSignals:{minLanguageClb:g.minLanguageClb,profileComplexity:g.profileComplexity,languageHeadroom:g.languageHeadroom},optimizerConstraints:d,scoreWeights:G,guidanceSummary:F}}function In({answers:e,result:n,suggestions:i=[],averageCutoff:a,activeDraws:s,categoryInfo:o=[],provinces:l=[],progress:d={},enableAdvancedForecasting:f=!1,eligibleCategoryCount:u=Number.NaN,optimizerConstraints:y=J}){const g=Fn({answers:e,result:n,averageCutoff:a,categoryInfo:o,provinces:l,eligibleCategoryCount:u,optimizerConstraints:y}),c=On({suggestions:i,strategy:g,scoreGap:Math.max((a||0)-(n?.total||0),0),progress:d}),m=f?Rn({activeDraws:s,userScore:n?.total||0,baseConfidence:g.overallConfidence}):null,E=Tn({strategy:g,forecast:m,actionPlan:c,averageCutoff:a,userScore:n?.total||0});return{strategy:g,actionPlan:c,forecast:m,digitalTwin:E}}function te(e,n,i,a,s,o,l,d="Medium",f,u={}){const{startDateIso:y,endDateIso:g,weekWindow:c,dateWindow:m}=me(f,a,s);return{id:e,title:n,rationale:i,window:un(a,s),dayFrom:a,dayTo:s,impact:o,lane:l,priority:d,startDateIso:y,endDateIso:g,weekWindow:c,dateWindow:m,successMetric:u.successMetric||"Task completed with verified profile update.",checkpoint:u.checkpoint||"Run a score recalculation and note delta.",dependencies:u.dependencies||[],cadence:u.cadence||"3 focused sessions per week"}}function On({suggestions:e=[],strategy:n,scoreGap:i=0,progress:a={}}){const s=e[1],o=n?.top?.title||"Profile Optimization",l=Math.max(j(i),0),d=pn(new Date),f=[te("plan-baseline","Lock baseline and target score",`Set a concrete target and freeze your baseline profile to avoid random changes. Current gap: ${l} points.`,1,7,0,o,"High",d,{successMetric:"Target score and top lane documented; baseline snapshot saved.",checkpoint:"Save profile with date tag and score target.",cadence:"One 45-minute planning block + one review"}),te("plan-primary-lane",`Execute primary lane: ${o}`,n?.top?.reason||"Follow the highest-impact lane identified by optimizer.",8,30,n?.top?.scoreGain||10,o,"High",d,{successMetric:`Deliver at least 60% of ${o} milestones.`,checkpoint:"Verify measurable progress (test booking, docs, submissions, etc.)."}),te("plan-secondary-lane",s?`Secondary boost: ${s.title}`:"Secondary boost: language and profile precision",s?.description||"Add one additional improvement path to reduce draw uncertainty.",24,50,s?.potentialGain||8,s?.title||"Secondary path","Medium",d,{successMetric:"Secondary lane started with first concrete deliverable completed.",checkpoint:"Compare score delta before/after secondary-lane kickoff.",dependencies:["plan-primary-lane"]}),te("plan-document-pack","Prepare immigration document pack","Collect and verify key documents (identity, education, work proofs, test reports, proof-of-funds readiness).",35,68,0,"Readiness","High",d,{successMetric:"Core document checklist reaches 90% readiness.",checkpoint:"Review missing docs and issue dates.",cadence:"Two short admin sessions weekly"}),te("plan-risk-buffer","Activate fallback lane if progress stalls","If progress velocity is below target, start a backup action immediately (e.g., category-specific adjustment or province-first route).",55,80,6,"Fallback Control","Medium",d,{successMetric:"Fallback lane is selected and started within 7 days of stall signal.",checkpoint:"Mark stall trigger if expected gain is short by 20%+.",dependencies:["plan-primary-lane"]}),te("plan-profile-audit","Profile audit and draw readiness check","Re-evaluate score vs latest draws and category cutoffs. Trigger fallback lane if gap remains above 15 points.",75,90,0,"Risk Control","High",d,{successMetric:"Final 90-day readiness review completed with go/no-go decision.",checkpoint:"Capture current score, active cutoff delta, and next 30-day plan.",dependencies:["plan-document-pack"]})],u=[{label:"Days 1-30",objective:"Baseline lock + launch primary lane",expectedGain:f[1].impact,dateWindow:me(d,1,30).dateWindow},{label:"Days 31-60",objective:"Add secondary lane + document readiness",expectedGain:f[2].impact,dateWindow:me(d,31,60).dateWindow},{label:"Days 61-90",objective:"Fallback control + final draw readiness review",expectedGain:f[4].impact,dateWindow:me(d,61,90).dateWindow}],y=f.filter(P=>!!a[P.id]).length,g=f.length,c=g>0?Math.round(y/g*100):0,m=[...f].filter(P=>!a[P.id]).sort((P,_)=>{const C=Ue[_.priority]-Ue[P.priority];return C!==0?C:P.dayFrom-_.dayFrom})[0]||null,E=c>=100?"All action-plan tasks are complete. Keep a weekly score monitor to stay draw-ready.":m?`Next best task: ${m.title} (${m.dateWindow}).`:"Continue progressing through the plan in order of priority.",k=[14,30,60,90].map(P=>{const _=ge(d,P-1);return{day:P,iso:_.toISOString(),label:Se(_)}});return{tasks:f,milestones:u,completedCount:y,totalCount:g,completionPct:c,nextBestTask:m,completionGuidance:E,calendar:{planStartIso:d.toISOString(),planEndIso:ge(d,89).toISOString(),reviewDates:k}}}function We(e={}){if(typeof window>"u")return{};const n=`${at}:${ot(e)}`;try{const i=window.localStorage.getItem(n);return i?JSON.parse(i):{}}catch{return{}}}function zn(e={},n={}){if(typeof window>"u")return;const i=`${at}:${ot(e)}`;try{window.localStorage.setItem(i,JSON.stringify(n||{}))}catch{}}function qe({value:e}){const n=e==="High"?"priority-high":e==="Medium"?"priority-medium":"priority-low";return t.jsx("span",{className:`priority-badge ${n}`,children:e})}function Ve({value:e}){const n=e==="Easy"?"effort-easy":e==="Medium"?"effort-medium":"effort-hard";return t.jsx("span",{className:`effort-badge ${n}`,children:e})}function Ye({value:e}){const n=e==="high"?"risk-high":e==="medium"?"risk-medium":"risk-low";return t.jsx("span",{className:`risk-badge ${n}`,children:e})}function Ln(e=""){return e==="High"?"assumption-high":e==="Medium"?"assumption-medium":"assumption-low"}function $n(e){return e==="free"?"Free":"Pro Tracking"}function pe(e,n=null){if(typeof window>"u")return n;try{const i=window.localStorage.getItem(e);return i?JSON.parse(i):n}catch{return n}}function fe(e,n){if(!(typeof window>"u"))try{window.localStorage.setItem(e,JSON.stringify(n))}catch{}}function Bn(e={}){const n=JSON.stringify(e||{});let i=0;for(let a=0;a<n.length;a+=1)i=(i<<5)-i+n.charCodeAt(a),i|=0;return Math.abs(i).toString(16)}function Hn({answers:e,result:n,suggestions:i,averageCutoff:a,activeDraws:s,activeCategoryInfo:o,provinces:l,drawFreshness:d,categoryFreshness:f,saveStatus:u,onJumpToSection:y,onOpenAccount:g}){const{t:c}=St(),[m,E]=h.useState(()=>Be()),[k,P]=h.useState(()=>({experimentKey:"pricing_layout_v1",variant:"control",source:"init"})),[_,C]=h.useState(()=>We(e)),N=h.useRef(null),O=h.useRef(0),[A,B]=h.useState(null),K=h.useRef(""),W=h.useMemo(()=>Bn(e),[e]),q=h.useMemo(()=>`crs-last-visit-snapshot-v1:${W}`,[W]),z=h.useMemo(()=>`crs-action-reminders-v1:${W}`,[W]),V=h.useMemo(()=>`crs-optimizer-constraints-v1:${W}`,[W]),[F,v]=h.useState(null),[I,ie]=h.useState(()=>pe(z,{})||{}),[he,ye]=h.useState(()=>ne(J)),[Ee,ae]=h.useState(""),[Ae,De]=h.useState("6m"),Te=h.useMemo(()=>o.filter(r=>typeof r?.check=="function"&&r.check(e)).length,[o,e]);h.useEffect(()=>{C(We(e))},[e]),h.useEffect(()=>{ie(pe(z,{})||{})},[z]),h.useEffect(()=>{const r=pe(V,J);ye(ne(r))},[V]),h.useEffect(()=>{const r=()=>E(Be());return window.addEventListener("crs-runtime-flags-updated",r),()=>window.removeEventListener("crs-runtime-flags-updated",r)},[]),h.useEffect(()=>{P(nt("pricing_layout_v1",{autoTrack:!0}))},[]);const xe=h.useMemo(()=>({answers:e,result:n,suggestions:i,averageCutoff:a,activeDraws:s,provinces:l,progress:_,enableAdvancedForecasting:m.enableAdvancedForecasting,eligibleCategoryCount:Te,optimizerConstraints:he}),[s,e,a,Te,he,_,l,n,m.enableAdvancedForecasting,i]);h.useEffect(()=>{let r=!1;const x=()=>{r||B(In(xe))};if(typeof Worker>"u")return x(),()=>{r=!0};try{N.current||(N.current=new Worker(new URL("/assets/strategy.worker-Br2xQwjw.js",import.meta.url),{type:"module"}));const w=N.current,H=O.current+=1,R=ue=>{const Z=ue?.data||{};if(!(r||Z.id!==H)){if(Z.status==="ok"&&Z.data){B(Z.data);return}x()}},de=()=>{r||x()};return w.addEventListener("message",R),w.addEventListener("error",de),w.postMessage({id:H,input:xe}),()=>{r=!0,w.removeEventListener("message",R),w.removeEventListener("error",de)}}catch{return x(),()=>{r=!0}}},[xe]),h.useEffect(()=>()=>{N.current?.terminate?.(),N.current=null},[]);const Re=h.useMemo(()=>({score:Number(n?.total)||0,cutoff:Number(a)||0,gap:Math.max((Number(a)||0)-(Number(n?.total)||0),0),ranked:[],top:null,nextBest:null,bottlenecks:[],assumptions:[],globalRiskFlags:[],overallConfidence:0,confidenceBand:"Low",profileSignals:{profileComplexity:0,minLanguageClb:0,languageHeadroom:0},guidanceSummary:"Preparing strategic insights..."}),[a,n?.total]),Fe=h.useMemo(()=>({tasks:[],milestones:[],completedCount:0,totalCount:0,completionPct:0,nextBestTask:null,completionGuidance:"Preparing action plan...",calendar:{reviewDates:[]}}),[]),p=h.useMemo(()=>A?.strategy||Re,[A?.strategy,Re]),S=h.useMemo(()=>A?.actionPlan||Fe,[Fe,A?.actionPlan]),M=A?.forecast||null,D=A?.digitalTwin||null,se=D?.recommendedHorizonId||"",X=h.useMemo(()=>Array.isArray(D?.horizons)?D.horizons:[],[D?.horizons]),L=h.useMemo(()=>X.find(r=>r.id===Ae)||X[0]||null,[X,Ae]),lt=S.completedCount||0,dt=S.totalCount||S.tasks.length,be=S.completionPct||0;h.useEffect(()=>{if(!A?.strategy)return;const r=pe(q,null),x={score:Number(p.score)||0,cutoff:Number(p.cutoff)||0,confidence:Number(p.overallConfidence)||0,updatedAt:new Date().toISOString()};r&&Number.isFinite(Number(r.score))?v({scoreDelta:x.score-(Number(r.score)||0),cutoffDelta:x.cutoff-(Number(r.cutoff)||0),confidenceDelta:x.confidence-(Number(r.confidence)||0),previousUpdatedAt:r.updatedAt||""}):v(null),fe(q,x)},[A?.strategy,q,p.cutoff,p.overallConfidence,p.score]),h.useEffect(()=>{se&&se&&De(se)},[se]),h.useEffect(()=>{if(!D)return;const r=`${D.generatedAt||""}:${D.recommendedHorizonId||""}:${X.length}`;!r||r===K.current||(K.current=r,T("digital_twin_rendered",{recommended_horizon_id:D.recommendedHorizonId||"none",horizon_count:X.length,confidence_band:D.confidenceBand||"unknown"}))},[D,X.length]);const ut=[{label:"Core Human Capital",value:n?.breakdown?.coreHumanCapital||0},{label:"Skill Transferability",value:n?.breakdown?.skillTransferability||0},{label:"Additional Points",value:n?.breakdown?.additionalPoints||0},{label:"Spouse Factors",value:n?.breakdown?.spouseFactors||0}].sort((r,x)=>x.value-r.value).slice(0,3),re=h.useMemo(()=>{const r=d?.tier==="fresh"?92:d?.tier==="recent"?74:48,x=f?.tier==="fresh"?88:f?.tier==="recent"?72:45,w=Math.round((r+x)/2),H=Math.max(Math.min(Math.round(be*.9+10),100),0),R=(p.globalRiskFlags||[]).filter(je=>je.severity==="high").length,de=(p.globalRiskFlags||[]).filter(je=>je.severity==="medium").length,ue=Math.min(R*12+de*6,36),Z=Number(M?.confidenceScore||p.overallConfidence||0);return{total:Math.max(Math.min(Math.round(Number(p.overallConfidence||0)*.35+w*.25+H*.2+Z*.2-ue),100),0),dataScore:w,executionScore:H,forecastScore:Z,riskPenalty:ue}},[f?.tier,be,d?.tier,M?.confidenceScore,p.globalRiskFlags,p.overallConfidence]),we=h.useMemo(()=>[...S.tasks||[]].filter(r=>!_[r.id]).sort((r,x)=>{const w=(r.priority==="High"?0:r.priority==="Medium"?1:2)-(x.priority==="High"?0:x.priority==="Medium"?1:2);return w!==0?w:(r.dayFrom||0)-(x.dayFrom||0)}).slice(0,4),[S.tasks,_]),oe=(()=>{const r=ln().slice(0,8).map(w=>({id:w.id,label:w.updatedAt?new Date(w.updatedAt).toLocaleDateString():"Saved",score:Number(w.score)||0,current:!1})),x={id:"current-profile",label:"Now",score:Number(n?.total)||0,current:!0};return[...r,x].filter(w=>w.score>0).slice(-9)})(),Ie=h.useMemo(()=>en({answers:e,result:n,strategy:p,forecast:M,actionPlan:S,drawData:{...s,source:d?.tier||"unknown"},categoryInfo:o}),[S,o,s,e,d?.tier,M,n,p]),pt=Math.max(...oe.map(r=>r.score||0),600),Y=h.useMemo(()=>{const r=p.globalRiskFlags?.some(R=>R.severity==="high"),x=(p.profileSignals?.profileComplexity||0)>=70,w=(p.gap||0)>45,H=r||p.top?.effort==="Hard"||(p.gap||0)>22;return w&&x?{tier:"pro",badge:"Priority recommendation",rationale:"Your profile looks high-complexity with a wider gap. Pro tracking helps reduce execution risk with tighter follow-through."}:H?{tier:"pro",badge:"Recommended now",rationale:"You likely benefit from structured tracking and guided execution while closing your gap."}:{tier:"free",badge:"Sufficient for now",rationale:"Your current profile can continue with free tools while monitoring draw changes."}},[p.gap,p.globalRiskFlags,p.profileSignals?.profileComplexity,p.top?.effort]),ft=p.globalRiskFlags?.some(r=>r.severity==="high")?"Elevated":p.globalRiskFlags?.some(r=>r.severity==="medium")?"Moderate":"Low",ce=p.optimizerConstraints||he,Oe=k.variant==="pro_first",mt=Oe?c("strategy.pricing.proCtaExperiment","Start Pro planning"):c("strategy.pricing.proCtaDefault","Go to Pro setup"),$=(r,x)=>{y(r),T("action_center_cta_clicked",{cta:x,target_section:r,confidence_band:p.confidenceBand,experiment_key:k.experimentKey,experiment_variant:k.variant})},gt=()=>{g?.(),T("action_center_cta_clicked",{cta:"manage_account",target_section:"account_modal",confidence_band:p.confidenceBand,experiment_key:k.experimentKey,experiment_variant:k.variant})},ht=()=>{const r=nn(Ie);ae(r?"Handoff file downloaded.":"Could not generate handoff file."),T("consultant_handoff_exported",{status:r?"ok":"failed",score:Number(n?.total)||0,confidence_band:p.confidenceBand,experiment_key:k.experimentKey,experiment_variant:k.variant}),ve("pricing_layout_v1","handoff_export",{status:r?"ok":"failed"})},yt=async()=>{const r=sn(Ie);if(!r){ae("Could not generate share link.");return}try{await navigator.clipboard.writeText(r),ae("Share link copied to clipboard."),T("consultant_handoff_share_link",{status:"copied",url_length:r.length,confidence_band:p.confidenceBand})}catch{ae("Clipboard blocked. Copy this link manually from browser URL after opening it."),window.open(r,"_blank","noopener,noreferrer"),T("consultant_handoff_share_link",{status:"fallback_opened",url_length:r.length,confidence_band:p.confidenceBand})}},le=(r,x)=>{ye(w=>{const H=r==="relocationPreference"?x:Number(x),R=ne({...w,[r]:H});return fe(V,R),T("optimizer_constraints_updated",{field:r,budget_cad:R.budgetCad,weekly_hours:R.weeklyHours,exam_attempts:R.examAttempts,relocation_preference:R.relocationPreference}),R})},xt=()=>{const r=ne(J);ye(r),fe(V,r),T("optimizer_constraints_reset",{budget_cad:r.budgetCad,weekly_hours:r.weeklyHours,exam_attempts:r.examAttempts,relocation_preference:r.relocationPreference})},bt=r=>{const x={..._,[r]:!_[r]};C(x),zn(e,x);const w=S.tasks.filter(R=>!!x[R.id]).length,H=S.tasks.length>0?Math.round(w/S.tasks.length*100):0;T("action_plan_task_toggled",{task_id:r,completed:!!x[r],completion_pct:H,completed_count:w,total_count:S.tasks.length,next_task_id:S.nextBestTask?.id||"none"})},wt=r=>{ie(x=>{const w={...x,[r]:!x[r]};return fe(z,w),T("action_queue_reminder_toggled",{task_id:r,enabled:!!w[r]}),w})};return t.jsxs(t.Fragment,{children:[t.jsxs("section",{className:"card strategic-action-center",id:"section-action-center",children:[t.jsx("h3",{children:c("strategy.actionCenter.title","Action Center")}),t.jsx("p",{className:"cat-intro",children:c("strategy.actionCenter.subtitle","Use this control center to execute the highest-impact moves with clear priority and risk visibility.")}),t.jsxs("div",{className:"strategic-action-grid",children:[t.jsx("button",{type:"button",className:"action-btn",onClick:()=>$("section-save","save_profile"),children:c("strategy.actionCenter.saveProfile","Save profile")}),m.enableAdvancedForecasting&&t.jsx("button",{type:"button",className:"action-btn",onClick:()=>$("section-forecast","open_forecast"),children:c("strategy.actionCenter.openForecast","Open forecast")}),t.jsx("button",{type:"button",className:"action-btn",onClick:()=>$("section-digital-twin","open_digital_twin"),children:c("strategy.actionCenter.openDigitalTwin","Open digital twin")}),t.jsx("button",{type:"button",className:"action-btn",onClick:()=>$("section-optimizer","open_optimizer"),children:c("strategy.actionCenter.openOptimizer","Open strategy optimizer")}),t.jsx("button",{type:"button",className:"action-btn",onClick:()=>$("section-90-day-plan","open_90_day_plan"),children:c("strategy.actionCenter.openPlan","Open 90-day plan")}),t.jsx("button",{type:"button",className:"action-btn",onClick:()=>$("section-pricing","compare_plans"),children:c("strategy.actionCenter.comparePlans","Compare plans")}),t.jsx("button",{type:"button",className:"action-btn",onClick:ht,children:c("strategy.actionCenter.exportHandoff","Export consultant handoff")}),t.jsx("button",{type:"button",className:"action-btn",onClick:yt,children:c("strategy.actionCenter.shareHandoff","Copy handoff share link")}),t.jsx("button",{type:"button",className:"action-btn",onClick:()=>$("section-action-queue","open_action_queue"),children:c("strategy.actionCenter.actionQueue","Smart action queue")}),t.jsx("button",{type:"button",className:"action-btn",onClick:()=>$("section-coach","expert_strategy_coach"),children:c("strategy.actionCenter.expertCoach","Expert strategy coach")}),t.jsx("button",{type:"button",className:"action-btn",onClick:()=>$("section-profile-trend","profile_trend_timeline"),children:c("strategy.actionCenter.profileTrend","Profile trend timeline")}),t.jsx("button",{type:"button",className:"action-btn",onClick:gt,children:c("strategy.actionCenter.manageAccount","Manage account")})]}),t.jsxs("div",{className:"strategic-action-status",children:[t.jsxs("span",{children:[c("strategy.actionCenter.profileStatus","Profile save status"),": ",t.jsx("strong",{children:u||c("strategy.actionCenter.notSavedYet","Not saved yet")})]}),t.jsxs("span",{children:[c("strategy.actionCenter.planCompletion","90-day completion"),": ",t.jsxs("strong",{children:[be,"%"]})," (",lt,"/",dt,")"]}),t.jsxs("span",{children:[c("strategy.actionCenter.confidence","Confidence"),": ",t.jsx("strong",{children:p.confidenceBand})," (",p.overallConfidence," / 100)"]}),t.jsxs("span",{children:[c("strategy.actionCenter.riskLevel","Risk level"),": ",t.jsx("strong",{children:ft})]})]}),Ee&&t.jsx("p",{className:"save-note",children:Ee}),S.nextBestTask&&t.jsxs("div",{className:"next-task-callout",children:[t.jsxs("div",{children:[t.jsxs("strong",{children:[c("strategy.actionCenter.nextTask","Next best task"),": ",S.nextBestTask.title]}),t.jsxs("p",{children:[S.nextBestTask.dateWindow," · ",S.nextBestTask.weekWindow]}),t.jsx("small",{children:S.nextBestTask.successMetric})]}),t.jsx("button",{type:"button",className:"action-btn auth-btn-primary",onClick:()=>$("section-90-day-plan","next_best_task"),children:c("strategy.actionCenter.startTask","Start task")})]})]}),F&&t.jsxs("section",{className:"card change-since-last-card",children:[t.jsx("h3",{children:c("strategy.changes.title","Since your last visit")}),t.jsxs("div",{className:"strategic-action-status",children:[t.jsxs("span",{children:["Score delta: ",t.jsxs("strong",{children:[F.scoreDelta>0?"+":"",F.scoreDelta]})]}),t.jsxs("span",{children:["Cutoff delta: ",t.jsxs("strong",{children:[F.cutoffDelta>0?"+":"",F.cutoffDelta]})]}),t.jsxs("span",{children:["Confidence delta: ",t.jsxs("strong",{children:[F.confidenceDelta>0?"+":"",F.confidenceDelta]})]})]}),F.previousUpdatedAt&&t.jsxs("p",{className:"save-note",children:["Previous snapshot: ",new Date(F.previousUpdatedAt).toLocaleString()]})]}),t.jsxs("section",{className:"card strategic-action-queue",id:"section-action-queue",children:[t.jsx("h3",{children:c("strategy.queue.title","Smart action queue")}),t.jsx("p",{className:"cat-intro",children:c("strategy.queue.subtitle","Prioritized next actions ordered by urgency and impact, with reminder toggles for follow-through.")}),!we.length&&t.jsx("p",{className:"save-note",children:"All queued tasks are complete. Nice work."}),!!we.length&&t.jsx("ul",{className:"plan-task-list",children:we.map(r=>t.jsxs("li",{children:[t.jsx("button",{type:"button",className:"plan-task-toggle","aria-label":`Toggle reminder for ${r.title}`,onClick:()=>wt(r.id),children:I[r.id]?"🔔":"🔕"}),t.jsxs("div",{children:[t.jsxs("div",{className:"plan-task-head",children:[t.jsx("strong",{children:r.title}),t.jsx(qe,{value:r.priority})]}),t.jsx("p",{children:r.rationale}),t.jsxs("div",{className:"optimizer-meta",children:[t.jsx("span",{children:r.dateWindow}),t.jsx("span",{children:r.weekWindow}),t.jsxs("span",{children:["Impact +",r.impact]})]}),t.jsxs("small",{className:"plan-task-metric",children:["Reminder: ",I[r.id]?"Enabled":"Disabled"]})]})]},`queue-${r.id}`))})]}),D&&t.jsxs("section",{className:"card strategic-digital-twin",id:"section-digital-twin",children:[t.jsx("h3",{children:c("strategy.digitalTwin.title","Invitation probability digital twin")}),t.jsx("p",{className:"cat-intro",children:D.summary}),t.jsxs("div",{className:"strategic-action-status",children:[t.jsxs("span",{children:[c("strategy.digitalTwin.recommended","Recommended horizon"),": ",t.jsx("strong",{children:D.recommendedHorizonId?.toUpperCase?.()||"—"})]}),t.jsxs("span",{children:[c("strategy.digitalTwin.confidenceBand","Model confidence"),": ",t.jsx("strong",{children:D.confidenceBand||"Unknown"})]}),t.jsxs("span",{children:[c("strategy.digitalTwin.topLane","Top lane"),": ",t.jsx("strong",{children:D.topLane||"—"})]})]}),t.jsx("div",{className:"digital-twin-horizon-switch",children:X.map(r=>t.jsx("button",{type:"button",className:`action-btn ${L?.id===r.id?"auth-btn-primary":""}`.trim(),onClick:()=>{De(r.id),T("digital_twin_horizon_selected",{horizon_id:r.id,chance_band:r.chanceBand,base_probability_pct:r.baseProbabilityPct})},children:r.label},r.id))}),L&&t.jsxs("div",{className:"digital-twin-scenario-grid",children:[t.jsxs("article",{className:"digital-twin-scenario",children:[t.jsx("h4",{children:"Base scenario"}),t.jsxs("strong",{children:[L.baseProbabilityPct,"%"]}),t.jsxs("p",{children:["Projected cutoff: ",L.projectedCutoff]}),t.jsxs("p",{children:["Expected score: ",L.expectedScore," (",L.scoreGap>=0?"+":"",L.scoreGap," gap)"]})]}),t.jsxs("article",{className:"digital-twin-scenario",children:[t.jsx("h4",{children:"Best-case execution"}),t.jsxs("strong",{children:[L.bestProbabilityPct,"%"]}),t.jsx("p",{children:"Assumes faster lane execution and lower draw variance."}),t.jsxs("p",{children:["Expected gain by horizon: +",L.expectedGain," pts"]})]}),t.jsxs("article",{className:"digital-twin-scenario",children:[t.jsx("h4",{children:"Downside scenario"}),t.jsxs("strong",{children:[L.worstProbabilityPct,"%"]}),t.jsx("p",{children:"Assumes execution slippage and higher draw volatility."}),t.jsxs("p",{children:["Confidence interval: ",L.confidenceInterval.lowPct,"%–",L.confidenceInterval.highPct,"%"]})]})]}),!!D.keyDrivers?.length&&t.jsx("ul",{className:"digital-twin-driver-list",children:D.keyDrivers.map(r=>t.jsxs("li",{children:[t.jsx("span",{children:r.label}),t.jsx("strong",{children:r.value})]},r.id))})]}),m.enableAdvancedForecasting&&M&&t.jsxs("section",{className:"card strategic-forecast",id:"section-forecast",children:[t.jsx("h3",{children:c("strategy.forecast.title","Forecast Outlook")}),t.jsx("p",{className:"cat-intro",children:c("strategy.forecast.subtitle","Projection based on recent draw cutoffs, volatility, and freshness of available data.")}),t.jsxs("div",{className:"strategic-action-status",children:[t.jsxs("span",{children:[c("strategy.forecast.trend","Trend"),": ",t.jsx("strong",{children:M.trendLabel})]}),t.jsxs("span",{children:[c("strategy.forecast.confidence","Forecast confidence"),": ",t.jsx("strong",{children:M.confidenceBand})," (",M.confidenceScore,"/100)"]}),t.jsxs("span",{children:[c("strategy.forecast.sampleSize","Sample size"),": ",t.jsx("strong",{children:M.sampleSize})]}),t.jsxs("span",{children:[c("strategy.forecast.likelihood","Invitation likelihood"),": ",t.jsx("strong",{children:M.invitationLikelihood})]})]}),t.jsxs("div",{className:"optimizer-top-callout",children:[t.jsxs("div",{className:"optimizer-option-head",children:[t.jsxs("strong",{children:[c("strategy.forecast.nextCutoff","Projected next cutoff"),": ",M.projectedNextCutoff]}),t.jsxs("span",{className:"optimizer-score",children:[c("strategy.forecast.threeDrawAvg","3-draw avg")," ",M.projectedThreeDrawAvg]})]}),t.jsxs("p",{children:[c("strategy.forecast.latestObserved","Latest observed cutoff"),": ",M.latestObservedCutoff," · ",c("strategy.forecast.gapToProjection","Gap to projection"),": ",M.userGapToNext>0?"+":"",M.userGapToNext]}),t.jsxs("div",{className:"optimizer-meta",children:[t.jsxs("span",{children:[c("strategy.forecast.projectedSequence","Projected sequence"),": ",M.projectedDraws.join(" → ")]}),t.jsxs("span",{children:[c("strategy.forecast.volatility","Volatility"),": ",M.volatility.toFixed(2)]}),t.jsxs("span",{children:[c("strategy.forecast.slope","Slope/draw"),": ",M.slopePerDraw]})]})]})]}),t.jsxs("section",{className:"card strategic-optimizer",id:"section-optimizer",children:[t.jsx("h3",{children:c("strategy.optimizer.title","Strategy Optimizer")}),t.jsx("p",{className:"cat-intro",children:p.guidanceSummary}),t.jsxs("div",{className:"optimizer-constraint-panel",children:[t.jsxs("div",{className:"optimizer-constraint-head",children:[t.jsx("h4",{children:c("strategy.optimizer.constraintsTitle","Constraint inputs")}),t.jsx("button",{type:"button",className:"action-btn",onClick:xt,children:c("strategy.optimizer.resetConstraints","Reset")})]}),t.jsxs("div",{className:"wi-grid",children:[t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:c("strategy.optimizer.budgetCad","Available budget (CAD)")}),t.jsx("select",{value:ce.budgetCad,onChange:r=>le("budgetCad",r.target.value),children:[1200,2e3,3500,5e3,8e3,12e3].map(r=>t.jsx("option",{value:r,children:r.toLocaleString()},`budget-${r}`))})]}),t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:c("strategy.optimizer.weeklyHours","Weekly execution hours")}),t.jsx("select",{value:ce.weeklyHours,onChange:r=>le("weeklyHours",r.target.value),children:[3,5,8,12,16,20].map(r=>t.jsxs("option",{value:r,children:[r,"h / week"]},`hours-${r}`))})]}),t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:c("strategy.optimizer.examAttempts","Exam retry budget")}),t.jsx("select",{value:ce.examAttempts,onChange:r=>le("examAttempts",r.target.value),children:[1,2,3,4,5].map(r=>t.jsxs("option",{value:r,children:[r," attempt",r>1?"s":""]},`exam-${r}`))})]}),t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:c("strategy.optimizer.relocationPreference","Relocation preference")}),t.jsxs("select",{value:ce.relocationPreference,onChange:r=>le("relocationPreference",r.target.value),children:[t.jsx("option",{value:"balanced",children:"Balanced"}),t.jsx("option",{value:"province",children:"Province-focused"}),t.jsx("option",{value:"federal",children:"Federal-focused"})]})]})]}),t.jsx("p",{className:"save-note",children:c("strategy.optimizer.constraintsHint","These constraints re-rank lanes by real-world feasibility, not just raw score gain.")})]}),p.top&&t.jsxs("div",{className:"optimizer-top-callout",children:[t.jsxs("div",{className:"optimizer-option-head",children:[t.jsxs("strong",{children:["Top lane: ",p.top.title]}),t.jsxs("span",{className:"optimizer-score",children:["Priority ",p.top.score,"/100"]})]}),t.jsx("p",{children:p.top.reason}),t.jsxs("div",{className:"optimizer-meta",children:[t.jsxs("span",{children:["Estimated gain: +",p.top.scoreGain]}),t.jsxs("span",{children:["Expected timeline: ~",p.top.months," months"]}),t.jsxs("span",{children:["Confidence: ",p.top.confidence,"%"]}),t.jsxs("span",{children:["Constraint fit: ",p.top.constraintFitScore,"/100"]}),t.jsxs("span",{children:["Estimated cost: ",Math.round(p.top.estimatedCostCad||0)," CAD"]}),t.jsxs("span",{children:["Weekly load: ~",p.top.requiredWeeklyHours||0,"h"]}),t.jsxs("span",{children:["Constraint adj: ",p.top.constraintAdjustment>0?"+":"",p.top.constraintAdjustment||0]}),t.jsx(Ve,{value:p.top.effort})]}),!!p.top.riskFlags?.length&&t.jsx("ul",{className:"optimizer-risk-list",children:p.top.riskFlags.map(r=>t.jsxs("li",{children:[t.jsx(Ye,{value:r.severity}),t.jsx("span",{children:r.label})]},r.id))})]}),t.jsx("div",{className:"optimizer-options",children:p.ranked.map((r,x)=>t.jsxs("article",{className:"optimizer-option",children:[t.jsxs("div",{className:"optimizer-option-head",children:[t.jsxs("strong",{children:[x+1,". ",r.title]}),t.jsxs("div",{className:"optimizer-option-end",children:[t.jsxs("span",{className:"optimizer-score",children:["Score ",r.score]}),t.jsx(Ve,{value:r.effort})]})]}),t.jsx("p",{children:r.reason}),t.jsxs("div",{className:"optimizer-meta",children:[t.jsxs("span",{children:["Lane: ",r.lane]}),t.jsxs("span",{children:["+",r.scoreGain," pts"]}),t.jsxs("span",{children:[r.months," mo"]}),t.jsxs("span",{children:[r.confidence,"% confidence"]}),t.jsxs("span",{children:["Fit ",r.constraintFitScore,"/100"]}),t.jsxs("span",{children:["Cost ",Math.round(r.estimatedCostCad||0)," CAD"]}),t.jsxs("span",{children:["Load ~",r.requiredWeeklyHours||0,"h/wk"]}),t.jsxs("span",{children:["Adj ",r.constraintAdjustment>0?"+":"",r.constraintAdjustment||0]})]})]},r.id))})]}),t.jsxs("section",{className:"card strategic-plan",id:"section-90-day-plan",children:[t.jsx("h3",{children:c("strategy.plan.title","90-Day Action Plan")}),t.jsx("p",{className:"cat-intro",children:"Execution-focused milestones with calendar windows, measurable outcomes, and fallback controls."}),t.jsx("p",{className:"plan-guidance",children:S.completionGuidance}),t.jsx("div",{className:"plan-review-dates",children:S.calendar?.reviewDates?.map(r=>t.jsxs("span",{children:["Review D",r.day,": ",r.label]},r.day))}),t.jsx("div",{className:"plan-milestones",children:S.milestones.map(r=>t.jsxs("div",{className:"plan-milestone",children:[t.jsx("strong",{children:r.label}),t.jsx("p",{children:r.objective}),t.jsx("small",{children:r.dateWindow}),t.jsxs("small",{children:["Expected gain: +",r.expectedGain," pts"]})]},r.label))}),t.jsx("ul",{className:"plan-task-list",children:S.tasks.map(r=>{const x=!!_[r.id],w=S.nextBestTask?.id===r.id&&!x;return t.jsxs("li",{className:`${x?"done":""} ${w?"next-task":""}`.trim(),children:[t.jsx("button",{type:"button",className:"plan-task-toggle",onClick:()=>bt(r.id),"aria-label":`Toggle ${r.title}`,children:x?"✓":"○"}),t.jsxs("div",{children:[t.jsxs("div",{className:"plan-task-head",children:[t.jsx("strong",{children:r.title}),t.jsx(qe,{value:r.priority})]}),t.jsx("p",{children:r.rationale}),t.jsxs("div",{className:"optimizer-meta",children:[t.jsx("span",{children:r.window}),t.jsx("span",{children:r.weekWindow}),t.jsx("span",{children:r.dateWindow}),t.jsxs("span",{children:["Lane: ",r.lane]}),t.jsxs("span",{children:["Impact: +",r.impact," pts"]})]}),t.jsxs("small",{className:"plan-task-metric",children:["Success metric: ",r.successMetric]}),t.jsxs("small",{className:"plan-task-metric",children:["Checkpoint: ",r.checkpoint]})]})]},r.id)})})]}),t.jsxs("section",{className:"card strategic-pricing",id:"section-pricing",children:[t.jsx("h3",{children:c("strategy.pricing.title","Plans & Upgrade Path")}),t.jsx("p",{className:"cat-intro",children:"Choose support depth based on your current gap, risk profile, and execution complexity."}),t.jsxs("div",{className:"pricing-recommendation-banner",children:[t.jsxs("strong",{children:[Y.badge,": ",$n(Y.tier)]}),t.jsx("p",{children:Y.rationale}),t.jsxs("small",{className:"pricing-experiment-note",children:[c("strategy.pricing.experimentLabel","Active experiment variant"),": ",k.variant]})]}),t.jsxs("div",{className:`pricing-grid ${Oe?"pro-first":""}`,children:[t.jsxs("article",{className:`pricing-tier pricing-tier-free ${Y.tier==="free"?"recommended":""}`,children:[Y.tier==="free"&&t.jsx("span",{className:"pricing-reco-badge",children:"Best fit now"}),t.jsx("h4",{children:"Free"}),t.jsx("strong",{children:"0 CAD"}),t.jsxs("ul",{children:[t.jsx("li",{children:"CRS scoring + basic suggestions"}),t.jsx("li",{children:"Scenario compare"}),t.jsx("li",{children:"Local profile save"})]}),t.jsx("button",{type:"button",className:"action-btn",onClick:()=>{ve("pricing_layout_v1","pricing_cta_click",{tier:"free"}),T("pricing_cta_clicked",{tier:"free",recommended:Y.tier==="free",experiment_key:k.experimentKey,experiment_variant:k.variant}),$("section-optimizer","continue_free")},children:c("strategy.pricing.freeCta","Continue with Free")})]}),t.jsxs("article",{className:`pricing-tier pricing-tier-pro featured ${Y.tier==="pro"?"recommended":""}`,children:[Y.tier==="pro"&&t.jsx("span",{className:"pricing-reco-badge",children:"Recommended"}),t.jsx("h4",{children:"Pro Tracking"}),t.jsx("strong",{children:"5 CAD / month"}),t.jsxs("ul",{children:[t.jsx("li",{children:"Expert strategy coach"}),t.jsx("li",{children:"Daily action tracking"}),t.jsx("li",{children:"Cloud sync + alerts"})]}),t.jsx("button",{type:"button",className:"action-btn auth-btn-primary",onClick:()=>{ve("pricing_layout_v1","pricing_cta_click",{tier:"pro_tracking"}),T("pricing_cta_clicked",{tier:"pro_tracking",recommended:Y.tier==="pro",experiment_key:k.experimentKey,experiment_variant:k.variant}),$("section-coach","go_to_pro_setup")},children:mt})]})]})]}),t.jsxs("section",{className:"card strategic-profile-trend",id:"section-profile-trend",children:[t.jsx("h3",{children:c("strategy.trend.title","Profile trend timeline")}),t.jsx("p",{className:"cat-intro",children:c("strategy.trend.subtitle","Track score movement across your saved snapshots and current profile.")}),!oe.length&&t.jsx("p",{className:"save-note",children:"Save a few profiles to unlock your timeline view."}),!!oe.length&&t.jsx("ul",{className:"profile-trend-list",children:oe.map(r=>t.jsxs("li",{className:r.current?"current":"",children:[t.jsxs("div",{className:"profile-trend-label",children:[t.jsx("strong",{children:r.label}),r.current&&t.jsx("span",{className:"profile-trend-current",children:"Current"})]}),t.jsx("div",{className:"profile-trend-bar-wrap",children:t.jsx("span",{className:"profile-trend-bar",style:{width:`${Math.max(Math.min(Math.round(r.score/pt*100),100),5)}%`}})}),t.jsx("span",{className:"profile-trend-score",children:r.score})]},r.id))})]}),t.jsxs("section",{className:"card strategic-explainability",id:"section-explainability",children:[t.jsx("h3",{children:c("strategy.explainability.title","Explainability & Confidence")}),t.jsx("p",{className:"cat-intro",children:"Structured reasoning for lane ranking, confidence, and risk assumptions."}),t.jsxs("div",{className:"explain-grid",children:[t.jsxs("article",{children:[t.jsx("h4",{children:"Top score drivers"}),t.jsx("ul",{children:ut.map(r=>t.jsxs("li",{children:[t.jsx("span",{children:r.label}),t.jsx("strong",{children:r.value})]},r.label))})]}),t.jsxs("article",{children:[t.jsx("h4",{children:"Recommendation score factors"}),t.jsx("ul",{className:"explain-factor-list",children:(p.top?.scoreBreakdown||[]).map(r=>t.jsxs("li",{children:[t.jsxs("div",{className:"explain-factor-head",children:[t.jsx("span",{children:r.label}),t.jsx("strong",{children:r.value})]}),t.jsx("div",{className:"explain-factor-track",children:t.jsx("span",{className:"explain-factor-fill",style:{width:`${r.value}%`}})}),t.jsxs("small",{children:["Weight: ",Math.round((r.weight||0)*100),"%"]})]},r.key))})]}),t.jsxs("article",{children:[t.jsx("h4",{children:"Data confidence"}),t.jsxs("ul",{children:[t.jsxs("li",{children:["Confidence v2: ",t.jsxs("strong",{children:[re.total,"/100"]})]}),t.jsxs("li",{children:["Overall confidence: ",t.jsxs("strong",{children:[p.confidenceBand," (",p.overallConfidence,"/100)"]})]}),t.jsxs("li",{children:["Data signal score: ",t.jsxs("strong",{children:[re.dataScore,"/100"]})]}),t.jsxs("li",{children:["Execution signal score: ",t.jsxs("strong",{children:[re.executionScore,"/100"]})]}),t.jsxs("li",{children:["Forecast signal score: ",t.jsxs("strong",{children:[re.forecastScore,"/100"]})]}),t.jsxs("li",{children:["Risk penalty: ",t.jsxs("strong",{children:["-",re.riskPenalty]})]}),t.jsxs("li",{children:["Draw freshness: ",t.jsx("strong",{children:d?.label||"Unknown"})]}),t.jsxs("li",{children:["Category freshness: ",t.jsx("strong",{children:f?.label||"Unknown"})]}),t.jsxs("li",{children:["Draw source snapshot: ",t.jsx("strong",{children:s?.lastUpdated||"Unavailable"})]})]})]}),t.jsxs("article",{children:[t.jsx("h4",{children:"Assumptions used"}),t.jsx("ul",{className:"assumption-list",children:(p.assumptions||[]).map(r=>t.jsxs("li",{children:[t.jsx("span",{children:r.label}),t.jsx("strong",{className:Ln(r.confidence),children:r.confidence})]},r.key))})]}),t.jsxs("article",{children:[t.jsx("h4",{children:"Risk indicators"}),t.jsxs("ul",{className:"risk-indicator-list",children:[(p.globalRiskFlags||[]).map(r=>t.jsxs("li",{children:[t.jsxs("div",{children:[t.jsx("strong",{children:r.label}),t.jsx("small",{children:r.detail})]}),t.jsx(Ye,{value:r.severity})]},r.id)),!p.globalRiskFlags?.length&&t.jsx("li",{children:"No major risk flags detected."})]})]}),t.jsxs("article",{children:[t.jsx("h4",{children:"Trust cues"}),t.jsxs("div",{className:"trust-inline-cues",children:[t.jsx("span",{children:"Estimate model only"}),t.jsx("span",{children:"No legal advice"}),t.jsx("span",{children:"Review official IRCC before filing"})]}),t.jsxs("p",{className:"save-note",children:["Review governance in the ",t.jsx("a",{href:"/trust.html",children:"Trust Center"}),", implementation guides in ",t.jsx("a",{href:"/guides.html",children:"Guides"}),", and rights controls in ",t.jsx("a",{href:"/privacy.html",children:"Privacy Policy"}),"."]})]})]})]})]})}const Zn=Object.freeze(Object.defineProperty({__proto__:null,default:Hn},Symbol.toStringTag,{value:"Module"}));export{qn as L,Zn as R,Xn as a,Kn as b,Vn as c,Yn as d,Jn as e,ln as l,Be as r,Qn as s,T as t,St as u};
