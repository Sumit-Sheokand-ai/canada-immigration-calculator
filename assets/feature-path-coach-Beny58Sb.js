import{r as f,j as r}from"./vendor-react-Ah1pgjPn.js";import{c as ct,a as lt,b as dt,d as ut,f as ft,e as ht,g as pt,h as mt,i as gt,s as yt,j as bt,k as kt,l as St,m as xt,n as wt,o as Tt,p as vt,q as Ct,r as Ae}from"./data-question-bank-BsLULj9F.js";import{u as Pt,m as re}from"./vendor-motion-CtNR3TjB.js";const _t="modulepreload",jt=function(e){return"/"+e},Ce={},Nt=function(t,n,s){let a=Promise.resolve();if(n&&n.length>0){let u=function(d){return Promise.all(d.map(g=>Promise.resolve(g).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");a=u(n.map(d=>{if(d=jt(d),d in Ce)return;Ce[d]=!0;const g=d.endsWith(".css"),y=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${y}`))return;const p=document.createElement("link");if(p.rel=g?"stylesheet":_t,g||(p.as="script"),p.crossOrigin="",p.href=d,l&&p.setAttribute("nonce",l),document.head.appendChild(p),g)return new Promise((w,C)=>{p.addEventListener("load",w),p.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},Et="https://rvijvbcknwwtfhulsesk.supabase.co",Ie="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ2aWp2YmNrbnd3dGZodWxzZXNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3NTY0NDIsImV4cCI6MjA3ODMzMjQ0Mn0.Nw7gfls2IHV88r4kFBXKRsAFfVqeDcTxQVwDo6OzDrg",K=!!Ie;let Z=null,X=null;async function H(){return K?Z||(X||(X=Nt(async()=>{const{createClient:e}=await import("./vendor-supabase-CkKAztfS.js");return{createClient:e}},[]).then(({createClient:e})=>(Z=e(Et,Ie,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),Z)).catch(e=>{throw X=null,e})),X):null}const Le=f.createContext(null);function Pe(){return`${window.location.origin}${window.location.pathname}`}async function Mt(e){if(!e)return"";const t=[];e.message&&t.push(String(e.message));const n=e.context;if(!n||typeof n.clone!="function")return t.join(" · ").trim();try{const s=n.clone();if((s.headers?.get?.("content-type")||"").includes("application/json")){const i=await s.json(),o=[i?.message,i?.error,i?.details].filter(Boolean).map(l=>String(l));o.length&&t.push(...o)}else{const i=await s.text();i&&t.push(i)}}catch{}return[...new Set(t)].join(" · ").trim()}function Un({children:e}){const[t,n]=f.useState(!1),[s,a]=f.useState(null),[i,o]=f.useState(null),l=f.useRef(!0),u=f.useRef(null),d=f.useRef(null),g=f.useCallback(b=>{a(b||null),o(b?.user||null)},[]);f.useEffect(()=>()=>{l.current=!1,u.current?.unsubscribe?.(),u.current=null},[]);const y=f.useCallback(async()=>K?(d.current||(d.current=(async()=>{const b=await H();if(!b)return null;if(!u.current){const{data:S}=b.auth.onAuthStateChange((x,T)=>{l.current&&g(T||null)});u.current=S?.subscription||null}l.current&&n(!0);try{const{data:S,error:x}=await b.auth.getSession();if(x)throw x;l.current&&g(S.session||null)}finally{l.current&&n(!1)}return b})().finally(()=>{d.current=null})),d.current):null,[g]),p=f.useCallback(async()=>{if(!K)throw new Error("Supabase auth is not configured.");const b=await y();if(!b)throw new Error("Supabase auth is not configured.");return b},[y]),w=f.useCallback(async b=>{const S=await p(),{error:x}=await S.auth.signInWithOtp({email:b,options:{shouldCreateUser:!0,emailRedirectTo:Pe()}});if(x)throw x;return{status:"sent"}},[p]),C=f.useCallback(async b=>w(b),[w]),h=f.useCallback(async(b,S)=>{const x=await p(),T=["email","magiclink","signup"];let P=null;for(const v of T){const{data:N,error:U}=await x.auth.verifyOtp({email:b,token:S,type:v});if(!U)return N;P=U}throw P||new Error("Unable to verify the email code.")},[p]),m=f.useCallback(async()=>{const b=await p(),{error:S}=await b.auth.signInWithOAuth({provider:"google",options:{redirectTo:Pe()}});if(S)throw S;return{status:"redirecting"}},[p]),M=f.useCallback(async()=>{const b=await y();if(!b)return;const{error:S}=await b.auth.signOut();if(S)throw S},[y]),$=f.useCallback(async({fullName:b})=>{const S=await p(),x={};typeof b=="string"&&(x.data={full_name:b.trim()});const{data:T,error:P}=await S.auth.updateUser(x);if(P)throw P;return T?.user&&o(T.user),T},[p]),G=f.useCallback(async b=>{const S=await p(),x=String(b||"");if(x.length<8)throw new Error("Password must be at least 8 characters.");const{data:T,error:P}=await S.auth.updateUser({password:x});if(P)throw P;return T?.user&&o(T.user),T},[p]),B=f.useCallback(async()=>{const b=await p(),S="delete-account",{data:x,error:T}=await b.functions.invoke(S,{body:{confirm:!0}});if(T){const v=await Mt(T)||String(T?.message||"");throw/Function not found/i.test(v)?new Error(`Delete account is not configured. Deploy the Supabase "${S}" edge function first.`):new Error(v||"Could not delete account.")}if(x?.success===!1)throw new Error(String(x?.message||x?.error||"Could not delete account."));return await b.auth.signOut(),a(null),o(null),x},[p]),_=f.useCallback(async()=>{const b=await y();if(!b)return null;const{data:S,error:x}=await b.auth.getSession();if(x)throw x;return g(S.session||null),S.session||null},[g,y]),J=f.useMemo(()=>({isConfigured:K,loading:t,session:s,user:i,isAuthenticated:!!i,sendEmailOtp:C,sendEmailMagicLink:w,verifyEmailOtp:h,ensureAuthReady:y,signInWithGoogle:m,signOut:M,updateProfile:$,changePassword:G,deleteAccount:B,refreshSession:_}),[G,B,y,t,_,w,C,s,m,M,$,i,h]);return r.jsx(Le.Provider,{value:J,children:e})}function Dt(){const e=f.useContext(Le);if(!e)throw new Error("useAuth must be used within AuthProvider");return e}const Q="crs-policy-ruleset-override-v1",At="2026-02-18-v1",Re=Object.freeze({"ircc-2025-03-25-v1":"ircc-2025-03-25-v2"});function ee(e){const t=new Date(e);return Number.isNaN(t.getTime())?null:t}const R=[{id:"ircc-2024-01-01-v1",label:"Legacy arranged-employment points",effectiveDate:"2024-01-01",arrangedEmploymentPoints:!0,notes:["Legacy profile includes arranged-employment CRS additional points (NOC 00: +200, others: +50).","PNP nomination remains +600 additional points.","French additional points depend on both French and English thresholds."]},{id:"ircc-2025-03-25-v2",label:"Arranged-employment points removed",effectiveDate:"2025-03-25",arrangedEmploymentPoints:!1,notes:["Arranged-employment CRS additional points removed effective March 25, 2025.","PNP nomination remains +600 additional points.","French additional points depend on both French and English thresholds."]}].sort((e,t)=>{const n=ee(e.effectiveDate)?.getTime()||0,s=ee(t.effectiveDate)?.getTime()||0;return n-s});function de(){return R[R.length-1]}function ue(e){const t=fe(e);return R.find(n=>n.id===t)||null}function fe(e){const t=String(e||"").trim();return t?Re[t]||t:""}function zn(){return{version:At,aliases:{...Re},latestRuleSetId:de()?.id||""}}function Fe(){if(typeof window>"u")return null;try{const e=window.localStorage.getItem(Q);if(!e)return null;const t=fe(e),n=ue(t)?.id||null;return n?(String(e).trim()!==n&&window.localStorage.setItem(Q,n),n):null}catch{return null}}function Yn(){return R.map(e=>({...e}))}function Kn(){return Fe()}function It(e){if(typeof window>"u")return null;const t=fe(e),n=ue(t);try{n?window.localStorage.setItem(Q,n.id):window.localStorage.removeItem(Q),window.dispatchEvent(new Event("crs-policy-ruleset-updated"))}catch{}return n?.id||null}function Hn(){return It("")}function Lt(e=new Date){const t=ee(e)||new Date;let n=R[0];for(const s of R){const a=ee(s.effectiveDate);a&&a.getTime()<=t.getTime()&&(n=s)}return n||de()}function Rt({asOfDate:e=new Date,ignoreOverride:t=!1}={}){if(!t){const s=Fe();if(s){const a=ue(s);if(a)return{...a,source:"override"}}}return{...Lt(e),source:"effective_date"}}function Ft(e){const t={...Ct};return e?.arrangedEmploymentPoints?(t.job_offer_00=200,t.job_offer_other=50):(t.job_offer_00=0,t.job_offer_other=0),t}function Oe({asOfDate:e=new Date,ignoreOverride:t=!1}={}){const n=Rt({asOfDate:e,ignoreOverride:t});return{version:n.id,label:n.label,source:n.source,effectiveDate:n.effectiveDate,notes:n.notes,tables:{agePoints:vt,educationPoints:Tt,firstLangPoints:wt,secondLangPoints:xt,canadianWorkPoints:St,spouseEducationPoints:kt,spouseLangPoints:bt,spouseWorkPoints:yt,eduRank:gt,eduLangTransfer:mt,eduCWETransfer:pt,fweLangTransfer:ht,fweCWETransfer:ft,certLangTransfer:ut,additionalPointsTable:Ft(n)},converters:{ieltsToCLB:dt,tefToNCLC:lt,tcfToNCLC:ct},caps:{secondLanguageNoSpouse:24,secondLanguageWithSpouse:22,spouseTotal:40,skillTransferabilityTotal:100,additionalPointsTotal:600,crsTotal:1200}}}const We=de();We.id;We.effectiveDate;Oe({ignoreOverride:!0});const $e=(e,t,n)=>Math.max(t,Math.min(n,e)),O=()=>Oe();function Ot(e,t=O()){const n={...e},s=te(e)==="french"||e.hasFrench==="yes";if(s&&e.frenchTestType==="tef")for(const a of["listening","reading","writing","speaking"])n[`french_${a}`]=String(t.converters.tefToNCLC(a,parseInt(e[`tef_${a}`],10)||0));else if(s&&e.frenchTestType==="tcf")for(const a of["listening","reading","writing","speaking"])n[`french_${a}`]=String(t.converters.tcfToNCLC(a,parseInt(e[`tcf_${a}`],10)||0));return n}function te(e){return e.firstOfficialLanguage==="french"?"french":"english"}function he(e){return te(e)==="french"||e.hasFrench==="yes"}function pe(e){return e.hasSpouse==="yes"&&e.spouseIsCanadian!=="yes"&&e.spouseAccompanying!=="no"}const q=e=>pe(e)?1:0;function me(e,t,n=O()){if(e.langTestType==="celpip")return $e(parseInt(e[`celpip_${t}`],10)||0,0,12);const s=parseFloat(e[`ielts_${t}`])||0;return n.converters.ieltsToCLB(t,s)}function ge(e,t){return $e(parseInt(e[`french_${t}`],10)||0,0,12)}function Ge(e,t,n=O()){return te(e)==="french"?ge(e,t):me(e,t,n)}function ye(e,t=O()){const n=["listening","reading","writing","speaking"];let s=99;for(const a of n){const i=Ge(e,a,t);i<s&&(s=i)}return s===99?0:s}function Wt(e,t=O()){const n=["listening","reading","writing","speaking"];let s=99;for(const a of n){const i=me(e,a,t);i<s&&(s=i)}return s===99?0:s}function $t(e){if(!he(e))return 0;const t=["listening","reading","writing","speaking"];let n=99;for(const s of t){const a=ge(e,s);a<n&&(n=a)}return n===99?0:n}function Gt(e,t){const n=ye(e,t);return n>=9?2:n>=7?1:0}function Bt(e){const t=parseInt(e.canadianWorkExp,10)||0;return t>=2?2:t>=1?1:0}function Ut(e){const t=parseInt(e.foreignWorkExp,10)||0;return t>=3?2:t>=1?1:0}function zt(e,t){let n=parseInt(e.age,10);return Number.isNaN(n)?0:(n<18&&(n=17),n>47&&(n=47),n>44&&(n=45),t.tables.agePoints[n]?.[q(e)]||0)}function Yt(e,t){return t.tables.educationPoints[e.education]?.[q(e)]||0}function Kt(e,t){const n=["listening","reading","writing","speaking"],s=q(e);return n.reduce((a,i)=>{const o=Ge(e,i,t);return a+(t.tables.firstLangPoints[o]?.[s]||0)},0)}function Ht(e,t){const n=te(e);if(!(n==="french"?e.langTestType==="ielts"||e.langTestType==="celpip":he(e)))return 0;const a=["listening","reading","writing","speaking"],i=q(e),o=a.reduce((l,u)=>{const d=n==="french"?me(e,u,t):ge(e,u);return l+(t.tables.secondLangPoints[d]?.[i]||0)},0);return Math.min(o,i===0?t.caps.secondLanguageNoSpouse:t.caps.secondLanguageWithSpouse)}function qt(e,t){let n=parseInt(e.canadianWorkExp,10)||0;return n>5&&(n=5),t.tables.canadianWorkPoints[n]?.[q(e)]||0}function Jt(e,t){if(!pe(e))return 0;let n=0;n+=t.tables.spouseEducationPoints[e.spouseEducation]||0;const s=["listening","reading","writing","speaking"];let a=0;for(const o of s){const l=parseInt(e[`spouseLang_${o}`],10)||0;a+=t.tables.spouseLangPoints[l]||0}n+=Math.min(a,20);let i=parseInt(e.spouseCanadianWork,10)||0;return i>5&&(i=5),n+=t.tables.spouseWorkPoints[i]||0,Math.min(n,t.caps.spouseTotal)}function Vt(e,t){const n=t.tables.eduRank[e.education]||0,s=Gt(e,t),a=Bt(e),i=Ut(e),o=t.tables.eduLangTransfer[n]?.[s]||0,l=t.tables.eduCWETransfer[n]?.[a]||0,u=Math.min(o+l,50),d=t.tables.fweLangTransfer[i]?.[s]||0,g=t.tables.fweCWETransfer[i]?.[a]||0,y=Math.min(d+g,50);let p=0;if(e.pathway==="fst"&&e.hasCertificate==="yes"){const w=ye(e,t);p=t.tables.certLangTransfer[w>=7?2:w>=5?1:0]}return Math.min(u+y+p,t.caps.skillTransferabilityTotal)}function Zt(e,t){let n=0;const s=t.tables.additionalPointsTable;return e.hasPNP==="yes"&&(n+=s.pnp_nomination),e.hasJobOffer==="yes"&&(n+=e.jobOfferTeer==="teer_0"?s.job_offer_00:s.job_offer_other),e.canadianEducation==="yes"&&(n+=e.canadianEduType==="long"?s.canadian_edu_long:s.canadian_edu_short),e.hasSibling==="yes"&&(n+=s.sibling_in_canada),he(e)&&$t(e)>=7&&(n+=Wt(e,t)>=5?s.french_strong_strong_english:s.french_strong_weak_english),Math.min(n,t.caps.additionalPointsTotal)}function Xt(e){const t=O(),n=Ot(e,t),s=zt(n,t),a=Yt(n,t),i=Kt(n,t),o=Ht(n,t),l=qt(n,t),u=parseInt(n.foreignWorkExp,10)||0,d=s+a+i+o+l,g=Jt(n,t),y=Vt(n,t),p=Zt(n,t);return{total:Math.min(d+g+y+p,t.caps.crsTotal),breakdown:{coreHumanCapital:d,spouseFactors:g,skillTransferability:y,additionalPoints:p},details:{age:s,education:a,firstLanguage:i,secondLanguage:o,canadianWork:l,foreignWork:u,spouseTotal:g,skillTotal:y,additionalTotal:p},policy:{version:t.version,effectiveDate:t.effectiveDate,source:t.source}}}function Qt(e,t){return Xt({...e,...t})}function en({as:e="div",className:t="",color:n="white",speed:s="6s",children:a,...i}){return r.jsxs(e,{className:`star-border ${t}`,style:{...i.style},...i,children:[r.jsx("div",{className:"star-border__glow star-border__glow--bottom",style:{background:`radial-gradient(circle, ${n}, transparent 10%)`,animationDuration:s}}),r.jsx("div",{className:"star-border__glow star-border__glow--top",style:{background:`radial-gradient(circle, ${n}, transparent 10%)`,animationDuration:s}}),r.jsx("div",{className:"star-border__inner",children:a})]})}const oe=["less_than_secondary","secondary","one_year_post","two_year_post","bachelors","two_or_more","masters","doctoral"],tn={Easy:14,Medium:7,Hard:0},Be={high:78,medium:58,low:35};function ce(e,t,n){return Math.max(t,Math.min(n,e))}function nn(e,t=Ae.averageCutoff){return Math.max(t+10,e+25)}function sn(e,t){return{listening:{7:6,8:7.5,9:8,10:8.5},reading:{7:6,8:6.5,9:7,10:8},writing:{7:6,8:6.5,9:7,10:7.5},speaking:{7:6,8:6.5,9:7,10:7.5}}[e]?.[t]||0}function an(e,t){if(e.firstOfficialLanguage==="french"){const s=["listening","reading","writing","speaking"],a={hasFrench:"yes",frenchTestType:"clb"};for(const i of s){const o=`french_${i}`;a[o]=String(Math.max(parseInt(e[o],10)||0,t))}return a}const n=["listening","reading","writing","speaking"];if(e.langTestType==="celpip"){const s={};for(const a of n){const i=`celpip_${a}`;s[i]=String(Math.max(parseInt(e[i],10)||0,t))}return s}if(e.langTestType==="ielts"){const s={};for(const a of n){const i=`ielts_${a}`,o=sn(a,t);s[i]=String(Math.max(parseFloat(e[i])||0,o))}return s}return{langTestType:"celpip",celpip_listening:String(t),celpip_reading:String(t),celpip_writing:String(t),celpip_speaking:String(t)}}function rn(e,t=7){const n={listening:parseInt(e.french_listening,10)||0,reading:parseInt(e.french_reading,10)||0,writing:parseInt(e.french_writing,10)||0,speaking:parseInt(e.french_speaking,10)||0};return{hasFrench:"yes",frenchTestType:"clb",french_listening:String(Math.max(n.listening,t)),french_reading:String(Math.max(n.reading,t)),french_writing:String(Math.max(n.writing,t)),french_speaking:String(Math.max(n.speaking,t))}}function on({pathId:e,gain:t,months:n,steps:s}){return s.map((a,i)=>({id:`${e}-m${i+1}`,title:a.title,details:a.details,etaWeeks:a.etaWeeks,expectedGain:i===s.length-1?Math.max(t-s.slice(0,-1).reduce((o,l)=>o+l.expectedGain,0),0):a.expectedGain,done:!1,monthHint:ce(Math.ceil((a.etaWeeks||1)/4),1,n)}))}function Ue({gain:e,months:t,difficulty:n,goalReached:s,likelihood:a}){const i=ce(24-t*2,0,24),o=ce(Math.round(e/4),0,80),l=s?32:0,u=Math.round((Be[a]||0)/3);return o+i+l+u+(tn[n]||0)}function W({id:e,title:t,summary:n,category:s,difficulty:a,months:i,estimatedCostCad:o,whyItFits:l,likelihood:u="medium",overrides:d,currentScore:g,targetScore:y,milestoneSteps:p}){const w=Qt(d.baseAnswers,d.patch),C=w.total-g;if(C<=0)return null;const h=w.total>=y,m=on({pathId:e,gain:C,months:i,steps:p});return{id:e,title:t,summary:n,category:s,difficulty:a,estimatedMonths:i,estimatedCostCad:o,projectedScore:w.total,potentialGain:C,goalReached:h,whyItFits:l,likelihood:u,likelihoodPercent:Be[u]||50,fitScore:Ue({gain:C,months:i,difficulty:a,goalReached:h,likelihood:u}),milestones:m,checks:{targetScore:y,currentScore:g,stillNeededAfterPath:Math.max(y-w.total,0)}}}function cn(e,t,n){const s=ye(e);if(s>=10)return null;const a=s<7?8:9,i=e.firstOfficialLanguage==="french"?"french":"english",o=i==="french"?"French Accelerator Path":"English Accelerator Path",l=i==="french"?"Raise your weakest French ability first, then target NCLC 9+ for stronger transferability outcomes.":"Raise your weakest English ability first, then target CLB 9+ for transferability gains.";return W({id:`${i}-accelerator`,title:o,summary:l,category:"Language",difficulty:"Medium",months:4,estimatedCostCad:460,whyItFits:`Your current minimum first-official-language level is CLB/NCLC ${s}, so language gains are one of the fastest realistic boosters.`,likelihood:"high",overrides:{baseAnswers:e,patch:an(e,a)},currentScore:t,targetScore:n,milestoneSteps:[{title:"Baseline audit and weak-skill diagnosis",details:"Run a mock test and identify the lowest 2 abilities to prioritize.",etaWeeks:1,expectedGain:0},{title:"Targeted study sprint",details:"Follow a 5-day weekly schedule focused on weakest modules and timed drills.",etaWeeks:6,expectedGain:8},{title:"Exam booking + strategy correction",details:"Book IELTS/CELPIP and fine-tune pacing, vocabulary, and response format.",etaWeeks:4,expectedGain:8},{title:"Retake and profile refresh",details:"Update final language scores in your profile and reassess draw competitiveness.",etaWeeks:4,expectedGain:12}]})}function ln(e,t,n){return e.firstOfficialLanguage==="french"?null:W({id:"french-advantage",title:"French Advantage Path",summary:"Reach NCLC 7 in all French abilities to unlock additional points and French-category draw access.",category:"Language",difficulty:"Hard",months:8,estimatedCostCad:690,whyItFits:"French pathways remain one of the highest-yield options for many candidates below general cutoffs.",likelihood:e.hasFrench==="yes"?"high":"medium",overrides:{baseAnswers:e,patch:rn(e,7)},currentScore:t,targetScore:n,milestoneSteps:[{title:"French baseline + study plan",details:"Assess current level and choose a structured curriculum for NCLC 7 goal.",etaWeeks:2,expectedGain:0},{title:"Core skill build phase",details:"Intensive reading/listening practice with weekly speaking/writing correction.",etaWeeks:12,expectedGain:8},{title:"TEF/TCF prep and mock cycles",details:"Complete timed mocks and focus weak modules before exam booking.",etaWeeks:8,expectedGain:8},{title:"Exam and score integration",details:"Enter verified NCLC scores and evaluate French-category competitiveness.",etaWeeks:6,expectedGain:12}]})}function dn(e,t,n){const s=parseInt(e.canadianWorkExp,10)||0;return s>=5?null:W({id:"canadian-work-ladder",title:"Canadian Work Ladder Path",summary:"Add one more year of Canadian skilled work to increase core and transferability points.",category:"Work Experience",difficulty:"Hard",months:12,estimatedCostCad:0,whyItFits:`You currently report ${s} year(s) of Canadian work; the next year can materially lift your score.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{canadianWorkExp:String(s+1)}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Employer alignment",details:"Confirm TEER eligibility and maintain full-time skilled role continuity.",etaWeeks:2,expectedGain:0},{title:"Documentation discipline",details:"Collect monthly pay records and letters for future proof of experience.",etaWeeks:16,expectedGain:4},{title:"Mid-year score checkpoint",details:"Recalculate progress and combine with language upgrades if needed.",etaWeeks:24,expectedGain:6},{title:"Complete one full year increment",details:"Update profile immediately when additional year is met.",etaWeeks:52,expectedGain:12}]})}function un(e,t,n){const s=oe.indexOf(e.education);if(s<0||s>=oe.length-1)return null;const a=oe[s+1];return W({id:"education-upgrade",title:"Education Upgrade Path",summary:"Move to the next recognized credential tier for predictable CRS uplift.",category:"Education",difficulty:"Hard",months:18,estimatedCostCad:12e3,whyItFits:`Your current education level can be improved to ${a.replace(/_/g," ")} for additional points.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{education:a}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Program selection",details:"Choose an accredited credential path aligned to CRS point tiers.",etaWeeks:4,expectedGain:0},{title:"Enrollment and milestone completion",details:"Track term-level progress to keep the plan on schedule.",etaWeeks:20,expectedGain:4},{title:"Credential completion prep",details:"Prepare final documents and ECA requirements where needed.",etaWeeks:20,expectedGain:4},{title:"Credential update in profile",details:"Add completed credential and recalculate total score immediately.",etaWeeks:28,expectedGain:10}]})}function fn(e,t,n){if(!pe(e))return null;const s=["listening","reading","writing","speaking"],a={};for(const i of s){const o=`spouseLang_${i}`;a[o]=String(Math.max(parseInt(e[o],10)||0,9))}return W({id:"spouse-optimization",title:"Spouse Optimization Path",summary:"Use spouse language and experience factors for faster low-cost point improvements.",category:"Family Factors",difficulty:"Medium",months:5,estimatedCostCad:420,whyItFits:"You have an accompanying spouse, so spouse-factor optimization is available and often underused.",likelihood:"high",overrides:{baseAnswers:e,patch:a},currentScore:t,targetScore:n,milestoneSteps:[{title:"Spouse baseline review",details:"Identify spouse factors currently missing points.",etaWeeks:1,expectedGain:0},{title:"Spouse language prep",details:"Prepare specifically for CLB 9 in the weakest spouse abilities.",etaWeeks:8,expectedGain:4},{title:"Spouse profile integration",details:"Update spouse test scores and re-optimize joint profile configuration.",etaWeeks:6,expectedGain:8}]})}function hn(e,t,n){return e.hasPNP==="yes"?null:W({id:"pnp-fast-track",title:"PNP Fast-Track Path",summary:"Pursue provincial nomination for the largest single CRS jump (+600).",category:"Provincial",difficulty:"Hard",months:6,estimatedCostCad:2200,whyItFits:"If your baseline is below recent cutoffs, PNP remains the most direct guaranteed-lift route.",likelihood:"medium",overrides:{baseAnswers:e,patch:{hasPNP:"yes"}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Province shortlist",details:"Match your profile to provinces aligned with occupation/language strengths.",etaWeeks:2,expectedGain:0},{title:"Document stack preparation",details:"Prepare references, test proofs, ECA, and provincial forms early.",etaWeeks:6,expectedGain:0},{title:"Submit nomination stream",details:"Apply to selected stream and monitor NOI/application updates.",etaWeeks:8,expectedGain:0},{title:"Nomination linked to profile",details:"Accept nomination and refresh profile for major score jump.",etaWeeks:8,expectedGain:600}]})}function pn(e,t){const n=[...e].sort((u,d)=>d.fitScore-u.fitScore);if(n.length<2)return null;const[s,a]=n,i=Math.min(s.projectedScore+a.potentialGain,1200),o=i-s.checks.currentScore;if(o<=0)return null;const l=i>=t;return{id:"combo-bridge-plan",title:"Bridge Combination Path",summary:`Combine “${s.title}” + “${a.title}” to maximize speed while limiting risk.`,category:"Combination",difficulty:s.difficulty==="Hard"||a.difficulty==="Hard"?"Hard":"Medium",estimatedMonths:Math.round((s.estimatedMonths+a.estimatedMonths)/2),estimatedCostCad:s.estimatedCostCad+a.estimatedCostCad,projectedScore:i,potentialGain:o,goalReached:l,whyItFits:"A blended route often reaches target faster than single-track attempts.",likelihood:"medium",likelihoodPercent:62,fitScore:Ue({gain:o,months:Math.round((s.estimatedMonths+a.estimatedMonths)/2),difficulty:s.difficulty==="Hard"||a.difficulty==="Hard"?"Hard":"Medium",goalReached:l,likelihood:"medium"}),milestones:[...s.milestones.slice(0,2).map(u=>({...u,id:`combo-${u.id}`})),...a.milestones.slice(0,2).map(u=>({...u,id:`combo-${u.id}`})),{id:"combo-final-sync",title:"Final score synchronization",details:"Update all achieved improvements together and reassess draw strategy.",etaWeeks:4,expectedGain:Math.max(o-16,0),done:!1,monthHint:2}],checks:{targetScore:t,currentScore:s.checks.currentScore,stillNeededAfterPath:Math.max(t-i,0)}}}function mn(e,t,n={}){const s=t?.total||0,a=Number(n.averageCutoff)||Ae.averageCutoff,i=Number(n.targetScore)||nn(s,a),o=[cn(e,s,i),ln(e,s,i),dn(e,s,i),un(e,s,i),fn(e,s,i),hn(e,s,i)].filter(Boolean),l=pn(o,i);l&&o.push(l);const u=o.sort((d,g)=>g.fitScore-d.fitScore).slice(0,5);return{currentScore:s,targetScore:i,plans:u,generatedAt:new Date().toISOString()}}const ze="crs-path-tracking-v1",_e=540,Ye=55,gn=30,yn=25;function Ke(e,t,n){return Math.max(t,Math.min(n,e))}function He(){return typeof localStorage<"u"}function E(e=new Date){const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)}function qe(e){return new Date(`${e}T00:00:00.000Z`)}function be(e,t){const n=new Date(e||Date.now());return n.setDate(n.getDate()+t),n.toISOString()}function F(e,t){const n=qe(e);return n.setUTCDate(n.getUTCDate()+t),E(n)}function ke(){if(!He())return{};try{const e=localStorage.getItem(ze);if(!e)return{};const t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch{return{}}}function Je(e){if(He())try{localStorage.setItem(ze,JSON.stringify(e))}catch{}}function Se(e,t){if(!e||typeof e!="object")return null;const n=Math.max(1,Number(e.etaWeeks)||1);return{...e,id:e.id||`m_${t+1}`,title:e.title||`Milestone ${t+1}`,details:e.details||"",etaWeeks:n,expectedGain:Number.isFinite(Number(e.expectedGain))?Number(e.expectedGain):0,done:!!e.done,completedAt:e.completedAt||null}}function Ve(e,t){if(!e||typeof e!="object")return null;const n=E(e.date||e.dateKey||e.scheduledFor);return n?{id:e.id||`d_${t+1}`,date:n,milestoneId:e.milestoneId||null,title:String(e.title||"Daily action").trim(),details:String(e.details||"").trim(),expectedMinutes:Math.max(10,Number(e.expectedMinutes)||Ye),expectedGain:Number.isFinite(Number(e.expectedGain))?Number(e.expectedGain):0,done:!!e.done,completedAt:e.completedAt||null}:null}function Ze(e,t){const n=(e?.milestones||[]).map((o,l)=>Se(o,l)).filter(Boolean);if(!n.length)return[];const s=E(t||new Date);if(!s)return[];const a=[];let i=0;for(const o of n){const l=Ke(Math.round((Number(o.etaWeeks)||1)*7),7,224),u=l>0?Number(((Number(o.expectedGain)||0)/l).toFixed(2)):0;for(let d=0;d<l&&a.length<_e;d++){const g=F(s,i+d),y=qe(g).getUTCDay(),p=y===0||y===6,w=d===0;let C=`Focused practice: ${o.title}`,h=o.details||"Work toward this milestone today.",m=p?gn:Ye;w?(C=`Kickoff plan: ${o.title}`,h=`Set tasks and resources for this phase. ${o.details||""}`.trim(),m=yn):p&&(C=`Weekly review: ${o.title}`,h=`Light revision + progress check. ${o.details||""}`.trim()),a.push({id:`${e?.id||"path"}-d${a.length+1}`,date:g,milestoneId:o.id,title:C,details:h,expectedMinutes:m,expectedGain:u,done:!1,completedAt:null})}if(i+=l,a.length>=_e)break}return a}function Xe(e){if(!e||typeof e!="object")return null;const t=e.startedAt||new Date().toISOString(),n=(e.milestones||[]).map((i,o)=>Se(i,o)).filter(Boolean),s=(e.dailyTasks||[]).map((i,o)=>Ve(i,o)).filter(Boolean),a=s.length>0?s:Ze(e.selectedPath,t);return{...e,id:e.id||`track_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`,status:e.status||"active",startedAt:t,updatedAt:e.updatedAt||t,nextCheckInAt:e.nextCheckInAt||be(t,7),currentScore:Number(e.currentScore)||0,targetScore:Number(e.targetScore)||Number(e?.selectedPath?.checks?.targetScore)||0,selectedPath:e.selectedPath||null,milestones:n,dailyTasks:a,notes:Array.isArray(e.notes)?e.notes:[],dailyStats:e.dailyStats||null}}function D(e,{touchUpdatedAt:t=!0}={}){const n=Xe(e);if(!n)return null;const s=Qe(n),a=ne(n),i=n.milestones.length>0&&n.milestones.every(u=>u.done),o=n.dailyTasks.length===0||n.dailyTasks.every(u=>u.done);return{...n,status:i&&o?"completed":"active",progressPct:s,dailyStats:a,updatedAt:t?new Date().toISOString():n.updatedAt}}function bn(e=null,t=null){return e?`user:${e}`:t?`profile:${t}`:"guest:default"}function je(e){if(!e)return null;const t=ke();return D(t[e],{touchUpdatedAt:!1})}function Ne(e,t){if(!e||!t)return t;const n=ke(),s=D(t,{touchUpdatedAt:!1});return n[e]=s,Je(n),s}function kn(e){if(!e)return;const t=ke();delete t[e],Je(t)}function Sn(e,t,n){const s=new Date().toISOString(),a=(e?.milestones||[]).map((o,l)=>Se({...o,done:!1,completedAt:null},l)).filter(Boolean),i=Ze(e,s);return D({id:`track_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`,status:"active",startedAt:s,updatedAt:s,nextCheckInAt:be(s,7),currentScore:Number(t)||0,targetScore:Number(n)||Number(e?.checks?.targetScore)||0,selectedPath:e,milestones:a,dailyTasks:i,notes:[]},{touchUpdatedAt:!0})}function Qe(e){const t=e?.milestones||[],n=e?.dailyTasks||[],s=t.length?t.filter(i=>i.done).length/t.length:0,a=n.length?n.filter(i=>i.done).length/n.length:0;return!t.length&&!n.length?0:n.length?t.length?Math.round((s*.65+a*.35)*100):Math.round(a*100):Math.round(s*100)}function ne(e){const t=(e?.dailyTasks||[]).map((h,m)=>Ve(h,m)).filter(Boolean).sort((h,m)=>h.date.localeCompare(m.date)),n=E(new Date);if(!t.length)return{totalTasks:0,completedTasks:0,completionPct:0,dueToday:0,completedToday:0,overdueTasks:0,expectedByToday:0,completedByToday:0,paceStatus:"not-started",streakDays:0,todayKey:n};const s=t.length,a=t.filter(h=>h.done).length,i=t.filter(h=>h.date===n).length,o=t.filter(h=>h.date===n&&h.done).length,l=t.filter(h=>h.date<=n).length,u=t.filter(h=>h.date<=n&&h.done).length,d=t.filter(h=>h.date<n&&!h.done).length,g=Math.round(a/s*100);let y="not-started";if(l>0){const h=u/l;h>=1?y="on-track":h>=.75?y="slightly-behind":y="behind"}const p=new Set(t.filter(h=>h.done).map(h=>E(h.completedAt||h.date)).filter(Boolean));let w=n;!p.has(w)&&i===0&&(w=F(n,-1));let C=0;for(;p.has(w);)C+=1,w=F(w,-1);return{totalTasks:s,completedTasks:a,completionPct:g,dueToday:i,completedToday:o,overdueTasks:d,expectedByToday:l,completedByToday:u,paceStatus:y,streakDays:C,todayKey:n}}function xn(e,t=E(new Date)){return(e?.dailyTasks||[]).filter(s=>E(s.date)===t)}function wn(e,t=7,n=E(new Date)){const s=F(n,Math.max(t-1,0));return(e?.dailyTasks||[]).filter(a=>{const i=E(a.date);return i>=n&&i<=s})}function Tn(e){const t=Xe(e);if(!t||!t.dailyTasks.length)return null;const n=ne(t),s=t.dailyTasks.length,a=t.dailyTasks[0]?.date||E(t.startedAt),i=s,o=n.expectedByToday>0?n.completedByToday/n.expectedByToday:1,l=Ke(o||1,.45,1.35),u=Math.max(1,Math.round(s/l)),d=F(a,i-1),g=F(a,u-1);return{baselineDate:d,projectedDate:g,paceMultiplier:l,baselineDays:i,projectedDays:u,delayDays:u-i}}function vn(e,t){if(!e)return e;const n=(e.milestones||[]).map(s=>{if(s.id!==t)return s;const a=!s.done;return{...s,done:a,completedAt:a?new Date().toISOString():null}});return D({...e,milestones:n},{touchUpdatedAt:!0})}function Cn(e,t){if(!e)return e;const n=(e.dailyTasks||[]).map(s=>{if(s.id!==t)return s;const a=!s.done;return{...s,done:a,completedAt:a?new Date().toISOString():null}});return D({...e,dailyTasks:n},{touchUpdatedAt:!0})}function Pn(e,t){return e&&D({...e,currentScore:Number(t)||0},{touchUpdatedAt:!0})}function _n(e,t=7){if(!e)return e;const n=e.nextCheckInAt||new Date().toISOString();return D({...e,nextCheckInAt:be(n,t)},{touchUpdatedAt:!0})}function jn(e,t){if(!e||!t?.trim())return e;const n=[...e.notes||[],{id:`note_${Date.now().toString(36)}`,text:t.trim(),createdAt:new Date().toISOString()}];return D({...e,notes:n},{touchUpdatedAt:!0})}function Nn(e){if(!e)return"Choose an expert path to get a daily action plan.";if(e.status==="completed")return"Great progress — this path is complete. Recalculate and choose your next upgrade target.";const t=ne(e),n=E(new Date),s=(e.dailyTasks||[]).find(i=>i.date===n&&!i.done);if(t.overdueTasks>0)return`You have ${t.overdueTasks} overdue daily task(s). Clear one overdue task before adding new work.`;if(s)return`Today’s focus: ${s.title} (~${s.expectedMinutes} min).`;const a=(e.milestones||[]).find(i=>!i.done);return a?`Next milestone: ${a.title}. Keep your streak alive with one focused task today.`:"You are close to completion — finish remaining daily actions and refresh your score."}function xe(e,t){const n=String(e?.message||"");return new RegExp(`relation\\s+["']?public\\.${t}["']?\\s+does not exist`,"i").test(n)||new RegExp(`table\\s+["']?${t}["']?\\s+not found`,"i").test(n)}function we(e,t){return new Error(`${e}: ${t?.message||t?.hint||String(t)}`)}function le(){return new Date().toISOString()}function Te(){return K}function En(e){if(!e)return!1;const t=new Set(["active","trialing","paid"]),n=String(e.status||"").toLowerCase();if(!t.has(n))return!1;if(!e.current_period_end)return!0;const s=new Date(e.current_period_end).getTime();return Number.isFinite(s)&&s>Date.now()}async function Ee(e){if(!e)return{status:"skipped",reason:"Missing user id",active:!1};if(!Te())return{status:"skipped",reason:"Supabase env vars are not configured",active:!1};const t=await H();if(!t)return{status:"skipped",reason:"Supabase client is unavailable",active:!1};const{data:n,error:s}=await t.from("user_tracking_access").select("*").eq("user_id",e).limit(1);if(s&&xe(s,"user_tracking_access"))return{status:"skipped",reason:"Tracking access table missing. Run the latest supabase/schema.sql.",active:!1};if(s)throw we("Failed to fetch tracking access",s);const a=n?.[0]||null;return{status:"ok",row:a,active:En(a)}}async function Mn(e,t){if(!e||!t)return{status:"skipped",reason:"Missing user id or tracking payload"};if(!Te())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=await H();if(!n)return{status:"skipped",reason:"Supabase client is unavailable"};const s={id:t.id,user_id:e,path_id:t.selectedPath?.id||null,target_score:Number(t.targetScore)||0,start_score:Number(t.selectedPath?.checks?.currentScore)||0,current_score:Number(t.currentScore)||0,status:t.status||"active",progress_pct:Number.isFinite(t.progressPct)?t.progressPct:0,next_check_in_at:t.nextCheckInAt||null,milestones_json:t.milestones||[],daily_tasks_json:t.dailyTasks||[],plan_json:t.selectedPath||{},notes_json:t.notes||[],updated_at:le()},{data:a,error:i}=await n.from("user_path_tracking").upsert(s,{onConflict:"id"}).select();if(i&&xe(i,"user_path_tracking"))return{status:"skipped",reason:"Path tracking table missing. Run the latest supabase/schema.sql."};if(i)throw we("Failed to save path tracking",i);return{status:"ok",data:a?.[0]||null}}async function Dn(e){if(!e)return{status:"skipped",reason:"Missing user id"};if(!Te())return{status:"skipped",reason:"Supabase env vars are not configured"};const t=await H();if(!t)return{status:"skipped",reason:"Supabase client is unavailable",data:null};const{data:n,error:s}=await t.from("user_path_tracking").select("*").eq("user_id",e).order("updated_at",{ascending:!1}).limit(1);if(s&&xe(s,"user_path_tracking"))return{status:"skipped",reason:"Path tracking table missing. Run the latest supabase/schema.sql.",data:null};if(s)throw we("Failed to load path tracking",s);const a=n?.[0]||null;return a?{status:"ok",data:{id:a.id,status:a.status||"active",startedAt:a.created_at||le(),updatedAt:a.updated_at||le(),nextCheckInAt:a.next_check_in_at||null,currentScore:a.current_score||0,targetScore:a.target_score||0,selectedPath:a.plan_json||null,milestones:Array.isArray(a.milestones_json)?a.milestones_json:[],dailyTasks:Array.isArray(a.daily_tasks_json)?a.daily_tasks_json:[],notes:Array.isArray(a.notes_json)?a.notes_json:[]}}:{status:"ok",data:null}}function L(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleDateString()}function An(e){const t=String(e||"").toLowerCase();return t==="easy"?"path-diff-easy":t==="hard"?"path-diff-hard":"path-diff-medium"}function Me(e,t,n){return Math.max(t,Math.min(n,e))}function De(e,t){const n=new Date(e||Date.now());return n.setMonth(n.getMonth()+t),n.toISOString()}function In(e){const t=Number(e)||0;return Number.isInteger(t)?String(t):t.toFixed(1)}function Ln(e){return{"on-track":"On track","slightly-behind":"Slightly behind",behind:"Behind schedule","not-started":"Not started"}[String(e||"")]||"In progress"}function Rn(e){return e?e.delayDays>0?`${e.delayDays} day(s) behind baseline`:e.delayDays<0?`${Math.abs(e.delayDays)} day(s) ahead of baseline`:"On baseline timeline":""}async function Fn(e){if(!e)return"";const t=[];e.message&&t.push(String(e.message));const n=e.context;if(!n||typeof n.clone!="function")return t.join(" · ").trim();try{const s=n.clone();if((s.headers?.get?.("content-type")||"").includes("application/json")){const i=await s.json(),o=[i?.message,i?.error,i?.details].filter(Boolean).map(l=>String(l));o.length&&t.push(...o)}else{const i=await s.text();i&&t.push(i)}}catch{}return[...new Set(t)].join(" · ").trim()}function On({answers:e,result:t,averageCutoff:n,categoryInfo:s}){const a=Number(t?.total)||0,i=Math.max(Number(n)||520,a+25),o=(s||[]).filter(d=>typeof d?.check=="function"&&d.check(e)).map(d=>Number(d.recentCutoff)).filter(d=>Number.isFinite(d)&&d>0);if(o.length===0)return Me(i+10,300,1200);const l=Math.min(...o),u=Math.max(l+5,a+5);return Me(Math.min(i+10,u),300,1200)}function Wn({answers:e,result:t,averageCutoff:n,categoryInfo:s=[],motionIntensity:a="full"}){const i=Pt()||a!=="full",{user:o,isAuthenticated:l}=Dt(),u=void 0,d=f.useMemo(()=>On({answers:e,result:t,averageCutoff:n,categoryInfo:s}),[e,t,n,s]),[g,y]=f.useState(()=>Math.max((t?.total||0)+25,500)),[p,w]=f.useState(!1),[C,h]=f.useState(""),[m,M]=f.useState(null),[$,G]=f.useState(""),[B,_]=f.useState(""),[J,b]=f.useState(!1),[S,x]=f.useState({loading:!1,active:!1,reason:""}),T=f.useMemo(()=>bn(o?.id||null,null),[o?.id]),P=f.useMemo(()=>mn(e,t,{targetScore:g,averageCutoff:n}),[e,t,g,n]),v=f.useMemo(()=>P.plans.find(c=>c.id===C)||P.plans[0]||null,[P.plans,C]),N=l&&S.active,U=Qe(m),et=Nn(m),A=f.useMemo(()=>ne(m),[m]),se=f.useMemo(()=>xn(m),[m]),ae=f.useMemo(()=>wn(m,7),[m]),V=f.useMemo(()=>Tn(m),[m]),z=f.useMemo(()=>{if(!v)return null;const c=m?.startedAt||new Date().toISOString(),k=v.difficulty==="Easy"?1:v.difficulty==="Hard"?3:2,j=Math.max(v.estimatedMonths-k,1),I=v.estimatedMonths+k+(v.goalReached?0:1);return{earliestMonths:j,latestMonths:I,earliestDate:De(c,j),latestDate:De(c,I)}},[v,m?.startedAt]);f.useEffect(()=>{w(!1)},[t?.total]),f.useEffect(()=>{p||y(d)},[d,p]),f.useEffect(()=>{if(!P.plans.length){h("");return}P.plans.some(k=>k.id===C)||h(P.plans[0].id)},[P.plans,C]),f.useEffect(()=>{let c=!0;return queueMicrotask(()=>{if(!c)return;const k=je(T);if(k){const j={...k,currentScore:Number(t?.total)||0};M(j)}else M(null)}),()=>{c=!1}},[t?.total,T]),f.useEffect(()=>{if(!l||!o?.id)return;let c=!0;return Ee(o.id).then(k=>{c&&x({loading:!1,active:!!k.active,reason:k.reason||""})}).catch(k=>{c&&x({loading:!1,active:!1,reason:k.message||"Could not verify tracking access."})}),()=>{c=!1}},[l,o?.id]),f.useEffect(()=>{if(!l||!o?.id)return;let c=!0;return Dn(o.id).then(k=>{if(!c||k.status!=="ok"||!k.data)return;const j=je(T),I=new Date(k.data.updatedAt||0).getTime(),ie=new Date(j?.updatedAt||0).getTime();if(!j||I>ie){const ve={...k.data,currentScore:Number(t?.total)||0};Ne(T,ve),M(ve)}}).catch(()=>{}),()=>{c=!1}},[l,t?.total,T,o?.id]);const Y=async c=>{const k=Pn(c,t.total),j=Ne(T,k);if(M(j),l&&N&&o?.id)try{await Mn(o.id,j)}catch{}return j},tt=async()=>{if(!v)return;if(!N){_("Tracking is available on the 5 CAD/month plan.");return}const c=Sn(v,t.total,g);await Y(c),_("Expert path started. Complete today's tasks to build momentum.")},nt=async c=>{if(!m||!N)return;const k=vn(m,c);await Y(k),_("Milestone progress updated.")},st=async c=>{if(!m||!N)return;const k=Cn(m,c);await Y(k),_("Daily task updated.")},at=async()=>{if(!m||!N)return;const c=_n(m,7);await Y(c),_("Next check-in moved by 7 days.")},it=async()=>{if(!m||!N)return;const c=$.trim();if(!c)return;const k=jn(m,c);await Y(k),G(""),_("Coach note saved.")},rt=()=>{kn(T),M(null),_("Tracking reset. Choose another expert path.")},ot=async()=>{if(!l||!o?.id){_("Please log in before subscribing.");return}b(!0),_("");try{const c=await H();if(!c)throw new Error("Supabase client is not configured.");const{data:k,error:j}=await c.functions.invoke("create-tracking-checkout",{body:{source:"path-coach"}});if(j){const ie=await Fn(j);throw new Error(ie||"Could not create checkout session.")}const I=k?.url;if(!I)throw new Error("Checkout function returned no URL.");window.location.href=I,_("Opening secure checkout...")}catch(c){const k=String(c?.message||""),j=/non-2xx status code/i.test(k);_(j?'Checkout backend is returning an error. Deploy/fix the Supabase "create-tracking-checkout" function and Stripe secrets, or set VITE_STRIPE_TRACKING_CHECKOUT_URL fallback.':k||"Could not start subscription checkout.")}finally{b(!1)}};return r.jsxs(re.div,{className:"card path-coach-card",initial:i?!1:{opacity:0,y:18},animate:{opacity:1,y:0},transition:i?{duration:0}:{duration:.24,ease:[.22,1,.36,1]},children:[r.jsxs("div",{className:"path-coach-head",children:[r.jsx("h3",{children:"Expert Strategy Coach"}),r.jsx("span",{className:"path-pill",children:"Phase 2"})]}),r.jsx("p",{className:"cat-intro",children:"Pick the strategy that fits you best, then follow a guided daily plan to close your CRS gap faster."}),r.jsxs("div",{className:"path-target-row",children:[r.jsxs("label",{className:"wi-field",children:[r.jsx("span",{children:"Target score"}),r.jsx("input",{type:"number",min:"300",max:"1200",value:g,onChange:c=>{w(!0),y(Number(c.target.value)||P.targetScore)}})]}),r.jsxs("div",{className:"path-target-meta",children:[r.jsxs("small",{children:["Current: ",P.currentScore]}),r.jsxs("small",{children:["Score gap: ",Math.max(g-P.currentScore,0)]}),r.jsxs("small",{children:["Smart target: ",d]})]})]}),r.jsx("div",{className:"path-grid",children:P.plans.map(c=>r.jsxs(re.button,{type:"button",className:`path-option ${v?.id===c.id?"selected":""}`,onClick:()=>h(c.id),"aria-pressed":v?.id===c.id,whileHover:i?void 0:{y:-3},whileTap:i?void 0:{scale:.98},children:[r.jsxs("div",{className:"path-option-head",children:[r.jsx("strong",{children:c.title}),r.jsx("span",{className:`path-diff ${An(c.difficulty)}`,children:c.difficulty})]}),r.jsx("p",{children:c.summary}),r.jsxs("div",{className:"path-stats",children:[r.jsxs("span",{children:["+",c.potentialGain," pts"]}),r.jsxs("span",{children:[c.estimatedMonths," months"]}),r.jsxs("span",{children:[c.likelihoodPercent,"% likely"]})]}),r.jsx("small",{children:c.goalReached?"Can likely reach your target with this path":`${c.checks.stillNeededAfterPath} pts still needed after this path`})]},c.id))}),v&&r.jsxs("div",{className:"path-detail",children:[r.jsx("h4",{children:v.title}),r.jsx("p",{className:"path-why",children:v.whyItFits}),r.jsxs("div",{className:"path-meta-line",children:[r.jsxs("span",{children:["Projected score: ",r.jsx("strong",{children:v.projectedScore})]}),r.jsxs("span",{children:["Estimated cost: ",r.jsxs("strong",{children:[v.estimatedCostCad," CAD"]})]})]}),z&&r.jsxs("div",{className:"path-meta-line",children:[r.jsxs("span",{children:["Likely completion window: ",r.jsxs("strong",{children:[z.earliestMonths,"-",z.latestMonths," months"]})]}),r.jsxs("span",{children:["Target finish dates: ",r.jsxs("strong",{children:[L(z.earliestDate)," - ",L(z.latestDate)]})]})]}),r.jsx("ul",{className:"path-milestones-preview",children:v.milestones.map(c=>r.jsxs("li",{children:[r.jsx("span",{children:c.title}),r.jsxs("small",{children:["~",c.etaWeeks," weeks"]})]},c.id))})]}),!l&&r.jsx("div",{className:"path-paywall",children:r.jsx("p",{children:"Log in first, then activate paid tracking (5 CAD/month) to unlock daily guidance and cloud sync."})}),l&&!N&&r.jsxs("div",{className:"path-paywall",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Tracking plan:"})," 5 CAD / month"]}),r.jsx("p",{children:"Includes expert strategy tracking, daily tasks, reminders, and cross-device progress sync."}),r.jsxs("div",{className:"path-pay-actions",children:[r.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:J,onClick:ot,children:J?"Opening...":"Subscribe (5 CAD/month)"}),r.jsx("button",{type:"button",className:"action-btn",onClick:async()=>{if(o?.id){x(c=>({...c,loading:!0}));try{const c=await Ee(o.id);x({loading:!1,active:!!c.active,reason:c.reason||""}),_(c.active?"Subscription detected. Tracking unlocked.":"Subscription not active yet.")}catch(c){x({loading:!1,active:!1,reason:c.message||""})}}},children:S.loading?"Checking...":"Refresh payment status"}),u]}),S.reason&&r.jsx("small",{children:S.reason})]}),r.jsxs("div",{className:"path-actions",children:[r.jsx(en,{color:"var(--primary)",speed:"5s",children:r.jsx("button",{className:"btn-next finish",type:"button",onClick:tt,children:m?"Switch to this strategy":"Start this strategy"})}),m&&r.jsx("button",{className:"btn-toggle",type:"button",onClick:rt,children:"Reset tracking"})]}),m&&r.jsxs("div",{className:"path-tracker",children:[r.jsxs("div",{className:"path-progress-head",children:[r.jsxs("strong",{children:["Progress: ",U,"%"]}),r.jsxs("span",{children:["Next check-in: ",L(m.nextCheckInAt)]})]}),r.jsx("div",{className:"path-progress-bar-wrap",children:r.jsx(re.div,{className:"path-progress-bar",initial:{width:0},animate:{width:`${U}%`},transition:i?{duration:0}:{duration:.7}})}),r.jsxs("div",{className:"path-daily-stats",children:[r.jsxs("span",{children:["Streak: ",r.jsxs("strong",{children:[A.streakDays," day(s)"]})]}),r.jsxs("span",{children:["Completed: ",r.jsxs("strong",{children:[A.completedTasks,"/",A.totalTasks]})]}),r.jsxs("span",{children:["Today: ",r.jsxs("strong",{children:[A.completedToday,"/",A.dueToday]})]}),r.jsxs("span",{className:`pace pace-${A.paceStatus}`,children:["Pace: ",r.jsx("strong",{children:Ln(A.paceStatus)})]})]}),V&&r.jsxs("div",{className:"path-coach-note",children:[r.jsx("strong",{children:"Completion forecast:"})," baseline ",L(V.baselineDate)," · current pace ",L(V.projectedDate)," (",Rn(V),")"]}),r.jsxs("div",{className:"path-coach-note",children:[r.jsx("strong",{children:"Coach guidance:"})," ",et]}),r.jsxs("div",{className:"path-daily-section",children:[r.jsx("h5",{children:"Today's guide"}),!se.length&&r.jsx("p",{className:"path-empty-text",children:"No task is due today. Continue with the next upcoming task."}),!!se.length&&r.jsx("ul",{className:"path-daily-list",children:se.map(c=>r.jsxs("li",{className:c.done?"done":"",children:[r.jsx("button",{type:"button",onClick:()=>st(c.id),disabled:!N,children:c.done?"✓":"○"}),r.jsxs("div",{children:[r.jsx("strong",{children:c.title}),r.jsx("p",{children:c.details}),r.jsxs("small",{children:[c.expectedMinutes," min planned · +",In(c.expectedGain)," projected CRS pace"]})]})]},c.id))})]}),r.jsxs("div",{className:"path-daily-section",children:[r.jsx("h5",{children:"Upcoming 7-day guide"}),!ae.length&&r.jsx("p",{className:"path-empty-text",children:"No upcoming tasks yet."}),!!ae.length&&r.jsx("ul",{className:"path-upcoming-list",children:ae.slice(0,10).map(c=>r.jsxs("li",{children:[r.jsx("span",{children:L(c.date)}),r.jsx("span",{children:c.title})]},c.id))})]}),r.jsx("ul",{className:"path-milestone-list",children:(m.milestones||[]).map(c=>r.jsxs("li",{className:c.done?"done":"",children:[r.jsx("button",{type:"button",onClick:()=>nt(c.id),disabled:!N,children:c.done?"✓":"○"}),r.jsxs("div",{children:[r.jsx("strong",{children:c.title}),r.jsx("p",{children:c.details}),r.jsxs("small",{children:["Expected impact: +",c.expectedGain," pts · ~",c.etaWeeks," weeks"]})]})]},c.id))}),r.jsx("div",{className:"path-checkin-row",children:r.jsx("button",{className:"action-btn",type:"button",onClick:at,disabled:!N,children:"Move next check-in by 7 days"})}),r.jsxs("div",{className:"path-note-input",children:[r.jsx("input",{type:"text",value:$,onChange:c=>G(c.target.value),placeholder:"Add blocker or update note for your next check-in..."}),r.jsx("button",{className:"action-btn",type:"button",onClick:it,disabled:!N,children:"Save note"})]})]}),B&&r.jsx("p",{className:"save-status",children:B})]})}const qn=Object.freeze(Object.defineProperty({__proto__:null,default:Wn},Symbol.toStringTag,{value:"Module"}));export{Un as A,qn as P,en as S,Nt as _,zn as a,mn as b,Xt as c,ye as d,Wt as e,Qt as f,H as g,$t as h,K as i,pe as j,Kn as k,Yn as l,Hn as m,Rt as r,It as s,Dt as u};
