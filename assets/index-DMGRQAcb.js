const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WelcomeScreen-BzG4swIP.js","assets/vendor-react-Ah1pgjPn.js","assets/feature-path-coach-CtSDU3nA.js","assets/data-question-bank-F-s7nTqV.js","assets/vendor-supabase-BZ0N5lZN.js","assets/vendor-motion-DURBmaq0.js","assets/Wizard-BAN-4pGr.js","assets/Results-CCMNm-l7.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,c as Me}from"./vendor-react-Ah1pgjPn.js";import{s as j,i as ce,u as be,A as ze}from"./feature-path-coach-CtSDU3nA.js";import{u as Fe,m as qe,A as Be}from"./vendor-motion-DURBmaq0.js";import{t as J,r as U}from"./data-question-bank-F-s7nTqV.js";import"./vendor-supabase-BZ0N5lZN.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();const Ue="modulepreload",Ye=function(t){return"/"+t},de={},le=function(s,n,i){let a=Promise.resolve();if(n&&n.length>0){let k=function(p){return Promise.all(p.map(S=>Promise.resolve(S).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),f=d?.nonce||d?.getAttribute("nonce");a=k(n.map(p=>{if(p=Ye(p),p in de)return;de[p]=!0;const S=p.endsWith(".css"),b=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const g=document.createElement("link");if(g.rel=S?"stylesheet":Ue,S||(g.as="script"),g.crossOrigin="",g.href=p,f&&g.setAttribute("nonce",f),document.head.appendChild(g),S)return new Promise((N,G)=>{g.addEventListener("load",N),g.addEventListener("error",()=>G(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(d){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=d,window.dispatchEvent(f),!f.defaultPrevented)throw d}return a.then(d=>{for(const f of d||[])f.status==="rejected"&&o(f.reason);return s().catch(o)})},ve=c.createContext();function Ge({children:t}){const[s,n]=c.useState(()=>{try{return localStorage.getItem("crs-theme")==="dark"}catch{return!1}});c.useEffect(()=>{document.documentElement.setAttribute("data-theme",s?"dark":"light");try{localStorage.setItem("crs-theme",s?"dark":"light")}catch{}},[s]);const i=()=>n(a=>!a);return e.jsx(ve.Provider,{value:{dark:s,toggle:i},children:t})}function We(){return c.useContext(ve)}const $e={"header.title":"CRS Calculator 2026","welcome.heading":`Free CRS Calculator
for Express Entry 2026`,"welcome.sub":"Calculate your Comprehensive Ranking System (CRS) score for Canada Express Entry. Check FSW, CEC, PNP eligibility instantly. Updated with latest IRCC draw cutoffs.","welcome.btn":"Calculate My CRS Score Free","welcome.updated":"IRCC data updated:","welcome.trust":"Uses official IRCC draw data â€” last updated:","welcome.microcopy":"This will take 3 minutes â€” one question at a time.","welcome.resume":"You have an unfinished calculation.","welcome.resumeBtn":"Resume","welcome.startFresh":"Start Fresh","feature.accurate":"Official CRS Formula","feature.accurateDesc":"100% accurate IRCC scoring algorithm","feature.suggestions":"Boost Your Score","feature.suggestionsDesc":"Get personalized tips to gain +50 points","feature.draws":"2026 Draw Cutoffs","feature.drawsDesc":"Live IRCC Express Entry draw results","feature.instant":"Free & Instant","feature.instantDesc":"No signup required Â· Results in 2 minutes","wizard.step":"Step","wizard.of":"of","wizard.next":"Next â†’","wizard.back":"â† Back","wizard.calculate":"Calculate Score âœ“","results.breakdown":"Your CRS Score Breakdown","results.improve":"How to Increase Your CRS Score","results.category":"Category-Based Draw Eligibility","results.catIntro":"IRCC runs category-based draws with lower cutoffs for healthcare, STEM, trades, transport, and French speakers. Here's your eligibility:","results.timeline":"PR Timeline Estimate","results.draws":"Latest Express Entry Draws 2026","results.disclaimer":"This free CRS calculator provides an estimate based on IRCC's publicly available scoring criteria. Not affiliated with Immigration, Refugees and Citizenship Canada.","results.restart":"â†» Recalculate","results.share":"Share Results","results.pdf":"Download PDF","results.whatif":"What-If Score Simulator","results.whatifDesc":"See how improving IELTS, education, or work experience affects your CRS:","results.original":"Current","results.projected":"Projected","results.foreignWork":"Foreign Work (Skill Bonus)","footer.copy":"Free CRS Calculator 2026 Â· Not affiliated with IRCC"},Ve={"header.title":"Calculateur SRC","welcome.heading":`Immigration au Canada
Calculateur de Points`,"welcome.sub":"Calculez votre score du SystÃ¨me de classement global (SCG) et dÃ©couvrez votre meilleur chemin vers la rÃ©sidence permanente canadienne.","welcome.btn":"Calculer Mon Score","welcome.updated":"DerniÃ¨re mise Ã  jour :","welcome.trust":"DonnÃ©es officielles dâ€™IRCC â€” derniÃ¨re mise Ã  jour :","welcome.microcopy":"Cela prend 3 minutes â€” une question Ã  la fois.","welcome.resume":"Vous avez un calcul en cours.","welcome.resumeBtn":"Reprendre","welcome.startFresh":"Recommencer","feature.accurate":"Score SCG PrÃ©cis","feature.accurateDesc":"Calcul complet du SystÃ¨me de classement global","feature.suggestions":"Suggestions Intelligentes","feature.suggestionsDesc":"Conseils personnalisÃ©s pour augmenter vos points","feature.draws":"Derniers Tirages","feature.drawsDesc":"RÃ©sultats Ã  jour des tirages EntrÃ©e express d'IRCC","feature.instant":"RÃ©sultats InstantanÃ©s","feature.instantDesc":"Obtenez votre score en moins de 2 minutes","wizard.step":"Ã‰tape","wizard.of":"de","wizard.next":"Suivant â†’","wizard.back":"â† Retour","wizard.calculate":"Calculer le Score âœ“","results.breakdown":"DÃ©tail de Votre Score","results.improve":"Comment AmÃ©liorer Votre Score","results.category":"AdmissibilitÃ© aux Tirages par CatÃ©gorie","results.catIntro":"Le Canada organise des tirages spÃ©ciaux pour des groupes spÃ©cifiques avec des seuils plus bas. Voici ce Ã  quoi vous pourriez Ãªtre admissible :","results.timeline":"Calendrier EstimÃ©","results.draws":"Tirages RÃ©cents EntrÃ©e Express","results.disclaimer":"Ce calculateur fournit une estimation basÃ©e sur les critÃ¨res SCG publics. Il n'est pas affiliÃ© Ã  IRCC.","results.restart":"â†» Recommencer","results.share":"Partager les RÃ©sultats","results.pdf":"TÃ©lÃ©charger PDF","results.whatif":"Comparaison HypothÃ©tique","results.whatifDesc":"Ajustez les variables pour voir comment votre score change :","results.original":"Original","results.projected":"ProjetÃ©","results.foreignWork":"Exp. Ã‰trangÃ¨re (Bonus)","footer.copy":"Calculateur SRC Â· Non affiliÃ© Ã  IRCC"},fe={en:$e,fr:Ve},Se=c.createContext();function He({children:t}){const[s,n]=c.useState(()=>{try{return localStorage.getItem("crs-lang")||"en"}catch{return"en"}}),i=c.useCallback(o=>{n(o);try{localStorage.setItem("crs-lang",o)}catch{}},[]),a=c.useCallback(o=>fe[s]?.[o]||fe.en[o]||o,[s]);return e.jsx(Se.Provider,{value:{lang:s,setLang:i,t:a},children:t})}function xe(){return c.useContext(Se)}const Ce="crs-analytics-queue-v2",me="crs-analytics-session-v1",he="2.0",Je=1800*1e3,Ke=2500;function je(t,s){try{return t?JSON.parse(t):s}catch{return s}}function Qe(t,s){return typeof window>"u"?s:je(window.localStorage.getItem(t),s)}function Xe(t,s){if(!(typeof window>"u"))try{window.localStorage.setItem(t,JSON.stringify(s))}catch{}}function ke(t="evt"){return`${t}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,9)}`}function Ze(t,s=0){const n=Number(t);return Number.isFinite(n)?n:s}function et(t){return t?String(t).trim().toLowerCase().replace(/[^a-z0-9:_-]+/g,"_").slice(0,80):""}function tt(t={}){const s={};for(const[n,i]of Object.entries(t||{}))if(!(!n||i==null)){if(typeof i=="string"){s[n]=i.slice(0,280);continue}if(typeof i=="number"||typeof i=="boolean"){s[n]=i;continue}if(Array.isArray(i)){s[n]=i.slice(0,20).map(a=>String(a).slice(0,120));continue}s[n]=String(i).slice(0,280)}return s}function st(){return Qe(Ce,[])}function nt(t){const s=Array.isArray(t)?t.slice(-300):[];Xe(Ce,s)}function at(){if(typeof window>"u")return{id:"server",seq:0,started_at:new Date().toISOString()};const t=Date.now(),s=je(window.sessionStorage.getItem(me),null),i=!s||!s.last_activity_ms||t-s.last_activity_ms>Je?{id:ke("sess"),seq:1,started_at:new Date().toISOString(),last_activity_ms:t}:{...s,seq:Ze(s.seq,0)+1,last_activity_ms:t};try{window.sessionStorage.setItem(me,JSON.stringify(i))}catch{}return i}function rt(){if(typeof window>"u")return{app_version:"dev"};let t="unknown";try{t=Intl.DateTimeFormat().resolvedOptions().timeZone||"unknown"}catch{}return{app_version:"dev",lang:window.navigator?.language||"unknown",timezone:t,path:window.location?.pathname||"/"}}function it(t){return!1}async function ot(t){if(typeof window>"u")return!1;const s=void 0;if(!it())return!1;const n=JSON.stringify(t);if(window.navigator?.sendBeacon&&document.visibilityState==="hidden")try{if(window.navigator.sendBeacon(s,new Blob([n],{type:"application/json"})))return!0}catch{}const i=typeof AbortController<"u"?new AbortController:null;let a=null;i&&(a=window.setTimeout(()=>i.abort(),Ke));try{return(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:n,keepalive:!0,signal:i?.signal})).ok}catch{return!1}finally{a&&window.clearTimeout(a)}}function ct(t,s){if(!(typeof window>"u")&&typeof window.plausible=="function")try{window.plausible(t,{props:s})}catch{}}function T(t,s={}){if(typeof window>"u")return;const n=et(t);if(!n)return;const i=at(),a=tt(s),o=rt(),d={event_id:ke("evt"),schema_version:he,name:n,ts:new Date().toISOString(),session_id:i.id,session_seq:i.seq,session_started_at:i.started_at,payload:a,meta:o},f=st();f.push(d),nt(f),ct(n,{...a,schema_version:he,session_seq:i.seq}),ot(d)}function lt(t,s){const n=t.answers||{};return{id:t.id,user_id:s||null,name:t.name||null,score:Number(t.score)||0,email:t.email||null,alert_opt_in:!!t.alertOptIn,alert_token:t.alertToken||null,profile_json:{answers:n,tracking:{userId:s||null,savedAt:new Date().toISOString()}},updated_at:new Date().toISOString()}}function ne(t){const s=String(t?.message||"");return/column\s+["']?user_id["']?\s+does not exist/i.test(s)}function K(t,s){const n=s?.message||s?.hint||String(s);return`${t}: ${n}`}function Y(){return ce&&!!j}async function Ft(t,s={}){if(!Y())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=s.userId||null,i=lt(t,n);let a,o;if({data:a,error:o}=await j.from("saved_profiles").upsert(i,{onConflict:"id"}).select(),o&&n&&ne(o)){const{user_id:d,...f}=i;({data:a,error:o}=await j.from("saved_profiles").upsert(f,{onConflict:"id"}).select())}if(o)throw new Error(K("Supabase upsert failed",o));return{status:"ok",data:a||[]}}async function ut(t){if(!t)return{status:"skipped",reason:"Missing token"};if(!Y())return{status:"skipped",reason:"Supabase env vars are not configured"};const{data:s,error:n}=await j.from("saved_profiles").update({alert_opt_in:!1,updated_at:new Date().toISOString()}).eq("alert_token",t).select();if(n)throw new Error(K("Supabase unsubscribe failed",n));return s?.length?{status:"ok",data:s[0]}:{status:"not-found"}}async function qt(t){if(!t)return{status:"skipped",reason:"Missing user id"};if(!Y())return{status:"skipped",reason:"Supabase env vars are not configured"};const{data:s,error:n}=await j.from("saved_profiles").select("id,name,score,email,updated_at").eq("user_id",t).order("updated_at",{ascending:!1}).limit(12);if(n&&ne(n))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(n)throw new Error(K("Supabase profile list failed",n));return{status:"ok",data:s||[]}}async function dt(t,s){if(!t)return{status:"skipped",reason:"Missing user id"};if(!Y())return{status:"skipped",reason:"Supabase env vars are not configured"};const{error:n,data:i}=await j.from("saved_profiles").update({alert_opt_in:!!s,updated_at:new Date().toISOString()}).eq("user_id",t).select("id");if(n&&ne(n))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(n)throw new Error(K("Supabase alert preference update failed",n));return{status:"ok",updatedCount:i?.length||0}}async function ft(t,s){if(!t)return{status:"skipped",reason:"Missing user id"};if(!Y())return{status:"skipped",reason:"Supabase env vars are not configured"};const n=s?String(s).trim().toLowerCase():null,{error:i,data:a}=await j.from("saved_profiles").update({email:n||null,updated_at:new Date().toISOString()}).eq("user_id",t).select("id");if(i&&ne(i))return{status:"skipped",reason:"saved_profiles.user_id column not found; run the latest supabase/schema.sql"};if(i)throw new Error(K("Supabase profile email update failed",i));return{status:"ok",updatedCount:a?.length||0}}const Ee="crs-account-settings-v1",B={profileName:"",contactEmail:"",defaultDrawAlerts:!1,autoSyncProfiles:!0,autoSaveProgress:!0,motionIntensity:"full"};function oe(){try{const t=localStorage.getItem(Ee);if(!t)return{...B};const s=JSON.parse(t);return!s||typeof s!="object"?{...B}:{...B,...s}}catch{return{...B}}}function mt(t){const s={...B,...t||{}};["off","subtle","full"].includes(s.motionIntensity)||(s.motionIntensity=B.motionIntensity);try{localStorage.setItem(Ee,JSON.stringify(s))}catch{}try{window.dispatchEvent(new Event("crs-account-settings-updated"))}catch{}return s}const pe=/^\S+@\S+\.\S+$/,H="DELETE",ge=8;function ht({open:t,onClose:s}){const{isConfigured:n,loading:i,user:a,sendEmailMagicLink:o,verifyEmailOtp:d,refreshSession:f,signInWithGoogle:k,signOut:p,updateProfile:S,changePassword:b,deleteAccount:g}=be(),[N,G]=c.useState(""),[O,L]=c.useState(""),[_,A]=c.useState("request"),[Q,w]=c.useState(""),[X,l]=c.useState(""),[I,M]=c.useState(0),[v,C]=c.useState(()=>oe()),[Z,W]=c.useState(""),[ee,u]=c.useState(""),[m,P]=c.useState(""),ae=c.useId(),R=c.useMemo(()=>a?"Account":"Login / Signup",[a]),D=Y(),y=Q!=="",x=r=>Q===r;if(c.useEffect(()=>{if(!t||I<=0)return;const r=window.setInterval(()=>{M(h=>h<=1?0:h-1)},1e3);return()=>window.clearInterval(r)},[t,I]),c.useEffect(()=>{!t||!a||C(r=>({...r,profileName:a.user_metadata?.full_name||r.profileName||"",contactEmail:r.contactEmail||a.email||""}))},[t,a]),c.useEffect(()=>{if(!t||!a||!(_==="sent"||_==="verify"))return;l("Signed in successfully.");const r=window.setTimeout(()=>s(),500);return()=>window.clearTimeout(r)},[s,t,_,a]),c.useEffect(()=>{t||(A("request"),L(""),l(""),w(""),M(0),W(""),u(""),P(""))},[t]),c.useEffect(()=>{if(!t)return;const r=document.body.style.overflow,h=re=>{re.key==="Escape"&&s()};return document.body.style.overflow="hidden",window.addEventListener("keydown",h),()=>{window.removeEventListener("keydown",h),document.body.style.overflow=r}},[s,t]),!t)return null;const E=N.trim().toLowerCase(),$=m.trim().toUpperCase(),z=r=>{const h=document.getElementById(r);h&&h.scrollIntoView({behavior:"smooth",block:"start"})},V=async()=>{if(!E||!pe.test(E)){l("Please enter a valid email address.");return}w("sendMagicLink"),l("");try{await o(E),A("sent"),L(""),M(25),l("Magic link sent. Open your email and click the secure sign-in link.")}catch(r){l(r.message||"Could not send magic link.")}finally{w("")}},te=async()=>{w("checkMagicLink"),l("");try{(await f())?.user?(l("Signed in successfully."),A("request"),window.setTimeout(()=>s(),500)):l("No active session found yet. Click the magic link from your email in this browser, then try again.")}catch(r){l(r.message||"Could not refresh session.")}finally{w("")}},se=async()=>{I>0||await V()},Ae=async()=>{if(!E||!O.trim()){l("Enter your email and 6-digit code.");return}w("verifyCode"),l("");try{await d(E,O.trim()),await f(),l("Signed in successfully."),A("request"),L(""),window.setTimeout(()=>s(),500)}catch(r){l(r.message||"Verification failed.")}finally{w("")}},Ie=async()=>{w("googleAuth"),l("");try{await k(),l("Redirecting to Google...")}catch(r){l(r.message||"Google login failed.")}finally{w("")}},Pe=async()=>{const r={...v,profileName:(v.profileName||"").trim(),contactEmail:(v.contactEmail||"").trim().toLowerCase()};if(r.contactEmail&&!pe.test(r.contactEmail)){l("Please enter a valid contact email.");return}w("saveSettings"),l("");try{await S({fullName:r.profileName}),mt(r),C(r),D&&a?.id&&await Promise.all([dt(a.id,r.defaultDrawAlerts),ft(a.id,r.contactEmail||a.email||"")]),l("Account settings saved.")}catch(h){l(h.message||"Could not save account settings.")}finally{w("")}},Re=async()=>{const r=Z.trim(),h=ee.trim();if(r.length<ge){l(`Password must be at least ${ge} characters.`);return}if(r!==h){l("New password and confirmation do not match.");return}w("changePassword"),l("");try{await b(r),W(""),u(""),l("Password updated successfully.")}catch(re){l(re.message||"Could not change password.")}finally{w("")}},Le=()=>{{l("Membership management is unavailable. Add VITE_STRIPE_BILLING_PORTAL_URL.");return}},De=async()=>{if($!==H){l(`Type ${H} to confirm account deletion.`);return}w("deleteAccount"),l("");try{await g(),P(""),l("Account deleted."),window.setTimeout(()=>s(),350)}catch(r){l(r.message||"Could not delete account.")}finally{w("")}},Te=async()=>{w("refreshSession"),l("");try{await f(),l("Session refreshed.")}catch(r){l(r.message||"Session refresh failed.")}finally{w("")}},Oe=async()=>{w("signOut"),l("");try{await p(),l("Signed out."),window.setTimeout(()=>s(),400)}catch(r){l(r.message||"Sign out failed.")}finally{w("")}};return e.jsx("div",{className:"auth-modal-backdrop",onClick:s,role:"presentation",children:e.jsxs("div",{className:"auth-modal",role:"dialog","aria-modal":"true","aria-labelledby":ae,onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"auth-modal-head",children:[e.jsx("h3",{id:ae,children:R}),e.jsx("button",{type:"button",className:"auth-close",onClick:s,"aria-label":"Close dialog",children:"Ã—"})]}),e.jsxs("div",{className:"auth-modal-scroll",children:[!n&&e.jsx("p",{className:"auth-note",children:"Auth is unavailable. Add `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`."}),n&&i&&e.jsx("p",{className:"auth-note",children:"Checking session..."}),n&&!i&&a&&e.jsxs("div",{className:"auth-body",children:[e.jsxs("p",{className:"auth-note",children:["Signed in as ",e.jsx("strong",{children:a.email})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section",children:[e.jsx("h4",{children:"Account actions"}),e.jsxs("div",{className:"auth-action-shortcuts",children:[e.jsx("button",{type:"button",className:"action-btn",onClick:()=>z("auth-security"),children:"Change password"}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>z("auth-membership"),children:"Remove membership"}),e.jsx("button",{type:"button",className:"action-btn auth-btn-danger",onClick:()=>z("auth-danger-zone"),children:"Delete account"})]})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section",children:[e.jsx("h4",{children:"Account settings"}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Display name"}),e.jsx("input",{type:"text",value:v.profileName,onChange:r=>C(h=>({...h,profileName:r.target.value})),placeholder:"Your name"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Contact email for draw alerts"}),e.jsx("input",{type:"email",value:v.contactEmail,onChange:r=>C(h=>({...h,contactEmail:r.target.value})),placeholder:"you@example.com"})]}),e.jsxs("label",{className:"auth-check-row",children:[e.jsx("input",{type:"checkbox",checked:v.defaultDrawAlerts,onChange:r=>C(h=>({...h,defaultDrawAlerts:r.target.checked}))}),e.jsx("span",{children:"Enable draw alerts by default"})]}),e.jsxs("label",{className:"auth-check-row",children:[e.jsx("input",{type:"checkbox",checked:v.autoSyncProfiles,onChange:r=>C(h=>({...h,autoSyncProfiles:r.target.checked}))}),e.jsx("span",{children:"Auto-sync saved profiles"})]}),e.jsxs("label",{className:"auth-check-row",children:[e.jsx("input",{type:"checkbox",checked:v.autoSaveProgress,onChange:r=>C(h=>({...h,autoSaveProgress:r.target.checked}))}),e.jsx("span",{children:"Auto-save wizard progress on this device"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Animation intensity"}),e.jsxs("select",{value:v.motionIntensity||"full",onChange:r=>C(h=>({...h,motionIntensity:r.target.value})),children:[e.jsx("option",{value:"full",children:"Full"}),e.jsx("option",{value:"subtle",children:"Subtle"}),e.jsx("option",{value:"off",children:"Off"})]})]}),!D&&e.jsx("p",{className:"auth-note",children:"Cloud account settings require Supabase env vars."})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section",id:"auth-security",children:[e.jsx("h4",{children:"Security"}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"New password"}),e.jsx("input",{type:"password",value:Z,onChange:r=>W(r.target.value),placeholder:"At least 8 characters",autoComplete:"new-password"})]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Confirm new password"}),e.jsx("input",{type:"password",value:ee,onChange:r=>u(r.target.value),placeholder:"Re-enter new password",autoComplete:"new-password"})]}),e.jsx("div",{className:"auth-actions",children:e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:Re,children:x("changePassword")?"Updating...":"Change password"})})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section",id:"auth-membership",children:[e.jsx("h4",{children:"Membership"}),e.jsx("p",{className:"auth-note",children:"Remove or manage your membership from the billing portal."}),e.jsx("div",{className:"auth-actions",children:e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:Le,children:"Remove membership"})})]}),e.jsxs("div",{className:"auth-settings-card auth-settings-section auth-danger-zone",id:"auth-danger-zone",children:[e.jsx("h4",{children:"Danger zone"}),e.jsxs("p",{className:"auth-note",children:["This permanently deletes your account. Type ",e.jsx("strong",{children:H})," to confirm."]}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Confirmation"}),e.jsx("input",{type:"text",value:m,onChange:r=>P(r.target.value),placeholder:H})]}),e.jsx("div",{className:"auth-actions",children:e.jsx("button",{type:"button",className:"action-btn auth-btn-danger",disabled:y||$!==H,onClick:De,children:x("deleteAccount")?"Deleting...":"Delete account"})})]}),e.jsxs("div",{className:"auth-actions",children:[e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:y,onClick:Pe,children:x("saveSettings")?"Saving...":"Save settings"}),e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:Te,children:x("refreshSession")?"Refreshing...":"Refresh session"}),e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:Oe,children:x("signOut")?"Signing out...":"Sign out"})]})]}),n&&!i&&!a&&e.jsxs("div",{className:"auth-body",children:[e.jsx("p",{className:"auth-note",children:"Sign in with a magic link (recommended) or verify manually with an email code."}),e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",placeholder:"you@example.com",value:N,onChange:r=>G(r.target.value),autoFocus:!0})]}),_==="verify"&&e.jsxs("label",{className:"wi-field",children:[e.jsx("span",{children:"Email verification code"}),e.jsx("input",{type:"text",inputMode:"numeric",placeholder:"Enter code",value:O,onChange:r=>L(r.target.value)})]}),e.jsxs("div",{className:"auth-actions",children:[_==="request"?e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:y,onClick:V,children:x("sendMagicLink")?"Sending...":"Send magic link"}):_==="sent"?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:y,onClick:te,children:x("checkMagicLink")?"Checking...":"I clicked the magic link"}),e.jsx("button",{type:"button",className:"action-btn",disabled:y||I>0,onClick:se,children:I>0?`Resend in ${I}s`:"Resend magic link"}),e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:()=>{A("verify"),l("If your email contains a code, enter it below.")},children:"Use email code instead"})]}):e.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:y,onClick:Ae,children:x("verifyCode")?"Verifying...":"Verify and sign in"}),e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:Ie,children:x("googleAuth")?"Redirecting...":"Continue with Google"}),_!=="request"&&e.jsx("button",{type:"button",className:"action-btn",disabled:y,onClick:()=>{A("request"),L(""),l(""),M(0)},children:"Back"})]})]}),X&&e.jsx("p",{className:"auth-status",role:"status","aria-live":"polite",children:X})]})]})})}const pt={en:"EN",fr:"FR"};function gt({canInstallApp:t=!1,onInstallApp:s=()=>{},motionIntensity:n="full"}){const i=Fe()||n==="off",{dark:a,toggle:o}=We(),{lang:d,setLang:f,t:k}=xe(),{user:p}=be(),[S,b]=c.useState(!1);return c.useEffect(()=>{const g=()=>b(!0);return window.addEventListener("crs-open-account-modal",g),()=>{window.removeEventListener("crs-open-account-modal",g)}},[]),e.jsxs(qe.header,{className:"header",initial:i?!1:{y:-60,opacity:0},animate:{y:0,opacity:1},transition:i?{duration:0}:{type:"spring",stiffness:120,damping:20},children:[e.jsxs("div",{className:"header-inner",children:[e.jsxs("div",{className:"logo",children:[e.jsx("span",{className:"logo-leaf",children:"ðŸ"}),e.jsx("span",{children:k("header.title")})]}),e.jsxs("div",{className:"header-actions",children:[t&&e.jsx("button",{type:"button",className:"install-btn",onClick:s,"aria-label":"Install app",title:"Add app shortcut",children:"Install app"}),e.jsx("button",{type:"button",className:"auth-toggle",onClick:()=>{b(!0),T("account_modal_opened",{source:"header_button",is_authenticated:!!p})},"aria-label":p?"Manage account":"Login or signup",title:p?p.email:"Login / Signup",children:p?"Account":"Login"}),e.jsx("select",{className:"lang-select",value:d,onChange:g=>f(g.target.value),"aria-label":"Select language",children:Object.entries(pt).map(([g,N])=>e.jsx("option",{value:g,children:N},g))}),e.jsx("button",{type:"button",className:"theme-toggle",onClick:o,"aria-label":a?"Switch to light mode":"Switch to dark mode",title:a?"Light mode":"Dark mode",children:a?"Light":"Dark"})]})]}),e.jsx(ht,{open:S,onClose:()=>b(!1)})]})}function ie(){const t=Array.from({length:9});return e.jsxs("div",{className:"uv-loader",children:[t.map((s,n)=>e.jsx("div",{className:"uv-text",children:e.jsx("span",{children:"Loading"})},n)),e.jsx("div",{className:"uv-line"})]})}const Ne=300*1e3,wt=!1;let F={data:null,source:"none",fetchedAt:0},q={data:null,source:"none",fetchedAt:0},_e=wt;function yt(t){return!!t&&typeof t=="object"&&Array.isArray(t.generalProgram)&&Array.isArray(t.categoryBased)&&Array.isArray(t.pnpDraws)&&Number.isFinite(Number(t.averageCutoff))}function bt(t){return yt(t)?{...t,generalProgram:t.generalProgram||[],categoryBased:t.categoryBased||[],pnpDraws:t.pnpDraws||[],averageCutoff:Number(t.averageCutoff)||U.averageCutoff,lastUpdated:t.lastUpdated||U.lastUpdated,pnpRanges:t.pnpRanges||U.pnpRanges}:null}function vt(t){if(!t||typeof t!="object")return null;const s=String(t.id||"").trim(),n=String(t.name||"").trim(),i=String(t.icon||"").trim(),a=String(t.description||"").trim(),o=String(t.eligibility||"").trim(),d=String(t.cutoff_range||t.cutoffRange||"").trim(),f=Number(t.recent_cutoff??t.recentCutoff);return!s||!n||!i||!a||!o||!Number.isFinite(f)?null:{id:s,name:n,icon:i,description:a,eligibility:o,recentCutoff:f,cutoffRange:d||"N/A",source:t.source||"supabase",updatedAt:t.updated_at||null}}function St(t){if(!t)return!1;const s=String(t.code||"").toUpperCase(),n=`${t.message||""} ${t.details||""} ${t.hint||""}`.toLowerCase();return!!(s==="PGRST205"||n.includes("could not find the table")||n.includes("category_draw_configs")&&n.includes("schema cache")||n.includes("relation")&&n.includes("does not exist"))}function xt(t=[]){const s=new Map(J.map(o=>[o.id,o])),n=new Map;for(const o of t){const d=vt(o);d&&(n.has(d.id)||n.set(d.id,d))}const i=J.map(o=>{const d=n.get(o.id);return d?{...o,name:d.name,icon:d.icon,description:d.description,eligibility:d.eligibility,recentCutoff:d.recentCutoff,cutoffRange:d.cutoffRange,source:d.source,updatedAt:d.updatedAt}:o}),a=[...n.values()].filter(o=>!s.has(o.id)).map(o=>({...o,check:()=>!1}));return[...i,...a]}function Ct(){return U}function jt(){return J}async function kt({forceRefresh:t=!1}={}){if(!t&&F.data&&Date.now()-F.fetchedAt<Ne)return{status:"ok",source:F.source,data:F.data};if(ce&&j&&_e)try{const{data:s,error:n}=await j.from("draw_snapshots").select("payload,last_updated").order("last_updated",{ascending:!1}).limit(1);if(!n){const i=s?.[0],a=bt(i?.payload);if(a)return F={data:a,source:"supabase",fetchedAt:Date.now()},{status:"ok",source:"supabase",data:a}}}catch{}return F={data:U,source:"local-fallback",fetchedAt:Date.now()},{status:"ok",source:"local-fallback",data:U}}async function Et({forceRefresh:t=!1}={}){if(!t&&q.data&&Date.now()-q.fetchedAt<Ne)return{status:"ok",source:q.source,data:q.data};if(ce&&j)try{const{data:s,error:n}=await j.from("category_draw_configs").select("id,source,name,icon,description,eligibility,recent_cutoff,cutoff_range,is_active,updated_at").eq("is_active",!0).order("updated_at",{ascending:!1});if(St(n)&&(_e=!1),!n&&Array.isArray(s)&&s.length>0){const i=xt(s);return q={data:i,source:"supabase",fetchedAt:Date.now()},{status:"ok",source:"supabase",data:i}}}catch{}return q={data:J,source:"local-fallback",fetchedAt:Date.now()},{status:"ok",source:"local-fallback",data:J}}const Nt=c.lazy(()=>le(()=>import("./WelcomeScreen-BzG4swIP.js"),__vite__mapDeps([0,1,2,3,4,5]))),_t=c.lazy(()=>le(()=>import("./Wizard-BAN-4pGr.js"),__vite__mapDeps([6,1,3,2,4,5]))),At=c.lazy(()=>le(()=>import("./Results-CCMNm-l7.js"),__vite__mapDeps([7,1,2,3,4,5]))),ue="crs-progress";function we(){try{const t=localStorage.getItem(ue);return t?JSON.parse(t):null}catch{return null}}function It(t){try{localStorage.setItem(ue,JSON.stringify(t))}catch{}}function ye(){try{localStorage.removeItem(ue)}catch{}}function Pt(){try{return new URLSearchParams(window.location.search).get("unsubscribe")}catch{return null}}function Rt(){return{}}function Lt(){const{t}=xe(),[s,n]=c.useState(()=>oe()),i=s.autoSaveProgress!==!1,a=["off","subtle","full"].includes(s.motionIntensity)?s.motionIntensity:"full",o=Pt(),d=Rt(),[f,k]=c.useState(()=>o?"unsubscribe":Object.keys(d).length>0?"results":"welcome"),[p,S]=c.useState(()=>d),[b,g]=c.useState(()=>o?"loading":"idle"),[N,G]=c.useState(()=>Ct()),[O,L]=c.useState("local-fallback"),[_,A]=c.useState(()=>jt());c.useEffect(()=>{if(!o)return;let u=!0;return ut(o).then(m=>{u&&g(m.status==="ok"?"success":"notfound")}).catch(()=>{u&&g("error")}),()=>{u=!1}},[o]),c.useEffect(()=>{let u=!0;return kt().then(m=>{u&&m?.status==="ok"&&m.data&&(G(m.data),L(m.source||"local-fallback"))}).catch(()=>{}),()=>{u=!1}},[]),c.useEffect(()=>{let u=!0;return Et().then(m=>{u&&m?.status==="ok"&&Array.isArray(m.data)&&m.data.length>0&&A(m.data)}).catch(()=>{}),()=>{u=!1}},[]);const Q=c.useCallback(u=>{if(u&&i){const m=we();m&&S(m)}T("wizard_started",{resumed:!!u}),k("wizard")},[i]),w=c.useCallback(u=>{S(u),ye(),T("wizard_completed",{answer_count:Object.keys(u||{}).length}),k("results"),window.scrollTo({top:0,behavior:"smooth"})},[]),X=c.useCallback(()=>{S({}),ye(),T("calculator_restarted"),window.history.replaceState(null,"",window.location.pathname),k("welcome"),window.scrollTo({top:0,behavior:"smooth"})},[]),l=i&&!!we(),[I,M]=c.useState(!1),[v,C]=c.useState(null),[Z,W]=c.useState(()=>{const u=window.matchMedia?.("(display-mode: standalone)")?.matches,m=window.navigator?.standalone===!0;return!!(u||m)});c.useEffect(()=>{const u=()=>M(window.scrollY>400);return window.addEventListener("scroll",u,{passive:!0}),()=>window.removeEventListener("scroll",u)},[]),c.useEffect(()=>{const u=P=>{typeof P?.prompt=="function"&&C(P)},m=()=>{C(null),W(!0)};return window.addEventListener("beforeinstallprompt",u),window.addEventListener("appinstalled",m),()=>{window.removeEventListener("beforeinstallprompt",u),window.removeEventListener("appinstalled",m)}},[]);const ee=c.useCallback(async()=>{if(!v)return;T("install_prompt_triggered"),v.prompt(),(await v.userChoice)?.outcome==="accepted"?(C(null),T("install_prompt_accepted")):T("install_prompt_dismissed")},[v]);return c.useEffect(()=>{const u=()=>{n(oe())};return window.addEventListener("storage",u),window.addEventListener("crs-account-settings-updated",u),()=>{window.removeEventListener("storage",u),window.removeEventListener("crs-account-settings-updated",u)}},[]),c.useEffect(()=>{document.documentElement.setAttribute("data-motion",a)},[a]),c.useEffect(()=>{const u=document.documentElement,m=window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,P=window.matchMedia?.("(pointer: fine)")?.matches;if(!(a!=="off"&&!m&&!!P)){u.style.setProperty("--pointer-x","50%"),u.style.setProperty("--pointer-y","40%"),u.style.setProperty("--pointer-glow","0");return}u.style.setProperty("--pointer-glow",a==="subtle"?"0.45":"1");let R=0,D=50,y=40,x=50,E=40;const $=()=>{D+=(x-D)*.12,y+=(E-y)*.12,u.style.setProperty("--pointer-x",`${D.toFixed(2)}%`),u.style.setProperty("--pointer-y",`${y.toFixed(2)}%`),Math.abs(x-D)>.05||Math.abs(E-y)>.05?R=window.requestAnimationFrame($):R=0},z=()=>{R||(R=window.requestAnimationFrame($))},V=se=>{x=se.clientX/window.innerWidth*100,E=se.clientY/window.innerHeight*100,z()},te=()=>{x=50,E=40,z()};return window.addEventListener("pointermove",V,{passive:!0}),window.addEventListener("pointerleave",te,{passive:!0}),()=>{window.removeEventListener("pointermove",V),window.removeEventListener("pointerleave",te),R&&window.cancelAnimationFrame(R)}},[a]),e.jsxs("div",{className:"app",children:[e.jsxs("div",{className:"anime-bg","aria-hidden":"true",children:[e.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--one"}),e.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--two"}),e.jsx("span",{className:"anime-bg-aurora anime-bg-aurora--three"}),e.jsx("span",{className:"anime-bg-grid"}),e.jsx("span",{className:"anime-bg-noise"}),e.jsx("span",{className:"anime-bg-pointer-glow"}),e.jsx("span",{className:"anime-bg-flare"}),e.jsx("span",{className:"anime-bg-vignette"}),e.jsxs("div",{className:"anime-bg-sparks",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})]}),e.jsx("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"}),e.jsx(gt,{canInstallApp:!Z&&!!v,onInstallApp:ee,motionIntensity:a}),e.jsx("main",{className:"main",role:"main",id:"main-content",children:e.jsxs(Be,{mode:"wait",children:[f==="welcome"&&e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(ie,{})}),children:e.jsx(Nt,{onStart:Q,hasSaved:l,drawData:N,drawSource:O,motionIntensity:a},"welcome")}),f==="wizard"&&e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(ie,{})}),children:e.jsx(_t,{onFinish:w,onProgress:i?It:void 0,initialAnswers:p,motionIntensity:a},"wizard")}),f==="unsubscribe"&&e.jsxs("div",{className:"card unsubscribe-card",children:[e.jsx("h3",{children:"Draw alert preferences"}),b==="loading"&&e.jsx("p",{children:"Processing your unsubscribe requestâ€¦"}),b==="success"&&e.jsx("p",{children:"Youâ€™ve been unsubscribed from draw alerts successfully."}),b==="notfound"&&e.jsx("p",{children:"This unsubscribe link is invalid or already inactive."}),b==="error"&&e.jsx("p",{children:"We couldnâ€™t process this request right now. Please try again later."}),e.jsx("button",{type:"button",className:"btn-restart",onClick:()=>k("welcome"),children:"Back to calculator"})]}),f==="results"&&e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"loading-fallback",children:e.jsx(ie,{})}),children:e.jsx(At,{answers:p,onRestart:X,drawData:N,drawSource:O,categoryInfo:_,motionIntensity:a},"results")})]})}),e.jsxs("footer",{className:"footer",children:[e.jsxs("p",{children:["Â© ",new Date().getFullYear()," ",t("footer.copy")]}),e.jsxs("p",{className:"footer-legal-links",children:[e.jsx("a",{href:"/guides.html",children:"Guides"}),e.jsx("span",{"aria-hidden":"true",children:" Â· "}),e.jsx("a",{href:"/terms.html",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:" Â· "}),e.jsx("a",{href:"/privacy.html",children:"Privacy Policy"}),e.jsx("span",{"aria-hidden":"true",children:" Â· "}),e.jsx("a",{href:"/trust.html",children:"Trust Center"})]})]}),I&&e.jsx("button",{type:"button",className:"btn-top",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),"aria-label":"Back to top",children:"â†‘"})]})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("[SW] Service Worker registered:",t)}).catch(t=>{console.error("[SW] Service Worker registration failed:",t)})});Me.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(ze,{children:e.jsx(Ge,{children:e.jsx(He,{children:e.jsx(Lt,{})})})})}));export{ie as L,le as _,Ct as a,Ft as b,jt as g,Y as i,qt as l,oe as r,mt as s,T as t,xe as u};
