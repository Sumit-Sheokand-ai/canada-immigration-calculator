import{c as St,a as jt,b as Nt,d as Ct,e as wt,f as Tt,s as Pt,g as Mt,h as _t,i as Et,j as At,k as Lt,l as It,m as Dt,n as $t,o as Ft,p as Wt,q as Bt,r as Ze,t as se,u as Rt,v as Xe,w as et,x as g,y as t,z as k,S as Ot,A as Gt,B as Re,C as Yt,D as Oe,E as Ut,F as be,G as Ht,H as qt,I as Kt,J as zt,L as Vt}from"./index-Bp6EI6Kd.js";const N={tables:{agePoints:Ct,educationPoints:wt,firstLangPoints:Tt,secondLangPoints:Pt,canadianWorkPoints:Mt,spouseEducationPoints:_t,spouseLangPoints:Wt,spouseWorkPoints:Et,eduRank:At,eduLangTransfer:Lt,eduCWETransfer:It,fweLangTransfer:Dt,fweCWETransfer:$t,certLangTransfer:Bt,additionalPointsTable:Ft},converters:{ieltsToCLB:Nt,tefToNCLC:St,tcfToNCLC:jt},caps:{secondLanguageNoSpouse:24,secondLanguageWithSpouse:22,spouseTotal:40,skillTransferabilityTotal:100,additionalPointsTotal:600,crsTotal:1200}},tt=(e,a,n)=>Math.max(a,Math.min(n,e));function Jt(e){const a={...e},n=me(e)==="french"||e.hasFrench==="yes";if(n&&e.frenchTestType==="tef")for(const s of["listening","reading","writing","speaking"])a[`french_${s}`]=String(N.converters.tefToNCLC(s,parseInt(e[`tef_${s}`],10)||0));else if(n&&e.frenchTestType==="tcf")for(const s of["listening","reading","writing","speaking"])a[`french_${s}`]=String(N.converters.tcfToNCLC(s,parseInt(e[`tcf_${s}`],10)||0));return a}function me(e){return e.firstOfficialLanguage==="french"?"french":"english"}function Te(e){return me(e)==="french"||e.hasFrench==="yes"}function pe(e){return e.hasSpouse==="yes"&&e.spouseIsCanadian!=="yes"&&e.spouseAccompanying!=="no"}const le=e=>pe(e)?1:0;function Pe(e,a){if(e.langTestType==="celpip")return tt(parseInt(e[`celpip_${a}`],10)||0,0,12);const n=parseFloat(e[`ielts_${a}`])||0;return N.converters.ieltsToCLB(a,n)}function Me(e,a){return tt(parseInt(e[`french_${a}`],10)||0,0,12)}function at(e,a){return me(e)==="french"?Me(e,a):Pe(e,a)}function fe(e){const a=["listening","reading","writing","speaking"];let n=99;for(const s of a){const i=at(e,s);i<n&&(n=i)}return n===99?0:n}function nt(e){const a=["listening","reading","writing","speaking"];let n=99;for(const s of a){const i=Pe(e,s);i<n&&(n=i)}return n===99?0:n}function st(e){if(!Te(e))return 0;const a=["listening","reading","writing","speaking"];let n=99;for(const s of a){const i=Me(e,s);i<n&&(n=i)}return n===99?0:n}function Qt(e){const a=fe(e);return a>=9?2:a>=7?1:0}function Zt(e){const a=parseInt(e.canadianWorkExp)||0;return a>=2?2:a>=1?1:0}function Xt(e){const a=parseInt(e.foreignWorkExp)||0;return a>=3?2:a>=1?1:0}function ea(e){let a=parseInt(e.age);return isNaN(a)?0:(a<18&&(a=17),a>47&&(a=47),a>44&&(a=45),N.tables.agePoints[a]?.[le(e)]||0)}function ta(e){return N.tables.educationPoints[e.education]?.[le(e)]||0}function aa(e){const a=["listening","reading","writing","speaking"],n=le(e);return a.reduce((s,i)=>{const r=at(e,i);return s+(N.tables.firstLangPoints[r]?.[n]||0)},0)}function na(e){const a=me(e);if(!(a==="french"?e.langTestType==="ielts"||e.langTestType==="celpip":Te(e)))return 0;const s=["listening","reading","writing","speaking"],i=le(e),r=s.reduce((o,d)=>{const u=a==="french"?Pe(e,d):Me(e,d);return o+(N.tables.secondLangPoints[u]?.[i]||0)},0);return Math.min(r,i===0?N.caps.secondLanguageNoSpouse:N.caps.secondLanguageWithSpouse)}function sa(e){let a=parseInt(e.canadianWorkExp)||0;return a>5&&(a=5),N.tables.canadianWorkPoints[a]?.[le(e)]||0}function ia(e){if(!pe(e))return 0;let a=0;a+=N.tables.spouseEducationPoints[e.spouseEducation]||0;const n=["listening","reading","writing","speaking"];let s=0;for(const r of n){const o=parseInt(e[`spouseLang_${r}`])||0;s+=N.tables.spouseLangPoints[o]||0}a+=Math.min(s,20);let i=parseInt(e.spouseCanadianWork)||0;return i>5&&(i=5),a+=N.tables.spouseWorkPoints[i]||0,Math.min(a,N.caps.spouseTotal)}function ra(e){const a=N.tables.eduRank[e.education]||0,n=Qt(e),s=Zt(e),i=Xt(e),r=N.tables.eduLangTransfer[a]?.[n]||0,o=N.tables.eduCWETransfer[a]?.[s]||0,d=Math.min(r+o,50),u=N.tables.fweLangTransfer[i]?.[n]||0,f=N.tables.fweCWETransfer[i]?.[s]||0,h=Math.min(u+f,50);let m=0;if(e.pathway==="fst"&&e.hasCertificate==="yes"){const y=fe(e);m=N.tables.certLangTransfer[y>=7?2:y>=5?1:0]}return Math.min(d+h+m,N.caps.skillTransferabilityTotal)}function oa(e){let a=0;const n=N.tables.additionalPointsTable;return e.hasPNP==="yes"&&(a+=n.pnp_nomination),e.canadianEducation==="yes"&&(a+=e.canadianEduType==="long"?n.canadian_edu_long:n.canadian_edu_short),e.hasSibling==="yes"&&(a+=n.sibling_in_canada),Te(e)&&st(e)>=7&&(a+=nt(e)>=5?n.french_strong_strong_english:n.french_strong_weak_english),Math.min(a,N.caps.additionalPointsTotal)}function it(e){const a=Jt(e),n=ea(a),s=ta(a),i=aa(a),r=na(a),o=sa(a),d=parseInt(a.foreignWorkExp)||0,u=n+s+i+r+o,f=ia(a),h=ra(a),m=oa(a);return{total:Math.min(u+f+h+m,N.caps.crsTotal),breakdown:{coreHumanCapital:u,spouseFactors:f,skillTransferability:h,additionalPoints:m},details:{age:n,education:s,firstLanguage:i,secondLanguage:r,canadianWork:o,foreignWork:d,spouseTotal:f,skillTotal:h,additionalTotal:m}}}function X(e,a){return it({...e,...a})}function U(e,a,n,s,i,r,o=""){return{title:e,description:a,potentialGain:n,difficulty:s,timeframe:i,icon:r,action:o}}function ca(e,a){const n=[],s=fe(e),i=nt(e),r=e.firstOfficialLanguage==="french"?"french":"english",o=r==="french"||e.hasFrench==="yes";if(s<10){const h=Math.min(s+1,10),m=["listening","reading","writing","speaking"];let y="First official language";const b={};if(r==="french"){y="French (NCLC)",b.hasFrench="yes",b.frenchTestType="clb";for(const j of m){const L=`french_${j}`,I=parseInt(e[L],10)||0;b[L]=String(Math.max(I,h))}}else{y=e.langTestType==="celpip"?"CELPIP":"IELTS";for(const j of m){const L=e.langTestType==="celpip"?`celpip_${j}`:`ielts_${j}`,I=e.langTestType==="celpip"?parseInt(e[L],10)||0:parseFloat(e[L])||0;e.langTestType==="celpip"?b[L]=Math.max(I,h):b[L]=Math.max(I,I+.5)}}const p=X(e,b).total-a.total;p>0&&n.push(U(`Improve ${y} Scores`,`Raising your weakest ${y} skill to CLB ${h} could add significant points. Focus on your lowest band.`,p,"Medium","3-5 months","language",`Current min CLB ${s} → target CLB ${h} = +${p} CRS`))}const d=["less_than_secondary","secondary","one_year_post","two_year_post","bachelors","two_or_more","masters","doctoral"],u=d.indexOf(e.education);if(u>=0&&u<d.length-1){const h=d[u+1],y=X(e,{education:h}).total-a.total;if(y>0){const b={secondary:"high school diploma",one_year_post:"1-year diploma",two_year_post:"2-year diploma",bachelors:"bachelor's degree",two_or_more:"two credentials",masters:"master's degree",doctoral:"doctoral degree"};n.push(U("Higher Education",`Completing a ${b[h]||"higher credential"} could boost your score.`,y,"Hard","1-4 years","education",`${e.education||"current level"} → ${h} = +${y} CRS`))}}const f=parseInt(e.canadianWorkExp)||0;if(f<5){const m=X(e,{canadianWorkExp:String(f+1)}).total-a.total;m>0&&n.push(U("Gain Canadian Work Experience","An additional year of Canadian work experience adds points across multiple categories including skill transferability.",m,"Hard","8-12 months","work",`${f} year(s) → ${f+1} year(s) = +${m} CRS`))}if(o)st(e)>=7&&a.total<520&&a.total>=370&&n.push(U("Target French-Language Category Draw",`With your French NCLC 7+ scores, you qualify for French-language category draws where recent cutoffs are around 400 — your score of ${a.total} may already be competitive!`,0,"Easy","Immediate","french",`Current score ${a.total} already fits many French-category cutoffs`));else{const y=X(e,{hasFrench:"yes",french_listening:"7",french_reading:"7",french_writing:"7",french_speaking:"7"}).total-a.total;y>0&&n.push(U("Add French Test Results (TEF/TCF)",`Strong French skills (NCLC 7+) earn ${i>=5?"50":"25"} additional CRS points. Plus, French-language category draws have cutoffs around 400 — much lower than general draws (~520).`,y,"Hard","6-12 months","french",`Reach NCLC 7 in all 4 abilities = +${y} CRS`))}if(e.hasPNP!=="yes"&&n.push(U("Provincial Nominee Program","A PNP nomination adds 600 points, virtually guaranteeing an ITA. Explore programs in provinces like Ontario, BC, Alberta and Saskatchewan.",600,"Hard","2-8 months","province","PNP nomination = +600 CRS")),e.canadianEducation!=="yes"&&n.push(U("Study in Canada","A Canadian credential (1-2 year program) adds 15 points, or 30 points for a 3+ year program.",30,"Hard","12-36 months","study","Canadian credential can add +15 to +30 CRS")),e.hasSibling!=="yes"&&n.push(U("Sibling in Canada (If Applicable)","If you have a sibling who is a Canadian citizen or PR, this adds 15 points. Check if any siblings qualify.",15,"Easy","1-2 weeks","family","Eligible sibling relationship = +15 CRS")),pe(e)){const h=["listening","reading","writing","speaking"];let m=99;for(const y of h){const b=parseInt(e[`spouseLang_${y}`])||0;b<m&&(m=b)}if(m<9){const y=Math.min(m+1,9),b={};for(const j of h)b[`spouseLang_${j}`]=String(Math.max(parseInt(e[`spouseLang_${j}`])||0,y));const p=X(e,b).total-a.total;p>0&&n.push(U("Improve Spouse's Language Scores",`Your spouse's language improvement to CLB ${y} could add points.`,p,"Medium","3-5 months","language",`Spouse min CLB ${m} → ${y} = +${p} CRS`))}}return n.sort((h,m)=>m.potentialGain-h.potentialGain),n}function la(e){const a=e.total;return a>=500?{label:"Very Strong",months:"1-3",description:"You are very likely to receive an ITA in the next few draws."}:a>=470?{label:"Strong",months:"3-6",description:"Your score is competitive. An ITA is likely within a few months."}:a>=440?{label:"Moderate",months:"6-12",description:"Your score is near recent cutoffs. Category-based draws may help."}:a>=400?{label:"Below Average",months:"12-18",description:"You may need to improve your profile or target a category-based draw."}:{label:"Needs Improvement",months:"18+",description:"Significant profile improvements are recommended before applying."}}const da=[{id:"on",name:"Ontario",abbr:"ON",streams:["Human Capital Priorities","Skilled Trades","French-Speaking"],demandSectors:["stem","healthcare","trade"],minCLB:7,minEducation:"bachelors",minWorkYears:1,notes:"Largest province. Strong demand for tech, healthcare, and skilled trades. Ontario often sends NOIs to Express Entry candidates with CRS 400+."},{id:"bc",name:"British Columbia",abbr:"BC",streams:["Skills Immigration","Express Entry BC","Tech"],demandSectors:["stem","healthcare","trade"],minCLB:5,minEducation:"two_year_post",minWorkYears:1,notes:"Tech hub (Vancouver). BC PNP Tech targets 29 in-demand occupations including software, data, and engineering roles."},{id:"ab",name:"Alberta",abbr:"AB",streams:["Alberta Advantage Immigration","Express Entry Stream"],demandSectors:["trade","healthcare","stem","transport"],minCLB:5,minEducation:"secondary",minWorkYears:1,notes:"Strong energy/oil sector. Growing tech scene in Calgary and Edmonton. Lower cost of living than ON/BC."},{id:"sk",name:"Saskatchewan",abbr:"SK",streams:["International Skilled Worker","Express Entry"],demandSectors:["agriculture","healthcare","trade","transport"],minCLB:4,minEducation:"secondary",minWorkYears:1,notes:"In-Demand Occupations list is broad. One of the easiest PNPs to qualify for. Agriculture and mining are key industries."},{id:"mb",name:"Manitoba",abbr:"MB",streams:["Skilled Workers Overseas","Skilled Workers in Manitoba"],demandSectors:["healthcare","agriculture","trade","transport"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Welcoming to newcomers. Strong need for healthcare workers and tradespeople. Lower CRS requirements than federal draws."},{id:"ns",name:"Nova Scotia",abbr:"NS",streams:["Labour Market Priorities","Skilled Worker","Physician"],demandSectors:["healthcare","trade","stem"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Part of Atlantic Immigration Program. Growing tech sector in Halifax. Healthcare workers are highly sought after."},{id:"nb",name:"New Brunswick",abbr:"NB",streams:["Express Entry Labour Market","Skilled Workers with Employer Support"],demandSectors:["healthcare","trade","agriculture"],minCLB:5,minEducation:"secondary",minWorkYears:1,notes:"Bilingual province (English/French). Part of Atlantic Immigration Program. Francophone candidates get priority."},{id:"pe",name:"Prince Edward Island",abbr:"PE",streams:["Express Entry","Labour Impact"],demandSectors:["agriculture","healthcare","trade"],minCLB:5,minEducation:"two_year_post",minWorkYears:2,notes:"Small province with lower competition. Agriculture and tourism are key industries."},{id:"nl",name:"Newfoundland & Labrador",abbr:"NL",streams:["Express Entry","Skilled Worker","Priority Skills"],demandSectors:["healthcare","trade","stem"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Part of Atlantic Immigration Program. Growing need for healthcare and tech workers. Oil and gas sector."},{id:"yt",name:"Yukon",abbr:"YT",streams:["Yukon Express Entry","Skilled Worker"],demandSectors:["trade","healthcare","transport"],minCLB:4,minEducation:"secondary",minWorkYears:1,notes:"Territory with small population. Job offer typically required. Good for tradespeople and healthcare workers."}],Ne={less_than_secondary:0,secondary:1,one_year_post:2,two_year_post:3,bachelors:4,two_or_more:5,masters:6,doctoral:7};function ua(e,a){return(Ne[e]||0)>=(Ne[a]||0)}function ha(e){const a=ma(e),n=e.education||"secondary",s=Math.max(parseInt(e.canadianWorkExp)||0,parseInt(e.foreignWorkExp)||0),i=e.occupationCategory||"other",r=e.hasFrench==="yes";return da.map(o=>{let d=0;const u=100;a>=o.minCLB&&(d+=20,a>=o.minCLB+2&&(d+=10)),ua(n,o.minEducation)&&(d+=15,(Ne[n]||0)>=4&&(d+=5)),s>=o.minWorkYears&&(d+=15,s>=3&&(d+=5)),o.demandSectors.includes(i)&&(d+=25),r&&(o.id==="nb"||o.id==="on")&&(d+=5);const f=Math.min(Math.round(d/u*100),100);return{...o,matchScore:f}}).sort((o,d)=>d.matchScore-o.matchScore)}function ma(e){if(e.langTestType==="celpip"){const n=["listening","reading","writing","speaking"].map(s=>parseInt(e[`celpip_${s}`])||0);return Math.min(...n)}if(e.langTestType==="ielts"){const n=["listening","reading","writing","speaking"].map(s=>{const i=parseFloat(e[`ielts_${s}`])||0;return i>=8?10:i>=7?9:i>=6.5?8:i>=6?7:i>=5.5?6:i>=5?5:i>=4?4:0});return Math.min(...n)}return 0}const rt="crs-saved-profiles-v1";function pa(){try{const e=localStorage.getItem(rt);if(!e)return{};const a=JSON.parse(e);return a&&typeof a=="object"?a:{}}catch{return{}}}function fa(e){try{localStorage.setItem(rt,JSON.stringify(e))}catch{}}function ga(){const e=Math.random().toString(36).slice(2,8);return`prf_${Date.now().toString(36)}_${e}`}function ya(){return`${Math.random().toString(36).slice(2,10)}${Math.random().toString(36).slice(2,10)}`}function xa({id:e,name:a="",answers:n={},score:s=0,email:i="",alertOptIn:r=!1,alertToken:o=null}){const d=pa(),u=e||ga(),f=new Date().toISOString(),h=d[u],m={id:u,name:a||h?.name||`Profile ${u.slice(-4)}`,answers:n,score:s,email:i,alertOptIn:!!r,alertToken:r?o||h?.alertToken||ya():null,createdAt:h?.createdAt||f,updatedAt:f};return d[u]=m,fa(d),m}const ke=["less_than_secondary","secondary","one_year_post","two_year_post","bachelors","two_or_more","masters","doctoral"],ba={Easy:14,Medium:7,Hard:0},ot={high:78,medium:58,low:35};function Ce(e,a,n){return Math.max(a,Math.min(n,e))}function ka(e,a=Ze.averageCutoff){return Math.max(a+10,e+25)}function va(e,a){return{listening:{7:6,8:7.5,9:8,10:8.5},reading:{7:6,8:6.5,9:7,10:8},writing:{7:6,8:6.5,9:7,10:7.5},speaking:{7:6,8:6.5,9:7,10:7.5}}[e]?.[a]||0}function Sa(e,a){if(e.firstOfficialLanguage==="french"){const s=["listening","reading","writing","speaking"],i={hasFrench:"yes",frenchTestType:"clb"};for(const r of s){const o=`french_${r}`;i[o]=String(Math.max(parseInt(e[o],10)||0,a))}return i}const n=["listening","reading","writing","speaking"];if(e.langTestType==="celpip"){const s={};for(const i of n){const r=`celpip_${i}`;s[r]=String(Math.max(parseInt(e[r],10)||0,a))}return s}if(e.langTestType==="ielts"){const s={};for(const i of n){const r=`ielts_${i}`,o=va(i,a);s[r]=String(Math.max(parseFloat(e[r])||0,o))}return s}return{langTestType:"celpip",celpip_listening:String(a),celpip_reading:String(a),celpip_writing:String(a),celpip_speaking:String(a)}}function ja(e,a=7){const n={listening:parseInt(e.french_listening,10)||0,reading:parseInt(e.french_reading,10)||0,writing:parseInt(e.french_writing,10)||0,speaking:parseInt(e.french_speaking,10)||0};return{hasFrench:"yes",frenchTestType:"clb",french_listening:String(Math.max(n.listening,a)),french_reading:String(Math.max(n.reading,a)),french_writing:String(Math.max(n.writing,a)),french_speaking:String(Math.max(n.speaking,a))}}function Na({pathId:e,gain:a,months:n,steps:s}){return s.map((i,r)=>({id:`${e}-m${r+1}`,title:i.title,details:i.details,etaWeeks:i.etaWeeks,expectedGain:r===s.length-1?Math.max(a-s.slice(0,-1).reduce((o,d)=>o+d.expectedGain,0),0):i.expectedGain,done:!1,monthHint:Ce(Math.ceil((i.etaWeeks||1)/4),1,n)}))}function ct({gain:e,months:a,difficulty:n,goalReached:s,likelihood:i}){const r=Ce(24-a*2,0,24),o=Ce(Math.round(e/4),0,80),d=s?32:0,u=Math.round((ot[i]||0)/3);return o+r+d+u+(ba[n]||0)}function re({id:e,title:a,summary:n,category:s,difficulty:i,months:r,estimatedCostCad:o,whyItFits:d,likelihood:u="medium",overrides:f,currentScore:h,targetScore:m,milestoneSteps:y}){const b=X(f.baseAnswers,f.patch),C=b.total-h;if(C<=0)return null;const p=b.total>=m,j=Na({pathId:e,gain:C,months:r,steps:y});return{id:e,title:a,summary:n,category:s,difficulty:i,estimatedMonths:r,estimatedCostCad:o,projectedScore:b.total,potentialGain:C,goalReached:p,whyItFits:d,likelihood:u,likelihoodPercent:ot[u]||50,fitScore:ct({gain:C,months:r,difficulty:i,goalReached:p,likelihood:u}),milestones:j,checks:{targetScore:m,currentScore:h,stillNeededAfterPath:Math.max(m-b.total,0)}}}function Ca(e,a,n){const s=fe(e);if(s>=10)return null;const i=s<7?8:9,r=e.firstOfficialLanguage==="french"?"french":"english",o=r==="french"?"French Accelerator Path":"English Accelerator Path",d=r==="french"?"Raise your weakest French ability first, then target NCLC 9+ for stronger transferability outcomes.":"Raise your weakest English ability first, then target CLB 9+ for transferability gains.";return re({id:`${r}-accelerator`,title:o,summary:d,category:"Language",difficulty:"Medium",months:4,estimatedCostCad:460,whyItFits:`Your current minimum first-official-language level is CLB/NCLC ${s}, so language gains are one of the fastest realistic boosters.`,likelihood:"high",overrides:{baseAnswers:e,patch:Sa(e,i)},currentScore:a,targetScore:n,milestoneSteps:[{title:"Baseline audit and weak-skill diagnosis",details:"Run a mock test and identify the lowest 2 abilities to prioritize.",etaWeeks:1,expectedGain:0},{title:"Targeted study sprint",details:"Follow a 5-day weekly schedule focused on weakest modules and timed drills.",etaWeeks:6,expectedGain:8},{title:"Exam booking + strategy correction",details:"Book IELTS/CELPIP and fine-tune pacing, vocabulary, and response format.",etaWeeks:4,expectedGain:8},{title:"Retake and profile refresh",details:"Update final language scores in your profile and reassess draw competitiveness.",etaWeeks:4,expectedGain:12}]})}function wa(e,a,n){return e.firstOfficialLanguage==="french"?null:re({id:"french-advantage",title:"French Advantage Path",summary:"Reach NCLC 7 in all French abilities to unlock additional points and French-category draw access.",category:"Language",difficulty:"Hard",months:8,estimatedCostCad:690,whyItFits:"French pathways remain one of the highest-yield options for many candidates below general cutoffs.",likelihood:e.hasFrench==="yes"?"high":"medium",overrides:{baseAnswers:e,patch:ja(e,7)},currentScore:a,targetScore:n,milestoneSteps:[{title:"French baseline + study plan",details:"Assess current level and choose a structured curriculum for NCLC 7 goal.",etaWeeks:2,expectedGain:0},{title:"Core skill build phase",details:"Intensive reading/listening practice with weekly speaking/writing correction.",etaWeeks:12,expectedGain:8},{title:"TEF/TCF prep and mock cycles",details:"Complete timed mocks and focus weak modules before exam booking.",etaWeeks:8,expectedGain:8},{title:"Exam and score integration",details:"Enter verified NCLC scores and evaluate French-category competitiveness.",etaWeeks:6,expectedGain:12}]})}function Ta(e,a,n){const s=parseInt(e.canadianWorkExp,10)||0;return s>=5?null:re({id:"canadian-work-ladder",title:"Canadian Work Ladder Path",summary:"Add one more year of Canadian skilled work to increase core and transferability points.",category:"Work Experience",difficulty:"Hard",months:12,estimatedCostCad:0,whyItFits:`You currently report ${s} year(s) of Canadian work; the next year can materially lift your score.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{canadianWorkExp:String(s+1)}},currentScore:a,targetScore:n,milestoneSteps:[{title:"Employer alignment",details:"Confirm TEER eligibility and maintain full-time skilled role continuity.",etaWeeks:2,expectedGain:0},{title:"Documentation discipline",details:"Collect monthly pay records and letters for future proof of experience.",etaWeeks:16,expectedGain:4},{title:"Mid-year score checkpoint",details:"Recalculate progress and combine with language upgrades if needed.",etaWeeks:24,expectedGain:6},{title:"Complete one full year increment",details:"Update profile immediately when additional year is met.",etaWeeks:52,expectedGain:12}]})}function Pa(e,a,n){const s=ke.indexOf(e.education);if(s<0||s>=ke.length-1)return null;const i=ke[s+1];return re({id:"education-upgrade",title:"Education Upgrade Path",summary:"Move to the next recognized credential tier for predictable CRS uplift.",category:"Education",difficulty:"Hard",months:18,estimatedCostCad:12e3,whyItFits:`Your current education level can be improved to ${i.replace(/_/g," ")} for additional points.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{education:i}},currentScore:a,targetScore:n,milestoneSteps:[{title:"Program selection",details:"Choose an accredited credential path aligned to CRS point tiers.",etaWeeks:4,expectedGain:0},{title:"Enrollment and milestone completion",details:"Track term-level progress to keep the plan on schedule.",etaWeeks:20,expectedGain:4},{title:"Credential completion prep",details:"Prepare final documents and ECA requirements where needed.",etaWeeks:20,expectedGain:4},{title:"Credential update in profile",details:"Add completed credential and recalculate total score immediately.",etaWeeks:28,expectedGain:10}]})}function Ma(e,a,n){if(!pe(e))return null;const s=["listening","reading","writing","speaking"],i={};for(const r of s){const o=`spouseLang_${r}`;i[o]=String(Math.max(parseInt(e[o],10)||0,9))}return re({id:"spouse-optimization",title:"Spouse Optimization Path",summary:"Use spouse language and experience factors for faster low-cost point improvements.",category:"Family Factors",difficulty:"Medium",months:5,estimatedCostCad:420,whyItFits:"You have an accompanying spouse, so spouse-factor optimization is available and often underused.",likelihood:"high",overrides:{baseAnswers:e,patch:i},currentScore:a,targetScore:n,milestoneSteps:[{title:"Spouse baseline review",details:"Identify spouse factors currently missing points.",etaWeeks:1,expectedGain:0},{title:"Spouse language prep",details:"Prepare specifically for CLB 9 in the weakest spouse abilities.",etaWeeks:8,expectedGain:4},{title:"Spouse profile integration",details:"Update spouse test scores and re-optimize joint profile configuration.",etaWeeks:6,expectedGain:8}]})}function _a(e,a,n){return e.hasPNP==="yes"?null:re({id:"pnp-fast-track",title:"PNP Fast-Track Path",summary:"Pursue provincial nomination for the largest single CRS jump (+600).",category:"Provincial",difficulty:"Hard",months:6,estimatedCostCad:2200,whyItFits:"If your baseline is below recent cutoffs, PNP remains the most direct guaranteed-lift route.",likelihood:"medium",overrides:{baseAnswers:e,patch:{hasPNP:"yes"}},currentScore:a,targetScore:n,milestoneSteps:[{title:"Province shortlist",details:"Match your profile to provinces aligned with occupation/language strengths.",etaWeeks:2,expectedGain:0},{title:"Document stack preparation",details:"Prepare references, test proofs, ECA, and provincial forms early.",etaWeeks:6,expectedGain:0},{title:"Submit nomination stream",details:"Apply to selected stream and monitor NOI/application updates.",etaWeeks:8,expectedGain:0},{title:"Nomination linked to profile",details:"Accept nomination and refresh profile for major score jump.",etaWeeks:8,expectedGain:600}]})}function Ea(e,a){const n=[...e].sort((u,f)=>f.fitScore-u.fitScore);if(n.length<2)return null;const[s,i]=n,r=Math.min(s.projectedScore+i.potentialGain,1200),o=r-s.checks.currentScore;if(o<=0)return null;const d=r>=a;return{id:"combo-bridge-plan",title:"Bridge Combination Path",summary:`Combine “${s.title}” + “${i.title}” to maximize speed while limiting risk.`,category:"Combination",difficulty:s.difficulty==="Hard"||i.difficulty==="Hard"?"Hard":"Medium",estimatedMonths:Math.round((s.estimatedMonths+i.estimatedMonths)/2),estimatedCostCad:s.estimatedCostCad+i.estimatedCostCad,projectedScore:r,potentialGain:o,goalReached:d,whyItFits:"A blended route often reaches target faster than single-track attempts.",likelihood:"medium",likelihoodPercent:62,fitScore:ct({gain:o,months:Math.round((s.estimatedMonths+i.estimatedMonths)/2),difficulty:s.difficulty==="Hard"||i.difficulty==="Hard"?"Hard":"Medium",goalReached:d,likelihood:"medium"}),milestones:[...s.milestones.slice(0,2).map(u=>({...u,id:`combo-${u.id}`})),...i.milestones.slice(0,2).map(u=>({...u,id:`combo-${u.id}`})),{id:"combo-final-sync",title:"Final score synchronization",details:"Update all achieved improvements together and reassess draw strategy.",etaWeeks:4,expectedGain:Math.max(o-16,0),done:!1,monthHint:2}],checks:{targetScore:a,currentScore:s.checks.currentScore,stillNeededAfterPath:Math.max(a-r,0)}}}function Aa(e,a,n={}){const s=a?.total||0,i=Number(n.averageCutoff)||Ze.averageCutoff,r=Number(n.targetScore)||ka(s,i),o=[Ca(e,s,r),wa(e,s,r),Ta(e,s,r),Pa(e,s,r),Ma(e,s,r),_a(e,s,r)].filter(Boolean),d=Ea(o,r);d&&o.push(d);const u=o.sort((f,h)=>h.fitScore-f.fitScore).slice(0,5);return{currentScore:s,targetScore:r,plans:u,generatedAt:new Date().toISOString()}}const lt="crs-path-tracking-v1",Ge=540,dt=55,La=30,Ia=25;function ut(e,a,n){return Math.max(a,Math.min(n,e))}function ht(){return typeof localStorage<"u"}function $(e=new Date){const a=e instanceof Date?e:new Date(e);return Number.isNaN(a.getTime())?"":a.toISOString().slice(0,10)}function mt(e){return new Date(`${e}T00:00:00.000Z`)}function _e(e,a){const n=new Date(e||Date.now());return n.setDate(n.getDate()+a),n.toISOString()}function ie(e,a){const n=mt(e);return n.setUTCDate(n.getUTCDate()+a),$(n)}function Ee(){if(!ht())return{};try{const e=localStorage.getItem(lt);if(!e)return{};const a=JSON.parse(e);return a&&typeof a=="object"?a:{}}catch{return{}}}function pt(e){if(ht())try{localStorage.setItem(lt,JSON.stringify(e))}catch{}}function Ae(e,a){if(!e||typeof e!="object")return null;const n=Math.max(1,Number(e.etaWeeks)||1);return{...e,id:e.id||`m_${a+1}`,title:e.title||`Milestone ${a+1}`,details:e.details||"",etaWeeks:n,expectedGain:Number.isFinite(Number(e.expectedGain))?Number(e.expectedGain):0,done:!!e.done,completedAt:e.completedAt||null}}function ft(e,a){if(!e||typeof e!="object")return null;const n=$(e.date||e.dateKey||e.scheduledFor);return n?{id:e.id||`d_${a+1}`,date:n,milestoneId:e.milestoneId||null,title:String(e.title||"Daily action").trim(),details:String(e.details||"").trim(),expectedMinutes:Math.max(10,Number(e.expectedMinutes)||dt),expectedGain:Number.isFinite(Number(e.expectedGain))?Number(e.expectedGain):0,done:!!e.done,completedAt:e.completedAt||null}:null}function gt(e,a){const n=(e?.milestones||[]).map((o,d)=>Ae(o,d)).filter(Boolean);if(!n.length)return[];const s=$(a||new Date);if(!s)return[];const i=[];let r=0;for(const o of n){const d=ut(Math.round((Number(o.etaWeeks)||1)*7),7,224),u=d>0?Number(((Number(o.expectedGain)||0)/d).toFixed(2)):0;for(let f=0;f<d&&i.length<Ge;f++){const h=ie(s,r+f),m=mt(h).getUTCDay(),y=m===0||m===6,b=f===0;let C=`Focused practice: ${o.title}`,p=o.details||"Work toward this milestone today.",j=y?La:dt;b?(C=`Kickoff plan: ${o.title}`,p=`Set tasks and resources for this phase. ${o.details||""}`.trim(),j=Ia):y&&(C=`Weekly review: ${o.title}`,p=`Light revision + progress check. ${o.details||""}`.trim()),i.push({id:`${e?.id||"path"}-d${i.length+1}`,date:h,milestoneId:o.id,title:C,details:p,expectedMinutes:j,expectedGain:u,done:!1,completedAt:null})}if(r+=d,i.length>=Ge)break}return i}function yt(e){if(!e||typeof e!="object")return null;const a=e.startedAt||new Date().toISOString(),n=(e.milestones||[]).map((r,o)=>Ae(r,o)).filter(Boolean),s=(e.dailyTasks||[]).map((r,o)=>ft(r,o)).filter(Boolean),i=s.length>0?s:gt(e.selectedPath,a);return{...e,id:e.id||`track_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`,status:e.status||"active",startedAt:a,updatedAt:e.updatedAt||a,nextCheckInAt:e.nextCheckInAt||_e(a,7),currentScore:Number(e.currentScore)||0,targetScore:Number(e.targetScore)||Number(e?.selectedPath?.checks?.targetScore)||0,selectedPath:e.selectedPath||null,milestones:n,dailyTasks:i,notes:Array.isArray(e.notes)?e.notes:[],dailyStats:e.dailyStats||null}}function J(e,{touchUpdatedAt:a=!0}={}){const n=yt(e);if(!n)return null;const s=xt(n),i=ge(n),r=n.milestones.length>0&&n.milestones.every(u=>u.done),o=n.dailyTasks.length===0||n.dailyTasks.every(u=>u.done);return{...n,status:r&&o?"completed":"active",progressPct:s,dailyStats:i,updatedAt:a?new Date().toISOString():n.updatedAt}}function Da(e=null,a=null){return e?`user:${e}`:a?`profile:${a}`:"guest:default"}function Ye(e){if(!e)return null;const a=Ee();return J(a[e],{touchUpdatedAt:!1})}function Ue(e,a){if(!e||!a)return a;const n=Ee(),s=J(a,{touchUpdatedAt:!1});return n[e]=s,pt(n),s}function $a(e){if(!e)return;const a=Ee();delete a[e],pt(a)}function Fa(e,a,n){const s=new Date().toISOString(),i=(e?.milestones||[]).map((o,d)=>Ae({...o,done:!1,completedAt:null},d)).filter(Boolean),r=gt(e,s);return J({id:`track_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`,status:"active",startedAt:s,updatedAt:s,nextCheckInAt:_e(s,7),currentScore:Number(a)||0,targetScore:Number(n)||Number(e?.checks?.targetScore)||0,selectedPath:e,milestones:i,dailyTasks:r,notes:[]},{touchUpdatedAt:!0})}function xt(e){const a=e?.milestones||[],n=e?.dailyTasks||[],s=a.length?a.filter(r=>r.done).length/a.length:0,i=n.length?n.filter(r=>r.done).length/n.length:0;return!a.length&&!n.length?0:n.length?a.length?Math.round((s*.65+i*.35)*100):Math.round(i*100):Math.round(s*100)}function ge(e){const a=(e?.dailyTasks||[]).map((p,j)=>ft(p,j)).filter(Boolean).sort((p,j)=>p.date.localeCompare(j.date)),n=$(new Date);if(!a.length)return{totalTasks:0,completedTasks:0,completionPct:0,dueToday:0,completedToday:0,overdueTasks:0,expectedByToday:0,completedByToday:0,paceStatus:"not-started",streakDays:0,todayKey:n};const s=a.length,i=a.filter(p=>p.done).length,r=a.filter(p=>p.date===n).length,o=a.filter(p=>p.date===n&&p.done).length,d=a.filter(p=>p.date<=n).length,u=a.filter(p=>p.date<=n&&p.done).length,f=a.filter(p=>p.date<n&&!p.done).length,h=Math.round(i/s*100);let m="not-started";if(d>0){const p=u/d;p>=1?m="on-track":p>=.75?m="slightly-behind":m="behind"}const y=new Set(a.filter(p=>p.done).map(p=>$(p.completedAt||p.date)).filter(Boolean));let b=n;!y.has(b)&&r===0&&(b=ie(n,-1));let C=0;for(;y.has(b);)C+=1,b=ie(b,-1);return{totalTasks:s,completedTasks:i,completionPct:h,dueToday:r,completedToday:o,overdueTasks:f,expectedByToday:d,completedByToday:u,paceStatus:m,streakDays:C,todayKey:n}}function Wa(e,a=$(new Date)){return(e?.dailyTasks||[]).filter(s=>$(s.date)===a)}function Ba(e,a=7,n=$(new Date)){const s=ie(n,Math.max(a-1,0));return(e?.dailyTasks||[]).filter(i=>{const r=$(i.date);return r>=n&&r<=s})}function Ra(e){const a=yt(e);if(!a||!a.dailyTasks.length)return null;const n=ge(a),s=a.dailyTasks.length,i=a.dailyTasks[0]?.date||$(a.startedAt),r=s,o=n.expectedByToday>0?n.completedByToday/n.expectedByToday:1,d=ut(o||1,.45,1.35),u=Math.max(1,Math.round(s/d)),f=ie(i,r-1),h=ie(i,u-1);return{baselineDate:f,projectedDate:h,paceMultiplier:d,baselineDays:r,projectedDays:u,delayDays:u-r}}function Oa(e,a){if(!e)return e;const n=(e.milestones||[]).map(s=>{if(s.id!==a)return s;const i=!s.done;return{...s,done:i,completedAt:i?new Date().toISOString():null}});return J({...e,milestones:n},{touchUpdatedAt:!0})}function Ga(e,a){if(!e)return e;const n=(e.dailyTasks||[]).map(s=>{if(s.id!==a)return s;const i=!s.done;return{...s,done:i,completedAt:i?new Date().toISOString():null}});return J({...e,dailyTasks:n},{touchUpdatedAt:!0})}function Ya(e,a){return e&&J({...e,currentScore:Number(a)||0},{touchUpdatedAt:!0})}function Ua(e,a=7){if(!e)return e;const n=e.nextCheckInAt||new Date().toISOString();return J({...e,nextCheckInAt:_e(n,a)},{touchUpdatedAt:!0})}function Ha(e,a){if(!e||!a?.trim())return e;const n=[...e.notes||[],{id:`note_${Date.now().toString(36)}`,text:a.trim(),createdAt:new Date().toISOString()}];return J({...e,notes:n},{touchUpdatedAt:!0})}function qa(e){if(!e)return"Choose an expert path to get a daily action plan.";if(e.status==="completed")return"Great progress — this path is complete. Recalculate and choose your next upgrade target.";const a=ge(e),n=$(new Date),s=(e.dailyTasks||[]).find(r=>r.date===n&&!r.done);if(a.overdueTasks>0)return`You have ${a.overdueTasks} overdue daily task(s). Clear one overdue task before adding new work.`;if(s)return`Today’s focus: ${s.title} (~${s.expectedMinutes} min).`;const i=(e.milestones||[]).find(r=>!r.done);return i?`Next milestone: ${i.title}. Keep your streak alive with one focused task today.`:"You are close to completion — finish remaining daily actions and refresh your score."}function Le(e,a){const n=String(e?.message||"");return new RegExp(`relation\\s+["']?public\\.${a}["']?\\s+does not exist`,"i").test(n)||new RegExp(`table\\s+["']?${a}["']?\\s+not found`,"i").test(n)}function Ie(e,a){return new Error(`${e}: ${a?.message||a?.hint||String(a)}`)}function we(){return new Date().toISOString()}function De(){return Rt&&!!se}function Ka(e){if(!e)return!1;const a=new Set(["active","trialing","paid"]),n=String(e.status||"").toLowerCase();if(!a.has(n))return!1;if(!e.current_period_end)return!0;const s=new Date(e.current_period_end).getTime();return Number.isFinite(s)&&s>Date.now()}async function He(e){if(!e)return{status:"skipped",reason:"Missing user id",active:!1};if(!De())return{status:"skipped",reason:"Supabase env vars are not configured",active:!1};const{data:a,error:n}=await se.from("user_tracking_access").select("*").eq("user_id",e).limit(1);if(n&&Le(n,"user_tracking_access"))return{status:"skipped",reason:"Tracking access table missing. Run the latest supabase/schema.sql.",active:!1};if(n)throw Ie("Failed to fetch tracking access",n);const s=a?.[0]||null;return{status:"ok",row:s,active:Ka(s)}}async function za(e,a){if(!e||!a)return{status:"skipped",reason:"Missing user id or tracking payload"};if(!De())return{status:"skipped",reason:"Supabase env vars are not configured"};const n={id:a.id,user_id:e,path_id:a.selectedPath?.id||null,target_score:Number(a.targetScore)||0,start_score:Number(a.selectedPath?.checks?.currentScore)||0,current_score:Number(a.currentScore)||0,status:a.status||"active",progress_pct:Number.isFinite(a.progressPct)?a.progressPct:0,next_check_in_at:a.nextCheckInAt||null,milestones_json:a.milestones||[],daily_tasks_json:a.dailyTasks||[],plan_json:a.selectedPath||{},notes_json:a.notes||[],updated_at:we()},{data:s,error:i}=await se.from("user_path_tracking").upsert(n,{onConflict:"id"}).select();if(i&&Le(i,"user_path_tracking"))return{status:"skipped",reason:"Path tracking table missing. Run the latest supabase/schema.sql."};if(i)throw Ie("Failed to save path tracking",i);return{status:"ok",data:s?.[0]||null}}async function Va(e){if(!e)return{status:"skipped",reason:"Missing user id"};if(!De())return{status:"skipped",reason:"Supabase env vars are not configured"};const{data:a,error:n}=await se.from("user_path_tracking").select("*").eq("user_id",e).order("updated_at",{ascending:!1}).limit(1);if(n&&Le(n,"user_path_tracking"))return{status:"skipped",reason:"Path tracking table missing. Run the latest supabase/schema.sql.",data:null};if(n)throw Ie("Failed to load path tracking",n);const s=a?.[0]||null;return s?{status:"ok",data:{id:s.id,status:s.status||"active",startedAt:s.created_at||we(),updatedAt:s.updated_at||we(),nextCheckInAt:s.next_check_in_at||null,currentScore:s.current_score||0,targetScore:s.target_score||0,selectedPath:s.plan_json||null,milestones:Array.isArray(s.milestones_json)?s.milestones_json:[],dailyTasks:Array.isArray(s.daily_tasks_json)?s.daily_tasks_json:[],notes:Array.isArray(s.notes_json)?s.notes_json:[]}}:{status:"ok",data:null}}function ne(e){if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?"—":a.toLocaleDateString()}function Ja(e){const a=String(e||"").toLowerCase();return a==="easy"?"path-diff-easy":a==="hard"?"path-diff-hard":"path-diff-medium"}function qe(e,a,n){return Math.max(a,Math.min(n,e))}function Ke(e,a){const n=new Date(e||Date.now());return n.setMonth(n.getMonth()+a),n.toISOString()}function Qa(e){const a=Number(e)||0;return Number.isInteger(a)?String(a):a.toFixed(1)}function Za(e){return{"on-track":"On track","slightly-behind":"Slightly behind",behind:"Behind schedule","not-started":"Not started"}[String(e||"")]||"In progress"}function Xa(e){return e?e.delayDays>0?`${e.delayDays} day(s) behind baseline`:e.delayDays<0?`${Math.abs(e.delayDays)} day(s) ahead of baseline`:"On baseline timeline":""}async function en(e){if(!e)return"";const a=[];e.message&&a.push(String(e.message));const n=e.context;if(!n||typeof n.clone!="function")return a.join(" · ").trim();try{const s=n.clone();if((s.headers?.get?.("content-type")||"").includes("application/json")){const r=await s.json(),o=[r?.message,r?.error,r?.details].filter(Boolean).map(d=>String(d));o.length&&a.push(...o)}else{const r=await s.text();r&&a.push(r)}}catch{}return[...new Set(a)].join(" · ").trim()}function tn({answers:e,result:a,averageCutoff:n,categoryInfo:s}){const i=Number(a?.total)||0,r=Math.max(Number(n)||520,i+25),o=(s||[]).filter(f=>typeof f?.check=="function"&&f.check(e)).map(f=>Number(f.recentCutoff)).filter(f=>Number.isFinite(f)&&f>0);if(o.length===0)return qe(r+10,300,1200);const d=Math.min(...o),u=Math.max(d+5,i+5);return qe(Math.min(r+10,u),300,1200)}function an({answers:e,result:a,averageCutoff:n,categoryInfo:s=[]}){const i=Xe(),{user:r,isAuthenticated:o}=et(),d=void 0,u=g.useMemo(()=>tn({answers:e,result:a,averageCutoff:n,categoryInfo:s}),[e,a,n,s]),[f,h]=g.useState(()=>Math.max((a?.total||0)+25,500)),[m,y]=g.useState(!1),[b,C]=g.useState(""),[p,j]=g.useState(null),[L,I]=g.useState(""),[de,M]=g.useState(""),[ue,ee]=g.useState(!1),[te,H]=g.useState({loading:!1,active:!1,reason:""}),W=g.useMemo(()=>Da(r?.id||null,null),[r?.id]),T=g.useMemo(()=>Aa(e,a,{targetScore:f,averageCutoff:n}),[e,a,f,n]),w=g.useMemo(()=>T.plans.find(c=>c.id===b)||T.plans[0]||null,[T.plans,b]),_=o&&te.active,B=xt(p),he=qa(p),F=g.useMemo(()=>ge(p),[p]),Q=g.useMemo(()=>Wa(p),[p]),q=g.useMemo(()=>Ba(p,7),[p]),K=g.useMemo(()=>Ra(p),[p]),D=g.useMemo(()=>{if(!w)return null;const c=p?.startedAt||new Date().toISOString(),x=w.difficulty==="Easy"?1:w.difficulty==="Hard"?3:2,v=Math.max(w.estimatedMonths-x,1),V=w.estimatedMonths+x+(w.goalReached?0:1);return{earliestMonths:v,latestMonths:V,earliestDate:Ke(c,v),latestDate:Ke(c,V)}},[w,p?.startedAt]);g.useEffect(()=>{y(!1)},[a?.total]),g.useEffect(()=>{m||h(u)},[u,m]),g.useEffect(()=>{if(!T.plans.length){C("");return}T.plans.some(x=>x.id===b)||C(T.plans[0].id)},[T.plans,b]),g.useEffect(()=>{let c=!0;return queueMicrotask(()=>{if(!c)return;const x=Ye(W);if(x){const v={...x,currentScore:Number(a?.total)||0};j(v)}else j(null)}),()=>{c=!1}},[a?.total,W]),g.useEffect(()=>{if(!o||!r?.id)return;let c=!0;return He(r.id).then(x=>{c&&H({loading:!1,active:!!x.active,reason:x.reason||""})}).catch(x=>{c&&H({loading:!1,active:!1,reason:x.message||"Could not verify tracking access."})}),()=>{c=!1}},[o,r?.id]),g.useEffect(()=>{if(!o||!r?.id)return;let c=!0;return Va(r.id).then(x=>{if(!c||x.status!=="ok"||!x.data)return;const v=Ye(W),V=new Date(x.data.updatedAt||0).getTime(),ye=new Date(v?.updatedAt||0).getTime();if(!v||V>ye){const ae={...x.data,currentScore:Number(a?.total)||0};Ue(W,ae),j(ae)}}).catch(()=>{}),()=>{c=!1}},[o,a?.total,W,r?.id]);const z=async c=>{const x=Ya(c,a.total),v=Ue(W,x);if(j(v),o&&_&&r?.id)try{await za(r.id,v)}catch{}return v},R=async()=>{if(!w)return;if(!_){M("Tracking is available on the 5 CAD/month plan.");return}const c=Fa(w,a.total,f);await z(c),M("Expert path started. Complete today's tasks to build momentum.")},A=async c=>{if(!p||!_)return;const x=Oa(p,c);await z(x),M("Milestone progress updated.")},E=async c=>{if(!p||!_)return;const x=Ga(p,c);await z(x),M("Daily task updated.")},O=async()=>{if(!p||!_)return;const c=Ua(p,7);await z(c),M("Next check-in moved by 7 days.")},G=async()=>{if(!p||!_)return;const c=L.trim();if(!c)return;const x=Ha(p,c);await z(x),I(""),M("Coach note saved.")},oe=()=>{$a(W),j(null),M("Tracking reset. Choose another expert path.")},Y=async()=>{if(!o||!r?.id){M("Please log in before subscribing.");return}ee(!0),M("");try{if(!se)throw new Error("Supabase client is not configured.");const{data:c,error:x}=await se.functions.invoke("create-tracking-checkout",{body:{source:"path-coach"}});if(x){const V=await en(x);throw new Error(V||"Could not create checkout session.")}const v=c?.url;if(!v)throw new Error("Checkout function returned no URL.");window.location.href=v,M("Opening secure checkout...")}catch(c){const x=String(c?.message||""),v=/non-2xx status code/i.test(x);M(v?'Checkout backend is returning an error. Deploy/fix the Supabase "create-tracking-checkout" function and Stripe secrets, or set VITE_STRIPE_TRACKING_CHECKOUT_URL fallback.':x||"Could not start subscription checkout.")}finally{ee(!1)}};return t.jsxs(k.div,{className:"card path-coach-card",initial:i?!1:{opacity:0,y:18},animate:{opacity:1,y:0},transition:i?{duration:0}:{duration:.24,ease:[.22,1,.36,1]},children:[t.jsxs("div",{className:"path-coach-head",children:[t.jsx("h3",{children:"Expert Strategy Coach"}),t.jsx("span",{className:"path-pill",children:"Phase 2"})]}),t.jsx("p",{className:"cat-intro",children:"Pick the strategy that fits you best, then follow a guided daily plan to close your CRS gap faster."}),t.jsxs("div",{className:"path-target-row",children:[t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Target score"}),t.jsx("input",{type:"number",min:"300",max:"1200",value:f,onChange:c=>{y(!0),h(Number(c.target.value)||T.targetScore)}})]}),t.jsxs("div",{className:"path-target-meta",children:[t.jsxs("small",{children:["Current: ",T.currentScore]}),t.jsxs("small",{children:["Score gap: ",Math.max(f-T.currentScore,0)]}),t.jsxs("small",{children:["Smart target: ",u]})]})]}),t.jsx("div",{className:"path-grid",children:T.plans.map(c=>t.jsxs(k.button,{type:"button",className:`path-option ${w?.id===c.id?"selected":""}`,onClick:()=>C(c.id),"aria-pressed":w?.id===c.id,whileHover:i?void 0:{y:-3},whileTap:i?void 0:{scale:.98},children:[t.jsxs("div",{className:"path-option-head",children:[t.jsx("strong",{children:c.title}),t.jsx("span",{className:`path-diff ${Ja(c.difficulty)}`,children:c.difficulty})]}),t.jsx("p",{children:c.summary}),t.jsxs("div",{className:"path-stats",children:[t.jsxs("span",{children:["+",c.potentialGain," pts"]}),t.jsxs("span",{children:[c.estimatedMonths," months"]}),t.jsxs("span",{children:[c.likelihoodPercent,"% likely"]})]}),t.jsx("small",{children:c.goalReached?"Can likely reach your target with this path":`${c.checks.stillNeededAfterPath} pts still needed after this path`})]},c.id))}),w&&t.jsxs("div",{className:"path-detail",children:[t.jsx("h4",{children:w.title}),t.jsx("p",{className:"path-why",children:w.whyItFits}),t.jsxs("div",{className:"path-meta-line",children:[t.jsxs("span",{children:["Projected score: ",t.jsx("strong",{children:w.projectedScore})]}),t.jsxs("span",{children:["Estimated cost: ",t.jsxs("strong",{children:[w.estimatedCostCad," CAD"]})]})]}),D&&t.jsxs("div",{className:"path-meta-line",children:[t.jsxs("span",{children:["Likely completion window: ",t.jsxs("strong",{children:[D.earliestMonths,"-",D.latestMonths," months"]})]}),t.jsxs("span",{children:["Target finish dates: ",t.jsxs("strong",{children:[ne(D.earliestDate)," - ",ne(D.latestDate)]})]})]}),t.jsx("ul",{className:"path-milestones-preview",children:w.milestones.map(c=>t.jsxs("li",{children:[t.jsx("span",{children:c.title}),t.jsxs("small",{children:["~",c.etaWeeks," weeks"]})]},c.id))})]}),!o&&t.jsx("div",{className:"path-paywall",children:t.jsx("p",{children:"Log in first, then activate paid tracking (5 CAD/month) to unlock daily guidance and cloud sync."})}),o&&!_&&t.jsxs("div",{className:"path-paywall",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Tracking plan:"})," 5 CAD / month"]}),t.jsx("p",{children:"Includes expert strategy tracking, daily tasks, reminders, and cross-device progress sync."}),t.jsxs("div",{className:"path-pay-actions",children:[t.jsx("button",{type:"button",className:"action-btn auth-btn-primary",disabled:ue,onClick:Y,children:ue?"Opening...":"Subscribe (5 CAD/month)"}),t.jsx("button",{type:"button",className:"action-btn",onClick:async()=>{if(r?.id){H(c=>({...c,loading:!0}));try{const c=await He(r.id);H({loading:!1,active:!!c.active,reason:c.reason||""}),M(c.active?"Subscription detected. Tracking unlocked.":"Subscription not active yet.")}catch(c){H({loading:!1,active:!1,reason:c.message||""})}}},children:te.loading?"Checking...":"Refresh payment status"}),d]}),te.reason&&t.jsx("small",{children:te.reason})]}),t.jsxs("div",{className:"path-actions",children:[t.jsx(Ot,{color:"var(--primary)",speed:"5s",children:t.jsx("button",{className:"btn-next finish",type:"button",onClick:R,children:p?"Switch to this strategy":"Start this strategy"})}),p&&t.jsx("button",{className:"btn-toggle",type:"button",onClick:oe,children:"Reset tracking"})]}),p&&t.jsxs("div",{className:"path-tracker",children:[t.jsxs("div",{className:"path-progress-head",children:[t.jsxs("strong",{children:["Progress: ",B,"%"]}),t.jsxs("span",{children:["Next check-in: ",ne(p.nextCheckInAt)]})]}),t.jsx("div",{className:"path-progress-bar-wrap",children:t.jsx(k.div,{className:"path-progress-bar",initial:{width:0},animate:{width:`${B}%`},transition:i?{duration:0}:{duration:.7}})}),t.jsxs("div",{className:"path-daily-stats",children:[t.jsxs("span",{children:["Streak: ",t.jsxs("strong",{children:[F.streakDays," day(s)"]})]}),t.jsxs("span",{children:["Completed: ",t.jsxs("strong",{children:[F.completedTasks,"/",F.totalTasks]})]}),t.jsxs("span",{children:["Today: ",t.jsxs("strong",{children:[F.completedToday,"/",F.dueToday]})]}),t.jsxs("span",{className:`pace pace-${F.paceStatus}`,children:["Pace: ",t.jsx("strong",{children:Za(F.paceStatus)})]})]}),K&&t.jsxs("div",{className:"path-coach-note",children:[t.jsx("strong",{children:"Completion forecast:"})," baseline ",ne(K.baselineDate)," · current pace ",ne(K.projectedDate)," (",Xa(K),")"]}),t.jsxs("div",{className:"path-coach-note",children:[t.jsx("strong",{children:"Coach guidance:"})," ",he]}),t.jsxs("div",{className:"path-daily-section",children:[t.jsx("h5",{children:"Today's guide"}),!Q.length&&t.jsx("p",{className:"path-empty-text",children:"No task is due today. Continue with the next upcoming task."}),!!Q.length&&t.jsx("ul",{className:"path-daily-list",children:Q.map(c=>t.jsxs("li",{className:c.done?"done":"",children:[t.jsx("button",{type:"button",onClick:()=>E(c.id),disabled:!_,children:c.done?"✓":"○"}),t.jsxs("div",{children:[t.jsx("strong",{children:c.title}),t.jsx("p",{children:c.details}),t.jsxs("small",{children:[c.expectedMinutes," min planned · +",Qa(c.expectedGain)," projected CRS pace"]})]})]},c.id))})]}),t.jsxs("div",{className:"path-daily-section",children:[t.jsx("h5",{children:"Upcoming 7-day guide"}),!q.length&&t.jsx("p",{className:"path-empty-text",children:"No upcoming tasks yet."}),!!q.length&&t.jsx("ul",{className:"path-upcoming-list",children:q.slice(0,10).map(c=>t.jsxs("li",{children:[t.jsx("span",{children:ne(c.date)}),t.jsx("span",{children:c.title})]},c.id))})]}),t.jsx("ul",{className:"path-milestone-list",children:(p.milestones||[]).map(c=>t.jsxs("li",{className:c.done?"done":"",children:[t.jsx("button",{type:"button",onClick:()=>A(c.id),disabled:!_,children:c.done?"✓":"○"}),t.jsxs("div",{children:[t.jsx("strong",{children:c.title}),t.jsx("p",{children:c.details}),t.jsxs("small",{children:["Expected impact: +",c.expectedGain," pts · ~",c.etaWeeks," weeks"]})]})]},c.id))}),t.jsx("div",{className:"path-checkin-row",children:t.jsx("button",{className:"action-btn",type:"button",onClick:O,disabled:!_,children:"Move next check-in by 7 days"})}),t.jsxs("div",{className:"path-note-input",children:[t.jsx("input",{type:"text",value:L,onChange:c=>I(c.target.value),placeholder:"Add blocker or update note for your next check-in..."}),t.jsx("button",{className:"action-btn",type:"button",onClick:G,disabled:!_,children:"Save note"})]})]}),de&&t.jsx("p",{className:"save-status",children:de})]})}const ze={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.08}}},P={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{type:"spring",stiffness:100,damping:18}}};function Ve(e){return e==="supabase"?"Live sync":"Local fallback"}function Je(e){return e==="supabase"?"draw-source-live":"draw-source-fallback"}function nn({value:e,duration:a=1.2,reduceMotion:n=!1}){const[s,i]=g.useState(e);return g.useEffect(()=>{if(n)return;const r=e,o=performance.now(),d=u=>{const f=(u-o)/(a*1e3);if(f>=1){i(r);return}const h=1-Math.pow(1-f,3);i(Math.round(r*h)),requestAnimationFrame(d)};requestAnimationFrame(d)},[e,a,n]),n?t.jsx(t.Fragment,{children:e}):t.jsx(t.Fragment,{children:s})}function sn({score:e,statusColor:a,reduceMotion:n=!1}){const i=2*Math.PI*54,r=Math.min(e/1200,1);return t.jsxs("div",{className:"score-gauge","aria-label":`CRS Score: ${e} out of 1200`,children:[t.jsxs("svg",{viewBox:"0 0 120 120",width:"180",height:"180",children:[t.jsx("circle",{cx:"60",cy:"60",r:54,fill:"none",stroke:"var(--surface-2)",strokeWidth:"8"}),t.jsx(k.circle,{cx:"60",cy:"60",r:54,fill:"none",stroke:a,strokeWidth:"8",strokeLinecap:"round",transform:"rotate(-90 60 60)",strokeDasharray:i,initial:n?!1:{strokeDashoffset:i},animate:{strokeDashoffset:i-r*i},transition:n?{duration:0}:{duration:1.4,ease:[.22,1,.36,1]}})]}),t.jsxs("div",{className:"gauge-text",children:[t.jsx("div",{className:"gauge-number","aria-live":"polite",children:t.jsx(nn,{value:e,reduceMotion:n})}),t.jsx("div",{className:"gauge-max",children:"/ 1,200"})]})]})}function ve({id:e,label:a,open:n,onToggle:s}){return t.jsx("h3",{className:"section-toggle-heading",children:t.jsxs("button",{type:"button",className:"section-toggle",onClick:s,"aria-expanded":n,"aria-controls":e,children:[t.jsx("span",{children:a}),t.jsx("span",{className:"toggle-arrow","aria-hidden":"true",children:"▾"})]})})}function rn({icon:e,label:a,value:n,max:s,note:i}){const r=Math.round(n/s*100);return t.jsxs(k.div,{className:"bd-item",variants:P,children:[t.jsx("span",{className:"bd-icon",children:e}),t.jsxs("div",{className:"bd-info",children:[t.jsxs("div",{className:"bd-top",children:[t.jsxs("span",{className:"bd-label",children:[a,i&&t.jsxs("small",{className:"bd-note",children:[" (",i,")"]})]}),t.jsxs("span",{className:"bd-pts",children:[n," ",t.jsxs("small",{children:["/ ",s]})]})]}),t.jsx("div",{className:"bd-bar-bg",children:t.jsx(k.div,{className:"bd-bar-fill",initial:{width:0},animate:{width:`${r}%`},transition:{duration:.8,delay:.3,ease:"easeOut"}})})]})]})}function Se({draw:e,userScore:a}){const n=a>=e.score;return t.jsxs("div",{className:`draw-row ${n?"draw-above":"draw-below"}`,children:[t.jsx("span",{className:"draw-date",children:e.date}),t.jsx("span",{className:"draw-program",children:e.program}),t.jsx("span",{className:"draw-score",children:e.score})]})}const on=[{value:"secondary",label:"High School"},{value:"one_year_post",label:"1-Year Diploma"},{value:"two_year_post",label:"2-Year Diploma"},{value:"bachelors",label:"Bachelor's"},{value:"two_or_more",label:"2+ Credentials"},{value:"masters",label:"Master's"},{value:"doctoral",label:"PhD"}];function je(e,a,n){return{id:e,label:a,age:n.age||"",education:n.education||"",canadianWorkExp:n.canadianWorkExp||"0",minClb:""}}function cn(e){return{5:5,6:5.5,7:6,8:6.5,9:7,10:7.5}[e]||0}function ln(e,a){const n={};if(a.age&&a.age!==e.age&&(n.age=a.age),a.education&&a.education!==e.education&&(n.education=a.education),a.canadianWorkExp&&a.canadianWorkExp!==e.canadianWorkExp&&(n.canadianWorkExp=a.canadianWorkExp),a.minClb){const s=parseInt(a.minClb,10),i=["listening","reading","writing","speaking"];if(e.langTestType==="celpip")for(const r of i){const o=`celpip_${r}`;n[o]=String(Math.max(parseInt(e[o],10)||0,s))}else{const r=cn(s);for(const o of i){const d=`ielts_${o}`;n[d]=String(Math.max(parseFloat(e[d])||0,r))}}}return Object.keys(n).length===0?null:X(e,n)}function dn({answers:e,originalScore:a,t:n}){const[s,i]=g.useState(()=>[je("a","Scenario A",e),je("b","Scenario B",e)]),r=()=>{s.length>=3||i(u=>[...u,je("c","Scenario C",e)])},o=u=>{s.length<=2||i(f=>f.filter(h=>h.id!==u))},d=(u,f)=>{i(h=>h.map(m=>m.id===u?{...m,...f}:m))};return t.jsxs("div",{className:"scenario-panel",children:[t.jsx("div",{className:"scenario-grid",children:s.map(u=>{const f=ln(e,u),h=f?f.total-a:0;return t.jsxs("div",{className:"scenario-card",children:[t.jsxs("div",{className:"scenario-head",children:[t.jsx("strong",{children:u.label}),u.id==="c"&&t.jsx("button",{type:"button",className:"scenario-remove",onClick:()=>o(u.id),children:"Remove"})]}),t.jsxs("div",{className:"wi-grid",children:[t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Age"}),t.jsxs("select",{value:u.age,onChange:m=>d(u.id,{age:m.target.value}),children:[t.jsx("option",{value:"",children:"Current"}),Array.from({length:30},(m,y)=>y+18).map(m=>t.jsx("option",{value:m,children:m},m))]})]}),t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Education"}),t.jsxs("select",{value:u.education,onChange:m=>d(u.id,{education:m.target.value}),children:[t.jsx("option",{value:"",children:"Current"}),on.map(m=>t.jsx("option",{value:m.value,children:m.label},m.value))]})]}),t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Canadian Work (yrs)"}),t.jsx("select",{value:u.canadianWorkExp,onChange:m=>d(u.id,{canadianWorkExp:m.target.value}),children:[0,1,2,3,4,5].map(m=>t.jsx("option",{value:m,children:m},m))})]}),t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Min Language CLB"}),t.jsxs("select",{value:u.minClb,onChange:m=>d(u.id,{minClb:m.target.value}),children:[t.jsx("option",{value:"",children:"Current"}),[5,6,7,8,9,10].map(m=>t.jsxs("option",{value:m,children:["CLB ",m,"+"]},m))]})]})]}),f&&t.jsx(k.div,{className:"wi-result",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:t.jsxs("div",{className:"wi-scores",children:[t.jsxs("div",{className:"wi-score-block",children:[t.jsx("small",{children:n("results.original")}),t.jsx("strong",{children:a})]}),t.jsx("span",{className:"wi-arrow",children:"→"}),t.jsxs("div",{className:"wi-score-block projected",children:[t.jsx("small",{children:n("results.projected")}),t.jsx("strong",{children:f.total})]}),t.jsxs("span",{className:`wi-delta ${h>0?"pos":h<0?"neg":""}`,children:[h>0?"+":"",h," pts"]})]})})]},u.id)})}),s.length<3&&t.jsx("button",{type:"button",className:"btn-toggle scenario-add-btn",onClick:r,children:"Add Scenario C ▼"})]})}function un(){return t.jsx(k.div,{className:"loading-screen",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,scale:.95,transition:{duration:.3}},children:t.jsx(Vt,{})})}function hn(e){const a=g.useRef(null);return g.useEffect(()=>{if(!e)return;const n=a.current;if(!n)return;const s=n.getContext("2d");n.width=window.innerWidth,n.height=window.innerHeight;const i=["#22c55e","#4CC9F0","#7C3AED","#f59e0b","#ec4899","#3A0CA3"],r=Array.from({length:120},()=>({x:Math.random()*n.width,y:Math.random()*n.height-n.height,w:Math.random()*8+4,h:Math.random()*6+2,color:i[Math.floor(Math.random()*i.length)],vx:(Math.random()-.5)*4,vy:Math.random()*3+2,rot:Math.random()*360,rv:(Math.random()-.5)*8}));let o;const d=()=>{s.clearRect(0,0,n.width,n.height);let f=!1;for(const h of r)h.x+=h.vx,h.y+=h.vy,h.rot+=h.rv,h.vy+=.05,h.y<n.height+20&&(f=!0),s.save(),s.translate(h.x,h.y),s.rotate(h.rot*Math.PI/180),s.fillStyle=h.color,s.fillRect(-h.w/2,-h.h/2,h.w,h.h),s.restore();f&&(o=requestAnimationFrame(d))};o=requestAnimationFrame(d);const u=setTimeout(()=>{cancelAnimationFrame(o),s.clearRect(0,0,n.width,n.height)},4e3);return()=>{cancelAnimationFrame(o),clearTimeout(u)}},[e]),a}function pn({answers:e,onRestart:a,drawData:n,drawSource:s="local-fallback",categoryInfo:i}){const{t:r}=Gt(),o=Xe(),{user:d,isAuthenticated:u}=et(),f=g.useMemo(()=>Re(),[]),h=n||Ht(),m=g.useMemo(()=>Array.isArray(i)&&i.length>0?i:Yt(),[i]),[y,b]=g.useState(!0),[C,p]=g.useState(!1),[j,L]=g.useState(!1),[I,de]=g.useState(!1),[M,ue]=g.useState(!1),[ee,te]=g.useState(()=>f.profileName||""),[H,W]=g.useState(()=>f.contactEmail||""),[T,w]=g.useState(()=>!!f.defaultDrawAlerts),[_,B]=g.useState(""),[he,F]=g.useState(!1),[Q,q]=g.useState([]),[K,D]=g.useState("idle"),z=f.autoSyncProfiles!==!1;g.useEffect(()=>{const l=setTimeout(()=>b(!1),900);return()=>clearTimeout(l)},[]);const R=g.useMemo(()=>{if(e.knowsScore==="yes"){const l=parseInt(e.scoreRange,10)||400;return{total:l,breakdown:{coreHumanCapital:l,spouseFactors:0,skillTransferability:0,additionalPoints:0},details:{age:0,education:0,firstLanguage:0,secondLanguage:0,canadianWork:0,foreignWork:0,spouseTotal:0,skillTotal:0,additionalTotal:0}}}return it(e)},[e]),A=e.knowsScore!=="yes",E=R.total,O=h.averageCutoff,G=E-O,oe=qt();g.useEffect(()=>{if(!u||!oe||!d?.id){q([]),D("idle");return}let l=!0;return D("loading"),Oe(d.id).then(S=>{l&&(S.status==="ok"?(q(S.data||[]),D("ready")):(q([]),D("empty")))}).catch(()=>{l&&D("error")}),()=>{l=!1}},[oe,u,d?.id]);const Y=G>=20?{cls:"above",marker:"+",title:"Great News!",desc:`Your score is ${G} points above the recent cut-off (${O}). You have a strong chance of receiving an Invitation to Apply.`,color:"#22c55e"}:G>=-10?{cls:"close",marker:"~",title:"Almost There!",desc:`You're just ${Math.abs(G)} points ${G>=0?"above":"below"} the recent cut-off (${O}). A few small improvements could make the difference.`,color:"#f59e0b"}:{cls:"below",marker:"—",title:"Room to Improve",desc:`You're ${Math.abs(G)} points below the recent cut-off (${O}). Don't worry — see the suggestions below to boost your score.`,color:"#ef4444"},c=g.useMemo(()=>ca(e,R),[e,R]),x=g.useMemo(()=>la(R),[R]),v=R.details,V=g.useMemo(()=>{const l=[{icon:"A",label:"Age",value:v.age,max:110},{icon:"E",label:"Education",value:v.education,max:150},{icon:"L",label:"English Language",value:v.firstLanguage,max:136},{icon:"W",label:"Canadian Work",value:v.canadianWork,max:80}];return v.secondLanguage>0&&l.splice(3,0,{icon:"F",label:"French",value:v.secondLanguage,max:24}),v.foreignWork>0?l.push({icon:"S",label:r("results.foreignWork"),value:v.skillTotal,max:100,note:"via skill transferability"}):l.push({icon:"S",label:"Skill Bonus",value:v.skillTotal,max:100}),v.spouseTotal>0&&l.push({icon:"P",label:"Spouse",value:v.spouseTotal,max:40}),v.additionalTotal>0&&l.push({icon:"+",label:"Bonus Points",value:v.additionalTotal,max:600}),l},[v,r]),ye=c.slice(0,3),ae=c.slice(3),xe=Ut[e.pathway],$e=g.useMemo(()=>A?ha(e):[],[e,A]),Fe=!o&&!y&&G>=20,bt=hn(Fe),kt=async()=>{const l=H.trim()||d?.email||"";if(T&&!l){B("Add an email to enable draw alerts (or sign in).");return}if(l&&!/^\S+@\S+\.\S+$/.test(l)){B("Please enter a valid email address.");return}const S=xa({name:ee.trim(),answers:e,score:E,email:l,alertOptIn:!!T&&!!l}),ce=Re();Kt({...ce,profileName:ee.trim(),contactEmail:l,defaultDrawAlerts:!!T}),F(!0);try{if(z&&(l||T))if((await zt(S,{userId:d?.id||null})).status==="ok"){if(u&&d?.id){const Be=await Oe(d.id);Be.status==="ok"&&(q(Be.data||[]),D("ready"))}B(T?"Profile saved, synced, and draw alerts subscribed.":"Profile saved and synced with your account.")}else B("Profile saved locally. Configure Supabase env vars to enable cloud sync/alerts.");else B(z?"Profile saved locally.":"Profile saved locally. Auto-sync is off in account settings.")}catch(We){B(`Profile saved locally, but cloud sync failed: ${We.message}`)}finally{F(!1)}},vt=()=>window.print(),Z=l=>{const S=document.getElementById(l);S&&S.scrollIntoView({behavior:"smooth",block:"start"})};return y?t.jsx(un,{}):t.jsxs(k.div,{className:"results",variants:ze,initial:"hidden",animate:"show",exit:{opacity:0,transition:{duration:.2}},children:[Fe&&t.jsx("canvas",{ref:bt,className:"confetti-canvas"}),t.jsx(k.div,{className:"score-hero",variants:P,children:t.jsx(sn,{score:E,statusColor:Y.color,reduceMotion:o})}),t.jsx(k.div,{className:"result-actions",variants:P,children:t.jsx("button",{type:"button",className:"action-btn",onClick:vt,"aria-label":"Download PDF",children:r("results.pdf")})}),t.jsxs(k.div,{className:"card quick-nav-card",variants:P,children:[t.jsx("h3",{children:"Quick navigation"}),t.jsxs("div",{className:"quick-nav-grid",children:[t.jsx("button",{type:"button",className:"action-btn",onClick:()=>Z("section-save"),children:"Save profile"}),A&&t.jsx("button",{type:"button",className:"action-btn",onClick:()=>Z("section-breakdown"),children:"Score breakdown"}),A&&t.jsx("button",{type:"button",className:"action-btn",onClick:()=>Z("section-improve"),children:"Improve score"}),A&&t.jsx("button",{type:"button",className:"action-btn",onClick:()=>Z("section-coach"),children:"Expert strategy"}),A&&t.jsx("button",{type:"button",className:"action-btn",onClick:()=>Z("section-category"),children:"Category draws"}),t.jsx("button",{type:"button",className:"action-btn",onClick:()=>Z("section-timeline"),children:"Timeline"}),t.jsx("button",{type:"button",className:"action-btn",onClick:()=>Z("section-draws"),children:"Recent draws"})]})]}),t.jsxs(k.div,{className:`card status-card ${Y.cls}-card`,variants:P,children:[t.jsxs("div",{className:"status-header",children:[t.jsx("span",{className:`status-marker ${Y.cls}`,children:Y.marker})," ",t.jsx("strong",{children:Y.title})]}),t.jsx("p",{className:"status-desc",children:Y.desc}),t.jsxs("div",{className:`draw-source-pill ${Je(s)}`,children:["Draw data source: ",Ve(s)," · Updated ",h.lastUpdated||"—"]}),t.jsxs("div",{className:"cutoff-compare",children:[t.jsx(Qe,{label:"Your Score",value:E,max:Math.max(E,O,600),color:"var(--primary)"}),t.jsx(Qe,{label:"Cut-off",value:O,max:Math.max(E,O,600),color:"var(--surface-3)"})]})]}),t.jsxs(k.div,{className:"card save-profile-card",variants:P,id:"section-save",children:[t.jsx("h3",{children:"Save your profile"}),t.jsx("p",{className:"cat-intro",children:"Save this result and optionally subscribe to draw alerts."}),u?t.jsxs("p",{className:"save-note",children:["Signed in as ",d.email,". Saves are synced across your devices."]}):t.jsx("p",{className:"save-note",children:"Tip: sign in to sync profiles and score tracking across devices."}),t.jsxs("div",{className:"save-grid",children:[t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Profile name (optional)"}),t.jsx("input",{type:"text",value:ee,onChange:l=>te(l.target.value),placeholder:"e.g., Feb 2026 Profile"})]}),t.jsxs("label",{className:"wi-field",children:[t.jsx("span",{children:"Email (optional)"}),t.jsx("input",{type:"email",value:H,onChange:l=>W(l.target.value),placeholder:"you@example.com"})]})]}),t.jsxs("label",{className:"save-alert-row",children:[t.jsx("input",{type:"checkbox",checked:T,onChange:l=>w(l.target.checked)}),t.jsx("span",{children:"Notify me by email when my score is at/above the latest cutoff"})]}),!oe&&t.jsx("p",{className:"save-note",children:"Cloud alerts need Supabase env vars (`VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`)."}),t.jsx("div",{className:"save-actions",children:t.jsx("button",{type:"button",className:"action-btn",onClick:kt,disabled:he,children:he?"Saving…":"Save Profile"})}),_&&t.jsx("p",{className:"save-status",children:_}),u&&t.jsxs("div",{className:"save-synced-list",children:[t.jsx("h4",{children:"Synced profiles"}),K==="loading"&&t.jsx("p",{className:"save-note",children:"Loading your synced profiles..."}),K==="error"&&t.jsx("p",{className:"save-note",children:"Could not load synced profiles right now."}),K!=="loading"&&Q.length===0&&t.jsx("p",{className:"save-note",children:"No synced profiles yet. Save your current result to start tracking."}),Q.length>0&&t.jsx("ul",{className:"save-synced-items",children:Q.slice(0,5).map(l=>t.jsxs("li",{children:[t.jsx("span",{children:l.name||l.id}),t.jsx("strong",{children:l.score})]},l.id))})]})]}),A&&t.jsxs(k.div,{className:"card",variants:P,id:"section-breakdown",children:[t.jsx("h3",{children:r("results.breakdown")}),t.jsx(k.div,{className:"breakdown-grid",variants:ze,initial:"hidden",animate:"show",children:V.map(l=>t.jsx(rn,{...l},l.label))}),t.jsxs("div",{className:"bd-total",children:[t.jsx("span",{children:"Total CRS Score"}),t.jsx("span",{className:"bd-total-num",children:E})]})]}),A&&t.jsxs(k.div,{className:"card whatif-card",variants:P,children:[t.jsx(ve,{id:"scenario-compare-panel",label:"Scenario Compare (A vs B)",open:I,onToggle:()=>de(!I)}),t.jsx(be,{initial:!1,children:I&&t.jsxs(k.div,{id:"scenario-compare-panel",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:o?{duration:0}:{duration:.2},children:[t.jsx("p",{className:"cat-intro",children:r("results.whatifDesc")}),t.jsx(dn,{answers:e,originalScore:E,t:r})]})})]}),c.length>0&&t.jsxs(k.div,{className:"card",variants:P,id:"section-improve",children:[t.jsx("h3",{children:r("results.improve")}),ye.map((l,S)=>t.jsxs(k.div,{className:"action-card",variants:P,children:[t.jsx("div",{className:"action-rank",children:S+1}),t.jsxs("div",{className:"action-body",children:[t.jsxs("div",{className:"action-title",children:[l.title,l.potentialGain>0&&t.jsxs("span",{className:"action-badge",children:["+",l.potentialGain," pts"]})]}),t.jsx("div",{className:"action-desc",children:l.description}),l.action&&t.jsx("div",{className:"action-specific",children:l.action}),t.jsxs("div",{className:"action-meta",children:[t.jsx("span",{className:"action-time",children:l.timeframe}),t.jsx("span",{className:`action-diff diff-${l.difficulty.toLowerCase()}`,children:l.difficulty})]})]})]},S)),ae.length>0&&t.jsxs(t.Fragment,{children:[C&&ae.map((l,S)=>t.jsxs(k.div,{className:"action-card",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[t.jsx("div",{className:"action-rank",children:S+4}),t.jsxs("div",{className:"action-body",children:[t.jsxs("div",{className:"action-title",children:[l.title,l.potentialGain>0&&t.jsxs("span",{className:"action-badge",children:["+",l.potentialGain," pts"]})]}),t.jsx("div",{className:"action-desc",children:l.description}),l.action&&t.jsx("div",{className:"action-specific",children:l.action}),t.jsxs("div",{className:"action-meta",children:[t.jsx("span",{className:"action-time",children:l.timeframe}),t.jsx("span",{className:`action-diff diff-${l.difficulty.toLowerCase()}`,children:l.difficulty})]})]})]},S+3)),t.jsx("button",{type:"button",className:"btn-toggle",onClick:()=>p(!C),children:C?"Show fewer ▲":`Show ${ae.length} more suggestions ▼`})]})]}),A&&t.jsx("div",{id:"section-coach",children:t.jsx(an,{answers:e,result:R,averageCutoff:h.averageCutoff,categoryInfo:m})}),A&&t.jsxs(k.div,{className:"card",variants:P,id:"section-category",children:[t.jsx("h3",{children:r("results.category")}),t.jsx("p",{className:"cat-intro",children:r("results.catIntro")}),t.jsx("div",{className:"cat-grid",children:m.map(l=>{const S=l.check(e),ce=S&&E>=l.recentCutoff;return t.jsxs(k.div,{className:`cat-card ${S?ce?"cat-above":"cat-eligible":"cat-na"}`,variants:P,children:[t.jsxs("div",{className:"cat-header",children:[t.jsx("span",{className:"cat-icon",children:l.icon}),t.jsxs("div",{children:[t.jsx("strong",{className:"cat-name",children:l.name}),S&&t.jsx("span",{className:`cat-badge ${ce?"badge-above":"badge-eligible"}`,children:ce?"Above Cutoff":"Eligible"}),!S&&t.jsx("span",{className:"cat-badge badge-na",children:"Not Eligible"})]})]}),t.jsx("p",{className:"cat-desc",children:l.description}),t.jsxs("div",{className:"cat-cutoff",children:[t.jsxs("span",{children:["Recent cutoff: ",t.jsx("strong",{children:l.recentCutoff})]}),t.jsxs("span",{className:"cat-range",children:["Range: ",l.cutoffRange]})]}),!S&&t.jsx("p",{className:"cat-req",children:l.eligibility})]},l.id)})})]}),A&&$e.length>0&&t.jsxs(k.div,{className:"card",variants:P,children:[t.jsx(ve,{id:"province-recommender-panel",label:"Province Recommender",open:M,onToggle:()=>ue(!M)}),t.jsx(be,{initial:!1,children:M&&t.jsxs(k.div,{id:"province-recommender-panel",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:o?{duration:0}:{duration:.2},children:[t.jsx("p",{className:"cat-intro",children:"Based on your profile, these provinces may be good matches for Provincial Nominee Programs."}),t.jsx("div",{className:"prov-grid",children:$e.slice(0,5).map(l=>t.jsxs("div",{className:"prov-card",children:[t.jsxs("div",{className:"prov-header",children:[t.jsx("span",{className:"prov-abbr",children:l.abbr}),t.jsxs("div",{children:[t.jsx("strong",{className:"prov-name",children:l.name}),t.jsxs("span",{className:`prov-match ${l.matchScore>=70?"match-high":l.matchScore>=40?"match-mid":"match-low"}`,children:[l.matchScore,"% match"]})]})]}),t.jsx("div",{className:"prov-bar-wrap",children:t.jsx(k.div,{className:"prov-bar",initial:{width:0},animate:{width:`${l.matchScore}%`},transition:o?{duration:0}:{duration:.8,ease:"easeOut"},style:{background:l.matchScore>=70?"#22c55e":l.matchScore>=40?"#f59e0b":"var(--surface-3)"}})}),t.jsx("p",{className:"prov-notes",children:l.notes})]},l.id))})]})})]}),t.jsxs(k.div,{className:"card",variants:P,id:"section-timeline",children:[t.jsx("h3",{children:r("results.timeline")}),t.jsxs("div",{className:`timeline-badge tl-${Y.cls}`,children:[t.jsx("strong",{children:x.label})," — est. ",x.months," months"]}),t.jsx("p",{className:"timeline-desc",children:x.description})]}),t.jsxs(k.div,{className:"card",variants:P,id:"section-draws",children:[t.jsx(ve,{id:"recent-draws-panel",label:r("results.draws"),open:j,onToggle:()=>L(!j)}),t.jsxs("div",{className:`draw-source-pill ${Je(s)}`,children:["Source: ",Ve(s)," · Updated ",h.lastUpdated||"—"]}),t.jsx(be,{initial:!1,children:j&&t.jsxs(k.div,{id:"recent-draws-panel",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:o?{duration:0}:{duration:.22},className:"draws-content",children:[t.jsx("h4",{className:"draws-subhead",children:"General / CEC Draws"}),h.generalProgram.slice(0,4).map((l,S)=>t.jsx(Se,{draw:l,userScore:E},`g${S}`)),t.jsx("h4",{className:"draws-subhead",children:"Category-Based Draws"}),h.categoryBased.slice(0,4).map((l,S)=>t.jsx(Se,{draw:l,userScore:E},`c${S}`)),!!h.pnpDraws?.length&&t.jsxs(t.Fragment,{children:[t.jsx("h4",{className:"draws-subhead",children:"Provincial Nominee (PNP)"}),h.pnpDraws.slice(0,3).map((l,S)=>t.jsx(Se,{draw:l,userScore:E},`p${S}`))]})]})})]}),xe&&t.jsxs(k.div,{className:"card",variants:P,children:[t.jsxs("h3",{children:[xe.name," Requirements"]}),t.jsx("ul",{className:"pathway-list",children:xe.requirements.map((l,S)=>t.jsx("li",{children:l},S))})]}),t.jsx(k.div,{className:"card disclaimer",variants:P,children:t.jsxs("p",{children:[t.jsx("strong",{children:"Disclaimer:"})," ",r("results.disclaimer")," ",t.jsx("a",{href:"https://www.canada.ca/en/immigration-refugees-citizenship.html",target:"_blank",rel:"noopener noreferrer",children:"canada.ca"})]})}),t.jsx(k.button,{type:"button",className:"btn-restart",onClick:a,whileHover:o?void 0:{scale:1.03},whileTap:o?void 0:{scale:.96},variants:P,children:r("results.restart")})]})}function Qe({label:e,value:a,max:n,color:s}){const i=Math.round(a/n*100);return t.jsxs("div",{className:"cutoff-row",children:[t.jsx("span",{className:"cutoff-label",children:e}),t.jsx("div",{className:"cutoff-bar-wrap",children:t.jsx(k.div,{className:"cutoff-bar",style:{background:s},initial:{width:0},animate:{width:`${i}%`},transition:{duration:.8,ease:"easeOut"},children:a})})]})}export{pn as default};
