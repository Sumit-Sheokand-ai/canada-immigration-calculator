import{c as vt,a as St,b as jt,d as Ct,e as Nt,f as wt,s as Tt,g as Pt,h as Mt,i as _t,j as Et,k as At,l as Lt,m as It,n as Dt,o as $t,p as Ft,q as Wt,r as Je,t as se,u as Bt,v as Qe,w as f,x as a,y as v,S as Rt,z as Ot,A as Gt,B as Ut,C as We,D as Yt,E as Ht,F as qt,G as zt,H as Kt,I as Vt,L as Jt}from"./index-DJq4dPUH.js";const j={tables:{agePoints:Ct,educationPoints:Nt,firstLangPoints:wt,secondLangPoints:Tt,canadianWorkPoints:Pt,spouseEducationPoints:Mt,spouseLangPoints:Ft,spouseWorkPoints:_t,eduRank:Et,eduLangTransfer:At,eduCWETransfer:Lt,fweLangTransfer:It,fweCWETransfer:Dt,certLangTransfer:Wt,additionalPointsTable:$t},converters:{ieltsToCLB:jt,tefToNCLC:vt,tcfToNCLC:St},caps:{secondLanguageNoSpouse:24,secondLanguageWithSpouse:22,spouseTotal:40,skillTransferabilityTotal:100,additionalPointsTotal:600,crsTotal:1200}},Xe=(e,t,n)=>Math.max(t,Math.min(n,e));function Qt(e){const t={...e},n=me(e)==="french"||e.hasFrench==="yes";if(n&&e.frenchTestType==="tef")for(const s of["listening","reading","writing","speaking"])t[`french_${s}`]=String(j.converters.tefToNCLC(s,parseInt(e[`tef_${s}`],10)||0));else if(n&&e.frenchTestType==="tcf")for(const s of["listening","reading","writing","speaking"])t[`french_${s}`]=String(j.converters.tcfToNCLC(s,parseInt(e[`tcf_${s}`],10)||0));return t}function me(e){return e.firstOfficialLanguage==="french"?"french":"english"}function Ne(e){return me(e)==="french"||e.hasFrench==="yes"}function pe(e){return e.hasSpouse==="yes"&&e.spouseIsCanadian!=="yes"&&e.spouseAccompanying!=="no"}const de=e=>pe(e)?1:0;function we(e,t){if(e.langTestType==="celpip")return Xe(parseInt(e[`celpip_${t}`],10)||0,0,12);const n=parseFloat(e[`ielts_${t}`])||0;return j.converters.ieltsToCLB(t,n)}function Te(e,t){return Xe(parseInt(e[`french_${t}`],10)||0,0,12)}function Ze(e,t){return me(e)==="french"?Te(e,t):we(e,t)}function fe(e){const t=["listening","reading","writing","speaking"];let n=99;for(const s of t){const i=Ze(e,s);i<n&&(n=i)}return n===99?0:n}function et(e){const t=["listening","reading","writing","speaking"];let n=99;for(const s of t){const i=we(e,s);i<n&&(n=i)}return n===99?0:n}function tt(e){if(!Ne(e))return 0;const t=["listening","reading","writing","speaking"];let n=99;for(const s of t){const i=Te(e,s);i<n&&(n=i)}return n===99?0:n}function Xt(e){const t=fe(e);return t>=9?2:t>=7?1:0}function Zt(e){const t=parseInt(e.canadianWorkExp)||0;return t>=2?2:t>=1?1:0}function ea(e){const t=parseInt(e.foreignWorkExp)||0;return t>=3?2:t>=1?1:0}function ta(e){let t=parseInt(e.age);return isNaN(t)?0:(t<18&&(t=17),t>47&&(t=47),t>44&&(t=45),j.tables.agePoints[t]?.[de(e)]||0)}function aa(e){return j.tables.educationPoints[e.education]?.[de(e)]||0}function na(e){const t=["listening","reading","writing","speaking"],n=de(e);return t.reduce((s,i)=>{const r=Ze(e,i);return s+(j.tables.firstLangPoints[r]?.[n]||0)},0)}function sa(e){const t=me(e);if(!(t==="french"?e.langTestType==="ielts"||e.langTestType==="celpip":Ne(e)))return 0;const s=["listening","reading","writing","speaking"],i=de(e),r=s.reduce((o,u)=>{const d=t==="french"?we(e,u):Te(e,u);return o+(j.tables.secondLangPoints[d]?.[i]||0)},0);return Math.min(r,i===0?j.caps.secondLanguageNoSpouse:j.caps.secondLanguageWithSpouse)}function ia(e){let t=parseInt(e.canadianWorkExp)||0;return t>5&&(t=5),j.tables.canadianWorkPoints[t]?.[de(e)]||0}function ra(e){if(!pe(e))return 0;let t=0;t+=j.tables.spouseEducationPoints[e.spouseEducation]||0;const n=["listening","reading","writing","speaking"];let s=0;for(const r of n){const o=parseInt(e[`spouseLang_${r}`])||0;s+=j.tables.spouseLangPoints[o]||0}t+=Math.min(s,20);let i=parseInt(e.spouseCanadianWork)||0;return i>5&&(i=5),t+=j.tables.spouseWorkPoints[i]||0,Math.min(t,j.caps.spouseTotal)}function oa(e){const t=j.tables.eduRank[e.education]||0,n=Xt(e),s=Zt(e),i=ea(e),r=j.tables.eduLangTransfer[t]?.[n]||0,o=j.tables.eduCWETransfer[t]?.[s]||0,u=Math.min(r+o,50),d=j.tables.fweLangTransfer[i]?.[n]||0,p=j.tables.fweCWETransfer[i]?.[s]||0,m=Math.min(d+p,50);let h=0;if(e.pathway==="fst"&&e.hasCertificate==="yes"){const x=fe(e);h=j.tables.certLangTransfer[x>=7?2:x>=5?1:0]}return Math.min(u+m+h,j.caps.skillTransferabilityTotal)}function ca(e){let t=0;const n=j.tables.additionalPointsTable;return e.hasPNP==="yes"&&(t+=n.pnp_nomination),e.canadianEducation==="yes"&&(t+=e.canadianEduType==="long"?n.canadian_edu_long:n.canadian_edu_short),e.hasSibling==="yes"&&(t+=n.sibling_in_canada),Ne(e)&&tt(e)>=7&&(t+=et(e)>=5?n.french_strong_strong_english:n.french_strong_weak_english),Math.min(t,j.caps.additionalPointsTotal)}function at(e){const t=Qt(e),n=ta(t),s=aa(t),i=na(t),r=sa(t),o=ia(t),u=parseInt(t.foreignWorkExp)||0,d=n+s+i+r+o,p=ra(t),m=oa(t),h=ca(t);return{total:Math.min(d+p+m+h,j.caps.crsTotal),breakdown:{coreHumanCapital:d,spouseFactors:p,skillTransferability:m,additionalPoints:h},details:{age:n,education:s,firstLanguage:i,secondLanguage:r,canadianWork:o,foreignWork:u,spouseTotal:p,skillTotal:m,additionalTotal:h}}}function Z(e,t){return at({...e,...t})}function z(e,t,n,s,i,r,o=""){return{title:e,description:t,potentialGain:n,difficulty:s,timeframe:i,icon:r,action:o}}function la(e,t){const n=[],s=fe(e),i=et(e),r=e.firstOfficialLanguage==="french"?"french":"english",o=r==="french"||e.hasFrench==="yes";if(s<10){const m=Math.min(s+1,10),h=["listening","reading","writing","speaking"];let x="First official language";const k={};if(r==="french"){x="French (NCLC)",k.hasFrench="yes",k.frenchTestType="clb";for(const C of h){const L=`french_${C}`,I=parseInt(e[L],10)||0;k[L]=String(Math.max(I,m))}}else{x=e.langTestType==="celpip"?"CELPIP":"IELTS";for(const C of h){const L=e.langTestType==="celpip"?`celpip_${C}`:`ielts_${C}`,I=e.langTestType==="celpip"?parseInt(e[L],10)||0:parseFloat(e[L])||0;e.langTestType==="celpip"?k[L]=Math.max(I,m):k[L]=Math.max(I,I+.5)}}const g=Z(e,k).total-t.total;g>0&&n.push(z(`Improve ${x} Scores`,`Raising your weakest ${x} skill to CLB ${m} could add significant points. Focus on your lowest band.`,g,"Medium","3-5 months","language",`Current min CLB ${s} → target CLB ${m} = +${g} CRS`))}const u=["less_than_secondary","secondary","one_year_post","two_year_post","bachelors","two_or_more","masters","doctoral"],d=u.indexOf(e.education);if(d>=0&&d<u.length-1){const m=u[d+1],x=Z(e,{education:m}).total-t.total;if(x>0){const k={secondary:"high school diploma",one_year_post:"1-year diploma",two_year_post:"2-year diploma",bachelors:"bachelor's degree",two_or_more:"two credentials",masters:"master's degree",doctoral:"doctoral degree"};n.push(z("Higher Education",`Completing a ${k[m]||"higher credential"} could boost your score.`,x,"Hard","1-4 years","education",`${e.education||"current level"} → ${m} = +${x} CRS`))}}const p=parseInt(e.canadianWorkExp)||0;if(p<5){const h=Z(e,{canadianWorkExp:String(p+1)}).total-t.total;h>0&&n.push(z("Gain Canadian Work Experience","An additional year of Canadian work experience adds points across multiple categories including skill transferability.",h,"Hard","8-12 months","work",`${p} year(s) → ${p+1} year(s) = +${h} CRS`))}if(o)tt(e)>=7&&t.total<520&&t.total>=370&&n.push(z("Target French-Language Category Draw",`With your French NCLC 7+ scores, you qualify for French-language category draws where recent cutoffs are around 400 — your score of ${t.total} may already be competitive!`,0,"Easy","Immediate","french",`Current score ${t.total} already fits many French-category cutoffs`));else{const x=Z(e,{hasFrench:"yes",french_listening:"7",french_reading:"7",french_writing:"7",french_speaking:"7"}).total-t.total;x>0&&n.push(z("Add French Test Results (TEF/TCF)",`Strong French skills (NCLC 7+) earn ${i>=5?"50":"25"} additional CRS points. Plus, French-language category draws have cutoffs around 400 — much lower than general draws (~520).`,x,"Hard","6-12 months","french",`Reach NCLC 7 in all 4 abilities = +${x} CRS`))}if(e.hasPNP!=="yes"&&n.push(z("Provincial Nominee Program","A PNP nomination adds 600 points, virtually guaranteeing an ITA. Explore programs in provinces like Ontario, BC, Alberta and Saskatchewan.",600,"Hard","2-8 months","province","PNP nomination = +600 CRS")),e.canadianEducation!=="yes"&&n.push(z("Study in Canada","A Canadian credential (1-2 year program) adds 15 points, or 30 points for a 3+ year program.",30,"Hard","12-36 months","study","Canadian credential can add +15 to +30 CRS")),e.hasSibling!=="yes"&&n.push(z("Sibling in Canada (If Applicable)","If you have a sibling who is a Canadian citizen or PR, this adds 15 points. Check if any siblings qualify.",15,"Easy","1-2 weeks","family","Eligible sibling relationship = +15 CRS")),pe(e)){const m=["listening","reading","writing","speaking"];let h=99;for(const x of m){const k=parseInt(e[`spouseLang_${x}`])||0;k<h&&(h=k)}if(h<9){const x=Math.min(h+1,9),k={};for(const C of m)k[`spouseLang_${C}`]=String(Math.max(parseInt(e[`spouseLang_${C}`])||0,x));const g=Z(e,k).total-t.total;g>0&&n.push(z("Improve Spouse's Language Scores",`Your spouse's language improvement to CLB ${x} could add points.`,g,"Medium","3-5 months","language",`Spouse min CLB ${h} → ${x} = +${g} CRS`))}}return n.sort((m,h)=>h.potentialGain-m.potentialGain),n}function da(e){const t=e.total;return t>=500?{label:"Very Strong",months:"1-3",description:"You are very likely to receive an ITA in the next few draws."}:t>=470?{label:"Strong",months:"3-6",description:"Your score is competitive. An ITA is likely within a few months."}:t>=440?{label:"Moderate",months:"6-12",description:"Your score is near recent cutoffs. Category-based draws may help."}:t>=400?{label:"Below Average",months:"12-18",description:"You may need to improve your profile or target a category-based draw."}:{label:"Needs Improvement",months:"18+",description:"Significant profile improvements are recommended before applying."}}const ua=[{id:"on",name:"Ontario",abbr:"ON",streams:["Human Capital Priorities","Skilled Trades","French-Speaking"],demandSectors:["stem","healthcare","trade"],minCLB:7,minEducation:"bachelors",minWorkYears:1,notes:"Largest province. Strong demand for tech, healthcare, and skilled trades. Ontario often sends NOIs to Express Entry candidates with CRS 400+."},{id:"bc",name:"British Columbia",abbr:"BC",streams:["Skills Immigration","Express Entry BC","Tech"],demandSectors:["stem","healthcare","trade"],minCLB:5,minEducation:"two_year_post",minWorkYears:1,notes:"Tech hub (Vancouver). BC PNP Tech targets 29 in-demand occupations including software, data, and engineering roles."},{id:"ab",name:"Alberta",abbr:"AB",streams:["Alberta Advantage Immigration","Express Entry Stream"],demandSectors:["trade","healthcare","stem","transport"],minCLB:5,minEducation:"secondary",minWorkYears:1,notes:"Strong energy/oil sector. Growing tech scene in Calgary and Edmonton. Lower cost of living than ON/BC."},{id:"sk",name:"Saskatchewan",abbr:"SK",streams:["International Skilled Worker","Express Entry"],demandSectors:["agriculture","healthcare","trade","transport"],minCLB:4,minEducation:"secondary",minWorkYears:1,notes:"In-Demand Occupations list is broad. One of the easiest PNPs to qualify for. Agriculture and mining are key industries."},{id:"mb",name:"Manitoba",abbr:"MB",streams:["Skilled Workers Overseas","Skilled Workers in Manitoba"],demandSectors:["healthcare","agriculture","trade","transport"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Welcoming to newcomers. Strong need for healthcare workers and tradespeople. Lower CRS requirements than federal draws."},{id:"ns",name:"Nova Scotia",abbr:"NS",streams:["Labour Market Priorities","Skilled Worker","Physician"],demandSectors:["healthcare","trade","stem"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Part of Atlantic Immigration Program. Growing tech sector in Halifax. Healthcare workers are highly sought after."},{id:"nb",name:"New Brunswick",abbr:"NB",streams:["Express Entry Labour Market","Skilled Workers with Employer Support"],demandSectors:["healthcare","trade","agriculture"],minCLB:5,minEducation:"secondary",minWorkYears:1,notes:"Bilingual province (English/French). Part of Atlantic Immigration Program. Francophone candidates get priority."},{id:"pe",name:"Prince Edward Island",abbr:"PE",streams:["Express Entry","Labour Impact"],demandSectors:["agriculture","healthcare","trade"],minCLB:5,minEducation:"two_year_post",minWorkYears:2,notes:"Small province with lower competition. Agriculture and tourism are key industries."},{id:"nl",name:"Newfoundland & Labrador",abbr:"NL",streams:["Express Entry","Skilled Worker","Priority Skills"],demandSectors:["healthcare","trade","stem"],minCLB:5,minEducation:"one_year_post",minWorkYears:1,notes:"Part of Atlantic Immigration Program. Growing need for healthcare and tech workers. Oil and gas sector."},{id:"yt",name:"Yukon",abbr:"YT",streams:["Yukon Express Entry","Skilled Worker"],demandSectors:["trade","healthcare","transport"],minCLB:4,minEducation:"secondary",minWorkYears:1,notes:"Territory with small population. Job offer typically required. Good for tradespeople and healthcare workers."}],Se={less_than_secondary:0,secondary:1,one_year_post:2,two_year_post:3,bachelors:4,two_or_more:5,masters:6,doctoral:7};function ha(e,t){return(Se[e]||0)>=(Se[t]||0)}function ma(e){const t=pa(e),n=e.education||"secondary",s=Math.max(parseInt(e.canadianWorkExp)||0,parseInt(e.foreignWorkExp)||0),i=e.occupationCategory||"other",r=e.hasFrench==="yes";return ua.map(o=>{let u=0;const d=100;t>=o.minCLB&&(u+=20,t>=o.minCLB+2&&(u+=10)),ha(n,o.minEducation)&&(u+=15,(Se[n]||0)>=4&&(u+=5)),s>=o.minWorkYears&&(u+=15,s>=3&&(u+=5)),o.demandSectors.includes(i)&&(u+=25),r&&(o.id==="nb"||o.id==="on")&&(u+=5);const p=Math.min(Math.round(u/d*100),100);return{...o,matchScore:p}}).sort((o,u)=>u.matchScore-o.matchScore)}function pa(e){if(e.langTestType==="celpip"){const n=["listening","reading","writing","speaking"].map(s=>parseInt(e[`celpip_${s}`])||0);return Math.min(...n)}if(e.langTestType==="ielts"){const n=["listening","reading","writing","speaking"].map(s=>{const i=parseFloat(e[`ielts_${s}`])||0;return i>=8?10:i>=7?9:i>=6.5?8:i>=6?7:i>=5.5?6:i>=5?5:i>=4?4:0});return Math.min(...n)}return 0}const be=["less_than_secondary","secondary","one_year_post","two_year_post","bachelors","two_or_more","masters","doctoral"],fa={Easy:14,Medium:7,Hard:0},nt={high:78,medium:58,low:35};function je(e,t,n){return Math.max(t,Math.min(n,e))}function ga(e,t=Je.averageCutoff){return Math.max(t+10,e+25)}function ya(e,t){return{listening:{7:6,8:7.5,9:8,10:8.5},reading:{7:6,8:6.5,9:7,10:8},writing:{7:6,8:6.5,9:7,10:7.5},speaking:{7:6,8:6.5,9:7,10:7.5}}[e]?.[t]||0}function xa(e,t){if(e.firstOfficialLanguage==="french"){const s=["listening","reading","writing","speaking"],i={hasFrench:"yes",frenchTestType:"clb"};for(const r of s){const o=`french_${r}`;i[o]=String(Math.max(parseInt(e[o],10)||0,t))}return i}const n=["listening","reading","writing","speaking"];if(e.langTestType==="celpip"){const s={};for(const i of n){const r=`celpip_${i}`;s[r]=String(Math.max(parseInt(e[r],10)||0,t))}return s}if(e.langTestType==="ielts"){const s={};for(const i of n){const r=`ielts_${i}`,o=ya(i,t);s[r]=String(Math.max(parseFloat(e[r])||0,o))}return s}return{langTestType:"celpip",celpip_listening:String(t),celpip_reading:String(t),celpip_writing:String(t),celpip_speaking:String(t)}}function ba(e,t=7){const n={listening:parseInt(e.french_listening,10)||0,reading:parseInt(e.french_reading,10)||0,writing:parseInt(e.french_writing,10)||0,speaking:parseInt(e.french_speaking,10)||0};return{hasFrench:"yes",frenchTestType:"clb",french_listening:String(Math.max(n.listening,t)),french_reading:String(Math.max(n.reading,t)),french_writing:String(Math.max(n.writing,t)),french_speaking:String(Math.max(n.speaking,t))}}function ka({pathId:e,gain:t,months:n,steps:s}){return s.map((i,r)=>({id:`${e}-m${r+1}`,title:i.title,details:i.details,etaWeeks:i.etaWeeks,expectedGain:r===s.length-1?Math.max(t-s.slice(0,-1).reduce((o,u)=>o+u.expectedGain,0),0):i.expectedGain,done:!1,monthHint:je(Math.ceil((i.etaWeeks||1)/4),1,n)}))}function st({gain:e,months:t,difficulty:n,goalReached:s,likelihood:i}){const r=je(24-t*2,0,24),o=je(Math.round(e/4),0,80),u=s?32:0,d=Math.round((nt[i]||0)/3);return o+r+u+d+(fa[n]||0)}function re({id:e,title:t,summary:n,category:s,difficulty:i,months:r,estimatedCostCad:o,whyItFits:u,likelihood:d="medium",overrides:p,currentScore:m,targetScore:h,milestoneSteps:x}){const k=Z(p.baseAnswers,p.patch),y=k.total-m;if(y<=0)return null;const g=k.total>=h,C=ka({pathId:e,gain:y,months:r,steps:x});return{id:e,title:t,summary:n,category:s,difficulty:i,estimatedMonths:r,estimatedCostCad:o,projectedScore:k.total,potentialGain:y,goalReached:g,whyItFits:u,likelihood:d,likelihoodPercent:nt[d]||50,fitScore:st({gain:y,months:r,difficulty:i,goalReached:g,likelihood:d}),milestones:C,checks:{targetScore:h,currentScore:m,stillNeededAfterPath:Math.max(h-k.total,0)}}}function va(e,t,n){const s=fe(e);if(s>=10)return null;const i=s<7?8:9,r=e.firstOfficialLanguage==="french"?"french":"english",o=r==="french"?"French Accelerator Path":"English Accelerator Path",u=r==="french"?"Raise your weakest French ability first, then target NCLC 9+ for stronger transferability outcomes.":"Raise your weakest English ability first, then target CLB 9+ for transferability gains.";return re({id:`${r}-accelerator`,title:o,summary:u,category:"Language",difficulty:"Medium",months:4,estimatedCostCad:460,whyItFits:`Your current minimum first-official-language level is CLB/NCLC ${s}, so language gains are one of the fastest realistic boosters.`,likelihood:"high",overrides:{baseAnswers:e,patch:xa(e,i)},currentScore:t,targetScore:n,milestoneSteps:[{title:"Baseline audit and weak-skill diagnosis",details:"Run a mock test and identify the lowest 2 abilities to prioritize.",etaWeeks:1,expectedGain:0},{title:"Targeted study sprint",details:"Follow a 5-day weekly schedule focused on weakest modules and timed drills.",etaWeeks:6,expectedGain:8},{title:"Exam booking + strategy correction",details:"Book IELTS/CELPIP and fine-tune pacing, vocabulary, and response format.",etaWeeks:4,expectedGain:8},{title:"Retake and profile refresh",details:"Update final language scores in your profile and reassess draw competitiveness.",etaWeeks:4,expectedGain:12}]})}function Sa(e,t,n){return e.firstOfficialLanguage==="french"?null:re({id:"french-advantage",title:"French Advantage Path",summary:"Reach NCLC 7 in all French abilities to unlock additional points and French-category draw access.",category:"Language",difficulty:"Hard",months:8,estimatedCostCad:690,whyItFits:"French pathways remain one of the highest-yield options for many candidates below general cutoffs.",likelihood:e.hasFrench==="yes"?"high":"medium",overrides:{baseAnswers:e,patch:ba(e,7)},currentScore:t,targetScore:n,milestoneSteps:[{title:"French baseline + study plan",details:"Assess current level and choose a structured curriculum for NCLC 7 goal.",etaWeeks:2,expectedGain:0},{title:"Core skill build phase",details:"Intensive reading/listening practice with weekly speaking/writing correction.",etaWeeks:12,expectedGain:8},{title:"TEF/TCF prep and mock cycles",details:"Complete timed mocks and focus weak modules before exam booking.",etaWeeks:8,expectedGain:8},{title:"Exam and score integration",details:"Enter verified NCLC scores and evaluate French-category competitiveness.",etaWeeks:6,expectedGain:12}]})}function ja(e,t,n){const s=parseInt(e.canadianWorkExp,10)||0;return s>=5?null:re({id:"canadian-work-ladder",title:"Canadian Work Ladder Path",summary:"Add one more year of Canadian skilled work to increase core and transferability points.",category:"Work Experience",difficulty:"Hard",months:12,estimatedCostCad:0,whyItFits:`You currently report ${s} year(s) of Canadian work; the next year can materially lift your score.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{canadianWorkExp:String(s+1)}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Employer alignment",details:"Confirm TEER eligibility and maintain full-time skilled role continuity.",etaWeeks:2,expectedGain:0},{title:"Documentation discipline",details:"Collect monthly pay records and letters for future proof of experience.",etaWeeks:16,expectedGain:4},{title:"Mid-year score checkpoint",details:"Recalculate progress and combine with language upgrades if needed.",etaWeeks:24,expectedGain:6},{title:"Complete one full year increment",details:"Update profile immediately when additional year is met.",etaWeeks:52,expectedGain:12}]})}function Ca(e,t,n){const s=be.indexOf(e.education);if(s<0||s>=be.length-1)return null;const i=be[s+1];return re({id:"education-upgrade",title:"Education Upgrade Path",summary:"Move to the next recognized credential tier for predictable CRS uplift.",category:"Education",difficulty:"Hard",months:18,estimatedCostCad:12e3,whyItFits:`Your current education level can be improved to ${i.replace(/_/g," ")} for additional points.`,likelihood:"medium",overrides:{baseAnswers:e,patch:{education:i}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Program selection",details:"Choose an accredited credential path aligned to CRS point tiers.",etaWeeks:4,expectedGain:0},{title:"Enrollment and milestone completion",details:"Track term-level progress to keep the plan on schedule.",etaWeeks:20,expectedGain:4},{title:"Credential completion prep",details:"Prepare final documents and ECA requirements where needed.",etaWeeks:20,expectedGain:4},{title:"Credential update in profile",details:"Add completed credential and recalculate total score immediately.",etaWeeks:28,expectedGain:10}]})}function Na(e,t,n){if(!pe(e))return null;const s=["listening","reading","writing","speaking"],i={};for(const r of s){const o=`spouseLang_${r}`;i[o]=String(Math.max(parseInt(e[o],10)||0,9))}return re({id:"spouse-optimization",title:"Spouse Optimization Path",summary:"Use spouse language and experience factors for faster low-cost point improvements.",category:"Family Factors",difficulty:"Medium",months:5,estimatedCostCad:420,whyItFits:"You have an accompanying spouse, so spouse-factor optimization is available and often underused.",likelihood:"high",overrides:{baseAnswers:e,patch:i},currentScore:t,targetScore:n,milestoneSteps:[{title:"Spouse baseline review",details:"Identify spouse factors currently missing points.",etaWeeks:1,expectedGain:0},{title:"Spouse language prep",details:"Prepare specifically for CLB 9 in the weakest spouse abilities.",etaWeeks:8,expectedGain:4},{title:"Spouse profile integration",details:"Update spouse test scores and re-optimize joint profile configuration.",etaWeeks:6,expectedGain:8}]})}function wa(e,t,n){return e.hasPNP==="yes"?null:re({id:"pnp-fast-track",title:"PNP Fast-Track Path",summary:"Pursue provincial nomination for the largest single CRS jump (+600).",category:"Provincial",difficulty:"Hard",months:6,estimatedCostCad:2200,whyItFits:"If your baseline is below recent cutoffs, PNP remains the most direct guaranteed-lift route.",likelihood:"medium",overrides:{baseAnswers:e,patch:{hasPNP:"yes"}},currentScore:t,targetScore:n,milestoneSteps:[{title:"Province shortlist",details:"Match your profile to provinces aligned with occupation/language strengths.",etaWeeks:2,expectedGain:0},{title:"Document stack preparation",details:"Prepare references, test proofs, ECA, and provincial forms early.",etaWeeks:6,expectedGain:0},{title:"Submit nomination stream",details:"Apply to selected stream and monitor NOI/application updates.",etaWeeks:8,expectedGain:0},{title:"Nomination linked to profile",details:"Accept nomination and refresh profile for major score jump.",etaWeeks:8,expectedGain:600}]})}function Ta(e,t){const n=[...e].sort((d,p)=>p.fitScore-d.fitScore);if(n.length<2)return null;const[s,i]=n,r=Math.min(s.projectedScore+i.potentialGain,1200),o=r-s.checks.currentScore;if(o<=0)return null;const u=r>=t;return{id:"combo-bridge-plan",title:"Bridge Combination Path",summary:`Combine “${s.title}” + “${i.title}” to maximize speed while limiting risk.`,category:"Combination",difficulty:s.difficulty==="Hard"||i.difficulty==="Hard"?"Hard":"Medium",estimatedMonths:Math.round((s.estimatedMonths+i.estimatedMonths)/2),estimatedCostCad:s.estimatedCostCad+i.estimatedCostCad,projectedScore:r,potentialGain:o,goalReached:u,whyItFits:"A blended route often reaches target faster than single-track attempts.",likelihood:"medium",likelihoodPercent:62,fitScore:st({gain:o,months:Math.round((s.estimatedMonths+i.estimatedMonths)/2),difficulty:s.difficulty==="Hard"||i.difficulty==="Hard"?"Hard":"Medium",goalReached:u,likelihood:"medium"}),milestones:[...s.milestones.slice(0,2).map(d=>({...d,id:`combo-${d.id}`})),...i.milestones.slice(0,2).map(d=>({...d,id:`combo-${d.id}`})),{id:"combo-final-sync",title:"Final score synchronization",details:"Update all achieved improvements together and reassess draw strategy.",etaWeeks:4,expectedGain:Math.max(o-16,0),done:!1,monthHint:2}],checks:{targetScore:t,currentScore:s.checks.currentScore,stillNeededAfterPath:Math.max(t-r,0)}}}function Pa(e,t,n={}){const s=t?.total||0,i=Number(n.averageCutoff)||Je.averageCutoff,r=Number(n.targetScore)||ga(s,i),o=[va(e,s,r),Sa(e,s,r),ja(e,s,r),Ca(e,s,r),Na(e,s,r),wa(e,s,r)].filter(Boolean),u=Ta(o,r);u&&o.push(u);const d=o.sort((p,m)=>m.fitScore-p.fitScore).slice(0,5);return{currentScore:s,targetScore:r,plans:d,generatedAt:new Date().toISOString()}}const it="crs-path-tracking-v1",Be=540,rt=55,Ma=30,_a=25;function ot(e,t,n){return Math.max(t,Math.min(n,e))}function ct(){return typeof localStorage<"u"}function D(e=new Date){const t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)}function lt(e){return new Date(`${e}T00:00:00.000Z`)}function Pe(e,t){const n=new Date(e||Date.now());return n.setDate(n.getDate()+t),n.toISOString()}function ie(e,t){const n=lt(e);return n.setUTCDate(n.getUTCDate()+t),D(n)}function Me(){if(!ct())return{};try{const e=localStorage.getItem(it);if(!e)return{};const t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch{return{}}}function dt(e){if(ct())try{localStorage.setItem(it,JSON.stringify(e))}catch{}}function _e(e,t){if(!e||typeof e!="object")return null;const n=Math.max(1,Number(e.etaWeeks)||1);return{...e,id:e.id||`m_${t+1}`,title:e.title||`Milestone ${t+1}`,details:e.details||"",etaWeeks:n,expectedGain:Number.isFinite(Number(e.expectedGain))?Number(e.expectedGain):0,done:!!e.done,completedAt:e.completedAt||null}}function ut(e,t){if(!e||typeof e!="object")return null;const n=D(e.date||e.dateKey||e.scheduledFor);return n?{id:e.id||`d_${t+1}`,date:n,milestoneId:e.milestoneId||null,title:String(e.title||"Daily action").trim(),details:String(e.details||"").trim(),expectedMinutes:Math.max(10,Number(e.expectedMinutes)||rt),expectedGain:Number.isFinite(Number(e.expectedGain))?Number(e.expectedGain):0,done:!!e.done,completedAt:e.completedAt||null}:null}function ht(e,t){const n=(e?.milestones||[]).map((o,u)=>_e(o,u)).filter(Boolean);if(!n.length)return[];const s=D(t||new Date);if(!s)return[];const i=[];let r=0;for(const o of n){const u=ot(Math.round((Number(o.etaWeeks)||1)*7),7,224),d=u>0?Number(((Number(o.expectedGain)||0)/u).toFixed(2)):0;for(let p=0;p<u&&i.length<Be;p++){const m=ie(s,r+p),h=lt(m).getUTCDay(),x=h===0||h===6,k=p===0;let y=`Focused practice: ${o.title}`,g=o.details||"Work toward this milestone today.",C=x?Ma:rt;k?(y=`Kickoff plan: ${o.title}`,g=`Set tasks and resources for this phase. ${o.details||""}`.trim(),C=_a):x&&(y=`Weekly review: ${o.title}`,g=`Light revision + progress check. ${o.details||""}`.trim()),i.push({id:`${e?.id||"path"}-d${i.length+1}`,date:m,milestoneId:o.id,title:y,details:g,expectedMinutes:C,expectedGain:d,done:!1,completedAt:null})}if(r+=u,i.length>=Be)break}return i}function mt(e){if(!e||typeof e!="object")return null;const t=e.startedAt||new Date().toISOString(),n=(e.milestones||[]).map((r,o)=>_e(r,o)).filter(Boolean),s=(e.dailyTasks||[]).map((r,o)=>ut(r,o)).filter(Boolean),i=s.length>0?s:ht(e.selectedPath,t);return{...e,id:e.id||`track_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`,status:e.status||"active",startedAt:t,updatedAt:e.updatedAt||t,nextCheckInAt:e.nextCheckInAt||Pe(t,7),currentScore:Number(e.currentScore)||0,targetScore:Number(e.targetScore)||Number(e?.selectedPath?.checks?.targetScore)||0,selectedPath:e.selectedPath||null,milestones:n,dailyTasks:i,notes:Array.isArray(e.notes)?e.notes:[],dailyStats:e.dailyStats||null}}function J(e,{touchUpdatedAt:t=!0}={}){const n=mt(e);if(!n)return null;const s=pt(n),i=ge(n),r=n.milestones.length>0&&n.milestones.every(d=>d.done),o=n.dailyTasks.length===0||n.dailyTasks.every(d=>d.done);return{...n,status:r&&o?"completed":"active",progressPct:s,dailyStats:i,updatedAt:t?new Date().toISOString():n.updatedAt}}function Ea(e=null,t=null){return e?`user:${e}`:t?`profile:${t}`:"guest:default"}function Re(e){if(!e)return null;const t=Me();return J(t[e],{touchUpdatedAt:!1})}function Oe(e,t){if(!e||!t)return t;const n=Me(),s=J(t,{touchUpdatedAt:!1});return n[e]=s,dt(n),s}function Aa(e){if(!e)return;const t=Me();delete t[e],dt(t)}function La(e,t,n){const s=new Date().toISOString(),i=(e?.milestones||[]).map((o,u)=>_e({...o,done:!1,completedAt:null},u)).filter(Boolean),r=ht(e,s);return J({id:`track_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`,status:"active",startedAt:s,updatedAt:s,nextCheckInAt:Pe(s,7),currentScore:Number(t)||0,targetScore:Number(n)||Number(e?.checks?.targetScore)||0,selectedPath:e,milestones:i,dailyTasks:r,notes:[]},{touchUpdatedAt:!0})}function pt(e){const t=e?.milestones||[],n=e?.dailyTasks||[],s=t.length?t.filter(r=>r.done).length/t.length:0,i=n.length?n.filter(r=>r.done).length/n.length:0;return!t.length&&!n.length?0:n.length?t.length?Math.round((s*.65+i*.35)*100):Math.round(i*100):Math.round(s*100)}function ge(e){const t=(e?.dailyTasks||[]).map((g,C)=>ut(g,C)).filter(Boolean).sort((g,C)=>g.date.localeCompare(C.date)),n=D(new Date);if(!t.length)return{totalTasks:0,completedTasks:0,completionPct:0,dueToday:0,completedToday:0,overdueTasks:0,expectedByToday:0,completedByToday:0,paceStatus:"not-started",streakDays:0,todayKey:n};const s=t.length,i=t.filter(g=>g.done).length,r=t.filter(g=>g.date===n).length,o=t.filter(g=>g.date===n&&g.done).length,u=t.filter(g=>g.date<=n).length,d=t.filter(g=>g.date<=n&&g.done).length,p=t.filter(g=>g.date<n&&!g.done).length,m=Math.round(i/s*100);let h="not-started";if(u>0){const g=d/u;g>=1?h="on-track":g>=.75?h="slightly-behind":h="behind"}const x=new Set(t.filter(g=>g.done).map(g=>D(g.completedAt||g.date)).filter(Boolean));let k=n;!x.has(k)&&r===0&&(k=ie(n,-1));let y=0;for(;x.has(k);)y+=1,k=ie(k,-1);return{totalTasks:s,completedTasks:i,completionPct:m,dueToday:r,completedToday:o,overdueTasks:p,expectedByToday:u,completedByToday:d,paceStatus:h,streakDays:y,todayKey:n}}function Ia(e,t=D(new Date)){return(e?.dailyTasks||[]).filter(s=>D(s.date)===t)}function Da(e,t=7,n=D(new Date)){const s=ie(n,Math.max(t-1,0));return(e?.dailyTasks||[]).filter(i=>{const r=D(i.date);return r>=n&&r<=s})}function $a(e){const t=mt(e);if(!t||!t.dailyTasks.length)return null;const n=ge(t),s=t.dailyTasks.length,i=t.dailyTasks[0]?.date||D(t.startedAt),r=s,o=n.expectedByToday>0?n.completedByToday/n.expectedByToday:1,u=ot(o||1,.45,1.35),d=Math.max(1,Math.round(s/u)),p=ie(i,r-1),m=ie(i,d-1);return{baselineDate:p,projectedDate:m,paceMultiplier:u,baselineDays:r,projectedDays:d,delayDays:d-r}}function Fa(e,t){if(!e)return e;const n=(e.milestones||[]).map(s=>{if(s.id!==t)return s;const i=!s.done;return{...s,done:i,completedAt:i?new Date().toISOString():null}});return J({...e,milestones:n},{touchUpdatedAt:!0})}function Wa(e,t){if(!e)return e;const n=(e.dailyTasks||[]).map(s=>{if(s.id!==t)return s;const i=!s.done;return{...s,done:i,completedAt:i?new Date().toISOString():null}});return J({...e,dailyTasks:n},{touchUpdatedAt:!0})}function Ba(e,t){return e&&J({...e,currentScore:Number(t)||0},{touchUpdatedAt:!0})}function Ra(e,t=7){if(!e)return e;const n=e.nextCheckInAt||new Date().toISOString();return J({...e,nextCheckInAt:Pe(n,t)},{touchUpdatedAt:!0})}function Oa(e,t){if(!e||!t?.trim())return e;const n=[...e.notes||[],{id:`note_${Date.now().toString(36)}`,text:t.trim(),createdAt:new Date().toISOString()}];return J({...e,notes:n},{touchUpdatedAt:!0})}function Ga(e){if(!e)return"Choose an expert path to get a daily action plan.";if(e.status==="completed")return"Great progress — this path is complete. Recalculate and choose your next upgrade target.";const t=ge(e),n=D(new Date),s=(e.dailyTasks||[]).find(r=>r.date===n&&!r.done);if(t.overdueTasks>0)return`You have ${t.overdueTasks} overdue daily task(s). Clear one overdue task before adding new work.`;if(s)return`Today’s focus: ${s.title} (~${s.expectedMinutes} min).`;const i=(e.milestones||[]).find(r=>!r.done);return i?`Next milestone: ${i.title}. Keep your streak alive with one focused task today.`:"You are close to completion — finish remaining daily actions and refresh your score."}function Ee(e,t){const n=String(e?.message||"");return new RegExp(`relation\\s+["']?public\\.${t}["']?\\s+does not exist`,"i").test(n)||new RegExp(`table\\s+["']?${t}["']?\\s+not found`,"i").test(n)}function Ae(e,t){return new Error(`${e}: ${t?.message||t?.hint||String(t)}`)}function Ce(){return new Date().toISOString()}function Le(){return Bt&&!!se}function Ua(e){if(!e)return!1;const t=new Set(["active","trialing","paid"]),n=String(e.status||"").toLowerCase();if(!t.has(n))return!1;if(!e.current_period_end)return!0;const s=new Date(e.current_period_end).getTime();return Number.isFinite(s)&&s>Date.now()}async function Ge(e){if(!e)return{status:"skipped",reason:"Missing user id",active:!1};if(!Le())return{status:"skipped",reason:"Supabase env vars are not configured",active:!1};const{data:t,error:n}=await se.from("user_tracking_access").select("*").eq("user_id",e).limit(1);if(n&&Ee(n,"user_tracking_access"))return{status:"skipped",reason:"Tracking access table missing. Run the latest supabase/schema.sql.",active:!1};if(n)throw Ae("Failed to fetch tracking access",n);const s=t?.[0]||null;return{status:"ok",row:s,active:Ua(s)}}async function Ya(e,t){if(!e||!t)return{status:"skipped",reason:"Missing user id or tracking payload"};if(!Le())return{status:"skipped",reason:"Supabase env vars are not configured"};const n={id:t.id,user_id:e,path_id:t.selectedPath?.id||null,target_score:Number(t.targetScore)||0,start_score:Number(t.selectedPath?.checks?.currentScore)||0,current_score:Number(t.currentScore)||0,status:t.status||"active",progress_pct:Number.isFinite(t.progressPct)?t.progressPct:0,next_check_in_at:t.nextCheckInAt||null,milestones_json:t.milestones||[],daily_tasks_json:t.dailyTasks||[],plan_json:t.selectedPath||{},notes_json:t.notes||[],updated_at:Ce()},{data:s,error:i}=await se.from("user_path_tracking").upsert(n,{onConflict:"id"}).select();if(i&&Ee(i,"user_path_tracking"))return{status:"skipped",reason:"Path tracking table missing. Run the latest supabase/schema.sql."};if(i)throw Ae("Failed to save path tracking",i);return{status:"ok",data:s?.[0]||null}}async function Ha(e){if(!e)return{status:"skipped",reason:"Missing user id"};if(!Le())return{status:"skipped",reason:"Supabase env vars are not configured"};const{data:t,error:n}=await se.from("user_path_tracking").select("*").eq("user_id",e).order("updated_at",{ascending:!1}).limit(1);if(n&&Ee(n,"user_path_tracking"))return{status:"skipped",reason:"Path tracking table missing. Run the latest supabase/schema.sql.",data:null};if(n)throw Ae("Failed to load path tracking",n);const s=t?.[0]||null;return s?{status:"ok",data:{id:s.id,status:s.status||"active",startedAt:s.created_at||Ce(),updatedAt:s.updated_at||Ce(),nextCheckInAt:s.next_check_in_at||null,currentScore:s.current_score||0,targetScore:s.target_score||0,selectedPath:s.plan_json||null,milestones:Array.isArray(s.milestones_json)?s.milestones_json:[],dailyTasks:Array.isArray(s.daily_tasks_json)?s.daily_tasks_json:[],notes:Array.isArray(s.notes_json)?s.notes_json:[]}}:{status:"ok",data:null}}function ne(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleDateString()}function qa(e){const t=String(e||"").toLowerCase();return t==="easy"?"path-diff-easy":t==="hard"?"path-diff-hard":"path-diff-medium"}function Ue(e,t,n){return Math.max(t,Math.min(n,e))}function Ye(e,t){const n=new Date(e||Date.now());return n.setMonth(n.getMonth()+t),n.toISOString()}function za(e){const t=Number(e)||0;return Number.isInteger(t)?String(t):t.toFixed(1)}function Ka(e){return{"on-track":"On track","slightly-behind":"Slightly behind",behind:"Behind schedule","not-started":"Not started"}[String(e||"")]||"In progress"}function Va(e){return e?e.delayDays>0?`${e.delayDays} day(s) behind baseline`:e.delayDays<0?`${Math.abs(e.delayDays)} day(s) ahead of baseline`:"On baseline timeline":""}async function Ja(e){if(!e)return"";const t=[];e.message&&t.push(String(e.message));const n=e.context;if(!n||typeof n.clone!="function")return t.join(" · ").trim();try{const s=n.clone();if((s.headers?.get?.("content-type")||"").includes("application/json")){const r=await s.json(),o=[r?.message,r?.error,r?.details].filter(Boolean).map(u=>String(u));o.length&&t.push(...o)}else{const r=await s.text();r&&t.push(r)}}catch{}return[...new Set(t)].join(" · ").trim()}function Qa({answers:e,result:t,averageCutoff:n,categoryInfo:s}){const i=Number(t?.total)||0,r=Math.max(Number(n)||520,i+25),o=(s||[]).filter(p=>typeof p?.check=="function"&&p.check(e)).map(p=>Number(p.recentCutoff)).filter(p=>Number.isFinite(p)&&p>0);if(o.length===0)return Ue(r+10,300,1200);const u=Math.min(...o),d=Math.max(u+5,i+5);return Ue(Math.min(r+10,d),300,1200)}function Xa({answers:e,result:t,averageCutoff:n,categoryInfo:s=[]}){const{user:i,isAuthenticated:r}=Qe(),o=void 0,u=f.useMemo(()=>Qa({answers:e,result:t,averageCutoff:n,categoryInfo:s}),[e,t,n,s]),[d,p]=f.useState(()=>Math.max((t?.total||0)+25,500)),[m,h]=f.useState(!1),[x,k]=f.useState(""),[y,g]=f.useState(null),[C,L]=f.useState(""),[I,_]=f.useState(""),[ue,oe]=f.useState(!1),[Q,X]=f.useState({loading:!1,active:!1,reason:""}),$=f.useMemo(()=>Ea(i?.id||null,null),[i?.id]),E=f.useMemo(()=>Pa(e,t,{targetScore:d,averageCutoff:n}),[e,t,d,n]),N=f.useMemo(()=>E.plans.find(l=>l.id===x)||E.plans[0]||null,[E.plans,x]),A=r&&Q.active,ce=pt(y),K=Ga(y),F=f.useMemo(()=>ge(y),[y]),ee=f.useMemo(()=>Ia(y),[y]),O=f.useMemo(()=>Da(y,7),[y]),te=f.useMemo(()=>$a(y),[y]),G=f.useMemo(()=>{if(!N)return null;const l=y?.startedAt||new Date().toISOString(),b=N.difficulty==="Easy"?1:N.difficulty==="Hard"?3:2,w=Math.max(N.estimatedMonths-b,1),R=N.estimatedMonths+b+(N.goalReached?0:1);return{earliestMonths:w,latestMonths:R,earliestDate:Ye(l,w),latestDate:Ye(l,R)}},[N,y?.startedAt]);f.useEffect(()=>{h(!1)},[t?.total]),f.useEffect(()=>{m||p(u)},[u,m]),f.useEffect(()=>{if(!E.plans.length){k("");return}E.plans.some(b=>b.id===x)||k(E.plans[0].id)},[E.plans,x]),f.useEffect(()=>{let l=!0;return queueMicrotask(()=>{if(!l)return;const b=Re($);if(b){const w={...b,currentScore:Number(t?.total)||0};g(w)}else g(null)}),()=>{l=!1}},[t?.total,$]),f.useEffect(()=>{if(!r||!i?.id)return;let l=!0;return Ge(i.id).then(b=>{l&&X({loading:!1,active:!!b.active,reason:b.reason||""})}).catch(b=>{l&&X({loading:!1,active:!1,reason:b.message||"Could not verify tracking access."})}),()=>{l=!1}},[r,i?.id]),f.useEffect(()=>{if(!r||!i?.id)return;let l=!0;return Ha(i.id).then(b=>{if(!l||b.status!=="ok"||!b.data)return;const w=Re($),R=new Date(b.data.updatedAt||0).getTime(),M=new Date(w?.updatedAt||0).getTime();if(!w||R>M){const he={...b.data,currentScore:Number(t?.total)||0};Oe($,he),g(he)}}).catch(()=>{}),()=>{l=!1}},[r,t?.total,$,i?.id]);const W=async l=>{const b=Ba(l,t.total),w=Oe($,b);if(g(w),r&&A&&i?.id)try{await Ya(i.id,w)}catch{}return w},le=async()=>{if(!N)return;if(!A){_("Tracking is available on the 5 CAD/month plan.");return}const l=La(N,t.total,d);await W(l),_("Expert path started. Complete today's tasks to build momentum.")},V=async l=>{if(!y||!A)return;const b=Fa(y,l);await W(b),_("Milestone progress updated.")},U=async l=>{if(!y||!A)return;const b=Wa(y,l);await W(b),_("Daily task updated.")},Y=async()=>{if(!y||!A)return;const l=Ra(y,7);await W(l),_("Next check-in moved by 7 days.")},P=async()=>{if(!y||!A)return;const l=C.trim();if(!l)return;const b=Oa(y,l);await W(b),L(""),_("Coach note saved.")},B=()=>{Aa($),g(null),_("Tracking reset. Choose another expert path.")},H=async()=>{if(!r||!i?.id){_("Please log in before subscribing.");return}oe(!0),_("");try{if(!se)throw new Error("Supabase client is not configured.");const{data:l,error:b}=await se.functions.invoke("create-tracking-checkout",{body:{source:"path-coach"}});if(b){const R=await Ja(b);throw new Error(R||"Could not create checkout session.")}const w=l?.url;if(!w)throw new Error("Checkout function returned no URL.");window.location.href=w,_("Opening secure checkout...")}catch(l){const b=String(l?.message||""),w=/non-2xx status code/i.test(b);_(w?'Checkout backend is returning an error. Deploy/fix the Supabase "create-tracking-checkout" function and Stripe secrets, or set VITE_STRIPE_TRACKING_CHECKOUT_URL fallback.':b||"Could not start subscription checkout.")}finally{oe(!1)}};return a.jsxs(v.div,{className:"card path-coach-card",initial:{opacity:0,y:18},animate:{opacity:1,y:0},children:[a.jsxs("div",{className:"path-coach-head",children:[a.jsx("h3",{children:"Expert Strategy Coach"}),a.jsx("span",{className:"path-pill",children:"Phase 2"})]}),a.jsx("p",{className:"cat-intro",children:"Pick the strategy that fits you best, then follow a guided daily plan to close your CRS gap faster."}),a.jsxs("div",{className:"path-target-row",children:[a.jsxs("label",{className:"wi-field",children:[a.jsx("span",{children:"Target score"}),a.jsx("input",{type:"number",min:"300",max:"1200",value:d,onChange:l=>{h(!0),p(Number(l.target.value)||E.targetScore)}})]}),a.jsxs("div",{className:"path-target-meta",children:[a.jsxs("small",{children:["Current: ",E.currentScore]}),a.jsxs("small",{children:["Score gap: ",Math.max(d-E.currentScore,0)]}),a.jsxs("small",{children:["Smart target: ",u]})]})]}),a.jsx("div",{className:"path-grid",children:E.plans.map(l=>a.jsxs(v.button,{className:`path-option ${N?.id===l.id?"selected":""}`,onClick:()=>k(l.id),whileHover:{y:-3},whileTap:{scale:.98},children:[a.jsxs("div",{className:"path-option-head",children:[a.jsx("strong",{children:l.title}),a.jsx("span",{className:`path-diff ${qa(l.difficulty)}`,children:l.difficulty})]}),a.jsx("p",{children:l.summary}),a.jsxs("div",{className:"path-stats",children:[a.jsxs("span",{children:["+",l.potentialGain," pts"]}),a.jsxs("span",{children:[l.estimatedMonths," months"]}),a.jsxs("span",{children:[l.likelihoodPercent,"% likely"]})]}),a.jsx("small",{children:l.goalReached?"Can likely reach your target with this path":`${l.checks.stillNeededAfterPath} pts still needed after this path`})]},l.id))}),N&&a.jsxs("div",{className:"path-detail",children:[a.jsx("h4",{children:N.title}),a.jsx("p",{className:"path-why",children:N.whyItFits}),a.jsxs("div",{className:"path-meta-line",children:[a.jsxs("span",{children:["Projected score: ",a.jsx("strong",{children:N.projectedScore})]}),a.jsxs("span",{children:["Estimated cost: ",a.jsxs("strong",{children:[N.estimatedCostCad," CAD"]})]})]}),G&&a.jsxs("div",{className:"path-meta-line",children:[a.jsxs("span",{children:["Likely completion window: ",a.jsxs("strong",{children:[G.earliestMonths,"-",G.latestMonths," months"]})]}),a.jsxs("span",{children:["Target finish dates: ",a.jsxs("strong",{children:[ne(G.earliestDate)," - ",ne(G.latestDate)]})]})]}),a.jsx("ul",{className:"path-milestones-preview",children:N.milestones.map(l=>a.jsxs("li",{children:[a.jsx("span",{children:l.title}),a.jsxs("small",{children:["~",l.etaWeeks," weeks"]})]},l.id))})]}),!r&&a.jsx("div",{className:"path-paywall",children:a.jsx("p",{children:"Log in first, then activate paid tracking (5 CAD/month) to unlock daily guidance and cloud sync."})}),r&&!A&&a.jsxs("div",{className:"path-paywall",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Tracking plan:"})," 5 CAD / month"]}),a.jsx("p",{children:"Includes expert strategy tracking, daily tasks, reminders, and cross-device progress sync."}),a.jsxs("div",{className:"path-pay-actions",children:[a.jsx("button",{className:"action-btn auth-btn-primary",disabled:ue,onClick:H,children:ue?"Opening...":"Subscribe (5 CAD/month)"}),a.jsx("button",{className:"action-btn",onClick:async()=>{if(i?.id){X(l=>({...l,loading:!0}));try{const l=await Ge(i.id);X({loading:!1,active:!!l.active,reason:l.reason||""}),_(l.active?"Subscription detected. Tracking unlocked.":"Subscription not active yet.")}catch(l){X({loading:!1,active:!1,reason:l.message||""})}}},children:Q.loading?"Checking...":"Refresh payment status"}),o]}),Q.reason&&a.jsx("small",{children:Q.reason})]}),a.jsxs("div",{className:"path-actions",children:[a.jsx(Rt,{color:"var(--primary)",speed:"5s",children:a.jsx("button",{className:"btn-next finish",type:"button",onClick:le,children:y?"Switch to this strategy":"Start this strategy"})}),y&&a.jsx("button",{className:"btn-toggle",type:"button",onClick:B,children:"Reset tracking"})]}),y&&a.jsxs("div",{className:"path-tracker",children:[a.jsxs("div",{className:"path-progress-head",children:[a.jsxs("strong",{children:["Progress: ",ce,"%"]}),a.jsxs("span",{children:["Next check-in: ",ne(y.nextCheckInAt)]})]}),a.jsx("div",{className:"path-progress-bar-wrap",children:a.jsx(v.div,{className:"path-progress-bar",initial:{width:0},animate:{width:`${ce}%`},transition:{duration:.7}})}),a.jsxs("div",{className:"path-daily-stats",children:[a.jsxs("span",{children:["Streak: ",a.jsxs("strong",{children:[F.streakDays," day(s)"]})]}),a.jsxs("span",{children:["Completed: ",a.jsxs("strong",{children:[F.completedTasks,"/",F.totalTasks]})]}),a.jsxs("span",{children:["Today: ",a.jsxs("strong",{children:[F.completedToday,"/",F.dueToday]})]}),a.jsxs("span",{className:`pace pace-${F.paceStatus}`,children:["Pace: ",a.jsx("strong",{children:Ka(F.paceStatus)})]})]}),te&&a.jsxs("div",{className:"path-coach-note",children:[a.jsx("strong",{children:"Completion forecast:"})," baseline ",ne(te.baselineDate)," · current pace ",ne(te.projectedDate)," (",Va(te),")"]}),a.jsxs("div",{className:"path-coach-note",children:[a.jsx("strong",{children:"Coach guidance:"})," ",K]}),a.jsxs("div",{className:"path-daily-section",children:[a.jsx("h5",{children:"Today's guide"}),!ee.length&&a.jsx("p",{className:"path-empty-text",children:"No task is due today. Continue with the next upcoming task."}),!!ee.length&&a.jsx("ul",{className:"path-daily-list",children:ee.map(l=>a.jsxs("li",{className:l.done?"done":"",children:[a.jsx("button",{type:"button",onClick:()=>U(l.id),disabled:!A,children:l.done?"✓":"○"}),a.jsxs("div",{children:[a.jsx("strong",{children:l.title}),a.jsx("p",{children:l.details}),a.jsxs("small",{children:[l.expectedMinutes," min planned · +",za(l.expectedGain)," projected CRS pace"]})]})]},l.id))})]}),a.jsxs("div",{className:"path-daily-section",children:[a.jsx("h5",{children:"Upcoming 7-day guide"}),!O.length&&a.jsx("p",{className:"path-empty-text",children:"No upcoming tasks yet."}),!!O.length&&a.jsx("ul",{className:"path-upcoming-list",children:O.slice(0,10).map(l=>a.jsxs("li",{children:[a.jsx("span",{children:ne(l.date)}),a.jsx("span",{children:l.title})]},l.id))})]}),a.jsx("ul",{className:"path-milestone-list",children:(y.milestones||[]).map(l=>a.jsxs("li",{className:l.done?"done":"",children:[a.jsx("button",{type:"button",onClick:()=>V(l.id),disabled:!A,children:l.done?"✓":"○"}),a.jsxs("div",{children:[a.jsx("strong",{children:l.title}),a.jsx("p",{children:l.details}),a.jsxs("small",{children:["Expected impact: +",l.expectedGain," pts · ~",l.etaWeeks," weeks"]})]})]},l.id))}),a.jsx("div",{className:"path-checkin-row",children:a.jsx("button",{className:"action-btn",type:"button",onClick:Y,disabled:!A,children:"Move next check-in by 7 days"})}),a.jsxs("div",{className:"path-note-input",children:[a.jsx("input",{type:"text",value:C,onChange:l=>L(l.target.value),placeholder:"Add blocker or update note for your next check-in..."}),a.jsx("button",{className:"action-btn",type:"button",onClick:P,disabled:!A,children:"Save note"})]})]}),I&&a.jsx("p",{className:"save-status",children:I})]})}const He={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.08}}},T={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{type:"spring",stiffness:100,damping:18}}};function qe(e){return e==="supabase"?"Live sync":"Local fallback"}function ze(e){return e==="supabase"?"draw-source-live":"draw-source-fallback"}function Za({value:e,duration:t=1.2}){const[n,s]=f.useState(0);return f.useEffect(()=>{const i=e,r=performance.now(),o=u=>{const d=(u-r)/(t*1e3);if(d>=1){s(i);return}const p=1-Math.pow(1-d,3);s(Math.round(i*p)),requestAnimationFrame(o)};requestAnimationFrame(o)},[e,t]),a.jsx(a.Fragment,{children:n})}function en({score:e,statusColor:t}){const s=2*Math.PI*54,i=Math.min(e/1200,1);return a.jsxs("div",{className:"score-gauge","aria-label":`CRS Score: ${e} out of 1200`,children:[a.jsxs("svg",{viewBox:"0 0 120 120",width:"180",height:"180",children:[a.jsx("circle",{cx:"60",cy:"60",r:54,fill:"none",stroke:"var(--surface-2)",strokeWidth:"8"}),a.jsx(v.circle,{cx:"60",cy:"60",r:54,fill:"none",stroke:t,strokeWidth:"8",strokeLinecap:"round",transform:"rotate(-90 60 60)",strokeDasharray:s,initial:{strokeDashoffset:s},animate:{strokeDashoffset:s-i*s},transition:{duration:1.4,ease:[.22,1,.36,1]}})]}),a.jsxs("div",{className:"gauge-text",children:[a.jsx("div",{className:"gauge-number","aria-live":"polite",children:a.jsx(Za,{value:e})}),a.jsx("div",{className:"gauge-max",children:"/ 1,200"})]})]})}function tn({icon:e,label:t,value:n,max:s,note:i}){const r=Math.round(n/s*100);return a.jsxs(v.div,{className:"bd-item",variants:T,children:[a.jsx("span",{className:"bd-icon",children:e}),a.jsxs("div",{className:"bd-info",children:[a.jsxs("div",{className:"bd-top",children:[a.jsxs("span",{className:"bd-label",children:[t,i&&a.jsxs("small",{className:"bd-note",children:[" (",i,")"]})]}),a.jsxs("span",{className:"bd-pts",children:[n," ",a.jsxs("small",{children:["/ ",s]})]})]}),a.jsx("div",{className:"bd-bar-bg",children:a.jsx(v.div,{className:"bd-bar-fill",initial:{width:0},animate:{width:`${r}%`},transition:{duration:.8,delay:.3,ease:"easeOut"}})})]})]})}function ke({draw:e,userScore:t}){const n=t>=e.score;return a.jsxs("div",{className:`draw-row ${n?"draw-above":"draw-below"}`,children:[a.jsx("span",{className:"draw-date",children:e.date}),a.jsx("span",{className:"draw-program",children:e.program}),a.jsx("span",{className:"draw-score",children:e.score})]})}const an=[{value:"secondary",label:"High School"},{value:"one_year_post",label:"1-Year Diploma"},{value:"two_year_post",label:"2-Year Diploma"},{value:"bachelors",label:"Bachelor's"},{value:"two_or_more",label:"2+ Credentials"},{value:"masters",label:"Master's"},{value:"doctoral",label:"PhD"}];function ve(e,t,n){return{id:e,label:t,age:n.age||"",education:n.education||"",canadianWorkExp:n.canadianWorkExp||"0",minClb:""}}function nn(e){return{5:5,6:5.5,7:6,8:6.5,9:7,10:7.5}[e]||0}function sn(e,t){const n={};if(t.age&&t.age!==e.age&&(n.age=t.age),t.education&&t.education!==e.education&&(n.education=t.education),t.canadianWorkExp&&t.canadianWorkExp!==e.canadianWorkExp&&(n.canadianWorkExp=t.canadianWorkExp),t.minClb){const s=parseInt(t.minClb,10),i=["listening","reading","writing","speaking"];if(e.langTestType==="celpip")for(const r of i){const o=`celpip_${r}`;n[o]=String(Math.max(parseInt(e[o],10)||0,s))}else{const r=nn(s);for(const o of i){const u=`ielts_${o}`;n[u]=String(Math.max(parseFloat(e[u])||0,r))}}}return Object.keys(n).length===0?null:Z(e,n)}function rn({answers:e,originalScore:t,t:n}){const[s,i]=f.useState(()=>[ve("a","Scenario A",e),ve("b","Scenario B",e)]),r=()=>{s.length>=3||i(d=>[...d,ve("c","Scenario C",e)])},o=d=>{s.length<=2||i(p=>p.filter(m=>m.id!==d))},u=(d,p)=>{i(m=>m.map(h=>h.id===d?{...h,...p}:h))};return a.jsxs("div",{className:"scenario-panel",children:[a.jsx("div",{className:"scenario-grid",children:s.map(d=>{const p=sn(e,d),m=p?p.total-t:0;return a.jsxs("div",{className:"scenario-card",children:[a.jsxs("div",{className:"scenario-head",children:[a.jsx("strong",{children:d.label}),d.id==="c"&&a.jsx("button",{type:"button",className:"scenario-remove",onClick:()=>o(d.id),children:"Remove"})]}),a.jsxs("div",{className:"wi-grid",children:[a.jsxs("label",{className:"wi-field",children:[a.jsx("span",{children:"Age"}),a.jsxs("select",{value:d.age,onChange:h=>u(d.id,{age:h.target.value}),children:[a.jsx("option",{value:"",children:"Current"}),Array.from({length:30},(h,x)=>x+18).map(h=>a.jsx("option",{value:h,children:h},h))]})]}),a.jsxs("label",{className:"wi-field",children:[a.jsx("span",{children:"Education"}),a.jsxs("select",{value:d.education,onChange:h=>u(d.id,{education:h.target.value}),children:[a.jsx("option",{value:"",children:"Current"}),an.map(h=>a.jsx("option",{value:h.value,children:h.label},h.value))]})]}),a.jsxs("label",{className:"wi-field",children:[a.jsx("span",{children:"Canadian Work (yrs)"}),a.jsx("select",{value:d.canadianWorkExp,onChange:h=>u(d.id,{canadianWorkExp:h.target.value}),children:[0,1,2,3,4,5].map(h=>a.jsx("option",{value:h,children:h},h))})]}),a.jsxs("label",{className:"wi-field",children:[a.jsx("span",{children:"Min Language CLB"}),a.jsxs("select",{value:d.minClb,onChange:h=>u(d.id,{minClb:h.target.value}),children:[a.jsx("option",{value:"",children:"Current"}),[5,6,7,8,9,10].map(h=>a.jsxs("option",{value:h,children:["CLB ",h,"+"]},h))]})]})]}),p&&a.jsx(v.div,{className:"wi-result",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:a.jsxs("div",{className:"wi-scores",children:[a.jsxs("div",{className:"wi-score-block",children:[a.jsx("small",{children:n("results.original")}),a.jsx("strong",{children:t})]}),a.jsx("span",{className:"wi-arrow",children:"→"}),a.jsxs("div",{className:"wi-score-block projected",children:[a.jsx("small",{children:n("results.projected")}),a.jsx("strong",{children:p.total})]}),a.jsxs("span",{className:`wi-delta ${m>0?"pos":m<0?"neg":""}`,children:[m>0?"+":"",m," pts"]})]})})]},d.id)})}),s.length<3&&a.jsx("button",{type:"button",className:"btn-toggle scenario-add-btn",onClick:r,children:"Add Scenario C ▼"})]})}function on(){return a.jsx(v.div,{className:"loading-screen",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,scale:.95,transition:{duration:.3}},children:a.jsx(Jt,{})})}function cn(e){const t=f.useRef(null);return f.useEffect(()=>{if(!e)return;const n=t.current;if(!n)return;const s=n.getContext("2d");n.width=window.innerWidth,n.height=window.innerHeight;const i=["#22c55e","#4CC9F0","#7C3AED","#f59e0b","#ec4899","#3A0CA3"],r=Array.from({length:120},()=>({x:Math.random()*n.width,y:Math.random()*n.height-n.height,w:Math.random()*8+4,h:Math.random()*6+2,color:i[Math.floor(Math.random()*i.length)],vx:(Math.random()-.5)*4,vy:Math.random()*3+2,rot:Math.random()*360,rv:(Math.random()-.5)*8}));let o;const u=()=>{s.clearRect(0,0,n.width,n.height);let p=!1;for(const m of r)m.x+=m.vx,m.y+=m.vy,m.rot+=m.rv,m.vy+=.05,m.y<n.height+20&&(p=!0),s.save(),s.translate(m.x,m.y),s.rotate(m.rot*Math.PI/180),s.fillStyle=m.color,s.fillRect(-m.w/2,-m.h/2,m.w,m.h),s.restore();p&&(o=requestAnimationFrame(u))};o=requestAnimationFrame(u);const d=setTimeout(()=>{cancelAnimationFrame(o),s.clearRect(0,0,n.width,n.height)},4e3);return()=>{cancelAnimationFrame(o),clearTimeout(d)}},[e]),t}async function Ke(e){try{return await navigator.clipboard.writeText(e),!0}catch{try{const t=document.createElement("textarea");return t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),!0}catch{return!1}}}function dn({answers:e,onRestart:t,drawData:n,drawSource:s="local-fallback",categoryInfo:i}){const{t:r}=Ot(),{user:o,isAuthenticated:u}=Qe(),d=n||Ht(),p=f.useMemo(()=>Array.isArray(i)&&i.length>0?i:Gt(),[i]),[m,h]=f.useState(!0),[x,k]=f.useState(!1),[y,g]=f.useState(!1),[C,L]=f.useState(!1),[I,_]=f.useState(!1),[ue,oe]=f.useState(!1),[Q,X]=f.useState(""),[$,E]=f.useState(""),[N,A]=f.useState(!1),[ce,K]=f.useState(""),[F,ee]=f.useState(!1),[O,te]=f.useState(()=>`${window.location.origin}${window.location.pathname}#${Ut(e)}`),[G,W]=f.useState([]),[le,V]=f.useState("idle");f.useEffect(()=>{const c=setTimeout(()=>h(!1),2500);return()=>clearTimeout(c)},[]);const U=f.useMemo(()=>{if(e.knowsScore==="yes"){const c=parseInt(e.scoreRange,10)||400;return{total:c,breakdown:{coreHumanCapital:c,spouseFactors:0,skillTransferability:0,additionalPoints:0},details:{age:0,education:0,firstLanguage:0,secondLanguage:0,canadianWork:0,foreignWork:0,spouseTotal:0,skillTotal:0,additionalTotal:0}}}return at(e)},[e]),Y=e.knowsScore!=="yes",P=U.total,B=d.averageCutoff,H=P-B,l=qt();f.useEffect(()=>{if(!u||!l||!o?.id){W([]),V("idle");return}let c=!0;return V("loading"),We(o.id).then(S=>{c&&(S.status==="ok"?(W(S.data||[]),V("ready")):(W([]),V("empty")))}).catch(()=>{c&&V("error")}),()=>{c=!1}},[l,u,o?.id]);const b=H>=20?{cls:"above",marker:"+",title:"Great News!",desc:`Your score is ${H} points above the recent cut-off (${B}). You have a strong chance of receiving an Invitation to Apply.`,color:"#22c55e"}:H>=-10?{cls:"close",marker:"~",title:"Almost There!",desc:`You're just ${Math.abs(H)} points ${H>=0?"above":"below"} the recent cut-off (${B}). A few small improvements could make the difference.`,color:"#f59e0b"}:{cls:"below",marker:"—",title:"Room to Improve",desc:`You're ${Math.abs(H)} points below the recent cut-off (${B}). Don't worry — see the suggestions below to boost your score.`,color:"#ef4444"},w=f.useMemo(()=>la(e,U),[e,U]),R=f.useMemo(()=>da(U),[U]),M=U.details,he=f.useMemo(()=>{const c=[{icon:"A",label:"Age",value:M.age,max:110},{icon:"E",label:"Education",value:M.education,max:150},{icon:"L",label:"English Language",value:M.firstLanguage,max:136},{icon:"W",label:"Canadian Work",value:M.canadianWork,max:80}];return M.secondLanguage>0&&c.splice(3,0,{icon:"F",label:"French",value:M.secondLanguage,max:24}),M.foreignWork>0?c.push({icon:"S",label:r("results.foreignWork"),value:M.skillTotal,max:100,note:"via skill transferability"}):c.push({icon:"S",label:"Skill Bonus",value:M.skillTotal,max:100}),M.spouseTotal>0&&c.push({icon:"P",label:"Spouse",value:M.spouseTotal,max:40}),M.additionalTotal>0&&c.push({icon:"+",label:"Bonus Points",value:M.additionalTotal,max:600}),c},[M,r]),ft=w.slice(0,3),ye=w.slice(3),xe=Yt[e.pathway],Ie=f.useMemo(()=>Y?ma(e):[],[e,Y]),De=!m&&H>=20,gt=cn(De),yt=async()=>{try{if(navigator.share){await navigator.share({title:"My CRS Score",text:`My CRS score is ${P}/1200!`,url:O});return}}catch{}await Ke(O)&&(oe(!0),setTimeout(()=>oe(!1),2e3))},xt=()=>{const c=Math.max(470,B),S=`My CRS = ${P} — see how to reach ${c}+`,q=`https://twitter.com/intent/tweet?text=${encodeURIComponent(S)}&url=${encodeURIComponent(O)}`;window.open(q,"_blank","noopener,noreferrer")},bt=async()=>{const c=$.trim()||o?.email||"";if(N&&!c){K("Add an email to enable draw alerts (or sign in).");return}if(c&&!/^\S+@\S+\.\S+$/.test(c)){K("Please enter a valid email address.");return}const S=zt({name:Q.trim(),answers:e,score:P,email:c,alertOptIn:!!N&&!!c}),q=Kt(S.id,e);te(q),ee(!0);try{if(c||N)if((await Vt(S,{userId:o?.id||null})).status==="ok"){if(u&&o?.id){const Fe=await We(o.id);Fe.status==="ok"&&(W(Fe.data||[]),V("ready"))}K(N?"Profile saved, synced, and draw alerts subscribed.":"Profile saved and synced with your account.")}else K("Profile saved locally. Configure Supabase env vars to enable cloud sync/alerts.");else K("Profile saved locally with a unique shareable link.")}catch($e){K(`Profile saved locally, but cloud sync failed: ${$e.message}`)}finally{ee(!1)}},kt=()=>window.print(),ae=c=>{const S=document.getElementById(c);if(!S)return;const q=S.getBoundingClientRect().top+window.scrollY-90;window.scrollTo({top:Math.max(0,q),behavior:"smooth"})};return m?a.jsx(on,{}):a.jsxs(v.div,{className:"results",variants:He,initial:"hidden",animate:"show",exit:{opacity:0,transition:{duration:.2}},children:[De&&a.jsx("canvas",{ref:gt,className:"confetti-canvas"}),a.jsx(v.div,{className:"score-hero",variants:T,children:a.jsx(en,{score:P,statusColor:b.color})}),a.jsxs(v.div,{className:"result-actions",variants:T,children:[a.jsx("button",{className:"action-btn",onClick:yt,"aria-label":"Share results",children:ue?"✓ Copied!":r("results.share")}),a.jsx("button",{className:"action-btn",onClick:xt,"aria-label":"Tweet score",children:"Share on X"}),a.jsx("button",{className:"action-btn",onClick:kt,"aria-label":"Download PDF",children:r("results.pdf")})]}),a.jsxs(v.div,{className:"card quick-nav-card",variants:T,children:[a.jsx("h3",{children:"Quick navigation"}),a.jsxs("div",{className:"quick-nav-grid",children:[a.jsx("button",{type:"button",className:"action-btn",onClick:()=>ae("section-save"),children:"Save profile"}),a.jsx("button",{type:"button",className:"action-btn",onClick:()=>ae("section-breakdown"),children:"Score breakdown"}),a.jsx("button",{type:"button",className:"action-btn",onClick:()=>ae("section-improve"),children:"Improve score"}),a.jsx("button",{type:"button",className:"action-btn",onClick:()=>ae("section-coach"),children:"Expert strategy"}),a.jsx("button",{type:"button",className:"action-btn",onClick:()=>ae("section-category"),children:"Category draws"}),a.jsx("button",{type:"button",className:"action-btn",onClick:()=>ae("section-draws"),children:"Recent draws"})]})]}),a.jsxs(v.div,{className:`card status-card ${b.cls}-card`,variants:T,children:[a.jsxs("div",{className:"status-header",children:[a.jsx("span",{className:`status-marker ${b.cls}`,children:b.marker})," ",a.jsx("strong",{children:b.title})]}),a.jsx("p",{className:"status-desc",children:b.desc}),a.jsxs("div",{className:`draw-source-pill ${ze(s)}`,children:["Draw data source: ",qe(s)," · Updated ",d.lastUpdated||"—"]}),a.jsxs("div",{className:"cutoff-compare",children:[a.jsx(Ve,{label:"Your Score",value:P,max:Math.max(P,B,600),color:"var(--primary)"}),a.jsx(Ve,{label:"Cut-off",value:B,max:Math.max(P,B,600),color:"var(--surface-3)"})]})]}),a.jsxs(v.div,{className:"card save-profile-card",variants:T,id:"section-save",children:[a.jsx("h3",{children:"Save & share your profile"}),a.jsx("p",{className:"cat-intro",children:"Save this result, generate a unique URL, and optionally subscribe to draw alerts."}),u?a.jsxs("p",{className:"save-note",children:["Signed in as ",o.email,". Saves are synced across your devices."]}):a.jsx("p",{className:"save-note",children:"Tip: sign in to sync profiles and score tracking across devices."}),a.jsxs("div",{className:"save-grid",children:[a.jsxs("label",{className:"wi-field",children:[a.jsx("span",{children:"Profile name (optional)"}),a.jsx("input",{value:Q,onChange:c=>X(c.target.value),placeholder:"e.g., Feb 2026 Profile"})]}),a.jsxs("label",{className:"wi-field",children:[a.jsx("span",{children:"Email (optional)"}),a.jsx("input",{value:$,onChange:c=>E(c.target.value),placeholder:"you@example.com"})]})]}),a.jsxs("label",{className:"save-alert-row",children:[a.jsx("input",{type:"checkbox",checked:N,onChange:c=>A(c.target.checked)}),a.jsx("span",{children:"Notify me by email when my score is at/above the latest cutoff"})]}),!l&&a.jsx("p",{className:"save-note",children:"Cloud alerts need Supabase env vars (`VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`)."}),a.jsxs("div",{className:"save-actions",children:[a.jsx("button",{className:"action-btn",onClick:bt,disabled:F,children:F?"Saving…":"Save Profile"}),a.jsx("button",{className:"action-btn",onClick:()=>Ke(O),children:"Copy Share URL"})]}),a.jsx("p",{className:"save-url",children:O}),ce&&a.jsx("p",{className:"save-status",children:ce}),u&&a.jsxs("div",{className:"save-synced-list",children:[a.jsx("h4",{children:"Synced profiles"}),le==="loading"&&a.jsx("p",{className:"save-note",children:"Loading your synced profiles..."}),le==="error"&&a.jsx("p",{className:"save-note",children:"Could not load synced profiles right now."}),le!=="loading"&&G.length===0&&a.jsx("p",{className:"save-note",children:"No synced profiles yet. Save your current result to start tracking."}),G.length>0&&a.jsx("ul",{className:"save-synced-items",children:G.slice(0,5).map(c=>a.jsxs("li",{children:[a.jsx("span",{children:c.name||c.id}),a.jsx("strong",{children:c.score})]},c.id))})]})]}),Y&&a.jsxs(v.div,{className:"card",variants:T,id:"section-category",children:[a.jsx("h3",{children:r("results.breakdown")}),a.jsx(v.div,{className:"breakdown-grid",variants:He,initial:"hidden",animate:"show",children:he.map(c=>a.jsx(tn,{...c},c.label))}),a.jsxs("div",{className:"bd-total",children:[a.jsx("span",{children:"Total CRS Score"}),a.jsx("span",{className:"bd-total-num",children:P})]})]}),Y&&a.jsxs(v.div,{className:"card whatif-card",variants:T,children:[a.jsxs("h3",{className:"draws-toggle",onClick:()=>L(!C),children:["Scenario Compare (A vs B) ",a.jsx("span",{className:"toggle-arrow",children:C?"▲":"▼"})]}),C&&a.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},children:[a.jsx("p",{className:"cat-intro",children:r("results.whatifDesc")}),a.jsx(rn,{answers:e,originalScore:P,t:r})]})]}),w.length>0&&a.jsxs(v.div,{className:"card",variants:T,id:"section-improve",children:[a.jsx("h3",{children:r("results.improve")}),ft.map((c,S)=>a.jsxs(v.div,{className:"action-card",variants:T,children:[a.jsx("div",{className:"action-rank",children:S+1}),a.jsxs("div",{className:"action-body",children:[a.jsxs("div",{className:"action-title",children:[c.title,c.potentialGain>0&&a.jsxs("span",{className:"action-badge",children:["+",c.potentialGain," pts"]})]}),a.jsx("div",{className:"action-desc",children:c.description}),c.action&&a.jsx("div",{className:"action-specific",children:c.action}),a.jsxs("div",{className:"action-meta",children:[a.jsx("span",{className:"action-time",children:c.timeframe}),a.jsx("span",{className:`action-diff diff-${c.difficulty.toLowerCase()}`,children:c.difficulty})]})]})]},S)),ye.length>0&&a.jsxs(a.Fragment,{children:[x&&ye.map((c,S)=>a.jsxs(v.div,{className:"action-card",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[a.jsx("div",{className:"action-rank",children:S+4}),a.jsxs("div",{className:"action-body",children:[a.jsxs("div",{className:"action-title",children:[c.title,c.potentialGain>0&&a.jsxs("span",{className:"action-badge",children:["+",c.potentialGain," pts"]})]}),a.jsx("div",{className:"action-desc",children:c.description}),c.action&&a.jsx("div",{className:"action-specific",children:c.action}),a.jsxs("div",{className:"action-meta",children:[a.jsx("span",{className:"action-time",children:c.timeframe}),a.jsx("span",{className:`action-diff diff-${c.difficulty.toLowerCase()}`,children:c.difficulty})]})]})]},S+3)),a.jsx("button",{className:"btn-toggle",onClick:()=>k(!x),children:x?"Show fewer ▲":`Show ${ye.length} more suggestions ▼`})]})]}),Y&&a.jsx("div",{id:"section-coach",children:a.jsx(Xa,{answers:e,result:U,averageCutoff:d.averageCutoff,categoryInfo:p})}),Y&&a.jsxs(v.div,{className:"card",variants:T,id:"section-category",children:[a.jsx("h3",{children:r("results.category")}),a.jsx("p",{className:"cat-intro",children:r("results.catIntro")}),a.jsx("div",{className:"cat-grid",children:p.map(c=>{const S=c.check(e),q=S&&P>=c.recentCutoff;return a.jsxs(v.div,{className:`cat-card ${S?q?"cat-above":"cat-eligible":"cat-na"}`,variants:T,children:[a.jsxs("div",{className:"cat-header",children:[a.jsx("span",{className:"cat-icon",children:c.icon}),a.jsxs("div",{children:[a.jsx("strong",{className:"cat-name",children:c.name}),S&&a.jsx("span",{className:`cat-badge ${q?"badge-above":"badge-eligible"}`,children:q?"Above Cutoff":"Eligible"}),!S&&a.jsx("span",{className:"cat-badge badge-na",children:"Not Eligible"})]})]}),a.jsx("p",{className:"cat-desc",children:c.description}),a.jsxs("div",{className:"cat-cutoff",children:[a.jsxs("span",{children:["Recent cutoff: ",a.jsx("strong",{children:c.recentCutoff})]}),a.jsxs("span",{className:"cat-range",children:["Range: ",c.cutoffRange]})]}),!S&&a.jsx("p",{className:"cat-req",children:c.eligibility})]},c.id)})})]}),Y&&Ie.length>0&&a.jsxs(v.div,{className:"card",variants:T,children:[a.jsxs("h3",{className:"draws-toggle",onClick:()=>_(!I),children:["Province Recommender ",a.jsx("span",{className:"toggle-arrow",children:I?"▲":"▼"})]}),I&&a.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},children:[a.jsx("p",{className:"cat-intro",children:"Based on your profile, these provinces may be good matches for Provincial Nominee Programs."}),a.jsx("div",{className:"prov-grid",children:Ie.slice(0,5).map(c=>a.jsxs("div",{className:"prov-card",children:[a.jsxs("div",{className:"prov-header",children:[a.jsx("span",{className:"prov-abbr",children:c.abbr}),a.jsxs("div",{children:[a.jsx("strong",{className:"prov-name",children:c.name}),a.jsxs("span",{className:`prov-match ${c.matchScore>=70?"match-high":c.matchScore>=40?"match-mid":"match-low"}`,children:[c.matchScore,"% match"]})]})]}),a.jsx("div",{className:"prov-bar-wrap",children:a.jsx(v.div,{className:"prov-bar",initial:{width:0},animate:{width:`${c.matchScore}%`},transition:{duration:.8,ease:"easeOut"},style:{background:c.matchScore>=70?"#22c55e":c.matchScore>=40?"#f59e0b":"var(--surface-3)"}})}),a.jsx("p",{className:"prov-notes",children:c.notes})]},c.id))})]})]}),a.jsxs(v.div,{className:"card",variants:T,id:"section-timeline",children:[a.jsx("h3",{children:r("results.timeline")}),a.jsxs("div",{className:`timeline-badge tl-${b.cls}`,children:[a.jsx("strong",{children:R.label})," — est. ",R.months," months"]}),a.jsx("p",{className:"timeline-desc",children:R.description})]}),a.jsxs(v.div,{className:"card",variants:T,id:"section-draws",children:[a.jsxs("h3",{className:"draws-toggle",onClick:()=>g(!y),children:[r("results.draws")," ",a.jsx("span",{className:"toggle-arrow",children:y?"▲":"▼"})]}),a.jsxs("div",{className:`draw-source-pill ${ze(s)}`,children:["Source: ",qe(s)," · Updated ",d.lastUpdated||"—"]}),y&&a.jsxs(v.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"draws-content",children:[a.jsx("h4",{className:"draws-subhead",children:"General / CEC Draws"}),d.generalProgram.slice(0,4).map((c,S)=>a.jsx(ke,{draw:c,userScore:P},`g${S}`)),a.jsx("h4",{className:"draws-subhead",children:"Category-Based Draws"}),d.categoryBased.slice(0,4).map((c,S)=>a.jsx(ke,{draw:c,userScore:P},`c${S}`)),!!d.pnpDraws?.length&&a.jsxs(a.Fragment,{children:[a.jsx("h4",{className:"draws-subhead",children:"Provincial Nominee (PNP)"}),d.pnpDraws.slice(0,3).map((c,S)=>a.jsx(ke,{draw:c,userScore:P},`p${S}`))]})]})]}),xe&&a.jsxs(v.div,{className:"card",variants:T,children:[a.jsxs("h3",{children:[xe.name," Requirements"]}),a.jsx("ul",{className:"pathway-list",children:xe.requirements.map((c,S)=>a.jsx("li",{children:c},S))})]}),a.jsx(v.div,{className:"card disclaimer",variants:T,children:a.jsxs("p",{children:[a.jsx("strong",{children:"Disclaimer:"})," ",r("results.disclaimer")," ",a.jsx("a",{href:"https://www.canada.ca/en/immigration-refugees-citizenship.html",target:"_blank",rel:"noopener noreferrer",children:"canada.ca"})]})}),a.jsx(v.button,{className:"btn-restart",onClick:t,whileHover:{scale:1.03},whileTap:{scale:.96},variants:T,children:r("results.restart")})]})}function Ve({label:e,value:t,max:n,color:s}){const i=Math.round(t/n*100);return a.jsxs("div",{className:"cutoff-row",children:[a.jsx("span",{className:"cutoff-label",children:e}),a.jsx("div",{className:"cutoff-bar-wrap",children:a.jsx(v.div,{className:"cutoff-bar",style:{background:s},initial:{width:0},animate:{width:`${i}%`},transition:{duration:.8,ease:"easeOut"},children:t})})]})}export{dn as default};
